/*
	Generated By : Steps Code Generator.
	Version : 2024
	Generated On : Thu Feb 12 2026 17:16:33 GMT+0530 (India Standard Time)
	Description : Client Logic for BCSSteam ListDetails.
	Warning : DON"T TOUCH THE BASE CODE 
*/


var currAppName = 'BCSSteam';
var isCustom = false;
var msCheck = 0;
var loadCheck = 0;
var contentView, formView, formClose;
var steamFlowMeterTable;


var steamFlowMeterVendor_idZoom;
var steamFlowMeterWorking_principle_idZoom;
var steamFlowMeterSize_idZoom;
var steamFlowMeterInput_power_idZoom;
var steamFlowMeterOutput_signal_idZoom;
var createSteamFlowMeterBtn, addSteamFlowMeterBtn, cancelBtns, duplicateSteamFlowMeterBtn, deleteSteamFlowMeterBtn, editSteamFlowMeterBtn, importSteamFlowMeterBtn, aiAssistantSteamFlowMeterBtn;
var cancelCreateBtn, cancelUpdateBtn;
var selectedRow;
var userObj;
var scrypto;
var params;
var rowData;
var backBtn;
var tourMsgs = [];
var primaryArr = [];
var chunkSize = 30;
var currentIndex = 0;
var offset = 0;
var limit = 100;
var limCookieSet = null;
var offCookieSet = null;
var loadMore, loadAll;
var actionsSelect;


var language = "EN";
var dlgOptions = {
  "STR_OK": "OK",
  "STR_CANCEL": "Cancel",
  "STR_YES": "Yes",
  "STR_NO": "No"
};

var filterSteamFlowMeterBtn, filterActionsSteamFlowMeterBtn;
var selectFilters;
var searchOptsTables = [];
var filterContent;

var numberFormat, currencyFormat, onlyNumRegExp, localeCode = null,
  currency = null;
var localeObj = {};
onlyNumRegExp = new RegExp(/^[0-9]*.?[0-9]*$/);

var actionsSelectOptionsArr = []
var steamFlowMeterSfm_code, steamFlowMeterSfm_description, steamFlowMeterVendor_id, steamFlowMeterModel_no, steamFlowMeterSerial_no, steamFlowMeterYear_of_manufacturing, steamFlowMeterWorking_principle_id, steamFlowMeterSize_id, steamFlowMeterFlow_rate_min, steamFlowMeterFlow_rate_max, steamFlowMeterInput_power_id, steamFlowMeterOutput_signal_id, steamFlowMeterConnected_tnpcb, steamFlowMeterTnpcb_ref, steamFlowMeterConnected_cpcb, steamFlowMeterCpcb_ref, steamFlowMeterIsactive, steamFlowMeterRemarks;
var vendorArr;
var vendor_idPnl, vendor_idAddBtn, vendor_idMobBackBtn, assignVendor_idBtn, cancelVendor_idBtn, searchVendor_idBox, vendor_idTable;
var selectedVendor_idId;
var workingPrincipleArr;
var working_principle_idPnl, working_principle_idAddBtn, working_principle_idMobBackBtn, assignWorking_principle_idBtn, cancelWorking_principle_idBtn, searchWorking_principle_idBox, working_principle_idTable;
var selectedWorking_principle_idId;
var sizeArr;
var size_idPnl, size_idAddBtn, size_idMobBackBtn, assignSize_idBtn, cancelSize_idBtn, searchSize_idBox, size_idTable;
var selectedSize_idId;
var inputPowerArr;
var input_power_idPnl, input_power_idAddBtn, input_power_idMobBackBtn, assignInput_power_idBtn, cancelInput_power_idBtn, searchInput_power_idBox, input_power_idTable;
var selectedInput_power_idId;
var outputSignalArr;
var output_signal_idPnl, output_signal_idAddBtn, output_signal_idMobBackBtn, assignOutput_signal_idBtn, cancelOutput_signal_idBtn, searchOutput_signal_idBox, output_signal_idTable;
var selectedOutput_signal_idId;

var dataSources = {};
var customDtOpns = {};
$(document).ready(onApplicationReady);


function onApplicationReady() {
  var qStr = window.location.search;

  if (qStr) {
    params = clCommon.getParams(qStr.substring(1, qStr.length));
  }

  setMenu(document.getElementById('sideMenu'), 'bcssteam_steamFlowMeter');


  clCommon.showLoader('svcProgress');
  var url = "/sauth/getuser";
  clCommon.getSvc(true, url, onUser, onUserError);
}


function initControls() {
  contentView = document.getElementById('contentView');
  formView = document.getElementById('steamFlowMeterDetailsPanel');
  formClose = document.getElementById('formClose');
  if (clCommon.isMobile()) {
    clCommon.hide(formClose);
    hideForm();
  } else {
    var formContent = document.querySelector('.form-content-holder');
    formContent.classList.add('expand');
  }

  cancelCreateBtn = document.getElementById('cancelCreateBtn');
  cancelUpdateBtn = document.getElementById('cancelUpdateBtn');

  filterContent = document.getElementById("filterContent");
  selectFilters = document.getElementById("selectFilters");

  // Set initial state of Cancel buttons based on Cookie
  var isFullCookie = clCommon.getCookie("bcssteam_full_view");
  if (isFullCookie === "true") {
    clCommon.show(cancelCreateBtn);
    clCommon.show(cancelUpdateBtn);
  } else {
    clCommon.hide(cancelCreateBtn);
    clCommon.hide(cancelUpdateBtn);
  }

  steamFlowMeterSfm_code = document.getElementById('steamFlowMeterSfm_code');
  steamFlowMeterSfm_description = document.getElementById('steamFlowMeterSfm_description');
  steamFlowMeterVendor_id = document.getElementById('steamFlowMeterVendor_id');
  steamFlowMeterModel_no = document.getElementById('steamFlowMeterModel_no');
  steamFlowMeterSerial_no = document.getElementById('steamFlowMeterSerial_no');
  steamFlowMeterYear_of_manufacturing = document.getElementById('steamFlowMeterYear_of_manufacturing');
  steamFlowMeterWorking_principle_id = document.getElementById('steamFlowMeterWorking_principle_id');
  steamFlowMeterSize_id = document.getElementById('steamFlowMeterSize_id');
  steamFlowMeterFlow_rate_min = document.getElementById('steamFlowMeterFlow_rate_min');
  steamFlowMeterFlow_rate_max = document.getElementById('steamFlowMeterFlow_rate_max');
  steamFlowMeterInput_power_id = document.getElementById('steamFlowMeterInput_power_id');
  steamFlowMeterOutput_signal_id = document.getElementById('steamFlowMeterOutput_signal_id');
  steamFlowMeterConnected_tnpcb = document.getElementById('steamFlowMeterConnected_tnpcb');
  steamFlowMeterTnpcb_ref = document.getElementById('steamFlowMeterTnpcb_ref');
  steamFlowMeterConnected_cpcb = document.getElementById('steamFlowMeterConnected_cpcb');
  steamFlowMeterCpcb_ref = document.getElementById('steamFlowMeterCpcb_ref');
  steamFlowMeterIsactive = document.getElementById('steamFlowMeterIsactive');
  steamFlowMeterRemarks = document.getElementById('steamFlowMeterRemarks');

}


function initTable() {
  var dtOpns = { //Funtion to display datatable
    data: [], //Sort array and set data
    scrollY: (document.querySelector(".content-list").offsetHeight - 200) + "px",
    autoWidth: false,
    columns: [{
      data: 'sfm_code',
      render: renderData,
    }, {
      data: 'vendor_id',
      render: renderData,
    }, {
      data: 'connected_tnpcb',
      render: renderData,
    }, {
      data: 'connected_cpcb',
      render: renderData,
    }, {
      data: 'isactive',
      render: renderData,
    }],
    "columnDefs": [],
    "orderClasses": false,
    "language": Strings.DATA_TABLE_LANG,
    "order": [], //to display the array sorted
    "deferRender": true
  };

  if (clCommon.isMobile())
    delete dtOpns.scrollY;

  if (Object.keys(customDtOpns).length > 0) {
    for (var opn in customDtOpns) {
      dtOpns[opn] = customDtOpns[opn];
    }
  }
  steamFlowMeterTable = $('#tableHolder').DataTable(dtOpns);



  if (!clCommon.isMobile()) {
    resizeTable();

    window.onresize = function(e) {
      resizeTable();
    };
  }
}

function renderData(data, type, row, meta) {
  var dataDisplay;
  if (SteamFlowMeterInterface && SteamFlowMeterInterface.renderData)
    dataDisplay = SteamFlowMeterInterface.renderData(data, type, row, meta);
  if (!dataDisplay || dataDisplay == null || dataDisplay == undefined) {
    dataDisplay = data;
  }

  var isFullCookie = clCommon.getCookie("bcssteam_full_view");

  if (!clCommon.isMobile() && isFullCookie === "true" && meta.col === 0) {
    return '<a href="javascript:void(0);" class="open-full-view-link">' + dataDisplay + '</a>';
  }

  if (!clCommon.isMobile()) resizeTable();

  return dataDisplay;
}

//To set the size of the table dynamically.
function resizeTable() {
  //Dont resize when listview is hidden
  if (contentView.classList.contains("hide")) {
    return;
  }
  setTimeout(setTableHeightOnResize, 50);

}

function setTableHeightOnResize() {
  // Get the height of the content list element
  var contListOffHeight = document.querySelector('.content-list').offsetHeight;

  // Get the height of the list head
  var listHeadOffHeight = document.querySelector('.listHead').offsetHeight;

  // Calculate and set the height of the list holder by subtracting the list head height from the content list height
  var listHolder = document.querySelector(".list-holder");
  listHolder.style.height = contListOffHeight - listHeadOffHeight + "px";

  // Get the heights of various DataTable elements
  var dtScrHeadClientHeight = document.querySelector('.dataTables_scrollHead').clientHeight; // DataTable scroll head height
  var dtFiltOfHeight = document.querySelector('.dataTables_filter').offsetHeight; // DataTable filter height
  var dtPagenateHeight = document.querySelector('.dataTables_paginate').offsetHeight; // DataTable pagination height

  // Set an additional offset to prevent the table from being too close to the bottom of the screen
  var addlOffSet = 10;

  // Calculate and set the height of the DataTable scroll body by subtracting the heights of the scroll head, filter, and pagination elements
  var scrollBodyHeight = listHolder.offsetHeight - dtScrHeadClientHeight - dtPagenateHeight - dtFiltOfHeight - addlOffSet;
  document.querySelector('div.dataTables_scrollBody').style.height = scrollBodyHeight + "px";

  // Adjust the DataTable columns after resizing
  steamFlowMeterTable.columns.adjust();
}



function registerEventListeners() {

  filterSteamFlowMeterBtn = document.getElementById('filterSteamFlowMeterBtn');
  filterSteamFlowMeterBtn.addEventListener('click', onFilterSteamFlowMeterBtnClick);

  formClose.addEventListener('click', toggleFullview);

  cancelBtns = document.querySelectorAll('.cancel-form-btn');
  cancelBtns.forEach(function(btn) {
    btn.addEventListener('click', onFormBackBtnClick);
  });
  if (clCommon.isMobile()) {
    cancelBtns = document.querySelectorAll('.cancel-form-btn');
    cancelBtns.forEach(function(btn) {
      clCommon.hide(btn);
    });
  }

  filterActionsSteamFlowMeterBtn = document.getElementById('filterActionsSteamFlowMeterBtn');
  filterActionsSteamFlowMeterBtn.addEventListener('click', onFilterSteamFlowMeterBtnClick);

  createSteamFlowMeterBtn = document.getElementById('createSteamFlowMeterBtn');
  createSteamFlowMeterBtn.addEventListener('click', onCreateSteamFlowMeterBtnClick);

  editSteamFlowMeterBtn = document.getElementById('updateSteamFlowMeterBtn');
  editSteamFlowMeterBtn.addEventListener('click', onUpdateSteamFlowMeterBtnClick);

  addSteamFlowMeterBtn = document.getElementById('addSteamFlowMeterBtn');
  addSteamFlowMeterBtn.addEventListener('click', onAddSteamFlowMeterBtnClick);



  if (clCommon.isMobile()) {
    deleteSteamFlowMeterBtn = document.getElementById('deleteSteamFlowMeterMobBtn');
    clCommon.hide(document.getElementById('deleteSteamFlowMeterBtn'));
  } else {
    deleteSteamFlowMeterBtn = document.getElementById('deleteSteamFlowMeterBtn');
  }
  deleteSteamFlowMeterBtn.addEventListener('click', onDeleteSteamFlowMeterBtnClick);







  loadMore = document.getElementById("loadMore");
  loadMore.addEventListener('click', onToolBarBtnClick);

  loadAll = document.getElementById("loadAll");
  loadAll.addEventListener('click', onToolBarBtnClick);

  steamFlowMeterSfm_code.addEventListener('change', onFieldChange);
  steamFlowMeterSfm_code.addEventListener('focus', onFieldFocus);
  steamFlowMeterSfm_code.addEventListener('blur', onFieldChange);
  steamFlowMeterSfm_description.addEventListener('change', onFieldChange);
  steamFlowMeterSfm_description.addEventListener('focus', onFieldFocus);
  steamFlowMeterSfm_description.addEventListener('blur', onFieldChange);
  steamFlowMeterVendor_id.addEventListener('change', onFieldChange);
  steamFlowMeterVendor_id.addEventListener('focus', onFieldFocus);
  steamFlowMeterVendor_id.addEventListener('blur', onFieldChange);

  steamFlowMeterVendor_idZoom = document.getElementById('steamFlowMeterVendor_idZoom');
  steamFlowMeterVendor_idZoom.addEventListener('click', onToolBarBtnClick);


  vendor_idPnl = document.getElementById("vendor_idPnl");

  vendor_idAddBtn = document.getElementById('vendor_idAddBtn');
  vendor_idAddBtn.addEventListener('click', onLookupAddBtnClick);

  vendor_idMobBackBtn = document.getElementById('vendor_idMobBackBtn');
  vendor_idMobBackBtn.addEventListener('click', onVendor_idMobBackBtn);

  relateVendor_idBtn = document.getElementById('assignVendor_idBtn');
  relateVendor_idBtn.addEventListener('click', onRelateVendor_idBtn);

  cancelVendor_idBtn = document.getElementById('cancelVendor_idBtn');
  cancelVendor_idBtn.addEventListener('click', onCancelVendor_idBtn);

  searchVendor_idBox = document.getElementById('searchVendor_idBox');
  searchVendor_idBox.addEventListener('keyup', onSearchVendor_id);
  steamFlowMeterModel_no.addEventListener('change', onFieldChange);
  steamFlowMeterModel_no.addEventListener('focus', onFieldFocus);
  steamFlowMeterModel_no.addEventListener('blur', onFieldChange);
  steamFlowMeterSerial_no.addEventListener('change', onFieldChange);
  steamFlowMeterSerial_no.addEventListener('focus', onFieldFocus);
  steamFlowMeterSerial_no.addEventListener('blur', onFieldChange);
  steamFlowMeterYear_of_manufacturing.addEventListener('change', onFieldChange);
  steamFlowMeterYear_of_manufacturing.addEventListener('focus', onFieldFocus);
  steamFlowMeterYear_of_manufacturing.addEventListener('blur', onFieldChange);
  steamFlowMeterWorking_principle_id.addEventListener('change', onFieldChange);
  steamFlowMeterWorking_principle_id.addEventListener('focus', onFieldFocus);
  steamFlowMeterWorking_principle_id.addEventListener('blur', onFieldChange);

  steamFlowMeterWorking_principle_idZoom = document.getElementById('steamFlowMeterWorking_principle_idZoom');
  steamFlowMeterWorking_principle_idZoom.addEventListener('click', onToolBarBtnClick);


  working_principle_idPnl = document.getElementById("working_principle_idPnl");

  working_principle_idAddBtn = document.getElementById('working_principle_idAddBtn');
  working_principle_idAddBtn.addEventListener('click', onLookupAddBtnClick);

  working_principle_idMobBackBtn = document.getElementById('working_principle_idMobBackBtn');
  working_principle_idMobBackBtn.addEventListener('click', onWorking_principle_idMobBackBtn);

  relateWorking_principle_idBtn = document.getElementById('assignWorking_principle_idBtn');
  relateWorking_principle_idBtn.addEventListener('click', onRelateWorking_principle_idBtn);

  cancelWorking_principle_idBtn = document.getElementById('cancelWorking_principle_idBtn');
  cancelWorking_principle_idBtn.addEventListener('click', onCancelWorking_principle_idBtn);

  searchWorking_principle_idBox = document.getElementById('searchWorking_principle_idBox');
  searchWorking_principle_idBox.addEventListener('keyup', onSearchWorking_principle_id);
  steamFlowMeterSize_id.addEventListener('change', onFieldChange);
  steamFlowMeterSize_id.addEventListener('focus', onFieldFocus);
  steamFlowMeterSize_id.addEventListener('blur', onFieldChange);

  steamFlowMeterSize_idZoom = document.getElementById('steamFlowMeterSize_idZoom');
  steamFlowMeterSize_idZoom.addEventListener('click', onToolBarBtnClick);


  size_idPnl = document.getElementById("size_idPnl");

  size_idAddBtn = document.getElementById('size_idAddBtn');
  size_idAddBtn.addEventListener('click', onLookupAddBtnClick);

  size_idMobBackBtn = document.getElementById('size_idMobBackBtn');
  size_idMobBackBtn.addEventListener('click', onSize_idMobBackBtn);

  relateSize_idBtn = document.getElementById('assignSize_idBtn');
  relateSize_idBtn.addEventListener('click', onRelateSize_idBtn);

  cancelSize_idBtn = document.getElementById('cancelSize_idBtn');
  cancelSize_idBtn.addEventListener('click', onCancelSize_idBtn);

  searchSize_idBox = document.getElementById('searchSize_idBox');
  searchSize_idBox.addEventListener('keyup', onSearchSize_id);
  steamFlowMeterFlow_rate_min.addEventListener('change', onFieldChange);
  steamFlowMeterFlow_rate_min.addEventListener('focus', onFieldFocus);
  steamFlowMeterFlow_rate_min.addEventListener('blur', onFieldChange);
  steamFlowMeterFlow_rate_max.addEventListener('change', onFieldChange);
  steamFlowMeterFlow_rate_max.addEventListener('focus', onFieldFocus);
  steamFlowMeterFlow_rate_max.addEventListener('blur', onFieldChange);
  steamFlowMeterInput_power_id.addEventListener('change', onFieldChange);
  steamFlowMeterInput_power_id.addEventListener('focus', onFieldFocus);
  steamFlowMeterInput_power_id.addEventListener('blur', onFieldChange);

  steamFlowMeterInput_power_idZoom = document.getElementById('steamFlowMeterInput_power_idZoom');
  steamFlowMeterInput_power_idZoom.addEventListener('click', onToolBarBtnClick);


  input_power_idPnl = document.getElementById("input_power_idPnl");

  input_power_idAddBtn = document.getElementById('input_power_idAddBtn');
  input_power_idAddBtn.addEventListener('click', onLookupAddBtnClick);

  input_power_idMobBackBtn = document.getElementById('input_power_idMobBackBtn');
  input_power_idMobBackBtn.addEventListener('click', onInput_power_idMobBackBtn);

  relateInput_power_idBtn = document.getElementById('assignInput_power_idBtn');
  relateInput_power_idBtn.addEventListener('click', onRelateInput_power_idBtn);

  cancelInput_power_idBtn = document.getElementById('cancelInput_power_idBtn');
  cancelInput_power_idBtn.addEventListener('click', onCancelInput_power_idBtn);

  searchInput_power_idBox = document.getElementById('searchInput_power_idBox');
  searchInput_power_idBox.addEventListener('keyup', onSearchInput_power_id);
  steamFlowMeterOutput_signal_id.addEventListener('change', onFieldChange);
  steamFlowMeterOutput_signal_id.addEventListener('focus', onFieldFocus);
  steamFlowMeterOutput_signal_id.addEventListener('blur', onFieldChange);

  steamFlowMeterOutput_signal_idZoom = document.getElementById('steamFlowMeterOutput_signal_idZoom');
  steamFlowMeterOutput_signal_idZoom.addEventListener('click', onToolBarBtnClick);


  output_signal_idPnl = document.getElementById("output_signal_idPnl");

  output_signal_idAddBtn = document.getElementById('output_signal_idAddBtn');
  output_signal_idAddBtn.addEventListener('click', onLookupAddBtnClick);

  output_signal_idMobBackBtn = document.getElementById('output_signal_idMobBackBtn');
  output_signal_idMobBackBtn.addEventListener('click', onOutput_signal_idMobBackBtn);

  relateOutput_signal_idBtn = document.getElementById('assignOutput_signal_idBtn');
  relateOutput_signal_idBtn.addEventListener('click', onRelateOutput_signal_idBtn);

  cancelOutput_signal_idBtn = document.getElementById('cancelOutput_signal_idBtn');
  cancelOutput_signal_idBtn.addEventListener('click', onCancelOutput_signal_idBtn);

  searchOutput_signal_idBox = document.getElementById('searchOutput_signal_idBox');
  searchOutput_signal_idBox.addEventListener('keyup', onSearchOutput_signal_id);
  steamFlowMeterConnected_tnpcb.addEventListener('change', onFieldChange);
  steamFlowMeterConnected_tnpcb.addEventListener('focus', onFieldFocus);
  steamFlowMeterConnected_tnpcb.addEventListener('blur', onFieldChange);
  steamFlowMeterTnpcb_ref.addEventListener('change', onFieldChange);
  steamFlowMeterTnpcb_ref.addEventListener('focus', onFieldFocus);
  steamFlowMeterTnpcb_ref.addEventListener('blur', onFieldChange);
  steamFlowMeterConnected_cpcb.addEventListener('change', onFieldChange);
  steamFlowMeterConnected_cpcb.addEventListener('focus', onFieldFocus);
  steamFlowMeterConnected_cpcb.addEventListener('blur', onFieldChange);
  steamFlowMeterCpcb_ref.addEventListener('change', onFieldChange);
  steamFlowMeterCpcb_ref.addEventListener('focus', onFieldFocus);
  steamFlowMeterCpcb_ref.addEventListener('blur', onFieldChange);
  steamFlowMeterIsactive.addEventListener('change', onFieldChange);
  steamFlowMeterIsactive.addEventListener('focus', onFieldFocus);
  steamFlowMeterIsactive.addEventListener('blur', onFieldChange);
  steamFlowMeterRemarks.addEventListener('change', onFieldChange);
  steamFlowMeterRemarks.addEventListener('focus', onFieldFocus);
  steamFlowMeterRemarks.addEventListener('blur', onFieldChange);


  $('#tableHolder tbody').on('click', 'tr', onRowClick);
  $('#tableHolder tbody').on('click', '.open-full-view-link', onTableLinkClick);


  backBtn = document.getElementById('backBtn');
  backBtn.addEventListener('click', onFormBackBtnClick);

  if (clCommon.isMobile() && window.history && window.history.pushState) {
    window.addEventListener('popstate', function() {
      hideForm();
    });
  }

  if (clCommon.isMobile()) {
    clCommon.setCookie("bcssteam_full_view", "", -1);
    formView.classList.remove('fullview');
  }


  common_util.setSelectTitleOnChange();
}

function onTableLinkClick(e) {
  e.preventDefault();
  e.stopPropagation();
  var tr = $(this).closest('tr');
  if (!tr.hasClass('selected')) {
    tr.trigger('click');
  }
  toggleFullview(true);
}

function toggleFullview(forceState) {
  var isCurrentlyFull = formView.classList.contains('fullview');
  var shouldBeFull;

  if (typeof forceState === 'boolean') {
    shouldBeFull = forceState;
  } else {
    shouldBeFull = !isCurrentlyFull;
  }

  if (shouldBeFull) {
    // ENTER Full View 
    contentView.classList.add('hide');
    formView.classList.remove('hide');

    if (!clCommon.isMobile()) {
      formView.classList.add('fullview');
    }

    if (cancelCreateBtn) clCommon.show(cancelCreateBtn);
    if (cancelUpdateBtn) clCommon.show(cancelUpdateBtn);

    clCommon.setCookie("bcssteam_full_view", "true", 10);

    if (steamFlowMeterTable) {
      steamFlowMeterTable.rows().invalidate().draw(false);
      resizeTable();
    }
  } else {
    // EXIT Full View
    contentView.classList.remove('hide');
    formView.classList.remove('fullview');
    formView.classList.remove('hide');

    if (cancelCreateBtn) clCommon.hide(cancelCreateBtn);
    if (cancelUpdateBtn) clCommon.hide(cancelUpdateBtn);

    clCommon.setCookie("bcssteam_full_view", "", -1);

    if (steamFlowMeterTable) {
      steamFlowMeterTable.rows().invalidate().draw(false);
      resizeTable();
    }
  }

  // Handle Title Visibility
  var formTitle = document.getElementById('formTitleHeader');
  if (formTitle) {
    if (formView.classList.contains('fullview')) {
      formTitle.classList.remove('hide');
    } else {
      formTitle.classList.add('hide');
    }
  }

  //Handle Dynamic Field Layout (data-expand-class & data-normal-class)
  var expandFields = formView.querySelectorAll('[field]');

  if (expandFields.length > 0) {
    expandFields.forEach(function(el) {
      var expandStr = el.getAttribute('data-expand-class');
      var normalStr = el.getAttribute('data-normal-class');

      var expandClasses = expandStr ? expandStr : [];
      var normalClasses = normalStr ? normalStr : [];

      if (shouldBeFull) {
        el.className = expandClasses;
      } else {
        el.className = normalClasses;
      }
    });
  }
}


function openLookupView(panelElement) {
  clCommon.hide(formView);
  clCommon.show(panelElement);

  if (!clCommon.isMobile() && formView.classList.contains('fullview')) {
    panelElement.classList.add('fullview');
    contentView.classList.add('hide');
  }
}

function closeLookupView(panelElement) {
  clCommon.hide(panelElement);
  panelElement.classList.remove('fullview');

  clCommon.show(formView);
}

function onOptionClick(opObj, containerId, changedElementId) {
  clCommon.show(selectFilters);
  clCommon.hide(document.getElementById(containerId));

  var id = opObj.getAttribute("optnId");
  document.getElementById(changedElementId).value = id;


}

function onFilterSteamFlowMeterBtnClick(e) {
  clCommon.show(selectFilters);

  const elements = document.querySelectorAll('[id$="OptsTableContainer"]');

  const ids = Array.from(elements).map(el => el.id);

  for (var id in ids) {
    clCommon.hide(document.getElementById(ids[id]));
  }

  openFilterPopup(e);
}

function openFilterPopup(event) {
  var bodyEl = filterContent;

  var options = {
    onSearch: function() {}
  };

  var buttons = [{
      label: "Cancel",
      handler: function(onPrompt) {
        return function(e) {
          clCommon.hide(filterContent);

          this.setAttribute("pressed", "cancel"),
            onPrompt && onPrompt.call(this, null);
        };
      },
      attributes: {
        "data-bs-dismiss": "modal"
      }
    },
    {
      label: "Apply",
      handler: (searchHandler = options.onSearch,
        function(e) {
          clCommon.hide(filterContent);
          loadSteamFlowMeterData();
        }),
      attributes: {
        "data-bs-dismiss": "modal"
      }
    }
  ];

  var searchPopup = s_dialog('searchPopup', "Options", bodyEl, buttons, options, dlgOptions);
  searchPopup.show();
  clCommon.show(filterContent);

  if (clCommon.isMobile()) {
    if (event.target.id === 'filterSteamFlowMeterBtn') {
      activateTab('nav-filter', 'nav-action');
    } else if (event.target.id === 'filterActionsSteamFlowMeterBtn') {
      activateTab('nav-action', 'nav-filter');
    }
  } else {
    // Desktop default (assuming you don't need the clCommon hide/show logic here based on your original code)
    document.getElementById('nav-filter-tab').click();
  }
}

function activateTab(activeId, inactiveId) {
  // Handle the "Active" Tab
  clCommon.show(document.getElementById(activeId + '-tab'));
  clCommon.show(document.getElementById(activeId));
  document.getElementById(activeId + '-tab').classList.add('active');
  document.getElementById(activeId).classList.add('active', 'show');

  // Handle the "Inactive" Tab
  clCommon.hide(document.getElementById(inactiveId + '-tab'));
  clCommon.hide(document.getElementById(inactiveId));
  document.getElementById(inactiveId + '-tab').classList.remove('active');
  document.getElementById(inactiveId).classList.remove('active', 'show');
}


/*
	Function is called during onload event
*/
function onUser(resp) {
  clCommon.hideLoader('svcProgress');

  if (resp.code !== 200)
    redirect("/");

  userObj = resp.user;

  document.getElementById('userName').innerHTML = (userObj.firstname ? userObj.firstname : userObj.username);
  clCommon.initLanguage(userObj.realm_lang, function() {
    dlgOptions.STR_OK = clCommon.getString("OK", "OK");
    dlgOptions.STR_CANCEL = clCommon.getString("CANCEL", "Cancel");
    dlgOptions.STR_YES = clCommon.getString("YES", "Yes");
    dlgOptions.STR_NO = clCommon.getString("NO", "No");

    if (typeof SteamFlowMeterInterface === 'undefined')
      SteamFlowMeterInterface = null;

    if (SteamFlowMeterInterface && SteamFlowMeterInterface.onLoad)
      SteamFlowMeterInterface.onLoad();

    initControls();
    initTable();
    initSearchTable();

    initVendor_idTable();
    initWorking_principle_idTable();
    initSize_idTable();
    initInput_power_idTable();
    initOutput_signal_idTable();


    registerEventListeners();
    setActionsSelectOptions();

    scrypto = new SimpleCrypto(userObj.realm_name);

    var userLocale = userObj.realm_locale ? userObj.realm_locale : localeObj;

    localeCode = userLocale.code ? userLocale.code : "en-IN";
    currency = userLocale.currency ? userLocale.currency : "INR";

    numberFormat = new Intl.NumberFormat(localeCode, {
      style: "decimal"
    });
    currencyFormat = new Intl.NumberFormat(localeCode, {
      style: "currency",
      currency: (typeof slocale !== 'undefined') ? slocale.getLocaleInfo(localeCode).currency_code : currency,
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    });


    clCommon.showLoader('svcProgress');

    var customAppName = clCommon.getCustomAppName();
    var url = customAppName ? ("/steps/hq/" + customAppName + "/common/appsvc?is_custom=true") : (isCustom ? "./common/appsvc?is_custom=true" : "./common/appsvc");

    //To handle the across app integration
    if (params && params.app) {
      // If the URL already has a "?" in it, append with "&", otherwise with "?"
      url += (url.includes("?") ? "&" : "?") + "app=" + params.app;
    }


    clCommon.getSvc(true, url, onAppUserInfo, onAppUserInfoError);
  });
}

function initSearchTable() {
  for (var p = 0; p < searchOptsTables.length; p++) {
    var tableVarName = searchOptsTables[p]; // "productFilterOptsTable"
    var tableId = "#" + tableVarName; // "#productFilterOptsTable"

    // Create datatable instance
    var dt = $(tableId).DataTable({
      paging: false,
      info: false,
      autoWidth: false,
      columns: [{
          data: 'radio'
        },
        {
          data: 'optionName'
        }
      ],
      columnDefs: [{
        width: "25px",
        targets: 0
      }]
    });

    dt.table().node().classList.remove('nowrap');

    // Assign instance to the correct global variable
    window[tableVarName] = dt;
  }
}

function setActionsSelectOptions() {
  if (!document.getElementById('actionsSelectTable'))
    return;

  var tableId = "#" + "actionsSelectTable";


  // Create datatable instance
  var actionsTable = $(tableId).DataTable({
    paging: false,
    info: false,
    autoWidth: false,
    columns: [{
        data: 'radio'
      },
      {
        data: 'optionName'
      }
    ],
    columnDefs: [{
      width: "25px",
      targets: 0
    }]
  });

  actionsTable.table().node().classList.remove('nowrap');

  var optionsArr = [];
  for (var d in actionsSelectOptionsArr) {
    var optObj = actionsSelectOptionsArr[d];
    var tObj = {
      "optionName": '<label for="' + optObj.idName + '">' + optObj.displayName + '</label>',
      "radio": '<input type="radio" ' +
        'id="' + optObj.idName + '" ' +
        'name="optionName" ' +
        'onclick="onChangeOfActionSelect(this)">'
    };
    optionsArr.push(tObj);
  }

  actionsTable.clear().draw();
  actionsTable.rows.add(optionsArr).draw();
}

function capitalizeAndUnderscore(str) {
  // Trim the string, replace spaces with underscores, and convert to uppercase
  return str.trim().replace(/s+/g, '_').toUpperCase();
}

function loadMasters() {
  getAllVendorsWithoutLimit();
  getWorkingPrinciple();
  getSize();
  getInputPower();
  getOutputSignal();
  getAllBusinessPartner();

  masterWs = 6;
  callOnLoadFunction();
}

function callOnLoadFunction() {
  if (msCheck == masterWs) {
    loadData();
    msCheck = 0;
    return;
  }
  setTimeout(() => {
    callOnLoadFunction();
  }, 300);
}

function findOnlyUniques(array) {
  var seen = {};
  var uniqueArr = [];

  // Step 1: Remove duplicates by _sid
  for (var i = 0; i < array.length; i++) {
    var item = array[i];
    if (!seen[item._sid]) {
      seen[item._sid] = true;
      uniqueArr.push(item);
    }
  }

  return uniqueArr;
}

function loadLimFunction(lim) {
  if (lim) {
    offset += limit;
    limit = lim;
  } else {
    offset = 0;
    limit = 0;
  }

  clCommon.setCookie("SteamFlowMeterOffset", offset, 10);
  clCommon.setCookie("SteamFlowMeterLimit", limit, 10);

  loadSteamFlowMeterData();
}


/*
	Function is called during onload event
	This function invoked on error response
*/
function onUserError(resp) {
  clCommon.hideLoader('svcProgress');
  redirect("/sauth/login.html");
}


/*
Function is called to redirect to the url
*/
function redirect(url) {
  window.location.href = url + (language !== "EN" ? ("?l=" + language) : "");
}


function getAllVendorsWithoutLimit(isFieldChange, changedField) {


  Service.getAllVendorsWithoutLimit(function(isFldChange, changedFld) {
    return function(respObj) {

      if (respObj.code == 200) {
        vendorArr = respObj.data;
        msCheck++;


        if (!dataSources.getAllVendorsWithoutLimit) {
          dataSources.getAllVendorsWithoutLimit = vendorArr;
        }




        if (SteamFlowMeterInterface && SteamFlowMeterInterface.onBeforeLoad)
          dataSources = SteamFlowMeterInterface.onBeforeLoad(dataSources);
        if (dataSources == false) {
          return;
        }



        if (undefined && dataSources.getAllVendorsWithoutLimit && dataSources.getAllVendorsWithoutLimit.length > 1) {
          dataSources.getAllVendorsWithoutLimit = clCommon.sort(dataSources.getAllVendorsWithoutLimit, "business_partner_short_name"); //Sort alphabetically
        }





        for (var t = 0; t < dataSources.getAllVendorsWithoutLimit.length; t++) {
          try {
            //decrypt response data
            dataSources.getAllVendorsWithoutLimit[t].business_partner_short_name = scrypto.decrypt(dataSources.getAllVendorsWithoutLimit[t].business_partner_short_name);
          } catch (e) {
            //ignore old unencrypted data
            dataSources.getAllVendorsWithoutLimit[t].business_partner_short_name = dataSources.getAllVendorsWithoutLimit[t].business_partner_short_name;
          }




        }



        if (SteamFlowMeterInterface && isFieldChange == true) {
          SteamFlowMeterInterface.onFieldChange(changedFld, dataSources);
        }
      }
    };
  }(isFieldChange, changedField));
}

function getWorkingPrinciple(isFieldChange, changedField) {


  Service.getWorkingPrinciple(function(isFldChange, changedFld) {
    return function(respObj) {

      if (respObj.code == 200) {
        workingPrincipleArr = JSON.parse(respObj.data[0].master_data);
        msCheck++;


        if (!dataSources.getWorkingPrinciple) {
          dataSources.getWorkingPrinciple = workingPrincipleArr;
        }




        if (SteamFlowMeterInterface && SteamFlowMeterInterface.onBeforeLoad)
          dataSources = SteamFlowMeterInterface.onBeforeLoad(dataSources);
        if (dataSources == false) {
          return;
        }


        if (undefined && dataSources.getWorkingPrinciple && dataSources.getWorkingPrinciple.length > 1) {
          dataSources.getWorkingPrinciple = clCommon.sort(dataSources.getWorkingPrinciple, "working_principle"); //Sort alphabetically
        }





        for (var t = 0; t < dataSources.getWorkingPrinciple.length; t++) {
          try {
            //decrypt response data
            dataSources.getWorkingPrinciple[t].working_principle = scrypto.decrypt(dataSources.getWorkingPrinciple[t].working_principle);
          } catch (e) {
            //ignore old unencrypted data
            dataSources.getWorkingPrinciple[t].working_principle = dataSources.getWorkingPrinciple[t].working_principle;
          }





        }


        if (SteamFlowMeterInterface && isFieldChange == true) {
          SteamFlowMeterInterface.onFieldChange(changedFld, dataSources);
        }

      }
    };
  }(isFieldChange, changedField));
}

function getSize(isFieldChange, changedField) {


  Service.getSize(function(isFldChange, changedFld) {
    return function(respObj) {

      if (respObj.code == 200) {
        sizeArr = JSON.parse(respObj.data[0].master_data);
        msCheck++;


        if (!dataSources.getSize) {
          dataSources.getSize = sizeArr;
        }




        if (SteamFlowMeterInterface && SteamFlowMeterInterface.onBeforeLoad)
          dataSources = SteamFlowMeterInterface.onBeforeLoad(dataSources);
        if (dataSources == false) {
          return;
        }


        if (undefined && dataSources.getSize && dataSources.getSize.length > 1) {
          dataSources.getSize = clCommon.sort(dataSources.getSize, "size"); //Sort alphabetically
        }





        for (var t = 0; t < dataSources.getSize.length; t++) {
          try {
            //decrypt response data
            dataSources.getSize[t].size = scrypto.decrypt(dataSources.getSize[t].size);
          } catch (e) {
            //ignore old unencrypted data
            dataSources.getSize[t].size = dataSources.getSize[t].size;
          }





        }


        if (SteamFlowMeterInterface && isFieldChange == true) {
          SteamFlowMeterInterface.onFieldChange(changedFld, dataSources);
        }

      }
    };
  }(isFieldChange, changedField));
}

function getInputPower(isFieldChange, changedField) {


  Service.getInputPower(function(isFldChange, changedFld) {
    return function(respObj) {

      if (respObj.code == 200) {
        inputPowerArr = JSON.parse(respObj.data[0].master_data);
        msCheck++;


        if (!dataSources.getInputPower) {
          dataSources.getInputPower = inputPowerArr;
        }




        if (SteamFlowMeterInterface && SteamFlowMeterInterface.onBeforeLoad)
          dataSources = SteamFlowMeterInterface.onBeforeLoad(dataSources);
        if (dataSources == false) {
          return;
        }


        if (undefined && dataSources.getInputPower && dataSources.getInputPower.length > 1) {
          dataSources.getInputPower = clCommon.sort(dataSources.getInputPower, "input_power"); //Sort alphabetically
        }





        for (var t = 0; t < dataSources.getInputPower.length; t++) {
          try {
            //decrypt response data
            dataSources.getInputPower[t].input_power = scrypto.decrypt(dataSources.getInputPower[t].input_power);
          } catch (e) {
            //ignore old unencrypted data
            dataSources.getInputPower[t].input_power = dataSources.getInputPower[t].input_power;
          }





        }


        if (SteamFlowMeterInterface && isFieldChange == true) {
          SteamFlowMeterInterface.onFieldChange(changedFld, dataSources);
        }

      }
    };
  }(isFieldChange, changedField));
}

function getOutputSignal(isFieldChange, changedField) {


  Service.getOutputSignal(function(isFldChange, changedFld) {
    return function(respObj) {

      if (respObj.code == 200) {
        outputSignalArr = JSON.parse(respObj.data[0].master_data);
        msCheck++;


        if (!dataSources.getOutputSignal) {
          dataSources.getOutputSignal = outputSignalArr;
        }




        if (SteamFlowMeterInterface && SteamFlowMeterInterface.onBeforeLoad)
          dataSources = SteamFlowMeterInterface.onBeforeLoad(dataSources);
        if (dataSources == false) {
          return;
        }


        if (undefined && dataSources.getOutputSignal && dataSources.getOutputSignal.length > 1) {
          dataSources.getOutputSignal = clCommon.sort(dataSources.getOutputSignal, "output_signal"); //Sort alphabetically
        }





        for (var t = 0; t < dataSources.getOutputSignal.length; t++) {
          try {
            //decrypt response data
            dataSources.getOutputSignal[t].output_signal = scrypto.decrypt(dataSources.getOutputSignal[t].output_signal);
          } catch (e) {
            //ignore old unencrypted data
            dataSources.getOutputSignal[t].output_signal = dataSources.getOutputSignal[t].output_signal;
          }





        }


        if (SteamFlowMeterInterface && isFieldChange == true) {
          SteamFlowMeterInterface.onFieldChange(changedFld, dataSources);
        }

      }
    };
  }(isFieldChange, changedField));
}

function getAllBusinessPartner(isFieldChange, changedField) {


  Service.getAllBusinessPartner(function(isFieldChange, changedField) {
    return function(respObj) {
      if (respObj.code == 200) {
        undefinedArr = respObj.data;
        msCheck++;


        if (!dataSources.getAllBusinessPartner) {
          dataSources.getAllBusinessPartner = undefinedArr;
        }




        if (SteamFlowMeterInterface && SteamFlowMeterInterface.onBeforeLoad)
          dataSources = SteamFlowMeterInterface.onBeforeLoad(dataSources);
        if (dataSources == false) {
          return;
        }



        if (undefined && dataSources.getAllBusinessPartner && dataSources.getAllBusinessPartner.length > 1) {
          dataSources.getAllBusinessPartner = clCommon.sort(dataSources.getAllBusinessPartner, "undefined"); //Sort alphabetically
        }







        if (SteamFlowMeterInterface && isFieldChange == true) {
          SteamFlowMeterInterface.onFieldChange(changedFld, dataSources);
        }

      }
    };
  }(isFieldChange, changedField));
}


/*
	Function is called during onload event on error response
*/
function onAppUserInfo(resp) {
  var noDataElem = document.getElementById("contentNoData");
  var dataElem = document.getElementById("contentData");

  clCommon.hideLoader('svcProgress');

  if (resp.code === 200) {
    if (resp.menuArr) {
      clCommon.show(dataElem);
      dataSources.menuArr = resp.menuArr;
      dataSources.roleArr = resp.roleArr;

      processMenu(resp.menuArr);

      clCommon.appendSystemRoles(document.getElementById('sideMenu'), userObj);



      loadMasters();
    } else {
      clCommon.show(noDataElem);
      clCommon.hide(dataElem);
    }
  } else {
    s_error(Strings.GET_APP_USER_INFO_ERROR_TITLE, Strings.APP_USER_MENU_ERROR, dlgOptions);
  }
}


/*
	Function is called during onload event on error response
*/
function onAppUserInfoError(resp) {
  clCommon.hideLoader('svcProgress');
  s_error(Strings.GET_APP_USER_INFO_ERROR_TITLE, Strings.APP_USER_MENU_ERROR, dlgOptions);
}

function showForm() {
  window.history.pushState('form', null, '#form');
  clCommon.hide(contentView);
  clCommon.show(formView);
}

function hideForm() {
  clCommon.show(contentView);
  clCommon.hide(formView);
  if (!clCommon.isMobile()) resizeTable();
}

function onFormBackBtnClick(e) {
  if (e) e.preventDefault();

  if (clCommon.isMobile()) {
    history.back();
    return;
  }

  var isFullCookie = clCommon.getCookie("bcssteam_full_view");
  clearForm();

  if (isFullCookie === "true") {
    contentView.classList.remove('hide');
    formView.classList.add('hide');
    formView.classList.add('fullview');
    if (selectedRow) {
      $(selectedRow).removeClass('selected');
      selectedRow = null;
    }
    deleteSteamFlowMeterBtn.classList.add('disabled');
  }

  if (!clCommon.isMobile()) resizeTable();
}




function loadData() {
  clCommon.showLoader('dataProgress');
  var beforeLoad = true;
  if (SteamFlowMeterInterface && SteamFlowMeterInterface.onBeforeLoad)
    beforeLoad = SteamFlowMeterInterface.onBeforeLoad(dataSources);

  if (beforeLoad == false) {
    return
  }
  svcCount = 1;
  loadMainSteamFlowMeterData();

  onAfterLoadFunction();
}

function loadMainSteamFlowMeterData() {
  clCommon.showLoader('dataProgress');
  checkAndLoadData();
  hideLoaderFn();
}


function onAfterLoadFunction() {
  if (SteamFlowMeterInterface && SteamFlowMeterInterface.onAfterLoad)
    SteamFlowMeterInterface.onAfterLoad(dataSources);
  clCommon.hideLoader('dataProgress');
  loadCheck = 0;
  return;
}


function hideLoaderFn() {
  clCommon.hideLoader('dataProgress');
  loadCheck = 0;
  return;
}

function checkAndLoadData() {
  var limitCookie = clCommon.getCookie("SteamFlowMeterLimit");
  var offsetCookie = clCommon.getCookie("SteamFlowMeterOffset");

  var limitVal = Number(limitCookie);
  var offsetVal = Number(offsetCookie);

  // Case 1: Load All - offset = 0 and limit = 0
  if (offsetVal === 0 && limitVal === 0 && limitCookie != "" && offsetCookie != "") {
    s_confirm(Strings.CONFIRM, Strings.CONFIRM_LOAD_ALL_PRT_1 + "?" + Strings.CONFIRM_LOAD_PRT_2, {
      STR_YES: dlgOptions.STR_YES,
      STR_NO: dlgOptions.STR_NO,
      onYes: function() {
        limCookieSet = 0;
        offCookieSet = 0;
        loadMore.classList.add('disabled');
        loadAll.classList.add('disabled');
        loadSteamFlowMeterData();
      },
      onNo: function() {
        offCookieSet = 0;
        limCookieSet = 100;
        loadSteamFlowMeterData();
      }
    });
    return;
  }

  // Case 2: Load 400 plus data threshold check
  if (offsetVal >= 400 && limitVal > 0) {
    s_confirm(Strings.CONFIRM, Strings.VALIDATION_COOKIE_LOAD_DATA + "?", {
      STR_YES: dlgOptions.STR_YES,
      STR_NO: dlgOptions.STR_NO,
      onYes: function() {
        offCookieSet = 0;
        limCookieSet = offsetVal + limitVal;
        loadSteamFlowMeterData();
      },
      onNo: function() {
        offCookieSet = 0;
        limCookieSet = 100;
        loadSteamFlowMeterData();
      }
    });
    return;
  } else if (limitCookie != "" && offsetCookie != "") {
    offCookieSet = 0;
    limCookieSet = offsetVal + limitVal;
  }

  // Default: load first 100
  loadSteamFlowMeterData();
}

function loadSteamFlowMeterData() {
  steamFlowMeterTable.clear().draw();
  clCommon.showLoader("listProgress");

  if (limCookieSet != null) {
    offset = offCookieSet;
    limit = limCookieSet;
  }

  var params = [offset, limit, ];

  var onBeforeData = true;
  if (SteamFlowMeterInterface && SteamFlowMeterInterface.onBeforeData)
    onBeforeData = SteamFlowMeterInterface.onBeforeData(params, dataSources);


  if (onBeforeData) {
    params.push(function(resultObj) {
      clCommon.hideLoader("listProgress");
      var dataArr;
      var isSuccessful;
      if (resultObj.code == 200) { //On success response
        if (limCookieSet != null) {
          offset = limCookieSet == 0 ? 0 : (limCookieSet - 100);
          limit = 100;
          offCookieSet = null;
          limCookieSet = null;
        }
        dataArr = resultObj.data.concat(primaryArr);
        dataArr = findOnlyUniques(dataArr);
        isSuccessful = true;


        if (SteamFlowMeterInterface && SteamFlowMeterInterface.onAfterData)
          dataArr = SteamFlowMeterInterface.onAfterData(isSuccessful, dataArr, dataSources);

        onLoadSuccessResponse(dataArr);


        // Check Cookie
        var isFullCookie = clCommon.getCookie("bcssteam_full_view");
        // Only auto-select first row if NOT mobile AND cookie is NOT set
        if (!clCommon.isMobile() && isFullCookie !== "true" && dataArr.length > 0) {
          var firstRow = $('#tableHolder tbody tr:eq(0)');
          if (firstRow) {
            firstRow.click(); //by default select first row
          }
        }

        // If cookie IS set, we ensure the form is hidden to show the table list
        else if (isFullCookie === "true") {
          contentView.classList.remove('hide');
          formView.classList.add('hide');
          formView.classList.add('fullview'); // Maintain state class for later logic

          // Ensure buttons are reset if needed
          deleteSteamFlowMeterBtn.classList.add('disabled');
        }
        dataSources.primary = dataArr;
        primaryArr = dataArr;
        if (resultObj.count) {
          if ((primaryArr.length == resultObj.count) || (resultObj.count == -1)) {
            loadMore.classList.add('disabled');
            loadAll.classList.add('disabled');
          }
        }

      } else { //On error response
        isSuccessful = false;

        if (SteamFlowMeterInterface && SteamFlowMeterInterface.onAfterData)
          dataArr = SteamFlowMeterInterface.onAfterData(isSuccessful, dataArr, dataSources);

        s_error(Strings.ERROR, Strings.ERROR_LOAD_STEAMFLOWMETER, dlgOptions);
      }
    });
    Service.getAllSfm.apply(this, params);
  }
  if (clCommon.isMobile()) {
    hideForm();
  }
}


function onLoadSuccessResponse(dataArr) {
  if (!dataArr || dataArr.length == 0) {
    clearForm();


    deleteSteamFlowMeterBtn.classList.add('disabled');
  }

  chunkSize = 30;
  currentIndex = 0;
  steamFlowMeterTable.clear().draw();
  loadChunk(dataArr);

  var isFullCookie = clCommon.getCookie("bcssteam_full_view");

  if (!clCommon.isMobile() && isFullCookie === "true") {
    contentView.classList.remove('hide');
    formView.classList.add('hide');
    formView.classList.add('fullview');

    clCommon.show(cancelCreateBtn);
    clCommon.show(cancelUpdateBtn);
  }
}

function loadChunk(dataArr) {
  if (!dataArr || currentIndex >= dataArr.length) {
    return;
  }

  var chunk = dataArr.slice(currentIndex, currentIndex + chunkSize);
  for (var i = 0; i < chunk.length; i++) {



  }
  steamFlowMeterTable.rows.add(chunk).draw(); // 'false' to not reset paging each time
  currentIndex += chunkSize;

  setTimeout(() => loadChunk(dataArr), 10); // adjust timeout as needed
}

function onChangeOfFilter(e) {



  offset = 0;
  limit = 100;

  clCommon.setCookie("SteamFlowMeterOffset", offset, 10);
  clCommon.setCookie("SteamFlowMeterLimit", limit, 10);

  primaryArr = [];
  loadMore.classList.remove('disabled');
  loadAll.classList.remove('disabled');

  const changedElement = e.target;
  const selectedType = changedElement.value;

  if (selectedType == 'search') {
    //TODO add logic for popup and setup options

    clCommon.hide(selectFilters);

    var optionsTbCont = changedElement.id + "OptsTableContainer";
    clCommon.show(document.getElementById(optionsTbCont));

    var title = "Search";

    const options = changedElement.querySelectorAll("option");
    var optnArr = [];
    options.forEach(opt => {
      const name = opt.textContent.trim();
      if (name !== "Search") {
        optnArr.push({
          id: opt.value,
          name: name
        });
      }
    });

    var optionsArr = [];
    for (var d in optnArr) {
      var optObj = optnArr[d];
      var tObj = {
        "optionName": '<label for="radio_' + optObj.id + '">' + optObj.name + '</label>',
        "radio": '<input type="radio" ' +
          'id="radio_' + optObj.id + '" ' +
          'name="optionName" ' +
          'optnId="' + optObj.id + '" ' +
          'onclick="onOptionClick(this, \'' + optionsTbCont + '\', \'' + e.target.id + '\')">'
      };
      optionsArr.push(tObj);
    }

    window[changedElement.id + "OptsTable"].clear().draw();
    window[changedElement.id + "OptsTable"].rows.add(optionsArr).draw();

    var onSearchCheck = true;
    if (SteamFlowMeterInterface && SteamFlowMeterInterface.onSearchChangeFilter) {
      onSearchCheck = SteamFlowMeterInterface.onSearchChangeFilter(e);
    }

  } else {
    var onChangeCheck = true;
    if (SteamFlowMeterInterface && SteamFlowMeterInterface.onChangeFilter)
      onChangeCheck = SteamFlowMeterInterface.onChangeFilter(e)
  }
}

function onChangeOfActionSelect(val) {
  var changedAction = val;
  var returnData = true;
  if (SteamFlowMeterInterface && SteamFlowMeterInterface.onChangeOfActionSelect)
    returnData = SteamFlowMeterInterface.onChangeOfActionSelect(changedAction, dataSources);
  if (returnData == false) {
    return;
  }
}


function onCreateSteamFlowMeterBtnClick(e) {
  e.preventDefault();

  var steamFlowMeterObj = {};

  if (steamFlowMeterSfm_code.value != "") {
    steamFlowMeterObj.sfm_code = steamFlowMeterSfm_code.value;
  } else {
    steamFlowMeterObj.sfm_code = null;
  }
  if (steamFlowMeterSfm_description.value != "") {
    steamFlowMeterObj.sfm_description = steamFlowMeterSfm_description.value;
  } else {
    steamFlowMeterObj.sfm_description = null;
  }
  steamFlowMeterObj.vendor_id = steamFlowMeterVendor_id.getAttribute('Vendor_id');
  if (steamFlowMeterModel_no.value != "") {
    steamFlowMeterObj.model_no = steamFlowMeterModel_no.value;
  } else {
    steamFlowMeterObj.model_no = null;
  }
  if (steamFlowMeterSerial_no.value != "") {
    steamFlowMeterObj.serial_no = steamFlowMeterSerial_no.value;
  } else {
    steamFlowMeterObj.serial_no = null;
  }
  if (steamFlowMeterYear_of_manufacturing.getAttribute("val") != "") {
    steamFlowMeterObj.year_of_manufacturing = Number(steamFlowMeterYear_of_manufacturing.getAttribute("val"));
  } else {
    steamFlowMeterObj.year_of_manufacturing = null;
  }
  steamFlowMeterObj.working_principle_id = steamFlowMeterWorking_principle_id.getAttribute('Working_principle_id');
  steamFlowMeterObj.size_id = steamFlowMeterSize_id.getAttribute('Size_id');
  if (steamFlowMeterFlow_rate_min.getAttribute("val") != "") {
    steamFlowMeterObj.flow_rate_min = Number(steamFlowMeterFlow_rate_min.getAttribute("val"));
  } else {
    steamFlowMeterObj.flow_rate_min = null;
  }
  if (steamFlowMeterFlow_rate_max.getAttribute("val") != "") {
    steamFlowMeterObj.flow_rate_max = Number(steamFlowMeterFlow_rate_max.getAttribute("val"));
  } else {
    steamFlowMeterObj.flow_rate_max = null;
  }
  steamFlowMeterObj.input_power_id = steamFlowMeterInput_power_id.getAttribute('Input_power_id');
  steamFlowMeterObj.output_signal_id = steamFlowMeterOutput_signal_id.getAttribute('Output_signal_id');
  steamFlowMeterObj.connected_tnpcb = steamFlowMeterConnected_tnpcb.checked;
  if (steamFlowMeterTnpcb_ref.value != "") {
    steamFlowMeterObj.tnpcb_ref = steamFlowMeterTnpcb_ref.value;
  } else {
    steamFlowMeterObj.tnpcb_ref = null;
  }
  steamFlowMeterObj.connected_cpcb = steamFlowMeterConnected_cpcb.checked;
  if (steamFlowMeterCpcb_ref.value != "") {
    steamFlowMeterObj.cpcb_ref = steamFlowMeterCpcb_ref.value;
  } else {
    steamFlowMeterObj.cpcb_ref = null;
  }
  steamFlowMeterObj.isactive = steamFlowMeterIsactive.checked;
  if (steamFlowMeterRemarks.value != "") {
    steamFlowMeterObj.remarks = steamFlowMeterRemarks.value;
  } else {
    steamFlowMeterObj.remarks = null;
  }

  var date = new Date();
  steamFlowMeterObj.created_by = userObj.username;
  steamFlowMeterObj.created_on = date.getTime();
  steamFlowMeterObj.modified_on = date.getTime();
  steamFlowMeterObj.modified_by = userObj.username;

  //Validate the steamFlowMeter object
  var checkSteamFlowMeter = validate(steamFlowMeterObj);

  //In validation is successfull
  if (checkSteamFlowMeter == true) {





    if (SteamFlowMeterInterface && SteamFlowMeterInterface.onBeforeCreate)
      steamFlowMeterObj = SteamFlowMeterInterface.onBeforeCreate(steamFlowMeterObj, dataSources);
    if (steamFlowMeterObj == false) {
      return;
    }


    clCommon.showLoader("createProgress");
    clCommon.disable(createSteamFlowMeterBtn);


    Service.createSfm(steamFlowMeterObj, function(resultObj) {
      if (resultObj.code == 200) { //on success response
        clCommon.hideLoader("createProgress");
        clCommon.enable(createSteamFlowMeterBtn);
        s_toast(Strings.CREATE_STEAMFLOWMETER_TOAST_SUCCESS);
        var isSuccessful = true;


        if (SteamFlowMeterInterface && SteamFlowMeterInterface.onAfterCreate)
          steamFlowMeterObj = SteamFlowMeterInterface.onAfterCreate(isSuccessful, resultObj.data, dataSources);

        if (steamFlowMeterObj == false) {
          return;
        }

        clCommon.setCookie("steamFlowMeter_id", resultObj.data._sid, 10);
        primaryArr.push(resultObj.data);

        addRow(resultObj.data);

      } else {
        var isSuccessful = false;


        if (SteamFlowMeterInterface && SteamFlowMeterInterface.onAfterCreate)
          steamFlowMeterObj = SteamFlowMeterInterface.onAfterCreate(isSuccessful, resultObj.data, dataSources);

        if (steamFlowMeterObj == false) {
          return;
        }

        s_error(Strings.STEAMFLOWMETER_ERROR_TITLE, Strings.CREATE_STEAMFLOWMETER_ERROR, dlgOptions);
      }
    });
  }
}

// Function to add a new row at the top
function addRow(newData) {



  // Add row to table
  var rowNode = steamFlowMeterTable.row.add(newData).node();

  // Draw the table to render the new data (triggers renderData)
  steamFlowMeterTable.draw(false);

  // Handle sorting to bring new item to top (visual preference)
  var rows = steamFlowMeterTable.rows().data().toArray();
  // Check if the last item is our new item
  if (rows.length > 0 && rows[rows.length - 1]._sid === newData._sid) {
    rows.unshift(rows.pop());
    steamFlowMeterTable.clear().rows.add(rows).draw(false);
  }

  // 5. Select the row
  selectRowBySid(newData._sid);
}



function onRowClick(e) {

  var isFullCookie = clCommon.getCookie("bcssteam_full_view");

  if (!selectedRow) { //executes when the row is clicked for the first time
    selectedRow = this;
    $(selectedRow).addClass('selected');

    deleteSteamFlowMeterBtn.classList.remove('disabled');


    clCommon.hide(createBtn);
    clCommon.show(updateBtn);

    clCommon.focus(steamFlowMeterSfm_code);
    selectedRow = this;

    rowData = steamFlowMeterTable.row(selectedRow).data();


    steamFlowMeterVendor_id.setAttribute("Vendor_id", rowData.vendor_id ? rowData.vendor_id : "");
    steamFlowMeterVendor_id.dispatchEvent(new Event('change'));

    selectedVendor_idId = rowData.vendor_id ? rowData.vendor_id : "";

    var vendorArr = dataSources.getAllVendorsWithoutLimit; // Dynamically fetch array
    for (var i = 0; i < vendorArr.length; i++) {
      var obj = vendorArr[i];
      if (rowData.vendor_id == obj._sid) {
        steamFlowMeterVendor_id.value = obj.business_partner_short_name ? obj.business_partner_short_name : "";
        break;
      }
    }

    steamFlowMeterWorking_principle_id.setAttribute("Working_principle_id", rowData.working_principle_id ? rowData.working_principle_id : "");
    steamFlowMeterWorking_principle_id.dispatchEvent(new Event('change'));

    selectedWorking_principle_idId = rowData.working_principle_id ? rowData.working_principle_id : "";

    var workingPrincipleArr = dataSources.getWorkingPrinciple; // Dynamically fetch array
    for (var i = 0; i < workingPrincipleArr.length; i++) {
      var obj = workingPrincipleArr[i];
      if (rowData.working_principle_id == obj.id) {
        steamFlowMeterWorking_principle_id.value = obj.working_principle ? obj.working_principle : "";
        break;
      }
    }

    steamFlowMeterSize_id.setAttribute("Size_id", rowData.size_id ? rowData.size_id : "");
    steamFlowMeterSize_id.dispatchEvent(new Event('change'));

    selectedSize_idId = rowData.size_id ? rowData.size_id : "";

    var sizeArr = dataSources.getSize; // Dynamically fetch array
    for (var i = 0; i < sizeArr.length; i++) {
      var obj = sizeArr[i];
      if (rowData.size_id == obj.id) {
        steamFlowMeterSize_id.value = obj.size ? obj.size : "";
        break;
      }
    }

    steamFlowMeterInput_power_id.setAttribute("Input_power_id", rowData.input_power_id ? rowData.input_power_id : "");
    steamFlowMeterInput_power_id.dispatchEvent(new Event('change'));

    selectedInput_power_idId = rowData.input_power_id ? rowData.input_power_id : "";

    var inputPowerArr = dataSources.getInputPower; // Dynamically fetch array
    for (var i = 0; i < inputPowerArr.length; i++) {
      var obj = inputPowerArr[i];
      if (rowData.input_power_id == obj.id) {
        steamFlowMeterInput_power_id.value = obj.input_power ? obj.input_power : "";
        break;
      }
    }

    steamFlowMeterOutput_signal_id.setAttribute("Output_signal_id", rowData.output_signal_id ? rowData.output_signal_id : "");
    steamFlowMeterOutput_signal_id.dispatchEvent(new Event('change'));

    selectedOutput_signal_idId = rowData.output_signal_id ? rowData.output_signal_id : "";

    var outputSignalArr = dataSources.getOutputSignal; // Dynamically fetch array
    for (var i = 0; i < outputSignalArr.length; i++) {
      var obj = outputSignalArr[i];
      if (rowData.output_signal_id == obj.id) {
        steamFlowMeterOutput_signal_id.value = obj.output_signal ? obj.output_signal : "";
        break;
      }
    }


    if (SteamFlowMeterInterface && SteamFlowMeterInterface.onRowItemClick)
      rowData = SteamFlowMeterInterface.onRowItemClick(rowData);

    displayForm(rowData);
  } else {

    if (selectedRow === this && isFullCookie === "true" && !clCommon.isMobile()) {
      return;
    }

    if (clCommon.isMobile() || (selectedRow != this) || (selectedRow == this)) { //executed when another row is selected
      $(selectedRow).removeClass('selected');

      deleteSteamFlowMeterBtn.classList.add('disabled');


      clearForm();

      selectedRow = this;
      $(selectedRow).addClass('selected');

      deleteSteamFlowMeterBtn.classList.remove('disabled');


      clCommon.hide(createBtn);
      clCommon.show(updateBtn);
      clCommon.focus(steamFlowMeterSfm_code);
      selectedRow = this;
      rowData = steamFlowMeterTable.row(selectedRow).data();


      steamFlowMeterVendor_id.setAttribute("Vendor_id", rowData.vendor_id ? rowData.vendor_id : "");
      steamFlowMeterVendor_id.dispatchEvent(new Event('change'));

      selectedVendor_idId = rowData.vendor_id ? rowData.vendor_id : "";

      var vendorArr = dataSources.getAllVendorsWithoutLimit; // Dynamically fetch array
      for (var i = 0; i < vendorArr.length; i++) {
        var obj = vendorArr[i];
        if (rowData.vendor_id == obj._sid) {
          steamFlowMeterVendor_id.value = obj.business_partner_short_name ? obj.business_partner_short_name : "";
          break;
        }
      }

      steamFlowMeterWorking_principle_id.setAttribute("Working_principle_id", rowData.working_principle_id ? rowData.working_principle_id : "");
      steamFlowMeterWorking_principle_id.dispatchEvent(new Event('change'));

      selectedWorking_principle_idId = rowData.working_principle_id ? rowData.working_principle_id : "";

      var workingPrincipleArr = dataSources.getWorkingPrinciple; // Dynamically fetch array
      for (var i = 0; i < workingPrincipleArr.length; i++) {
        var obj = workingPrincipleArr[i];
        if (rowData.working_principle_id == obj.id) {
          steamFlowMeterWorking_principle_id.value = obj.working_principle ? obj.working_principle : "";
          break;
        }
      }

      steamFlowMeterSize_id.setAttribute("Size_id", rowData.size_id ? rowData.size_id : "");
      steamFlowMeterSize_id.dispatchEvent(new Event('change'));

      selectedSize_idId = rowData.size_id ? rowData.size_id : "";

      var sizeArr = dataSources.getSize; // Dynamically fetch array
      for (var i = 0; i < sizeArr.length; i++) {
        var obj = sizeArr[i];
        if (rowData.size_id == obj.id) {
          steamFlowMeterSize_id.value = obj.size ? obj.size : "";
          break;
        }
      }

      steamFlowMeterInput_power_id.setAttribute("Input_power_id", rowData.input_power_id ? rowData.input_power_id : "");
      steamFlowMeterInput_power_id.dispatchEvent(new Event('change'));

      selectedInput_power_idId = rowData.input_power_id ? rowData.input_power_id : "";

      var inputPowerArr = dataSources.getInputPower; // Dynamically fetch array
      for (var i = 0; i < inputPowerArr.length; i++) {
        var obj = inputPowerArr[i];
        if (rowData.input_power_id == obj.id) {
          steamFlowMeterInput_power_id.value = obj.input_power ? obj.input_power : "";
          break;
        }
      }

      steamFlowMeterOutput_signal_id.setAttribute("Output_signal_id", rowData.output_signal_id ? rowData.output_signal_id : "");
      steamFlowMeterOutput_signal_id.dispatchEvent(new Event('change'));

      selectedOutput_signal_idId = rowData.output_signal_id ? rowData.output_signal_id : "";

      var outputSignalArr = dataSources.getOutputSignal; // Dynamically fetch array
      for (var i = 0; i < outputSignalArr.length; i++) {
        var obj = outputSignalArr[i];
        if (rowData.output_signal_id == obj.id) {
          steamFlowMeterOutput_signal_id.value = obj.output_signal ? obj.output_signal : "";
          break;
        }
      }


      if (SteamFlowMeterInterface && SteamFlowMeterInterface.onRowItemClick)
        rowData = SteamFlowMeterInterface.onRowItemClick(rowData);

      displayForm(rowData);
    }
  }

  if (clCommon.isMobile()) {
    showForm();
  } else {
    if (isFullCookie === "true") {
      hideForm();
    }
  }
}


//This function displays all the data in corresponsing controls
function displayForm(rowData) {

  steamFlowMeterSfm_code.value = rowData.sfm_code;
  steamFlowMeterSfm_description.value = rowData.sfm_description;
  steamFlowMeterVendor_id.value = rowData.vendor_id;
  steamFlowMeterVendor_id.dispatchEvent(new Event("change"));
  steamFlowMeterModel_no.value = rowData.model_no;
  steamFlowMeterSerial_no.value = rowData.serial_no;
  steamFlowMeterYear_of_manufacturing.setAttribute('val', rowData.year_of_manufacturing);
  steamFlowMeterYear_of_manufacturing.value = rowData.year_of_manufacturing;
  steamFlowMeterYear_of_manufacturing.dispatchEvent(new Event("change"));
  steamFlowMeterWorking_principle_id.value = rowData.working_principle_id;
  steamFlowMeterWorking_principle_id.dispatchEvent(new Event("change"));
  steamFlowMeterSize_id.value = rowData.size_id;
  steamFlowMeterSize_id.dispatchEvent(new Event("change"));
  steamFlowMeterFlow_rate_min.setAttribute('val', rowData.flow_rate_min);
  steamFlowMeterFlow_rate_min.value = rowData.flow_rate_min;
  steamFlowMeterFlow_rate_min.dispatchEvent(new Event("change"));
  steamFlowMeterFlow_rate_max.setAttribute('val', rowData.flow_rate_max);
  steamFlowMeterFlow_rate_max.value = rowData.flow_rate_max;
  steamFlowMeterFlow_rate_max.dispatchEvent(new Event("change"));
  steamFlowMeterInput_power_id.value = rowData.input_power_id;
  steamFlowMeterInput_power_id.dispatchEvent(new Event("change"));
  steamFlowMeterOutput_signal_id.value = rowData.output_signal_id;
  steamFlowMeterOutput_signal_id.dispatchEvent(new Event("change"));
  steamFlowMeterConnected_tnpcb.checked = rowData.connected_tnpcb;
  steamFlowMeterTnpcb_ref.value = rowData.tnpcb_ref;
  steamFlowMeterConnected_cpcb.checked = rowData.connected_cpcb;
  steamFlowMeterCpcb_ref.value = rowData.cpcb_ref;
  steamFlowMeterIsactive.checked = rowData.isactive;
  steamFlowMeterRemarks.value = rowData.remarks;



  if (SteamFlowMeterInterface && SteamFlowMeterInterface.onDisplayForm)
    rowData = SteamFlowMeterInterface.onDisplayForm(rowData);

}


function onUpdateSteamFlowMeterBtnClick(e) {
  e.preventDefault();

  var steamFlowMeterObj = {};

  if (steamFlowMeterSfm_code.value != "") {
    steamFlowMeterObj.sfm_code = steamFlowMeterSfm_code.value;
  } else {
    steamFlowMeterObj.sfm_code = null;
  }
  if (steamFlowMeterSfm_description.value != "") {
    steamFlowMeterObj.sfm_description = steamFlowMeterSfm_description.value;
  } else {
    steamFlowMeterObj.sfm_description = null;
  }
  steamFlowMeterObj.vendor_id = steamFlowMeterVendor_id.getAttribute('Vendor_id');
  if (steamFlowMeterModel_no.value != "") {
    steamFlowMeterObj.model_no = steamFlowMeterModel_no.value;
  } else {
    steamFlowMeterObj.model_no = null;
  }
  if (steamFlowMeterSerial_no.value != "") {
    steamFlowMeterObj.serial_no = steamFlowMeterSerial_no.value;
  } else {
    steamFlowMeterObj.serial_no = null;
  }
  if (steamFlowMeterYear_of_manufacturing.getAttribute("val") != "") {
    steamFlowMeterObj.year_of_manufacturing = Number(steamFlowMeterYear_of_manufacturing.getAttribute("val"));
  } else {
    steamFlowMeterObj.year_of_manufacturing = null;
  }
  steamFlowMeterObj.working_principle_id = steamFlowMeterWorking_principle_id.getAttribute('Working_principle_id');
  steamFlowMeterObj.size_id = steamFlowMeterSize_id.getAttribute('Size_id');
  if (steamFlowMeterFlow_rate_min.getAttribute("val") != "") {
    steamFlowMeterObj.flow_rate_min = Number(steamFlowMeterFlow_rate_min.getAttribute("val"));
  } else {
    steamFlowMeterObj.flow_rate_min = null;
  }
  if (steamFlowMeterFlow_rate_max.getAttribute("val") != "") {
    steamFlowMeterObj.flow_rate_max = Number(steamFlowMeterFlow_rate_max.getAttribute("val"));
  } else {
    steamFlowMeterObj.flow_rate_max = null;
  }
  steamFlowMeterObj.input_power_id = steamFlowMeterInput_power_id.getAttribute('Input_power_id');
  steamFlowMeterObj.output_signal_id = steamFlowMeterOutput_signal_id.getAttribute('Output_signal_id');
  steamFlowMeterObj.connected_tnpcb = steamFlowMeterConnected_tnpcb.checked;
  if (steamFlowMeterTnpcb_ref.value != "") {
    steamFlowMeterObj.tnpcb_ref = steamFlowMeterTnpcb_ref.value;
  } else {
    steamFlowMeterObj.tnpcb_ref = null;
  }
  steamFlowMeterObj.connected_cpcb = steamFlowMeterConnected_cpcb.checked;
  if (steamFlowMeterCpcb_ref.value != "") {
    steamFlowMeterObj.cpcb_ref = steamFlowMeterCpcb_ref.value;
  } else {
    steamFlowMeterObj.cpcb_ref = null;
  }
  steamFlowMeterObj.isactive = steamFlowMeterIsactive.checked;
  if (steamFlowMeterRemarks.value != "") {
    steamFlowMeterObj.remarks = steamFlowMeterRemarks.value;
  } else {
    steamFlowMeterObj.remarks = null;
  }


  steamFlowMeterObj._sid = rowData._sid;
  var date = new Date();
  steamFlowMeterObj.modified_on = date.getTime();
  steamFlowMeterObj.modified_by = userObj.username;
  steamFlowMeterObj.created_by = rowData.created_by ? rowData.created_by : userObj.username;
  steamFlowMeterObj.created_on = rowData.created_on ? rowData.created_on : null;

  //Validate the steamFlowMeter object
  var checkSteamFlowMeter = validate(steamFlowMeterObj);

  //In validation is successfull
  if (checkSteamFlowMeter == true) {




    if (SteamFlowMeterInterface && SteamFlowMeterInterface.onBeforeUpdate)
      steamFlowMeterObj = SteamFlowMeterInterface.onBeforeUpdate(steamFlowMeterObj, dataSources);
    if (steamFlowMeterObj == false) {
      return;
    }


    clCommon.showLoader("updateProgress");
    clCommon.disable(updateSteamFlowMeterBtn);

    Service.updateSfm(steamFlowMeterObj, function(resultObj) {
      if (resultObj.code == 200) { //on success response
        clCommon.hideLoader("updateProgress");
        clCommon.enable(updateSteamFlowMeterBtn);
        s_toast(Strings.UPDATE_STEAMFLOWMETER_TOAST_SUCCESS);

        var isSuccessful = true;


        if (SteamFlowMeterInterface && SteamFlowMeterInterface.onAfterUpdate)
          steamFlowMeterObj = SteamFlowMeterInterface.onAfterUpdate(isSuccessful, resultObj.data, dataSources);
        if (steamFlowMeterObj == false) {
          return;
        }


        clCommon.setCookie("steamFlowMeter_id", resultObj.data._sid, 10);

        var index = primaryArr.findIndex(obj => obj._sid === resultObj.data._sid);

        if (index !== -1) {
          // Insert at the index where _sid matches
          primaryArr.splice(index, 0, resultObj.data);
        } else {
          // If not found, optionally push to end
          primaryArr.push(resultObj.data);
        }

        updateRowBySid(resultObj.data._sid, resultObj.data);

      } else {
        var isSuccessful = false;


        if (SteamFlowMeterInterface && SteamFlowMeterInterface.onAfterUpdate)
          steamFlowMeterObj = SteamFlowMeterInterface.onAfterUpdate(isSuccessful, resultObj.data, dataSources);
        if (steamFlowMeterObj == false) {
          return;
        }


        s_error(Strings.STEAMFLOWMETER_ERROR_TITLE, Strings.UPDATE_STEAMFLOWMETER_ERROR, dlgOptions);
      }
    });
  }
}

// Function to update a row by _sid
function updateRowBySid(sid, updatedData) {



  // Find the existing row index
  var rowIndexes = steamFlowMeterTable.rows().indexes().toArray();
  var foundIndex = -1;

  // Manual search to be precise
  for (var i = 0; i < rowIndexes.length; i++) {
    var d = steamFlowMeterTable.row(rowIndexes[i]).data();
    if (d && d._sid === sid) {
      foundIndex = rowIndexes[i];
      break;
    }
  }

  if (foundIndex !== -1) {
    // 1. Update the data in place (better than remove/add for maintaining state)
    steamFlowMeterTable.row(foundIndex).data(updatedData);

    // 2. Invalidate the row to force re-render (Runs renderData again)
    steamFlowMeterTable.row(foundIndex).invalidate().draw(false);

    // 3. Move to top (Optional, to match your previous logic)
    var rows = steamFlowMeterTable.rows().data().toArray();
    // Find our updated object in the array
    var internalIdx = rows.findIndex(function(r) {
      return r._sid === sid;
    });
    if (internalIdx > 0) {
      var item = rows.splice(internalIdx, 1)[0];
      rows.unshift(item);
      steamFlowMeterTable.clear().rows.add(rows).draw(false);
    }
  }

  selectRowBySid(sid);
}


// Function to select a row by _sid and trigger onRowClick
function selectRowBySid(sid) {
  if (sid == null) return;

  var table = steamFlowMeterTable;
  var pageLen = table.page.len();

  // Find the row by _sid
  var target = table.row(function(idx, data) {
    return data && data._sid === sid;
  });

  // Fallback: first row on current page if not found (and table not empty)
  if (!target.any()) {
    var first = table.row(':eq(0)', {
      page: 'current'
    });
    if (!first.any()) return; // empty table

    table.one('draw', function() {
      // Clear all current selections
      table.rows({
        page: 'current'
      }).every(function() {
        this.node().classList.remove('selected');
      });

      var firstNode = first.node();
      firstNode.classList.add('selected');

      // Trigger click
      firstNode.dispatchEvent(new Event('click', {
        bubbles: true
      }));
    });

    table.draw(false);
    return;
  }

  // Compute the display position (after search/order) to know the page number
  var rowIdx = target.index(); // DataTables internal index
  var displayIdxs = table.rows({
    search: 'applied',
    order: 'applied'
  }).indexes().toArray();
  var pos = displayIdxs.indexOf(rowIdx);
  var pageIndex = (pos > -1) ? Math.floor(pos / pageLen) : table.page();

  // After the table redraws to the right page, re-find & select the row, then click
  table.one('draw', function() {
    var r = table.row(function(i, d) {
      return d && d._sid === sid;
    });
    if (!r.any()) return;

    // Clear current selections
    table.rows({
      page: 'current'
    }).every(function() {
      this.node().classList.remove('selected');
    });

    var node = r.node();
    node.classList.add('selected');

    // Trigger click
    node.dispatchEvent(new Event('click', {
      bubbles: true
    }));
  });

  table.page(pageIndex).draw(false);


  var isFullCookie = clCommon.getCookie("bcssteam_full_view");
  if (isFullCookie === "true") {
    //clCommon.show(contentView);
    //clCommon.hide(formView);
    hideForm();
    if (selectedRow) {
      $(selectedRow).removeClass('selected');
      selectedRow = null;
    }
    deleteSteamFlowMeterBtn.classList.add('disabled');
  }
}




function onAddSteamFlowMeterBtnClick(e) {
  e.preventDefault();
  clearForm();

  if (clCommon.isMobile()) {
    showForm();
  } else {
    var isFullCookie = clCommon.getCookie("bcssteam_full_view");
    if (isFullCookie === "true") {
      toggleFullview(true);
    }
  }

  deleteSteamFlowMeterBtn.classList.add('disabled');


}



function clearForm() {
  var defaultObj = {
    "sfm_code": "",
    "sfm_description": "",
    "vendor_id": "",
    "model_no": "",
    "serial_no": "",
    "year_of_manufacturing": "",
    "working_principle_id": "",
    "size_id": "",
    "flow_rate_min": "",
    "flow_rate_max": "",
    "input_power_id": "",
    "output_signal_id": "",
    "connected_tnpcb": false,
    "tnpcb_ref": "",
    "connected_cpcb": false,
    "cpcb_ref": "",
    "isactive": false,
    "remarks": ""
  };


  clCommon.hide(vendor_idPnl);
  steamFlowMeterVendor_id.setAttribute("Vendor_id", "");
  selectedVendor_idId = defaultObj.vendor_id;

  clCommon.hide(working_principle_idPnl);
  steamFlowMeterWorking_principle_id.setAttribute("Working_principle_id", "");
  selectedWorking_principle_idId = defaultObj.working_principle_id;

  clCommon.hide(size_idPnl);
  steamFlowMeterSize_id.setAttribute("Size_id", "");
  selectedSize_idId = defaultObj.size_id;

  clCommon.hide(input_power_idPnl);
  steamFlowMeterInput_power_id.setAttribute("Input_power_id", "");
  selectedInput_power_idId = defaultObj.input_power_id;

  clCommon.hide(output_signal_idPnl);
  steamFlowMeterOutput_signal_id.setAttribute("Output_signal_id", "");
  selectedOutput_signal_idId = defaultObj.output_signal_id;



  steamFlowMeterYear_of_manufacturing.setAttribute("val", "");

  steamFlowMeterFlow_rate_min.setAttribute("val", "");

  steamFlowMeterFlow_rate_max.setAttribute("val", "");


  if (SteamFlowMeterInterface && SteamFlowMeterInterface.onClearForm) {
    var modDefaultObj = SteamFlowMeterInterface.onClearForm(defaultObj, dataSources);
    for (var attr in modDefaultObj) {
      if (modDefaultObj.hasOwnProperty(attr)) {
        defaultObj[attr] = modDefaultObj[attr]; // Apply changes to defaultObj
      }
    }
  }
  if (!clCommon.isMobile()) {
    clCommon.show(formView);
  }

  displayForm(defaultObj);

  clCommon.hide(updateBtn);
  clCommon.show(createBtn);

  deleteSteamFlowMeterBtn.classList.add('disabled');


  rowData = "";

  clCommon.focus(steamFlowMeterSfm_code);

  if (selectedRow) {
    $(selectedRow).removeClass('selected');
  }

  selectedRow = "";
}



function onDeleteSteamFlowMeterBtnClick() {
  var clArr = deleteSteamFlowMeterBtn.classList;
  if (clArr.contains('disabled') == false)
    s_confirm(Strings.CONFIRM, Strings.STEAMFLOWMETER_DELETE_CONFIRM + " - " + rowData.sfm_code + Strings.DELETE_TITLE_STEAMFLOWMETER + " ?", { //Confirmation with user
      STR_YES: dlgOptions.STR_YES,
      STR_NO: dlgOptions.STR_NO,
      onYes: function() { //on approval
        clCommon.showLoader("removeProgress");

        if (SteamFlowMeterInterface && SteamFlowMeterInterface.onBeforeDelete)
          rowData = SteamFlowMeterInterface.onBeforeDelete(rowData, dataSources);
        if (rowData == false) {
          clCommon.hideLoader("removeProgress");
          return;
        }


        Service.deleteSfm(rowData._sid, function(resultObj) {
          if (resultObj.code == 200) { //on Success response
            clCommon.hideLoader("removeProgress");

            var isSuccessful = true;

            var afterDelete = true;
            if (SteamFlowMeterInterface && SteamFlowMeterInterface.onAfterDelete)
              afterDelete = SteamFlowMeterInterface.onAfterDelete(isSuccessful, resultObj, dataSources);
            if (afterDelete == false) {
              return;
            }


            deleteSteamFlowMeterBtn.classList.add('disabled');

            removeRowBySid(rowData._sid);

            var index = primaryArr.findIndex(item => item._sid === rowData._sid);

            if (index !== -1) {
              primaryArr.splice(index, 1);
            }

            s_toast(Strings.DELETE_STEAMFLOWMETER_TOAST_SUCCESS);
          } else { //On Error response
            var isSuccessful = false;

            var afterDelete = true;
            if (SteamFlowMeterInterface && SteamFlowMeterInterface.onAfterDelete)
              afterDelete = SteamFlowMeterInterface.onAfterDelete(isSuccessful, resultObj, dataSources);
            if (afterDelete == false) {
              return;
            }

            s_error(Strings.STEAMFLOWMETER_ERROR_TITLE, Strings.DELETE_STEAMFLOWMETER_ERROR, dlgOptions);
            clCommon.hideLoader("removeProgress");
          }
        });
      }
    });
}

// Function to remove a row by _sid
function removeRowBySid(sid) {
  // Remove the row that matches the provided sid
  steamFlowMeterTable.rows(function(idx, data, node) {
    return data._sid === sid; // Find row where _sid matches
  }).remove().draw(); // Remove and redraw the table

  if (steamFlowMeterTable.data().any()) {
    // Select the first row in the current page
    var firstRowNode = steamFlowMeterTable.row(':eq(0)', {
      page: 'current'
    }).node();
    if (firstRowNode) {


      clCommon.enable(deleteSteamFlowMeterBtn);

      $(firstRowNode).addClass('selected');
      $(firstRowNode).trigger('click'); // Trigger the click event to simulate row selection
    }
  }
}



function onFieldFocus(e) {
  e.preventDefault();
  var focusedField = this;

  var currencyAttr = focusedField.getAttribute("currency");
  var isCurrencyField = currencyAttr && currencyAttr.trim().toLowerCase() === "true";

  var defaultVal = focusedField.getAttribute("default_val");
  var defaultDigits = Number.isFinite(parseInt(defaultVal)) ? parseInt(defaultVal) : (isCurrencyField ? "" : 0);


  if (focusedField.id == "steamFlowMeterYear_of_manufacturing") {
    var raw = focusedField.value.replace(/[^0-9.-]+/g, "");
    raw = (raw <= 0 || raw === "" || isNaN(raw)) ? defaultDigits : Number(raw);
    focusedField.value = raw;
  }

  if (focusedField.id == "steamFlowMeterFlow_rate_min") {
    var raw = focusedField.value.replace(/[^0-9.-]+/g, "");
    raw = (raw <= 0 || raw === "" || isNaN(raw)) ? defaultDigits : Number(raw);
    focusedField.value = raw;
  }

  if (focusedField.id == "steamFlowMeterFlow_rate_max") {
    var raw = focusedField.value.replace(/[^0-9.-]+/g, "");
    raw = (raw <= 0 || raw === "" || isNaN(raw)) ? defaultDigits : Number(raw);
    focusedField.value = raw;
  }



  if (SteamFlowMeterInterface && SteamFlowMeterInterface.onFieldFocus)
    var returnData = SteamFlowMeterInterface.onFieldFocus(focusedField, dataSources);
}


function onFieldChange(e) {
  e.preventDefault();
  var changedField = this;


  if (changedField.id == "steamFlowMeterVendor_id") {
    for (var dt in dataSources.getAllVendorsWithoutLimit) {
      var dtObj = dataSources.getAllVendorsWithoutLimit[dt];
      if (selectedVendor_idId && selectedVendor_idId == dtObj._sid) {
        steamFlowMeterVendor_id.value = dtObj.business_partner_short_name ? dtObj.business_partner_short_name : "";
        break;
      }
    }
  }

  if (changedField.id == "steamFlowMeterWorking_principle_id") {
    for (var dt in dataSources.getWorkingPrinciple) {
      var dtObj = dataSources.getWorkingPrinciple[dt];
      if (selectedWorking_principle_idId && selectedWorking_principle_idId == dtObj.id) {
        steamFlowMeterWorking_principle_id.value = dtObj.working_principle ? dtObj.working_principle : "";
        break;
      }
    }
  }

  if (changedField.id == "steamFlowMeterSize_id") {
    for (var dt in dataSources.getSize) {
      var dtObj = dataSources.getSize[dt];
      if (selectedSize_idId && selectedSize_idId == dtObj.id) {
        steamFlowMeterSize_id.value = dtObj.size ? dtObj.size : "";
        break;
      }
    }
  }

  if (changedField.id == "steamFlowMeterInput_power_id") {
    for (var dt in dataSources.getInputPower) {
      var dtObj = dataSources.getInputPower[dt];
      if (selectedInput_power_idId && selectedInput_power_idId == dtObj.id) {
        steamFlowMeterInput_power_id.value = dtObj.input_power ? dtObj.input_power : "";
        break;
      }
    }
  }

  if (changedField.id == "steamFlowMeterOutput_signal_id") {
    for (var dt in dataSources.getOutputSignal) {
      var dtObj = dataSources.getOutputSignal[dt];
      if (selectedOutput_signal_idId && selectedOutput_signal_idId == dtObj.id) {
        steamFlowMeterOutput_signal_id.value = dtObj.output_signal ? dtObj.output_signal : "";
        break;
      }
    }
  }



  if (changedField.id == "steamFlowMeterYear_of_manufacturing") {
    steamFlowMeterYear_of_manufacturing = formattingNumberElements(changedField);
  }

  if (changedField.id == "steamFlowMeterFlow_rate_min") {
    steamFlowMeterFlow_rate_min = formattingNumberElements(changedField);
  }

  if (changedField.id == "steamFlowMeterFlow_rate_max") {
    steamFlowMeterFlow_rate_max = formattingNumberElements(changedField);
  }


  var dependentFieldArr = document.querySelectorAll(".form-holder [data-dependent=" + changedField.id + "]");
  if (dependentFieldArr.length > 0) {
    for (var idx = 0; idx < dependentFieldArr.length; idx++) {
      var dependentField = dependentFieldArr[idx];
      var dataSrcFunction = dependentField.getAttribute("data-srcFunc");
      if (dataSrcFunction) {
        delete window.dataSources[dataSrcFunction];
        var functionCall = window[dataSrcFunction].call(window, true, changedField);
      } else {
        if (SteamFlowMeterInterface && SteamFlowMeterInterface.onFieldChange)
          var returnData = SteamFlowMeterInterface.onFieldChange(changedField, dataSources);
      }
    }
  } else {
    if (SteamFlowMeterInterface && SteamFlowMeterInterface.onFieldChange)
      var returnData = SteamFlowMeterInterface.onFieldChange(changedField, dataSources);
  }

}

function formattingNumberElements(fieldEl) {
  var raw = fieldEl.value.replace(/[^0-9.-]+/g, "");
  raw = raw === "" || isNaN(raw) ? 0 : Number(raw);
  fieldEl.setAttribute("val", raw);

  var decimalAttr = fieldEl.getAttribute("decimal");
  var decimalDigits = Number.isFinite(parseInt(decimalAttr)) ? parseInt(decimalAttr) : null;


  var currencyAttr = fieldEl.getAttribute("currency");
  var isCurrencyField = currencyAttr && currencyAttr.trim().toLowerCase() === "true";

  var currencyCode = (typeof slocale !== "undefined") ? slocale.getLocaleInfo(localeCode).currency_code : currency;


  if (isCurrencyField) {
    var currencyFormatForAmount = decimalDigits !== null ? new Intl.NumberFormat(localeCode, {
      style: "currency",
      currency: currencyCode,
      minimumFractionDigits: decimalDigits,
      maximumFractionDigits: decimalDigits
    }) : currencyFormat;


    fieldEl.value = currencyFormatForAmount.format(raw);
  } else {
    var numberFormatForAmount = decimalDigits !== null ? new Intl.NumberFormat(localeCode, {
      style: "decimal",
      minimumFractionDigits: decimalDigits,
      maximumFractionDigits: decimalDigits
    }) : numberFormat;


    fieldEl.value = numberFormatForAmount.format(raw);
  }
  return fieldEl;
}


function validate(steamFlowMeterObj) {

  if (!steamFlowMeterObj.sfm_code) {
    s_info(Strings.VALIDATION_ERROR_TITLE, Strings.STEAMFLOWMETER_INVALID_SFM_CODE, dlgOptions);
    return false;
  }

  if (!steamFlowMeterObj.sfm_description) {
    s_info(Strings.VALIDATION_ERROR_TITLE, Strings.STEAMFLOWMETER_INVALID_SFM_DESCRIPTION, dlgOptions);
    return false;
  }

  if (!steamFlowMeterObj.vendor_id) {
    s_info(Strings.VALIDATION_ERROR_TITLE, Strings.STEAMFLOWMETER_INVALID_VENDOR_ID, dlgOptions);
    return false;
  }

  if (!steamFlowMeterObj.model_no) {
    s_info(Strings.VALIDATION_ERROR_TITLE, Strings.STEAMFLOWMETER_INVALID_MODEL_NO, dlgOptions);
    return false;
  }

  if (!steamFlowMeterObj.serial_no) {
    s_info(Strings.VALIDATION_ERROR_TITLE, Strings.STEAMFLOWMETER_INVALID_SERIAL_NO, dlgOptions);
    return false;
  }

  if (!steamFlowMeterObj.year_of_manufacturing) {
    s_info(Strings.VALIDATION_ERROR_TITLE, Strings.STEAMFLOWMETER_INVALID_YEAR_OF_MANUFACTURING, dlgOptions);
    return false;
  }

  if (steamFlowMeterObj.year_of_manufacturing && !onlyNumRegExp.test(steamFlowMeterObj.year_of_manufacturing)) {
    s_info(Strings.VALIDATION_ERROR_TITLE, Strings.STEAMFLOWMETER_INVALID_YEAR_OF_MANUFACTURING, dlgOptions);
    return false;
  }

  if (!steamFlowMeterObj.working_principle_id) {
    s_info(Strings.VALIDATION_ERROR_TITLE, Strings.STEAMFLOWMETER_INVALID_WORKING_PRINCIPLE_ID, dlgOptions);
    return false;
  }

  if (!steamFlowMeterObj.size_id) {
    s_info(Strings.VALIDATION_ERROR_TITLE, Strings.STEAMFLOWMETER_INVALID_SIZE_ID, dlgOptions);
    return false;
  }

  if (steamFlowMeterObj.flow_rate_min && !onlyNumRegExp.test(steamFlowMeterObj.flow_rate_min)) {
    s_info(Strings.VALIDATION_ERROR_TITLE, Strings.STEAMFLOWMETER_INVALID_FLOW_RATE_MIN, dlgOptions);
    return false;
  }

  if (!steamFlowMeterObj.flow_rate_max) {
    s_info(Strings.VALIDATION_ERROR_TITLE, Strings.STEAMFLOWMETER_INVALID_FLOW_RATE_MAX, dlgOptions);
    return false;
  }

  if (steamFlowMeterObj.flow_rate_max && !onlyNumRegExp.test(steamFlowMeterObj.flow_rate_max)) {
    s_info(Strings.VALIDATION_ERROR_TITLE, Strings.STEAMFLOWMETER_INVALID_FLOW_RATE_MAX, dlgOptions);
    return false;
  }

  if (!steamFlowMeterObj.input_power_id) {
    s_info(Strings.VALIDATION_ERROR_TITLE, Strings.STEAMFLOWMETER_INVALID_INPUT_POWER_ID, dlgOptions);
    return false;
  }

  if (!steamFlowMeterObj.output_signal_id) {
    s_info(Strings.VALIDATION_ERROR_TITLE, Strings.STEAMFLOWMETER_INVALID_OUTPUT_SIGNAL_ID, dlgOptions);
    return false;
  }


  return true;
}


function containsOnlyLetters(str) {
  return /^[a-zA-Z\s]+$/.test(str);
}



function containsNumbers(str) {
  return /^[0-9.]+$/.test(str);
}




function onToolBarBtnClick(e) {
  e.preventDefault();
  var clickedBtn = this;
  var returnData = true;
  if (SteamFlowMeterInterface && SteamFlowMeterInterface.onToolBarBtnClick)
    returnData = SteamFlowMeterInterface.onToolBarBtnClick(clickedBtn, dataSources);
  if (returnData === false) {
    return;
  } else {
    var clArr;
    switch (clickedBtn.id) {
      case "loadMore":
        clArr = loadMore.classList;
        if (clArr.contains('disabled') == false)
          loadLimFunction(limit);
        break;
      case "loadAll":
        clArr = loadAll.classList;
        if (clArr.contains('disabled') == false)
          s_confirm(Strings.CONFIRM, Strings.CONFIRM_LOAD_ALL_PRT_1 + "?" + Strings.CONFIRM_LOAD_PRT_2, { //Confirm with the user 
            STR_YES: dlgOptions.STR_YES,
            STR_NO: dlgOptions.STR_NO,
            onYes: function() { //On positive confirmation
              primaryArr = [];
              loadMore.classList.add('disabled');
              loadAll.classList.add('disabled');
              loadLimFunction(0);

            }
          });

        break;


      case "steamFlowMeterVendor_idZoom":
        onVendor_idZoomBtn();
        break;
      case "steamFlowMeterWorking_principle_idZoom":
        onWorking_principle_idZoomBtn();
        break;
      case "steamFlowMeterSize_idZoom":
        onSize_idZoomBtn();
        break;
      case "steamFlowMeterInput_power_idZoom":
        onInput_power_idZoomBtn();
        break;
      case "steamFlowMeterOutput_signal_idZoom":
        onOutput_signal_idZoomBtn();
        break;

    }
  }
}


function onLookupAddBtnClick(e) {
  e.preventDefault();
  var clickedBtn = this;
  var returnData = true;
  if (SteamFlowMeterInterface && SteamFlowMeterInterface.onLookupAddBtnClick)
    returnData = SteamFlowMeterInterface.onLookupAddBtnClick(clickedBtn.getAttribute('data-lookup-add'), clickedBtn, dataSources);
  if (returnData === false) {
    return;
  }
}









function initVendor_idTable() {
  vendor_idTable = $('#vendor_idTable').DataTable({
    paging: false,
    info: false,
    autoWidth: false,
    columns: [{
        data: 'radio'
      },
      {
        data: 'vendor_idName'
      }
    ],
    columnDefs: [{
      "width": "25px",
      "targets": 0
    }]
  });
  vendor_idTable.table().node().classList.remove('nowrap');
}

function onVendor_idZoomBtn(e) {
  clCommon.hide(formView);
  clCommon.show(vendor_idPnl);
  openLookupView(vendor_idPnl);
  var pushState = (e !== false);
  var vendor_idArr = [];
  var vendor_idFlg = false;
  var objective = {
    "_sid": steamFlowMeterVendor_id.getAttribute("Vendor_id")
  };
  var check = true;
  if (SteamFlowMeterInterface && SteamFlowMeterInterface.onLookUpData) {
    check = SteamFlowMeterInterface.onLookUpData("vendor_id", dataSources);
  }
  if (check == false) return;

  for (var item of dataSources.getAllVendorsWithoutLimit) {
    var checked = "";
    if (objective._sid && objective._sid == item._sid) {
      checked = "checked";
      vendor_idFlg = true;
    } else if (rowData && rowData.vendor_id == item._sid && !vendor_idFlg) {
      checked = "checked";
    }

    vendor_idArr.push({
      "vendor_idName": '<label for="' + item._sid + '">' + item.business_partner_short_name + '</label>',
      "radio": '<input type="radio" name="vendor_idName" vendor_idId="' + item._sid + '" vendor_idName="' + JSON.stringify(item).replaceAll('"', '$' + 'DQUOTE' + '$') + '" ' + checked + '>'
    });
  }

  vendor_idTable.clear().draw();
  vendor_idTable.rows.add(vendor_idArr).draw();

  if (clCommon.isMobile() && pushState) {
    window.history.pushState('vendor_idForm', null, '#vendor_idsForm');
    clCommon.hide(contentView);
  }
}

function onRelateVendor_idBtn(e) {
  var selectedObj = document.querySelector('input[name="vendor_idName"]:checked');
  if (!selectedObj) {
    s_info(Strings.STEAMFLOWMETER_ALERT_TITLE, Strings.STEAMFLOWMETER_INVALID_VENDOR_ID, dlgOptions);
    return;
  }

  var objective = JSON.parse(selectedObj.getAttribute("vendor_idName").replaceAll('$DQUOTE$', '"'));
  steamFlowMeterVendor_id.value = objective.business_partner_short_name || "";
  steamFlowMeterVendor_id.setAttribute("Vendor_id", objective._sid || "");
  selectedVendor_idId = objective._sid || "";

  steamFlowMeterVendor_id.dispatchEvent(new Event('change'));
  clCommon.hide(vendor_idPnl);
  clCommon.show(formView);
  closeLookupView(vendor_idPnl);
}

function onSearchVendor_id() {
  const searchInput = document.getElementById('searchVendor_idBox');
  if (vendor_idTable && searchInput) {
    vendor_idTable.search(searchInput.value).draw();
  }
}

function onCancelVendor_idBtn(e) {
  clCommon.hide(vendor_idPnl);
  clCommon.show(formView);
  closeLookupView(vendor_idPnl);
}

function onVendor_idMobBackBtn(e) {
  history.back();
}

function initWorking_principle_idTable() {
  working_principle_idTable = $('#working_principle_idTable').DataTable({
    paging: false,
    info: false,
    autoWidth: false,
    columns: [{
        data: 'radio'
      },
      {
        data: 'working_principle_idName'
      }
    ],
    columnDefs: [{
      "width": "25px",
      "targets": 0
    }]
  });
  working_principle_idTable.table().node().classList.remove('nowrap');
}

function onWorking_principle_idZoomBtn(e) {
  clCommon.hide(formView);
  clCommon.show(working_principle_idPnl);
  openLookupView(working_principle_idPnl);
  var pushState = (e !== false);
  var working_principle_idArr = [];
  var working_principle_idFlg = false;
  var objective = {
    "id": steamFlowMeterWorking_principle_id.getAttribute("Working_principle_id")
  };
  var check = true;
  if (SteamFlowMeterInterface && SteamFlowMeterInterface.onLookUpData) {
    check = SteamFlowMeterInterface.onLookUpData("working_principle_id", dataSources);
  }
  if (check == false) return;

  for (var item of dataSources.getWorkingPrinciple) {
    var checked = "";
    if (objective.id && objective.id == item.id) {
      checked = "checked";
      working_principle_idFlg = true;
    } else if (rowData && rowData.working_principle_id == item.id && !working_principle_idFlg) {
      checked = "checked";
    }

    working_principle_idArr.push({
      "working_principle_idName": '<label for="' + item.id + '">' + item.working_principle + '</label>',
      "radio": '<input type="radio" name="working_principle_idName" working_principle_idId="' + item._sid + '" working_principle_idName="' + JSON.stringify(item).replaceAll('"', '$' + 'DQUOTE' + '$') + '" ' + checked + '>'
    });
  }

  working_principle_idTable.clear().draw();
  working_principle_idTable.rows.add(working_principle_idArr).draw();

  if (clCommon.isMobile() && pushState) {
    window.history.pushState('working_principle_idForm', null, '#working_principle_idsForm');
    clCommon.hide(contentView);
  }
}

function onRelateWorking_principle_idBtn(e) {
  var selectedObj = document.querySelector('input[name="working_principle_idName"]:checked');
  if (!selectedObj) {
    s_info(Strings.STEAMFLOWMETER_ALERT_TITLE, Strings.STEAMFLOWMETER_INVALID_WORKING_PRINCIPLE_ID, dlgOptions);
    return;
  }

  var objective = JSON.parse(selectedObj.getAttribute("working_principle_idName").replaceAll('$DQUOTE$', '"'));
  steamFlowMeterWorking_principle_id.value = objective.working_principle || "";
  steamFlowMeterWorking_principle_id.setAttribute("Working_principle_id", objective.id || "");
  selectedWorking_principle_idId = objective.id || "";

  steamFlowMeterWorking_principle_id.dispatchEvent(new Event('change'));
  clCommon.hide(working_principle_idPnl);
  clCommon.show(formView);
  closeLookupView(working_principle_idPnl);
}

function onSearchWorking_principle_id() {
  const searchInput = document.getElementById('searchWorking_principle_idBox');
  if (working_principle_idTable && searchInput) {
    working_principle_idTable.search(searchInput.value).draw();
  }
}

function onCancelWorking_principle_idBtn(e) {
  clCommon.hide(working_principle_idPnl);
  clCommon.show(formView);
  closeLookupView(working_principle_idPnl);
}

function onWorking_principle_idMobBackBtn(e) {
  history.back();
}

function initSize_idTable() {
  size_idTable = $('#size_idTable').DataTable({
    paging: false,
    info: false,
    autoWidth: false,
    columns: [{
        data: 'radio'
      },
      {
        data: 'size_idName'
      }
    ],
    columnDefs: [{
      "width": "25px",
      "targets": 0
    }]
  });
  size_idTable.table().node().classList.remove('nowrap');
}

function onSize_idZoomBtn(e) {
  clCommon.hide(formView);
  clCommon.show(size_idPnl);
  openLookupView(size_idPnl);
  var pushState = (e !== false);
  var size_idArr = [];
  var size_idFlg = false;
  var objective = {
    "id": steamFlowMeterSize_id.getAttribute("Size_id")
  };
  var check = true;
  if (SteamFlowMeterInterface && SteamFlowMeterInterface.onLookUpData) {
    check = SteamFlowMeterInterface.onLookUpData("size_id", dataSources);
  }
  if (check == false) return;

  for (var item of dataSources.getSize) {
    var checked = "";
    if (objective.id && objective.id == item.id) {
      checked = "checked";
      size_idFlg = true;
    } else if (rowData && rowData.size_id == item.id && !size_idFlg) {
      checked = "checked";
    }

    size_idArr.push({
      "size_idName": '<label for="' + item.id + '">' + item.size + '</label>',
      "radio": '<input type="radio" name="size_idName" size_idId="' + item._sid + '" size_idName="' + JSON.stringify(item).replaceAll('"', '$' + 'DQUOTE' + '$') + '" ' + checked + '>'
    });
  }

  size_idTable.clear().draw();
  size_idTable.rows.add(size_idArr).draw();

  if (clCommon.isMobile() && pushState) {
    window.history.pushState('size_idForm', null, '#size_idsForm');
    clCommon.hide(contentView);
  }
}

function onRelateSize_idBtn(e) {
  var selectedObj = document.querySelector('input[name="size_idName"]:checked');
  if (!selectedObj) {
    s_info(Strings.STEAMFLOWMETER_ALERT_TITLE, Strings.STEAMFLOWMETER_INVALID_SIZE_ID, dlgOptions);
    return;
  }

  var objective = JSON.parse(selectedObj.getAttribute("size_idName").replaceAll('$DQUOTE$', '"'));
  steamFlowMeterSize_id.value = objective.size || "";
  steamFlowMeterSize_id.setAttribute("Size_id", objective.id || "");
  selectedSize_idId = objective.id || "";

  steamFlowMeterSize_id.dispatchEvent(new Event('change'));
  clCommon.hide(size_idPnl);
  clCommon.show(formView);
  closeLookupView(size_idPnl);
}

function onSearchSize_id() {
  const searchInput = document.getElementById('searchSize_idBox');
  if (size_idTable && searchInput) {
    size_idTable.search(searchInput.value).draw();
  }
}

function onCancelSize_idBtn(e) {
  clCommon.hide(size_idPnl);
  clCommon.show(formView);
  closeLookupView(size_idPnl);
}

function onSize_idMobBackBtn(e) {
  history.back();
}

function initInput_power_idTable() {
  input_power_idTable = $('#input_power_idTable').DataTable({
    paging: false,
    info: false,
    autoWidth: false,
    columns: [{
        data: 'radio'
      },
      {
        data: 'input_power_idName'
      }
    ],
    columnDefs: [{
      "width": "25px",
      "targets": 0
    }]
  });
  input_power_idTable.table().node().classList.remove('nowrap');
}

function onInput_power_idZoomBtn(e) {
  clCommon.hide(formView);
  clCommon.show(input_power_idPnl);
  openLookupView(input_power_idPnl);
  var pushState = (e !== false);
  var input_power_idArr = [];
  var input_power_idFlg = false;
  var objective = {
    "id": steamFlowMeterInput_power_id.getAttribute("Input_power_id")
  };
  var check = true;
  if (SteamFlowMeterInterface && SteamFlowMeterInterface.onLookUpData) {
    check = SteamFlowMeterInterface.onLookUpData("input_power_id", dataSources);
  }
  if (check == false) return;

  for (var item of dataSources.getInputPower) {
    var checked = "";
    if (objective.id && objective.id == item.id) {
      checked = "checked";
      input_power_idFlg = true;
    } else if (rowData && rowData.input_power_id == item.id && !input_power_idFlg) {
      checked = "checked";
    }

    input_power_idArr.push({
      "input_power_idName": '<label for="' + item.id + '">' + item.input_power + '</label>',
      "radio": '<input type="radio" name="input_power_idName" input_power_idId="' + item._sid + '" input_power_idName="' + JSON.stringify(item).replaceAll('"', '$' + 'DQUOTE' + '$') + '" ' + checked + '>'
    });
  }

  input_power_idTable.clear().draw();
  input_power_idTable.rows.add(input_power_idArr).draw();

  if (clCommon.isMobile() && pushState) {
    window.history.pushState('input_power_idForm', null, '#input_power_idsForm');
    clCommon.hide(contentView);
  }
}

function onRelateInput_power_idBtn(e) {
  var selectedObj = document.querySelector('input[name="input_power_idName"]:checked');
  if (!selectedObj) {
    s_info(Strings.STEAMFLOWMETER_ALERT_TITLE, Strings.STEAMFLOWMETER_INVALID_INPUT_POWER_ID, dlgOptions);
    return;
  }

  var objective = JSON.parse(selectedObj.getAttribute("input_power_idName").replaceAll('$DQUOTE$', '"'));
  steamFlowMeterInput_power_id.value = objective.input_power || "";
  steamFlowMeterInput_power_id.setAttribute("Input_power_id", objective.id || "");
  selectedInput_power_idId = objective.id || "";

  steamFlowMeterInput_power_id.dispatchEvent(new Event('change'));
  clCommon.hide(input_power_idPnl);
  clCommon.show(formView);
  closeLookupView(input_power_idPnl);
}

function onSearchInput_power_id() {
  const searchInput = document.getElementById('searchInput_power_idBox');
  if (input_power_idTable && searchInput) {
    input_power_idTable.search(searchInput.value).draw();
  }
}

function onCancelInput_power_idBtn(e) {
  clCommon.hide(input_power_idPnl);
  clCommon.show(formView);
  closeLookupView(input_power_idPnl);
}

function onInput_power_idMobBackBtn(e) {
  history.back();
}

function initOutput_signal_idTable() {
  output_signal_idTable = $('#output_signal_idTable').DataTable({
    paging: false,
    info: false,
    autoWidth: false,
    columns: [{
        data: 'radio'
      },
      {
        data: 'output_signal_idName'
      }
    ],
    columnDefs: [{
      "width": "25px",
      "targets": 0
    }]
  });
  output_signal_idTable.table().node().classList.remove('nowrap');
}

function onOutput_signal_idZoomBtn(e) {
  clCommon.hide(formView);
  clCommon.show(output_signal_idPnl);
  openLookupView(output_signal_idPnl);
  var pushState = (e !== false);
  var output_signal_idArr = [];
  var output_signal_idFlg = false;
  var objective = {
    "id": steamFlowMeterOutput_signal_id.getAttribute("Output_signal_id")
  };
  var check = true;
  if (SteamFlowMeterInterface && SteamFlowMeterInterface.onLookUpData) {
    check = SteamFlowMeterInterface.onLookUpData("output_signal_id", dataSources);
  }
  if (check == false) return;

  for (var item of dataSources.getOutputSignal) {
    var checked = "";
    if (objective.id && objective.id == item.id) {
      checked = "checked";
      output_signal_idFlg = true;
    } else if (rowData && rowData.output_signal_id == item.id && !output_signal_idFlg) {
      checked = "checked";
    }

    output_signal_idArr.push({
      "output_signal_idName": '<label for="' + item.id + '">' + item.output_signal + '</label>',
      "radio": '<input type="radio" name="output_signal_idName" output_signal_idId="' + item._sid + '" output_signal_idName="' + JSON.stringify(item).replaceAll('"', '$' + 'DQUOTE' + '$') + '" ' + checked + '>'
    });
  }

  output_signal_idTable.clear().draw();
  output_signal_idTable.rows.add(output_signal_idArr).draw();

  if (clCommon.isMobile() && pushState) {
    window.history.pushState('output_signal_idForm', null, '#output_signal_idsForm');
    clCommon.hide(contentView);
  }
}

function onRelateOutput_signal_idBtn(e) {
  var selectedObj = document.querySelector('input[name="output_signal_idName"]:checked');
  if (!selectedObj) {
    s_info(Strings.STEAMFLOWMETER_ALERT_TITLE, Strings.STEAMFLOWMETER_INVALID_OUTPUT_SIGNAL_ID, dlgOptions);
    return;
  }

  var objective = JSON.parse(selectedObj.getAttribute("output_signal_idName").replaceAll('$DQUOTE$', '"'));
  steamFlowMeterOutput_signal_id.value = objective.output_signal || "";
  steamFlowMeterOutput_signal_id.setAttribute("Output_signal_id", objective.id || "");
  selectedOutput_signal_idId = objective.id || "";

  steamFlowMeterOutput_signal_id.dispatchEvent(new Event('change'));
  clCommon.hide(output_signal_idPnl);
  clCommon.show(formView);
  closeLookupView(output_signal_idPnl);
}

function onSearchOutput_signal_id() {
  const searchInput = document.getElementById('searchOutput_signal_idBox');
  if (output_signal_idTable && searchInput) {
    output_signal_idTable.search(searchInput.value).draw();
  }
}

function onCancelOutput_signal_idBtn(e) {
  clCommon.hide(output_signal_idPnl);
  clCommon.show(formView);
  closeLookupView(output_signal_idPnl);
}

function onOutput_signal_idMobBackBtn(e) {
  history.back();
}
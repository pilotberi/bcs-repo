/*
	Generated By : Steps Code Generator.
	Generated On : Wed Feb 11 2026 10:25:14 GMT+0530 (India Standard Time)
	Description : Menu Library for BCSSteam
*/

var customMenuLblArr = [];
var isCustom = false;
var customAppName = null;

var menuHolderElem;
var activeMenu;
var activeFlg = false;

//Function to set menu based on parent html element
function setMenu(menuHolder, pageMenu, customFlg, customMenu) {
  menuHolderElem = menuHolder;
  activeMenu = pageMenu;

  if (customMenu && Array.isArray(customMenu))
    customMenuLblArr = customMenu

  if (customFlg) {
    isCustom = customFlg;
    customAppName = clCommon.getCustomAppName();
  }
}

function processMenu(menuArr) {
  try {
    var menus = {};

    for (var m = 0; m < menuArr.length; m++) {
      var menuObj = JSON.parse(menuArr[m].definition);
      var active = (m === 0) ? true : false;
      menuObj.active = active;
      menus[menuObj.id] = menuObj;
    }

    var menuLabels = [" bcsusermenu", "bcssupervisormenu", "bcsexecutivemenu", "bcsadminmenu"];
    menuLabels = menuLabels.sort(function(m1, m2) {
      if (menus[m1] && menus[m2]) {
        var seq1 = menus[m1].sequence ? menus[m1].sequence : 0;
        var seq2 = menus[m2].sequence ? menus[m2].sequence : 0;

        return seq1 - seq2;
      }
    });

    for (var mIdx = 0; mIdx <= menuLabels.length; mIdx++) {
      var menuLabel = menuLabels[mIdx];
      if (menus[menuLabel]) {
        var menuObj = menus[menuLabel];
        addToolBar(menuObj);

      }

      delete menus[menuLabel];
    }

    var menuKeys = Object.keys(menus);
    if (menuKeys.length > 0) {
      menuKeys = menuKeys.sort(function(m1, m2) {
        if (menus[m1] && menus[m2]) {
          var seq1 = menus[m1].sequence ? menus[m1].sequence : 0;
          var seq2 = menus[m2].sequence ? menus[m2].sequence : 0;

          return seq1 - seq2;
        }
      });

      for (var mkIdx = 0; mkIdx < menuKeys.length; mkIdx++) { // Fixed loop condition
        var menuKey = menuKeys[mkIdx];
        if (menus[menuKey]) {
          var menuObj = menus[menuKey];
          if (params && params.app) {
            var appName = params.app;
            menuObj.tools.forEach(tool => {

              //Process href
              if (tool.href.startsWith("../")) {
                if (tool.href.indexOf(`/${currAppName}/`) !== -1) {
                  var parts = tool.href.split("/");
                  tool.href = parts.slice(2).join("/"); // Remove "../" and the first directory
                }
              } else {
                tool.href = `../${appName}/${tool.href}`;
              }

              // Process icon
              if (tool.icon.startsWith("../")) {
                if (tool.href.indexOf(`/${currAppName}/`) !== -1) {
                  var parts = tool.icon.split("/");
                  tool.icon = parts.slice(2).join("/"); // Remove "../" and the first directory
                }
              } else {
                tool.icon = `../${appName}/${tool.icon}`;
              }
            });
          }
          addToolBar(menuObj);
        }
      }
    }



  } catch (e) {
    s_error(Strings.GET_APP_USER_INFO_ERROR_TITLE, Strings.APP_USER_MENU_ERROR);
    console.error(e);
  }
}

function addToolBar(menuObj) {
  var toolsArr = menuObj.tools;
  var mobileToolsArr = menuObj.mobile_tools;
  var active = menuObj.active;

  if (clCommon.isMobile() && mobileToolsArr) {
    var modToolsArr = [];

    mobileToolsArr.forEach(mToolId => {
      toolsArr.forEach(tool => {
        if (tool.id === mToolId) {
          modToolsArr.push(tool);
        }
      });
    });
    if (modToolsArr.length > 0)
      toolsArr = modToolsArr;
    else
      return;
  }

  var toolBar = document.createElement('ul');

  toolBar.classList.add('list-unstyled');
  toolBar.classList.add('components');
  toolBar.classList.add('menu');

  for (var t = 0; t < toolsArr.length; t++) {
    var tool = toolsArr[t];

    //Function to add menu to menu bar
    addTool(toolBar, tool, (tool.id == activeMenu));
  }
  if (toolBar.children.length !== 0) {
    menuHolderElem.appendChild(toolBar);
  }
}

var globMenuArr = [];

function addTool(toolBar, toolObj, active) {
  if (!globMenuArr.includes(toolObj.id + "-" + toolObj.href)) {
    var tool = document.createElement('li');
    tool.setAttribute('title', clCommon.getString(clCommon.formatStringAsKey(toolObj.title), toolObj.title));
    globMenuArr.push(toolObj.id + "-" + toolObj.href);
    //Check Active menu
    if (!activeFlg && active) {
      tool.classList.add('active');
      currTool = tool;
      activeFlg = true; //set active only for the first menu in the order
    }

    //Add menu icon
    var iconPath = (customAppName && !clCommon.isOrgApp(toolObj.icon)) ? '/steps/hq/' + customAppName + '/' + toolObj.icon : toolObj.icon;
    tool.innerHTML = '<a><img src="' + iconPath + '" title="' + clCommon.getString(clCommon.formatStringAsKey(toolObj.title), toolObj.title) + '"></a>';
    toolObj.el = tool;

    tool.addEventListener('click', function() {
      if (customAppName && !clCommon.isOrgApp(toolObj.href))
        window.location = '/steps/hq/' + customAppName + '/' + toolObj.href;
      else
        window.location = toolObj.href;
    });

    toolBar.appendChild(tool);
  }
}
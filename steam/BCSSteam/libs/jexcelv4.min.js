
                
/*
    Generated BY    : Steps Code Generator
    Generated On    : Mon Jan 05 2026 10:41:48 GMT+0530 (India Standard Time)
    Description     : JSpreadsheet v4.10.1 JS Library for BCSSteam
    Version         : 2024.09

    WARNING         : DO NOT EDIT THIS FILE. This file is generated, any changes may be overwritten.
*/

                
                /**
 * Jspreadsheet v4.10.1
 *
 * Website: https://bossanova.uk/jspreadsheet/
 * Description: Create amazing web based spreadsheets.
 *
 * This software is distribute under MIT License
 */
var formula=function(){var error=function(){var exports={};return exports.nil=new Error("#NULL!"),exports.div0=new Error("#DIV/0!"),exports.value=new Error("#VALUE!"),exports.ref=new Error("#REF!"),exports.name=new Error("#NAME?"),exports.num=new Error("#NUM!"),exports.na=new Error("#N/A"),exports.error=new Error("#ERROR!"),exports.data=new Error("#GETTING_DATA"),exports}(),utils=function(){var exports={flattenShallow:function(array){return array&&array.reduce?array.reduce((function(a,b){var aIsArray=Array.isArray(a),bIsArray=Array.isArray(b);return aIsArray&&bIsArray?a.concat(b):aIsArray?(a.push(b),a):bIsArray?[a].concat(b):[a,b]})):array},isFlat:function(array){if(!array)return!1;for(var i=0;i<array.length;++i)if(Array.isArray(array[i]))return!1;return!0},flatten:function(){for(var result=exports.argsToArray.apply(null,arguments);!exports.isFlat(result);)result=exports.flattenShallow(result);return result},argsToArray:function(args){var result=[];return exports.arrayEach(args,(function(value){result.push(value)})),result},numbers:function(){var possibleNumbers=this.flatten.apply(null,arguments);return possibleNumbers.filter((function(el){return"number"==typeof el}))},cleanFloat:function(number){var power=1e14;return Math.round(1e14*number)/1e14},parseBool:function(bool){if("boolean"==typeof bool)return bool;if(bool instanceof Error)return bool;if("number"==typeof bool)return 0!==bool;if("string"==typeof bool){var up=bool.toUpperCase();if("TRUE"===up)return!0;if("FALSE"===up)return!1}return bool instanceof Date&&!isNaN(bool)||error.value},parseNumber:function(string){return void 0===string||""===string?error.value:isNaN(string)?error.value:parseFloat(string)},parseNumberArray:function(arr){var len,parsed;if(!arr||0===(len=arr.length))return error.value;for(;len--;){if((parsed=exports.parseNumber(arr[len]))===error.value)return parsed;arr[len]=parsed}return arr},parseMatrix:function(matrix){var n,pnarr;if(!matrix||0===(n=matrix.length))return error.value;for(var i=0;i<matrix.length;i++)if(pnarr=exports.parseNumberArray(matrix[i]),matrix[i]=pnarr,pnarr instanceof Error)return pnarr;return matrix}},d1900=new Date(Date.UTC(1900,0,1));return exports.parseDate=function(date){if(!isNaN(date)){if(date instanceof Date)return new Date(date);var d=parseInt(date,10);return d<0?error.num:d<=60?new Date(d1900.getTime()+864e5*(d-1)):new Date(d1900.getTime()+864e5*(d-2))}return"string"!=typeof date||(date=new Date(date),isNaN(date))?error.value:date},exports.parseDateArray=function(arr){for(var len=arr.length,parsed;len--;){if((parsed=this.parseDate(arr[len]))===error.value)return parsed;arr[len]=parsed}return arr},exports.anyIsError=function(){for(var n=arguments.length;n--;)if(arguments[n]instanceof Error)return!0;return!1},exports.arrayValuesToNumbers=function(arr){for(var n=arr.length,el;n--;)if("number"!=typeof(el=arr[n]))if(!0!==el)if(!1!==el){if("string"==typeof el){var number=this.parseNumber(el);number instanceof Error?arr[n]=0:arr[n]=number}}else arr[n]=0;else arr[n]=1;return arr},exports.rest=function(array,idx){return idx=idx||1,array&&"function"==typeof array.slice?array.slice(idx):array},exports.initial=function(array,idx){return idx=idx||1,array&&"function"==typeof array.slice?array.slice(0,array.length-idx):array},exports.arrayEach=function(array,iteratee){for(var index=-1,length=array.length;++index<length&&!1!==iteratee(array[index],index,array););return array},exports.transpose=function(matrix){return matrix?matrix[0].map((function(col,i){return matrix.map((function(row){return row[i]}))})):error.value},exports}(),met={};met.datetime=function(){var exports={},d1900=new Date(1900,0,1),WEEK_STARTS=[void 0,0,1,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,1,2,3,4,5,6,0],WEEK_TYPES=[[],[1,2,3,4,5,6,7],[7,1,2,3,4,5,6],[6,0,1,2,3,4,5],[],[],[],[],[],[],[],[7,1,2,3,4,5,6],[6,7,1,2,3,4,5],[5,6,7,1,2,3,4],[4,5,6,7,1,2,3],[3,4,5,6,7,1,2],[2,3,4,5,6,7,1],[1,2,3,4,5,6,7]],WEEKEND_TYPES=[[],[6,0],[0,1],[1,2],[2,3],[3,4],[4,5],[5,6],void 0,void 0,void 0,[0,0],[1,1],[2,2],[3,3],[4,4],[5,5],[6,6]];function isLeapYear(year){return 1===new Date(year,1,29).getMonth()}function serial(date){var addOn;return(date-d1900)/864e5+(date>-22038912e5?2:1)}return exports.DATE=function(year,month,day){return year=utils.parseNumber(year),month=utils.parseNumber(month),day=utils.parseNumber(day),utils.anyIsError(year,month,day)?error.value:year<0||month<0||day<0?error.num:new Date(year,month-1,day);var date},exports.DATEVALUE=function(date_text){if("string"!=typeof date_text)return error.value;var date=Date.parse(date_text);return isNaN(date)?error.value:date<=-22038912e5?(date-d1900)/864e5+1:(date-d1900)/864e5+2},exports.DAY=function(serial_number){var date=utils.parseDate(serial_number);return date instanceof Error?date:date.getDate()},exports.DAYS=function(end_date,start_date){return end_date=utils.parseDate(end_date),start_date=utils.parseDate(start_date),end_date instanceof Error?end_date:start_date instanceof Error?start_date:serial(end_date)-serial(start_date)},exports.DAYS360=function(start_date,end_date,method){},exports.EDATE=function(start_date,months){return(start_date=utils.parseDate(start_date))instanceof Error?start_date:isNaN(months)?error.value:(months=parseInt(months,10),start_date.setMonth(start_date.getMonth()+months),serial(start_date))},exports.EOMONTH=function(start_date,months){return(start_date=utils.parseDate(start_date))instanceof Error?start_date:isNaN(months)?error.value:(months=parseInt(months,10),serial(new Date(start_date.getFullYear(),start_date.getMonth()+months+1,0)))},exports.HOUR=function(serial_number){return(serial_number=utils.parseDate(serial_number))instanceof Error?serial_number:serial_number.getHours()},exports.INTERVAL=function(second){if("number"!=typeof second&&"string"!=typeof second)return error.value;second=parseInt(second,10);var year=Math.floor(second/94608e4);second%=94608e4;var month=Math.floor(second/2592e3);second%=2592e3;var day=Math.floor(second/86400);second%=86400;var hour=Math.floor(second/3600);second%=3600;var min=Math.floor(second/60),sec=second%=60;return"P"+(year=year>0?year+"Y":"")+(month=month>0?month+"M":"")+(day=day>0?day+"D":"")+"T"+(hour=hour>0?hour+"H":"")+(min=min>0?min+"M":"")+(sec=sec>0?sec+"S":"")},exports.ISOWEEKNUM=function(date){if((date=utils.parseDate(date))instanceof Error)return date;date.setHours(0,0,0),date.setDate(date.getDate()+4-(date.getDay()||7));var yearStart=new Date(date.getFullYear(),0,1);return Math.ceil(((date-yearStart)/864e5+1)/7)},exports.MINUTE=function(serial_number){return(serial_number=utils.parseDate(serial_number))instanceof Error?serial_number:serial_number.getMinutes()},exports.MONTH=function(serial_number){return(serial_number=utils.parseDate(serial_number))instanceof Error?serial_number:serial_number.getMonth()+1},exports.NETWORKDAYS=function(start_date,end_date,holidays){},exports.NETWORKDAYS.INTL=function(start_date,end_date,weekend,holidays){},exports.NOW=function(){return new Date},exports.SECOND=function(serial_number){return(serial_number=utils.parseDate(serial_number))instanceof Error?serial_number:serial_number.getSeconds()},exports.TIME=function(hour,minute,second){return hour=utils.parseNumber(hour),minute=utils.parseNumber(minute),second=utils.parseNumber(second),utils.anyIsError(hour,minute,second)?error.value:hour<0||minute<0||second<0?error.num:(3600*hour+60*minute+second)/86400},exports.TIMEVALUE=function(time_text){return(time_text=utils.parseDate(time_text))instanceof Error?time_text:(3600*time_text.getHours()+60*time_text.getMinutes()+time_text.getSeconds())/86400},exports.TODAY=function(){return new Date},exports.WEEKDAY=function(serial_number,return_type){if((serial_number=utils.parseDate(serial_number))instanceof Error)return serial_number;void 0===return_type&&(return_type=1);var day=serial_number.getDay();return WEEK_TYPES[return_type][day]},exports.WEEKNUM=function(serial_number,return_type){},exports.WORKDAY=function(start_date,days,holidays){},exports.WORKDAY.INTL=function(start_date,days,weekend,holidays){},exports.YEAR=function(serial_number){return(serial_number=utils.parseDate(serial_number))instanceof Error?serial_number:serial_number.getFullYear()},exports.YEARFRAC=function(start_date,end_date,basis){},exports}(),met.database=function(){var exports={};function compact(array){if(!array)return array;for(var result=[],i=0;i<array.length;++i)array[i]&&result.push(array[i]);return result}function findResultIndex(database,criterias){for(var matches={},i=1;i<database[0].length;++i)matches[i]=!0;var maxCriteriaLength=criterias[0].length;for(i=1;i<criterias.length;++i)criterias[i].length>maxCriteriaLength&&(maxCriteriaLength=criterias[i].length);for(var k=1;k<database.length;++k)for(var l=1;l<database[k].length;++l){for(var currentCriteriaResult=!1,hasMatchingCriteria=!1,j=0;j<criterias.length;++j){var criteria=criterias[j];if(!(criteria.length<maxCriteriaLength)){var criteriaField=criteria[0];if(database[k][0]===criteriaField){hasMatchingCriteria=!0;for(var p=1;p<criteria.length;++p)currentCriteriaResult=currentCriteriaResult||eval(database[k][l]+criteria[p])}}}hasMatchingCriteria&&(matches[l]=matches[l]&&currentCriteriaResult)}for(var result=[],n=0;n<database[0].length;++n)matches[n]&&result.push(n-1);return result}return exports.FINDFIELD=function(database,title){for(var index=null,i=0;i<database.length;i++)if(database[i][0]===title){index=i;break}return null==index?error.value:index},exports.DAVERAGE=function(database,field,criteria){if(isNaN(field)&&"string"!=typeof field)return error.value;var resultIndexes=findResultIndex(database,criteria),targetFields=[];if("string"==typeof field){var index=exports.FINDFIELD(database,field);targetFields=utils.rest(database[index])}else targetFields=utils.rest(database[field]);for(var sum=0,i=0;i<resultIndexes.length;i++)sum+=targetFields[resultIndexes[i]];return 0===resultIndexes.length?error.div0:sum/resultIndexes.length},exports.DCOUNT=function(database,field,criteria){},exports.DCOUNTA=function(database,field,criteria){},exports.DGET=function(database,field,criteria){if(isNaN(field)&&"string"!=typeof field)return error.value;var resultIndexes=findResultIndex(database,criteria),targetFields=[];if("string"==typeof field){var index=exports.FINDFIELD(database,field);targetFields=utils.rest(database[index])}else targetFields=utils.rest(database[field]);return 0===resultIndexes.length?error.value:resultIndexes.length>1?error.num:targetFields[resultIndexes[0]]},exports.DMAX=function(database,field,criteria){if(isNaN(field)&&"string"!=typeof field)return error.value;var resultIndexes=findResultIndex(database,criteria),targetFields=[];if("string"==typeof field){var index=exports.FINDFIELD(database,field);targetFields=utils.rest(database[index])}else targetFields=utils.rest(database[field]);for(var maxValue=targetFields[resultIndexes[0]],i=1;i<resultIndexes.length;i++)maxValue<targetFields[resultIndexes[i]]&&(maxValue=targetFields[resultIndexes[i]]);return maxValue},exports.DMIN=function(database,field,criteria){if(isNaN(field)&&"string"!=typeof field)return error.value;var resultIndexes=findResultIndex(database,criteria),targetFields=[];if("string"==typeof field){var index=exports.FINDFIELD(database,field);targetFields=utils.rest(database[index])}else targetFields=utils.rest(database[field]);for(var minValue=targetFields[resultIndexes[0]],i=1;i<resultIndexes.length;i++)minValue>targetFields[resultIndexes[i]]&&(minValue=targetFields[resultIndexes[i]]);return minValue},exports.DPRODUCT=function(database,field,criteria){if(isNaN(field)&&"string"!=typeof field)return error.value;var resultIndexes=findResultIndex(database,criteria),targetFields=[];if("string"==typeof field){var index=exports.FINDFIELD(database,field);targetFields=utils.rest(database[index])}else targetFields=utils.rest(database[field]);for(var targetValues=[],i=0;i<resultIndexes.length;i++)targetValues[i]=targetFields[resultIndexes[i]];targetValues=compact(targetValues);var result=1;for(i=0;i<targetValues.length;i++)result*=targetValues[i];return result},exports.DSTDEV=function(database,field,criteria){},exports.DSTDEVP=function(database,field,criteria){},exports.DSUM=function(database,field,criteria){},exports.DVAR=function(database,field,criteria){},exports.DVARP=function(database,field,criteria){},exports.MATCH=function(lookupValue,lookupArray,matchType){if(!lookupValue&&!lookupArray)return error.na;if(2===arguments.length&&(matchType=1),!(lookupArray instanceof Array))return error.na;if(-1!==matchType&&0!==matchType&&1!==matchType)return error.na;for(var index,indexValue,idx=0;idx<lookupArray.length;idx++)if(1===matchType){if(lookupArray[idx]===lookupValue)return idx+1;lookupArray[idx]<lookupValue&&(indexValue?lookupArray[idx]>indexValue&&(index=idx+1,indexValue=lookupArray[idx]):(index=idx+1,indexValue=lookupArray[idx]))}else if(0===matchType){if("string"==typeof lookupValue){if(lookupValue=lookupValue.replace(/\?/g,"."),lookupArray[idx].toLowerCase().match(lookupValue.toLowerCase()))return idx+1}else if(lookupArray[idx]===lookupValue)return idx+1}else if(-1===matchType){if(lookupArray[idx]===lookupValue)return idx+1;lookupArray[idx]>lookupValue&&(indexValue?lookupArray[idx]<indexValue&&(index=idx+1,indexValue=lookupArray[idx]):(index=idx+1,indexValue=lookupArray[idx]))}return index||error.na},exports}(),met.engineering=function(){var exports={};function isValidBinaryNumber(number){return/^[01]{1,10}$/.test(number)}return exports.BESSELI=function(x,n){},exports.BESSELJ=function(x,n){},exports.BESSELK=function(x,n){},exports.BESSELY=function(x,n){},exports.BIN2DEC=function(number){if(!isValidBinaryNumber(number))return error.num;var result=parseInt(number,2),stringified=number.toString();return 10===stringified.length&&"1"===stringified.substring(0,1)?parseInt(stringified.substring(1),2)-512:result},exports.BIN2HEX=function(number,places){if(!isValidBinaryNumber(number))return error.num;var stringified=number.toString();if(10===stringified.length&&"1"===stringified.substring(0,1))return(0xfffffffe00+parseInt(stringified.substring(1),2)).toString(16);var result=parseInt(number,2).toString(16);return void 0===places?result:isNaN(places)?error.value:places<0?error.num:(places=Math.floor(places))>=result.length?REPT("0",places-result.length)+result:error.num},exports.BIN2OCT=function(number,places){if(!isValidBinaryNumber(number))return error.num;var stringified=number.toString();if(10===stringified.length&&"1"===stringified.substring(0,1))return(1073741312+parseInt(stringified.substring(1),2)).toString(8);var result=parseInt(number,2).toString(8);return void 0===places?result:isNaN(places)?error.value:places<0?error.num:(places=Math.floor(places))>=result.length?REPT("0",places-result.length)+result:error.num},exports.BITAND=function(number1,number2){return number1=utils.parseNumber(number1),number2=utils.parseNumber(number2),utils.anyIsError(number1,number2)?error.value:number1<0||number2<0?error.num:Math.floor(number1)!==number1||Math.floor(number2)!==number2?error.num:number1>0xffffffffffff||number2>0xffffffffffff?error.num:number1&number2},exports.BITLSHIFT=function(number,shift){return number=utils.parseNumber(number),shift=utils.parseNumber(shift),utils.anyIsError(number,shift)?error.value:number<0?error.num:Math.floor(number)!==number?error.num:number>0xffffffffffff?error.num:Math.abs(shift)>53?error.num:shift>=0?number<<shift:number>>-shift},exports.BITOR=function(number1,number2){return number1=utils.parseNumber(number1),number2=utils.parseNumber(number2),utils.anyIsError(number1,number2)?error.value:number1<0||number2<0?error.num:Math.floor(number1)!==number1||Math.floor(number2)!==number2?error.num:number1>0xffffffffffff||number2>0xffffffffffff?error.num:number1|number2},exports.BITRSHIFT=function(number,shift){return number=utils.parseNumber(number),shift=utils.parseNumber(shift),utils.anyIsError(number,shift)?error.value:number<0?error.num:Math.floor(number)!==number?error.num:number>0xffffffffffff?error.num:Math.abs(shift)>53?error.num:shift>=0?number>>shift:number<<-shift},exports.BITXOR=function(number1,number2){return number1=utils.parseNumber(number1),number2=utils.parseNumber(number2),utils.anyIsError(number1,number2)?error.value:number1<0||number2<0?error.num:Math.floor(number1)!==number1||Math.floor(number2)!==number2?error.num:number1>0xffffffffffff||number2>0xffffffffffff?error.num:number1^number2},exports.COMPLEX=function(real,imaginary,suffix){if(real=utils.parseNumber(real),imaginary=utils.parseNumber(imaginary),utils.anyIsError(real,imaginary))return real;if("i"!==(suffix=void 0===suffix?"i":suffix)&&"j"!==suffix)return error.value;if(0===real&&0===imaginary)return 0;if(0===real)return 1===imaginary?suffix:imaginary.toString()+suffix;if(0===imaginary)return real.toString();var sign=imaginary>0?"+":"";return real.toString()+sign+(1===imaginary?suffix:imaginary.toString()+suffix)},exports.CONVERT=function(number,from_unit,to_unit){if((number=utils.parseNumber(number))instanceof Error)return number;for(var units=[["a.u. of action","?",null,"action",!1,!1,105457168181818e-48],["a.u. of charge","e",null,"electric_charge",!1,!1,160217653141414e-33],["a.u. of energy","Eh",null,"energy",!1,!1,435974417757576e-32],["a.u. of length","a?",null,"length",!1,!1,529177210818182e-25],["a.u. of mass","m?",null,"mass",!1,!1,910938261616162e-45],["a.u. of time","?/Eh",null,"time",!1,!1,241888432650516e-31],["admiralty knot","admkn",null,"speed",!1,!0,.514773333],["ampere","A",null,"electric_current",!0,!1,1],["ampere per meter","A/m",null,"magnetic_field_intensity",!0,!1,1],["Ã¥ngstrÃ¶m","Ã…",["ang"],"length",!1,!0,1e-10],["are","ar",null,"area",!1,!0,100],["astronomical unit","ua",null,"length",!1,!1,149597870691667e-25],["bar","bar",null,"pressure",!1,!1,1e5],["barn","b",null,"area",!1,!1,1e-28],["becquerel","Bq",null,"radioactivity",!0,!1,1],["bit","bit",["b"],"information",!1,!0,1],["btu","BTU",["btu"],"energy",!1,!0,1055.05585262],["byte","byte",null,"information",!1,!0,8],["candela","cd",null,"luminous_intensity",!0,!1,1],["candela per square metre","cd/m?",null,"luminance",!0,!1,1],["coulomb","C",null,"electric_charge",!0,!1,1],["cubic Ã¥ngstrÃ¶m","ang3",["ang^3"],"volume",!1,!0,1e-30],["cubic foot","ft3",["ft^3"],"volume",!1,!0,.028316846592],["cubic inch","in3",["in^3"],"volume",!1,!0,16387064e-12],["cubic light-year","ly3",["ly^3"],"volume",!1,!0,846786664623715e-61],["cubic metre","m?",null,"volume",!0,!0,1],["cubic mile","mi3",["mi^3"],"volume",!1,!0,4168181825.44058],["cubic nautical mile","Nmi3",["Nmi^3"],"volume",!1,!0,6352182208],["cubic Pica","Pica3",["Picapt3","Pica^3","Picapt^3"],"volume",!1,!0,7.58660370370369e-8],["cubic yard","yd3",["yd^3"],"volume",!1,!0,.764554857984],["cup","cup",null,"volume",!1,!0,.0002365882365],["dalton","Da",["u"],"mass",!1,!1,166053886282828e-41],["day","d",["day"],"time",!1,!0,86400],["degree","Â°",null,"angle",!1,!1,.0174532925199433],["degrees Rankine","Rank",null,"temperature",!1,!0,.555555555555556],["dyne","dyn",["dy"],"force",!1,!0,1e-5],["electronvolt","eV",["ev"],"energy",!1,!0,1.60217656514141],["ell","ell",null,"length",!1,!0,1.143],["erg","erg",["e"],"energy",!1,!0,1e-7],["farad","F",null,"electric_capacitance",!0,!1,1],["fluid ounce","oz",null,"volume",!1,!0,295735295625e-16],["foot","ft",null,"length",!1,!0,.3048],["foot-pound","flb",null,"energy",!1,!0,1.3558179483314],["gal","Gal",null,"acceleration",!1,!1,.01],["gallon","gal",null,"volume",!1,!0,.003785411784],["gauss","G",["ga"],"magnetic_flux_density",!1,!0,1],["grain","grain",null,"mass",!1,!0,647989e-10],["gram","g",null,"mass",!1,!0,.001],["gray","Gy",null,"absorbed_dose",!0,!1,1],["gross registered ton","GRT",["regton"],"volume",!1,!0,2.8316846592],["hectare","ha",null,"area",!1,!0,1e4],["henry","H",null,"inductance",!0,!1,1],["hertz","Hz",null,"frequency",!0,!1,1],["horsepower","HP",["h"],"power",!1,!0,745.69987158227],["horsepower-hour","HPh",["hh","hph"],"energy",!1,!0,2684519.538],["hour","h",["hr"],"time",!1,!0,3600],["imperial gallon (U.K.)","uk_gal",null,"volume",!1,!0,.00454609],["imperial hundredweight","lcwt",["uk_cwt","hweight"],"mass",!1,!0,50.802345],["imperial quart (U.K)","uk_qt",null,"volume",!1,!0,.0011365225],["imperial ton","brton",["uk_ton","LTON"],"mass",!1,!0,1016.046909],["inch","in",null,"length",!1,!0,.0254],["international acre","uk_acre",null,"area",!1,!0,4046.8564224],["IT calorie","cal",null,"energy",!1,!0,4.1868],["joule","J",null,"energy",!0,!0,1],["katal","kat",null,"catalytic_activity",!0,!1,1],["kelvin","K",["kel"],"temperature",!0,!0,1],["kilogram","kg",null,"mass",!0,!0,1],["knot","kn",null,"speed",!1,!0,.514444444444444],["light-year","ly",null,"length",!1,!0,9460730472580800],["litre","L",["l","lt"],"volume",!1,!0,.001],["lumen","lm",null,"luminous_flux",!0,!1,1],["lux","lx",null,"illuminance",!0,!1,1],["maxwell","Mx",null,"magnetic_flux",!1,!1,1e-18],["measurement ton","MTON",null,"volume",!1,!0,1.13267386368],["meter per hour","m/h",["m/hr"],"speed",!1,!0,.00027777777777778],["meter per second","m/s",["m/sec"],"speed",!0,!0,1],["meter per second squared","m?s??",null,"acceleration",!0,!1,1],["parsec","pc",["parsec"],"length",!1,!0,0x6da012f958ee1c],["meter squared per second","m?/s",null,"kinematic_viscosity",!0,!1,1],["metre","m",null,"length",!0,!0,1],["miles per hour","mph",null,"speed",!1,!0,.44704],["millimetre of mercury","mmHg",null,"pressure",!1,!1,133.322],["minute","?",null,"angle",!1,!1,.000290888208665722],["minute","min",["mn"],"time",!1,!0,60],["modern teaspoon","tspm",null,"volume",!1,!0,5e-6],["mole","mol",null,"amount_of_substance",!0,!1,1],["morgen","Morgen",null,"area",!1,!0,2500],["n.u. of action","?",null,"action",!1,!1,105457168181818e-48],["n.u. of mass","m?",null,"mass",!1,!1,910938261616162e-45],["n.u. of speed","c?",null,"speed",!1,!1,299792458],["n.u. of time","?/(me?c??)",null,"time",!1,!1,128808866778687e-35],["nautical mile","M",["Nmi"],"length",!1,!0,1852],["newton","N",null,"force",!0,!0,1],["Å“rsted","Oe ",null,"magnetic_field_intensity",!1,!1,79.5774715459477],["ohm","Î©",null,"electric_resistance",!0,!1,1],["ounce mass","ozm",null,"mass",!1,!0,.028349523125],["pascal","Pa",null,"pressure",!0,!1,1],["pascal second","Pa?s",null,"dynamic_viscosity",!0,!1,1],["pferdestÃ¤rke","PS",null,"power",!1,!0,735.49875],["phot","ph",null,"illuminance",!1,!1,1e-4],["pica (1/6 inch)","pica",null,"length",!1,!0,.00035277777777778],["pica (1/72 inch)","Pica",["Picapt"],"length",!1,!0,.00423333333333333],["poise","P",null,"dynamic_viscosity",!1,!1,.1],["pond","pond",null,"force",!1,!0,.00980665],["pound force","lbf",null,"force",!1,!0,4.4482216152605],["pound mass","lbm",null,"mass",!1,!0,.45359237],["quart","qt",null,"volume",!1,!0,.000946352946],["radian","rad",null,"angle",!0,!1,1],["second","?",null,"angle",!1,!1,484813681109536e-20],["second","s",["sec"],"time",!0,!0,1],["short hundredweight","cwt",["shweight"],"mass",!1,!0,45.359237],["siemens","S",null,"electrical_conductance",!0,!1,1],["sievert","Sv",null,"equivalent_dose",!0,!1,1],["slug","sg",null,"mass",!1,!0,14.59390294],["square Ã¥ngstrÃ¶m","ang2",["ang^2"],"area",!1,!0,1e-20],["square foot","ft2",["ft^2"],"area",!1,!0,.09290304],["square inch","in2",["in^2"],"area",!1,!0,64516e-8],["square light-year","ly2",["ly^2"],"area",!1,!0,895054210748189e17],["square meter","m?",null,"area",!0,!0,1],["square mile","mi2",["mi^2"],"area",!1,!0,2589988.110336],["square nautical mile","Nmi2",["Nmi^2"],"area",!1,!0,3429904],["square Pica","Pica2",["Picapt2","Pica^2","Picapt^2"],"area",!1,!0,1792111111111e-17],["square yard","yd2",["yd^2"],"area",!1,!0,.83612736],["statute mile","mi",null,"length",!1,!0,1609.344],["steradian","sr",null,"solid_angle",!0,!1,1],["stilb","sb",null,"luminance",!1,!1,1e-4],["stokes","St",null,"kinematic_viscosity",!1,!1,1e-4],["stone","stone",null,"mass",!1,!0,6.35029318],["tablespoon","tbs",null,"volume",!1,!0,147868e-10],["teaspoon","tsp",null,"volume",!1,!0,492892e-11],["tesla","T",null,"magnetic_flux_density",!0,!0,1],["thermodynamic calorie","c",null,"energy",!1,!0,4.184],["ton","ton",null,"mass",!1,!0,907.18474],["tonne","t",null,"mass",!1,!1,1e3],["U.K. pint","uk_pt",null,"volume",!1,!0,.00056826125],["U.S. bushel","bushel",null,"volume",!1,!0,.03523907],["U.S. oil barrel","barrel",null,"volume",!1,!0,.158987295],["U.S. pint","pt",["us_pt"],"volume",!1,!0,.000473176473],["U.S. survey mile","survey_mi",null,"length",!1,!0,1609.347219],["U.S. survey/statute acre","us_acre",null,"area",!1,!0,4046.87261],["volt","V",null,"voltage",!0,!1,1],["watt","W",null,"power",!0,!0,1],["watt-hour","Wh",["wh"],"energy",!1,!0,3600],["weber","Wb",null,"magnetic_flux",!0,!1,1],["yard","yd",null,"length",!1,!0,.9144],["year","yr",null,"time",!1,!0,31557600]],binary_prefixes={Yi:["yobi",80,12089258196146292e8,"Yi","yotta"],Zi:["zebi",70,11805916207174113e5,"Zi","zetta"],Ei:["exbi",60,0x1000000000000000,"Ei","exa"],Pi:["pebi",50,0x4000000000000,"Pi","peta"],Ti:["tebi",40,1099511627776,"Ti","tera"],Gi:["gibi",30,1073741824,"Gi","giga"],Mi:["mebi",20,1048576,"Mi","mega"],ki:["kibi",10,1024,"ki","kilo"]},unit_prefixes={Y:["yotta",1e24,"Y"],Z:["zetta",1e21,"Z"],E:["exa",1e18,"E"],P:["peta",1e15,"P"],T:["tera",1e12,"T"],G:["giga",1e9,"G"],M:["mega",1e6,"M"],k:["kilo",1e3,"k"],h:["hecto",100,"h"],e:["dekao",10,"e"],d:["deci",.1,"d"],c:["centi",.01,"c"],m:["milli",.001,"m"],u:["micro",1e-6,"u"],n:["nano",1e-9,"n"],p:["pico",1e-12,"p"],f:["femto",1e-15,"f"],a:["atto",1e-18,"a"],z:["zepto",1e-21,"z"],y:["yocto",1e-24,"y"]},from=null,to=null,base_from_unit=from_unit,base_to_unit=to_unit,from_multiplier=1,to_multiplier=1,alt,i=0;i<units.length;i++)alt=null===units[i][2]?[]:units[i][2],(units[i][1]===base_from_unit||alt.indexOf(base_from_unit)>=0)&&(from=units[i]),(units[i][1]===base_to_unit||alt.indexOf(base_to_unit)>=0)&&(to=units[i]);if(null===from){var from_binary_prefix=binary_prefixes[from_unit.substring(0,2)],from_unit_prefix=unit_prefixes[from_unit.substring(0,1)];"da"===from_unit.substring(0,2)&&(from_unit_prefix=["dekao",10,"da"]),from_binary_prefix?(from_multiplier=from_binary_prefix[2],base_from_unit=from_unit.substring(2)):from_unit_prefix&&(from_multiplier=from_unit_prefix[1],base_from_unit=from_unit.substring(from_unit_prefix[2].length));for(var j=0;j<units.length;j++)alt=null===units[j][2]?[]:units[j][2],(units[j][1]===base_from_unit||alt.indexOf(base_from_unit)>=0)&&(from=units[j])}if(null===to){var to_binary_prefix=binary_prefixes[to_unit.substring(0,2)],to_unit_prefix=unit_prefixes[to_unit.substring(0,1)];"da"===to_unit.substring(0,2)&&(to_unit_prefix=["dekao",10,"da"]),to_binary_prefix?(to_multiplier=to_binary_prefix[2],base_to_unit=to_unit.substring(2)):to_unit_prefix&&(to_multiplier=to_unit_prefix[1],base_to_unit=to_unit.substring(to_unit_prefix[2].length));for(var k=0;k<units.length;k++)alt=null===units[k][2]?[]:units[k][2],(units[k][1]===base_to_unit||alt.indexOf(base_to_unit)>=0)&&(to=units[k])}return null===from||null===to?error.na:from[3]!==to[3]?error.na:number*from[6]*from_multiplier/(to[6]*to_multiplier)},exports.DEC2BIN=function(number,places){if((number=utils.parseNumber(number))instanceof Error)return number;if(!/^-?[0-9]{1,3}$/.test(number)||number<-512||number>511)return error.num;if(number<0)return"1"+REPT("0",9-(512+number).toString(2).length)+(512+number).toString(2);var result=parseInt(number,10).toString(2);return void 0===places?result:isNaN(places)?error.value:places<0?error.num:(places=Math.floor(places))>=result.length?REPT("0",places-result.length)+result:error.num},exports.DEC2HEX=function(number,places){if((number=utils.parseNumber(number))instanceof Error)return number;if(!/^-?[0-9]{1,12}$/.test(number)||number<-549755813888||number>549755813887)return error.num;if(number<0)return(1099511627776+number).toString(16);var result=parseInt(number,10).toString(16);return void 0===places?result:isNaN(places)?error.value:places<0?error.num:(places=Math.floor(places))>=result.length?REPT("0",places-result.length)+result:error.num},exports.DEC2OCT=function(number,places){if((number=utils.parseNumber(number))instanceof Error)return number;if(!/^-?[0-9]{1,9}$/.test(number)||number<-536870912||number>536870911)return error.num;if(number<0)return(1073741824+number).toString(8);var result=parseInt(number,10).toString(8);return void 0===places?result:isNaN(places)?error.value:places<0?error.num:(places=Math.floor(places))>=result.length?REPT("0",places-result.length)+result:error.num},exports.DELTA=function(number1,number2){return number2=void 0===number2?0:number2,number1=utils.parseNumber(number1),number2=utils.parseNumber(number2),utils.anyIsError(number1,number2)?error.value:number1===number2?1:0},exports.ERF=function(lower_bound,upper_bound){},exports.ERF.PRECISE=function(){},exports.ERFC=function(x){},exports.ERFC.PRECISE=function(){},exports.GESTEP=function(number,step){return step=step||0,number=utils.parseNumber(number),utils.anyIsError(step,number)?number:number>=step?1:0},exports.HEX2BIN=function(number,places){if(!/^[0-9A-Fa-f]{1,10}$/.test(number))return error.num;var negative=10===number.length&&"f"===number.substring(0,1).toLowerCase(),decimal=negative?parseInt(number,16)-1099511627776:parseInt(number,16);if(decimal<-512||decimal>511)return error.num;if(negative)return"1"+REPT("0",9-(512+decimal).toString(2).length)+(512+decimal).toString(2);var result=decimal.toString(2);return void 0===places?result:isNaN(places)?error.value:places<0?error.num:(places=Math.floor(places))>=result.length?REPT("0",places-result.length)+result:error.num},exports.HEX2DEC=function(number){if(!/^[0-9A-Fa-f]{1,10}$/.test(number))return error.num;var decimal=parseInt(number,16);return decimal>=549755813888?decimal-1099511627776:decimal},exports.HEX2OCT=function(number,places){if(!/^[0-9A-Fa-f]{1,10}$/.test(number))return error.num;var decimal=parseInt(number,16);if(decimal>536870911&&decimal<0xffe0000000)return error.num;if(decimal>=0xffe0000000)return(decimal-0xffc0000000).toString(8);var result=decimal.toString(8);return void 0===places?result:isNaN(places)?error.value:places<0?error.num:(places=Math.floor(places))>=result.length?REPT("0",places-result.length)+result:error.num},exports.IMABS=function(inumber){var x=exports.IMREAL(inumber),y=exports.IMAGINARY(inumber);return utils.anyIsError(x,y)?error.value:Math.sqrt(Math.pow(x,2)+Math.pow(y,2))},exports.IMAGINARY=function(inumber){if(void 0===inumber||!0===inumber||!1===inumber)return error.value;if(0===inumber||"0"===inumber)return 0;if(["i","j"].indexOf(inumber)>=0)return 1;var plus=(inumber=inumber.replace("+i","+1i").replace("-i","-1i").replace("+j","+1j").replace("-j","-1j")).indexOf("+"),minus=inumber.indexOf("-");0===plus&&(plus=inumber.indexOf("+",1)),0===minus&&(minus=inumber.indexOf("-",1));var last=inumber.substring(inumber.length-1,inumber.length),unit="i"===last||"j"===last;return plus>=0||minus>=0?unit?plus>=0?isNaN(inumber.substring(0,plus))||isNaN(inumber.substring(plus+1,inumber.length-1))?error.num:Number(inumber.substring(plus+1,inumber.length-1)):isNaN(inumber.substring(0,minus))||isNaN(inumber.substring(minus+1,inumber.length-1))?error.num:-Number(inumber.substring(minus+1,inumber.length-1)):error.num:unit?isNaN(inumber.substring(0,inumber.length-1))?error.num:inumber.substring(0,inumber.length-1):isNaN(inumber)?error.num:0},exports.IMARGUMENT=function(inumber){var x=exports.IMREAL(inumber),y=exports.IMAGINARY(inumber);return utils.anyIsError(x,y)?error.value:0===x&&0===y?error.div0:0===x&&y>0?Math.PI/2:0===x&&y<0?-Math.PI/2:0===y&&x>0?0:0===y&&x<0?-Math.PI:x>0?Math.atan(y/x):x<0&&y>=0?Math.atan(y/x)+Math.PI:Math.atan(y/x)-Math.PI},exports.IMCONJUGATE=function(inumber){var x=exports.IMREAL(inumber),y=exports.IMAGINARY(inumber);if(utils.anyIsError(x,y))return error.value;var unit=inumber.substring(inumber.length-1);return unit="i"===unit||"j"===unit?unit:"i",0!==y?exports.COMPLEX(x,-y,unit):inumber},exports.IMCOS=function(inumber){var x=exports.IMREAL(inumber),y=exports.IMAGINARY(inumber);if(utils.anyIsError(x,y))return error.value;var unit=inumber.substring(inumber.length-1);return unit="i"===unit||"j"===unit?unit:"i",exports.COMPLEX(Math.cos(x)*(Math.exp(y)+Math.exp(-y))/2,-Math.sin(x)*(Math.exp(y)-Math.exp(-y))/2,unit)},exports.IMCOSH=function(inumber){var x=exports.IMREAL(inumber),y=exports.IMAGINARY(inumber);if(utils.anyIsError(x,y))return error.value;var unit=inumber.substring(inumber.length-1);return unit="i"===unit||"j"===unit?unit:"i",exports.COMPLEX(Math.cos(y)*(Math.exp(x)+Math.exp(-x))/2,Math.sin(y)*(Math.exp(x)-Math.exp(-x))/2,unit)},exports.IMCOT=function(inumber){var x=exports.IMREAL(inumber),y=exports.IMAGINARY(inumber);return utils.anyIsError(x,y)?error.value:exports.IMDIV(exports.IMCOS(inumber),exports.IMSIN(inumber))},exports.IMDIV=function(inumber1,inumber2){var a=exports.IMREAL(inumber1),b=exports.IMAGINARY(inumber1),c=exports.IMREAL(inumber2),d=exports.IMAGINARY(inumber2);if(utils.anyIsError(a,b,c,d))return error.value;var unit1=inumber1.substring(inumber1.length-1),unit2=inumber2.substring(inumber2.length-1),unit="i";if("j"===unit1?unit="j":"j"===unit2&&(unit="j"),0===c&&0===d)return error.num;var den=c*c+d*d;return exports.COMPLEX((a*c+b*d)/den,(b*c-a*d)/den,unit)},exports.IMEXP=function(inumber){var x=exports.IMREAL(inumber),y=exports.IMAGINARY(inumber);if(utils.anyIsError(x,y))return error.value;var unit=inumber.substring(inumber.length-1);unit="i"===unit||"j"===unit?unit:"i";var e=Math.exp(x);return exports.COMPLEX(e*Math.cos(y),e*Math.sin(y),unit)},exports.IMLN=function(inumber){var x=exports.IMREAL(inumber),y=exports.IMAGINARY(inumber);if(utils.anyIsError(x,y))return error.value;var unit=inumber.substring(inumber.length-1);return unit="i"===unit||"j"===unit?unit:"i",exports.COMPLEX(Math.log(Math.sqrt(x*x+y*y)),Math.atan(y/x),unit)},exports.IMLOG10=function(inumber){var x=exports.IMREAL(inumber),y=exports.IMAGINARY(inumber);if(utils.anyIsError(x,y))return error.value;var unit=inumber.substring(inumber.length-1);return unit="i"===unit||"j"===unit?unit:"i",exports.COMPLEX(Math.log(Math.sqrt(x*x+y*y))/Math.log(10),Math.atan(y/x)/Math.log(10),unit)},exports.IMLOG2=function(inumber){var x=exports.IMREAL(inumber),y=exports.IMAGINARY(inumber);if(utils.anyIsError(x,y))return error.value;var unit=inumber.substring(inumber.length-1);return unit="i"===unit||"j"===unit?unit:"i",exports.COMPLEX(Math.log(Math.sqrt(x*x+y*y))/Math.log(2),Math.atan(y/x)/Math.log(2),unit)},exports.IMPOWER=function(inumber,number){number=utils.parseNumber(number);var x=exports.IMREAL(inumber),y=exports.IMAGINARY(inumber);if(utils.anyIsError(number,x,y))return error.value;var unit=inumber.substring(inumber.length-1);unit="i"===unit||"j"===unit?unit:"i";var p=Math.pow(exports.IMABS(inumber),number),t=exports.IMARGUMENT(inumber);return exports.COMPLEX(p*Math.cos(number*t),p*Math.sin(number*t),unit)},exports.IMPRODUCT=function(){for(var result=arguments[0],i=1;i<arguments.length;i++){var a=exports.IMREAL(result),b=exports.IMAGINARY(result),c=exports.IMREAL(arguments[i]),d=exports.IMAGINARY(arguments[i]);if(utils.anyIsError(a,b,c,d))return error.value;result=exports.COMPLEX(a*c-b*d,a*d+b*c)}return result},exports.IMREAL=function(inumber){if(void 0===inumber||!0===inumber||!1===inumber)return error.value;if(0===inumber||"0"===inumber)return 0;if(["i","+i","1i","+1i","-i","-1i","j","+j","1j","+1j","-j","-1j"].indexOf(inumber)>=0)return 0;var plus=inumber.indexOf("+"),minus=inumber.indexOf("-");0===plus&&(plus=inumber.indexOf("+",1)),0===minus&&(minus=inumber.indexOf("-",1));var last=inumber.substring(inumber.length-1,inumber.length),unit="i"===last||"j"===last;return plus>=0||minus>=0?unit?plus>=0?isNaN(inumber.substring(0,plus))||isNaN(inumber.substring(plus+1,inumber.length-1))?error.num:Number(inumber.substring(0,plus)):isNaN(inumber.substring(0,minus))||isNaN(inumber.substring(minus+1,inumber.length-1))?error.num:Number(inumber.substring(0,minus)):error.num:unit?isNaN(inumber.substring(0,inumber.length-1))?error.num:0:isNaN(inumber)?error.num:inumber},exports.IMSEC=function(inumber){if(!0===inumber||!1===inumber)return error.value;var x=exports.IMREAL(inumber),y=exports.IMAGINARY(inumber);return utils.anyIsError(x,y)?error.value:exports.IMDIV("1",exports.IMCOS(inumber))},exports.IMSECH=function(inumber){var x=exports.IMREAL(inumber),y=exports.IMAGINARY(inumber);return utils.anyIsError(x,y)?error.value:exports.IMDIV("1",exports.IMCOSH(inumber))},exports.IMSIN=function(inumber){var x=exports.IMREAL(inumber),y=exports.IMAGINARY(inumber);if(utils.anyIsError(x,y))return error.value;var unit=inumber.substring(inumber.length-1);return unit="i"===unit||"j"===unit?unit:"i",exports.COMPLEX(Math.sin(x)*(Math.exp(y)+Math.exp(-y))/2,Math.cos(x)*(Math.exp(y)-Math.exp(-y))/2,unit)},exports.IMSINH=function(inumber){var x=exports.IMREAL(inumber),y=exports.IMAGINARY(inumber);if(utils.anyIsError(x,y))return error.value;var unit=inumber.substring(inumber.length-1);return unit="i"===unit||"j"===unit?unit:"i",exports.COMPLEX(Math.cos(y)*(Math.exp(x)-Math.exp(-x))/2,Math.sin(y)*(Math.exp(x)+Math.exp(-x))/2,unit)},exports.IMSQRT=function(inumber){var x=exports.IMREAL(inumber),y=exports.IMAGINARY(inumber);if(utils.anyIsError(x,y))return error.value;var unit=inumber.substring(inumber.length-1);unit="i"===unit||"j"===unit?unit:"i";var s=Math.sqrt(exports.IMABS(inumber)),t=exports.IMARGUMENT(inumber);return exports.COMPLEX(s*Math.cos(t/2),s*Math.sin(t/2),unit)},exports.IMCSC=function(inumber){if(!0===inumber||!1===inumber)return error.value;var x=exports.IMREAL(inumber),y=exports.IMAGINARY(inumber);return utils.anyIsError(x,y)?error.num:exports.IMDIV("1",exports.IMSIN(inumber))},exports.IMCSCH=function(inumber){if(!0===inumber||!1===inumber)return error.value;var x=exports.IMREAL(inumber),y=exports.IMAGINARY(inumber);return utils.anyIsError(x,y)?error.num:exports.IMDIV("1",exports.IMSINH(inumber))},exports.IMSUB=function(inumber1,inumber2){var a=this.IMREAL(inumber1),b=this.IMAGINARY(inumber1),c=this.IMREAL(inumber2),d=this.IMAGINARY(inumber2);if(utils.anyIsError(a,b,c,d))return error.value;var unit1=inumber1.substring(inumber1.length-1),unit2=inumber2.substring(inumber2.length-1),unit="i";return"j"===unit1?unit="j":"j"===unit2&&(unit="j"),this.COMPLEX(a-c,b-d,unit)},exports.IMSUM=function(){for(var args=utils.flatten(arguments),result=args[0],i=1;i<args.length;i++){var a=this.IMREAL(result),b=this.IMAGINARY(result),c=this.IMREAL(args[i]),d=this.IMAGINARY(args[i]);if(utils.anyIsError(a,b,c,d))return error.value;result=this.COMPLEX(a+c,b+d)}return result},exports.IMTAN=function(inumber){if(!0===inumber||!1===inumber)return error.value;var x=exports.IMREAL(inumber),y=exports.IMAGINARY(inumber);return utils.anyIsError(x,y)?error.value:this.IMDIV(this.IMSIN(inumber),this.IMCOS(inumber))},exports.OCT2BIN=function(number,places){if(!/^[0-7]{1,10}$/.test(number))return error.num;var negative=10===number.length&&"7"===number.substring(0,1),decimal=negative?parseInt(number,8)-1073741824:parseInt(number,8);if(decimal<-512||decimal>511)return error.num;if(negative)return"1"+REPT("0",9-(512+decimal).toString(2).length)+(512+decimal).toString(2);var result=decimal.toString(2);return void 0===places?result:isNaN(places)?error.value:places<0?error.num:(places=Math.floor(places))>=result.length?REPT("0",places-result.length)+result:error.num},exports.OCT2DEC=function(number){if(!/^[0-7]{1,10}$/.test(number))return error.num;var decimal=parseInt(number,8);return decimal>=536870912?decimal-1073741824:decimal},exports.OCT2HEX=function(number,places){if(!/^[0-7]{1,10}$/.test(number))return error.num;var decimal=parseInt(number,8);if(decimal>=536870912)return"ff"+(decimal+3221225472).toString(16);var result=decimal.toString(16);return void 0===places?result:isNaN(places)?error.value:places<0?error.num:(places=Math.floor(places))>=result.length?REPT("0",places-result.length)+result:error.num},exports}(),met.financial=function(){var exports={};function validDate(d){return d&&d.getTime&&!isNaN(d.getTime())}function ensureDate(d){return d instanceof Date?d:new Date(d)}return exports.ACCRINT=function(issue,first,settlement,rate,par,frequency,basis){return issue=ensureDate(issue),first=ensureDate(first),settlement=ensureDate(settlement),validDate(issue)&&validDate(first)&&validDate(settlement)?rate<=0||par<=0?"#NUM!":-1===[1,2,4].indexOf(frequency)?"#NUM!":-1===[0,1,2,3,4].indexOf(basis)?"#NUM!":settlement<=issue?"#NUM!":(basis=basis||0,(par=par||0)*rate*YEARFRAC(issue,settlement,basis)):"#VALUE!"},exports.ACCRINTM=null,exports.AMORDEGRC=null,exports.AMORLINC=null,exports.COUPDAYBS=null,exports.COUPDAYS=null,exports.COUPDAYSNC=null,exports.COUPNCD=null,exports.COUPNUM=null,exports.COUPPCD=null,exports.CUMIPMT=function(rate,periods,value,start,end,type){if(rate=utils.parseNumber(rate),periods=utils.parseNumber(periods),value=utils.parseNumber(value),utils.anyIsError(rate,periods,value))return error.value;if(rate<=0||periods<=0||value<=0)return error.num;if(start<1||end<1||start>end)return error.num;if(0!==type&&1!==type)return error.num;var payment=exports.PMT(rate,periods,value,0,type),interest=0;1===start&&0===type&&(interest=-value,start++);for(var i=start;i<=end;i++)interest+=1===type?exports.FV(rate,i-2,payment,value,1)-payment:exports.FV(rate,i-1,payment,value,0);return interest*=rate},exports.CUMPRINC=function(rate,periods,value,start,end,type){if(rate=utils.parseNumber(rate),periods=utils.parseNumber(periods),value=utils.parseNumber(value),utils.anyIsError(rate,periods,value))return error.value;if(rate<=0||periods<=0||value<=0)return error.num;if(start<1||end<1||start>end)return error.num;if(0!==type&&1!==type)return error.num;var payment=exports.PMT(rate,periods,value,0,type),principal=0;1===start&&(principal=0===type?payment+value*rate:payment,start++);for(var i=start;i<=end;i++)principal+=type>0?payment-(exports.FV(rate,i-2,payment,value,1)-payment)*rate:payment-exports.FV(rate,i-1,payment,value,0)*rate;return principal},exports.DB=function(cost,salvage,life,period,month){if(month=void 0===month?12:month,cost=utils.parseNumber(cost),salvage=utils.parseNumber(salvage),life=utils.parseNumber(life),period=utils.parseNumber(period),month=utils.parseNumber(month),utils.anyIsError(cost,salvage,life,period,month))return error.value;if(cost<0||salvage<0||life<0||period<0)return error.num;if(-1===[1,2,3,4,5,6,7,8,9,10,11,12].indexOf(month))return error.num;if(period>life)return error.num;if(salvage>=cost)return 0;for(var rate=(1-Math.pow(salvage/cost,1/life)).toFixed(3),initial=cost*rate*month/12,total=initial,current=0,ceiling=period===life?life-1:period,i=2;i<=ceiling;i++)total+=current=(cost-total)*rate;return 1===period?initial:period===life?(cost-total)*rate:current},exports.DDB=function(cost,salvage,life,period,factor){if(factor=void 0===factor?2:factor,cost=utils.parseNumber(cost),salvage=utils.parseNumber(salvage),life=utils.parseNumber(life),period=utils.parseNumber(period),factor=utils.parseNumber(factor),utils.anyIsError(cost,salvage,life,period,factor))return error.value;if(cost<0||salvage<0||life<0||period<0||factor<=0)return error.num;if(period>life)return error.num;if(salvage>=cost)return 0;for(var total=0,current=0,i=1;i<=period;i++)total+=current=Math.min(factor/life*(cost-total),cost-salvage-total);return current},exports.DISC=null,exports.DOLLARDE=function(dollar,fraction){if(dollar=utils.parseNumber(dollar),fraction=utils.parseNumber(fraction),utils.anyIsError(dollar,fraction))return error.value;if(fraction<0)return error.num;if(fraction>=0&&fraction<1)return error.div0;fraction=parseInt(fraction,10);var result=parseInt(dollar,10);result+=dollar%1*Math.pow(10,Math.ceil(Math.log(fraction)/Math.LN10))/fraction;var power=Math.pow(10,Math.ceil(Math.log(fraction)/Math.LN2)+1);return result=Math.round(result*power)/power},exports.DOLLARFR=function(dollar,fraction){if(dollar=utils.parseNumber(dollar),fraction=utils.parseNumber(fraction),utils.anyIsError(dollar,fraction))return error.value;if(fraction<0)return error.num;if(fraction>=0&&fraction<1)return error.div0;fraction=parseInt(fraction,10);var result=parseInt(dollar,10);return result+=dollar%1*Math.pow(10,-Math.ceil(Math.log(fraction)/Math.LN10))*fraction},exports.DURATION=null,exports.EFFECT=function(rate,periods){return rate=utils.parseNumber(rate),periods=utils.parseNumber(periods),utils.anyIsError(rate,periods)?error.value:rate<=0||periods<1?error.num:(periods=parseInt(periods,10),Math.pow(1+rate/periods,periods)-1)},exports.FV=function(rate,periods,payment,value,type){if(value=value||0,type=type||0,rate=utils.parseNumber(rate),periods=utils.parseNumber(periods),payment=utils.parseNumber(payment),value=utils.parseNumber(value),type=utils.parseNumber(type),utils.anyIsError(rate,periods,payment,value,type))return error.value;var result;if(0===rate)result=value+payment*periods;else{var term=Math.pow(1+rate,periods);result=1===type?value*term+payment*(1+rate)*(term-1)/rate:value*term+payment*(term-1)/rate}return-result},exports.FVSCHEDULE=function(principal,schedule){if(principal=utils.parseNumber(principal),schedule=utils.parseNumberArray(utils.flatten(schedule)),utils.anyIsError(principal,schedule))return error.value;for(var n=schedule.length,future=principal,i=0;i<n;i++)future*=1+schedule[i];return future},exports.INTRATE=null,exports.IPMT=function(rate,period,periods,present,future,type){if(future=future||0,type=type||0,rate=utils.parseNumber(rate),period=utils.parseNumber(period),periods=utils.parseNumber(periods),present=utils.parseNumber(present),future=utils.parseNumber(future),type=utils.parseNumber(type),utils.anyIsError(rate,period,periods,present,future,type))return error.value;var payment=exports.PMT(rate,periods,present,future,type),interest;return(interest=1===period?1===type?0:-present:1===type?exports.FV(rate,period-2,payment,present,1)-payment:exports.FV(rate,period-1,payment,present,0))*rate},exports.IRR=function(values,guess){if(guess=guess||0,values=utils.parseNumberArray(utils.flatten(values)),guess=utils.parseNumber(guess),utils.anyIsError(values,guess))return error.value;for(var irrResult=function(values,dates,rate){for(var r=rate+1,result=values[0],i=1;i<values.length;i++)result+=values[i]/Math.pow(r,(dates[i]-dates[0])/365);return result},irrResultDeriv=function(values,dates,rate){for(var r=rate+1,result=0,i=1;i<values.length;i++){var frac=(dates[i]-dates[0])/365;result-=frac*values[i]/Math.pow(r,frac+1)}return result},dates=[],positive=!1,negative=!1,i=0;i<values.length;i++)dates[i]=0===i?0:dates[i-1]+365,values[i]>0&&(positive=!0),values[i]<0&&(negative=!0);if(!positive||!negative)return error.num;var resultRate=guess=void 0===guess?.1:guess,epsMax=1e-10,newRate,epsRate,resultValue,contLoop=!0;do{newRate=resultRate-(resultValue=irrResult(values,dates,resultRate))/irrResultDeriv(values,dates,resultRate),epsRate=Math.abs(newRate-resultRate),resultRate=newRate,contLoop=epsRate>1e-10&&Math.abs(resultValue)>1e-10}while(contLoop);return resultRate},exports.ISPMT=function(rate,period,periods,value){return rate=utils.parseNumber(rate),period=utils.parseNumber(period),periods=utils.parseNumber(periods),value=utils.parseNumber(value),utils.anyIsError(rate,period,periods,value)?error.value:value*rate*(period/periods-1)},exports.MDURATION=null,exports.MIRR=function(values,finance_rate,reinvest_rate){if(values=utils.parseNumberArray(utils.flatten(values)),finance_rate=utils.parseNumber(finance_rate),reinvest_rate=utils.parseNumber(reinvest_rate),utils.anyIsError(values,finance_rate,reinvest_rate))return error.value;for(var n=values.length,payments=[],incomes=[],i=0;i<n;i++)values[i]<0?payments.push(values[i]):incomes.push(values[i]);var num=-exports.NPV(reinvest_rate,incomes)*Math.pow(1+reinvest_rate,n-1),den=exports.NPV(finance_rate,payments)*(1+finance_rate);return Math.pow(num/den,1/(n-1))-1},exports.NOMINAL=function(rate,periods){return rate=utils.parseNumber(rate),periods=utils.parseNumber(periods),utils.anyIsError(rate,periods)?error.value:rate<=0||periods<1?error.num:(periods=parseInt(periods,10),(Math.pow(rate+1,1/periods)-1)*periods)},exports.NPER=function(rate,payment,present,future,type){if(type=void 0===type?0:type,future=void 0===future?0:future,rate=utils.parseNumber(rate),payment=utils.parseNumber(payment),present=utils.parseNumber(present),future=utils.parseNumber(future),type=utils.parseNumber(type),utils.anyIsError(rate,payment,present,future,type))return error.value;var num=payment*(1+rate*type)-future*rate,den=present*rate+payment*(1+rate*type);return Math.log(num/den)/Math.log(1+rate)},exports.NPV=function(){var args=utils.parseNumberArray(utils.flatten(arguments));if(args instanceof Error)return args;for(var rate=args[0],value=0,j=1;j<args.length;j++)value+=args[j]/Math.pow(1+rate,j);return value},exports.ODDFPRICE=null,exports.ODDFYIELD=null,exports.ODDLPRICE=null,exports.ODDLYIELD=null,exports.PDURATION=function(rate,present,future){return rate=utils.parseNumber(rate),present=utils.parseNumber(present),future=utils.parseNumber(future),utils.anyIsError(rate,present,future)?error.value:rate<=0?error.num:(Math.log(future)-Math.log(present))/Math.log(1+rate)},exports.PMT=function(rate,periods,present,future,type){if(future=future||0,type=type||0,rate=utils.parseNumber(rate),periods=utils.parseNumber(periods),present=utils.parseNumber(present),future=utils.parseNumber(future),type=utils.parseNumber(type),utils.anyIsError(rate,periods,present,future,type))return error.value;var result;if(0===rate)result=(present+future)/periods;else{var term=Math.pow(1+rate,periods);result=1===type?(future*rate/(term-1)+present*rate/(1-1/term))/(1+rate):future*rate/(term-1)+present*rate/(1-1/term)}return-result},exports.PPMT=function(rate,period,periods,present,future,type){return future=future||0,type=type||0,rate=utils.parseNumber(rate),periods=utils.parseNumber(periods),present=utils.parseNumber(present),future=utils.parseNumber(future),type=utils.parseNumber(type),utils.anyIsError(rate,periods,present,future,type)?error.value:exports.PMT(rate,periods,present,future,type)-exports.IPMT(rate,period,periods,present,future,type)},exports.PRICE=null,exports.PRICEDISC=null,exports.PRICEMAT=null,exports.PV=function(rate,periods,payment,future,type){return future=future||0,type=type||0,rate=utils.parseNumber(rate),periods=utils.parseNumber(periods),payment=utils.parseNumber(payment),future=utils.parseNumber(future),type=utils.parseNumber(type),utils.anyIsError(rate,periods,payment,future,type)?error.value:0===rate?-payment*periods-future:((1-Math.pow(1+rate,periods))/rate*payment*(1+rate*type)-future)/Math.pow(1+rate,periods)},exports.RATE=function(periods,payment,present,future,type,guess){if(guess=void 0===guess?.01:guess,future=void 0===future?0:future,type=void 0===type?0:type,periods=utils.parseNumber(periods),payment=utils.parseNumber(payment),present=utils.parseNumber(present),future=utils.parseNumber(future),type=utils.parseNumber(type),guess=utils.parseNumber(guess),utils.anyIsError(periods,payment,present,future,type,guess))return error.value;for(var epsMax=1e-6,iterMax=100,iter=0,close=!1,rate=guess;iter<100&&!close;){var t1=Math.pow(rate+1,periods),t2=Math.pow(rate+1,periods-1),f1,f2,f3,newRate=rate-(future+t1*present+payment*(t1-1)*(rate*type+1)/rate)/(periods*t2*present-payment*(t1-1)*(rate*type+1)/Math.pow(rate,2)+(periods*payment*t2*(rate*type+1)/rate+payment*(t1-1)*type/rate));Math.abs(newRate-rate)<1e-6&&(close=!0),iter++,rate=newRate}return close?rate:Number.NaN+rate},exports.RECEIVED=null,exports.RRI=function(periods,present,future){return periods=utils.parseNumber(periods),present=utils.parseNumber(present),future=utils.parseNumber(future),utils.anyIsError(periods,present,future)?error.value:0===periods||0===present?error.num:Math.pow(future/present,1/periods)-1},exports.SLN=function(cost,salvage,life){return cost=utils.parseNumber(cost),salvage=utils.parseNumber(salvage),life=utils.parseNumber(life),utils.anyIsError(cost,salvage,life)?error.value:0===life?error.num:(cost-salvage)/life},exports.SYD=function(cost,salvage,life,period){return cost=utils.parseNumber(cost),salvage=utils.parseNumber(salvage),life=utils.parseNumber(life),period=utils.parseNumber(period),utils.anyIsError(cost,salvage,life,period)?error.value:0===life?error.num:period<1||period>life?error.num:(cost-salvage)*(life-(period=parseInt(period,10))+1)*2/(life*(life+1))},exports.TBILLEQ=function(settlement,maturity,discount){return settlement=utils.parseDate(settlement),maturity=utils.parseDate(maturity),discount=utils.parseNumber(discount),utils.anyIsError(settlement,maturity,discount)?error.value:discount<=0?error.num:settlement>maturity?error.num:maturity-settlement>31536e6?error.num:365*discount/(360-discount*DAYS360(settlement,maturity,!1))},exports.TBILLPRICE=function(settlement,maturity,discount){return settlement=utils.parseDate(settlement),maturity=utils.parseDate(maturity),discount=utils.parseNumber(discount),utils.anyIsError(settlement,maturity,discount)?error.value:discount<=0?error.num:settlement>maturity?error.num:maturity-settlement>31536e6?error.num:100*(1-discount*DAYS360(settlement,maturity,!1)/360)},exports.TBILLYIELD=function(settlement,maturity,price){return settlement=utils.parseDate(settlement),maturity=utils.parseDate(maturity),price=utils.parseNumber(price),utils.anyIsError(settlement,maturity,price)?error.value:price<=0?error.num:settlement>maturity?error.num:maturity-settlement>31536e6?error.num:360*(100-price)/(price*DAYS360(settlement,maturity,!1))},exports.VDB=null,exports.XIRR=function(values,dates,guess){if(values=utils.parseNumberArray(utils.flatten(values)),dates=utils.parseDateArray(utils.flatten(dates)),guess=utils.parseNumber(guess),utils.anyIsError(values,dates,guess))return error.value;for(var irrResult=function(values,dates,rate){for(var r=rate+1,result=values[0],i=1;i<values.length;i++)result+=values[i]/Math.pow(r,DAYS(dates[i],dates[0])/365);return result},irrResultDeriv=function(values,dates,rate){for(var r=rate+1,result=0,i=1;i<values.length;i++){var frac=DAYS(dates[i],dates[0])/365;result-=frac*values[i]/Math.pow(r,frac+1)}return result},positive=!1,negative=!1,i=0;i<values.length;i++)values[i]>0&&(positive=!0),values[i]<0&&(negative=!0);if(!positive||!negative)return error.num;var resultRate=guess=guess||.1,epsMax=1e-10,newRate,epsRate,resultValue,contLoop=!0;do{newRate=resultRate-(resultValue=irrResult(values,dates,resultRate))/irrResultDeriv(values,dates,resultRate),epsRate=Math.abs(newRate-resultRate),resultRate=newRate,contLoop=epsRate>1e-10&&Math.abs(resultValue)>1e-10}while(contLoop);return resultRate},exports.XNPV=function(rate,values,dates){if(rate=utils.parseNumber(rate),values=utils.parseNumberArray(utils.flatten(values)),dates=utils.parseDateArray(utils.flatten(dates)),utils.anyIsError(rate,values,dates))return error.value;for(var result=0,i=0;i<values.length;i++)result+=values[i]/Math.pow(1+rate,DAYS(dates[i],dates[0])/365);return result},exports.YIELD=null,exports.YIELDDISC=null,exports.YIELDMAT=null,exports}(),met.information=function(){var exports={CELL:null,ERROR:{}};return exports.ERROR.TYPE=function(error_val){switch(error_val){case error.nil:return 1;case error.div0:return 2;case error.value:return 3;case error.ref:return 4;case error.name:return 5;case error.num:return 6;case error.na:return 7;case error.data:return 8}return error.na},exports.INFO=null,exports.ISBLANK=function(value){return null===value},exports.ISBINARY=function(number){return/^[01]{1,10}$/.test(number)},exports.ISERR=function(value){return[error.value,error.ref,error.div0,error.num,error.name,error.nil].indexOf(value)>=0||"number"==typeof value&&(isNaN(value)||!isFinite(value))},exports.ISERROR=function(value){return exports.ISERR(value)||value===error.na},exports.ISEVEN=function(number){return!(1&Math.floor(Math.abs(number)))},exports.ISFORMULA=null,exports.ISLOGICAL=function(value){return!0===value||!1===value},exports.ISNA=function(value){return value===error.na},exports.ISNONTEXT=function(value){return"string"!=typeof value},exports.ISNUMBER=function(value){return"number"==typeof value&&!isNaN(value)&&isFinite(value)},exports.ISODD=function(number){return!!(1&Math.floor(Math.abs(number)))},exports.ISREF=null,exports.ISTEXT=function(value){return"string"==typeof value},exports.N=function(value){return this.ISNUMBER(value)?value:value instanceof Date?value.getTime():!0===value?1:!1===value?0:this.ISERROR(value)?value:0},exports.NA=function(){return error.na},exports.SHEET=null,exports.SHEETS=null,exports.TYPE=function(value){return this.ISNUMBER(value)?1:this.ISTEXT(value)?2:this.ISLOGICAL(value)?4:this.ISERROR(value)?16:Array.isArray(value)?64:void 0},exports}(),met.logical=function(){var exports={AND:function(){for(var args=utils.flatten(arguments),result=!0,i=0;i<args.length;i++)args[i]||(result=!1);return result},CHOOSE:function(){if(arguments.length<2)return error.na;var index=arguments[0];return index<1||index>254?error.value:arguments.length<index+1?error.value:arguments[index]},FALSE:function(){return!1},IF:function(test,then_value,otherwise_value){return test?then_value:otherwise_value},IFERROR:function(value,valueIfError){return ISERROR(value)?valueIfError:value},IFNA:function(value,value_if_na){return value===error.na?value_if_na:value},NOT:function(logical){return!logical},OR:function(){for(var args=utils.flatten(arguments),result=!1,i=0;i<args.length;i++)args[i]&&(result=!0);return result},TRUE:function(){return!0},XOR:function(){for(var args=utils.flatten(arguments),result=0,i=0;i<args.length;i++)args[i]&&result++;return!!(1&Math.floor(Math.abs(result)))},SWITCH:function(){var result;if(arguments.length>0){var targetValue=arguments[0],argc=arguments.length-1,switchCount=Math.floor(argc/2),switchSatisfied=!1,defaultClause=argc%2==0?null:arguments[arguments.length-1];if(switchCount)for(var index=0;index<switchCount;index++)if(targetValue===arguments[2*index+1]){result=arguments[2*index+2],switchSatisfied=!0;break}!switchSatisfied&&defaultClause&&(result=defaultClause)}return result}};return exports}(),met.math=function(){var exports={ABS:function(number){return(number=utils.parseNumber(number))instanceof Error?number:Math.abs(utils.parseNumber(number))},ACOS:function(number){return(number=utils.parseNumber(number))instanceof Error?number:Math.acos(number)},ACOSH:function(number){return(number=utils.parseNumber(number))instanceof Error?number:Math.log(number+Math.sqrt(number*number-1))},ACOT:function(number){return(number=utils.parseNumber(number))instanceof Error?number:Math.atan(1/number)},ACOTH:function(number){return(number=utils.parseNumber(number))instanceof Error?number:.5*Math.log((number+1)/(number-1))},AGGREGATE:null,ARABIC:function(text){if(!/^M*(?:D?C{0,3}|C[MD])(?:L?X{0,3}|X[CL])(?:V?I{0,3}|I[XV])$/.test(text))return error.value;var r=0;return text.replace(/[MDLV]|C[MD]?|X[CL]?|I[XV]?/g,(function(i){r+={M:1e3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1}[i]})),r},ASIN:function(number){return(number=utils.parseNumber(number))instanceof Error?number:Math.asin(number)},ASINH:function(number){return(number=utils.parseNumber(number))instanceof Error?number:Math.log(number+Math.sqrt(number*number+1))},ATAN:function(number){return(number=utils.parseNumber(number))instanceof Error?number:Math.atan(number)},ATAN2:function(number_x,number_y){return number_x=utils.parseNumber(number_x),number_y=utils.parseNumber(number_y),utils.anyIsError(number_x,number_y)?error.value:Math.atan2(number_x,number_y)},ATANH:function(number){return(number=utils.parseNumber(number))instanceof Error?number:Math.log((1+number)/(1-number))/2},BASE:function(number,radix,min_length){if(min_length=min_length||0,number=utils.parseNumber(number),radix=utils.parseNumber(radix),min_length=utils.parseNumber(min_length),utils.anyIsError(number,radix,min_length))return error.value;min_length=void 0===min_length?0:min_length;var result=number.toString(radix);return new Array(Math.max(min_length+1-result.length,0)).join("0")+result},CEILING:function(number,significance,mode){return significance=void 0===significance?1:significance,mode=void 0===mode?0:mode,number=utils.parseNumber(number),significance=utils.parseNumber(significance),mode=utils.parseNumber(mode),utils.anyIsError(number,significance,mode)?error.value:0===significance?0:(significance=Math.abs(significance),number>=0?Math.ceil(number/significance)*significance:0===mode?-1*Math.floor(Math.abs(number)/significance)*significance:-1*Math.ceil(Math.abs(number)/significance)*significance)}};exports.CEILING.MATH=exports.CEILING,exports.CEILING.PRECISE=exports.CEILING,exports.COMBIN=function(number,number_chosen){return number=utils.parseNumber(number),number_chosen=utils.parseNumber(number_chosen),utils.anyIsError(number,number_chosen)?error.value:exports.FACT(number)/(exports.FACT(number_chosen)*exports.FACT(number-number_chosen))},exports.COMBINA=function(number,number_chosen){return number=utils.parseNumber(number),number_chosen=utils.parseNumber(number_chosen),utils.anyIsError(number,number_chosen)?error.value:0===number&&0===number_chosen?1:exports.COMBIN(number+number_chosen-1,number-1)},exports.COS=function(number){return(number=utils.parseNumber(number))instanceof Error?number:Math.cos(number)},exports.COSH=function(number){return(number=utils.parseNumber(number))instanceof Error?number:(Math.exp(number)+Math.exp(-number))/2},exports.COT=function(number){return(number=utils.parseNumber(number))instanceof Error?number:1/Math.tan(number)},exports.COTH=function(number){if((number=utils.parseNumber(number))instanceof Error)return number;var e2=Math.exp(2*number);return(e2+1)/(e2-1)},exports.CSC=function(number){return(number=utils.parseNumber(number))instanceof Error?number:1/Math.sin(number)},exports.CSCH=function(number){return(number=utils.parseNumber(number))instanceof Error?number:2/(Math.exp(number)-Math.exp(-number))},exports.DECIMAL=function(number,radix){return arguments.length<1?error.value:parseInt(number,radix)},exports.DEGREES=function(number){return(number=utils.parseNumber(number))instanceof Error?number:180*number/Math.PI},exports.EVEN=function(number){return(number=utils.parseNumber(number))instanceof Error?number:exports.CEILING(number,-2,-1)},exports.EXP=Math.exp;var MEMOIZED_FACT=[];return exports.FACT=function(number){if((number=utils.parseNumber(number))instanceof Error)return number;var n=Math.floor(number);return 0===n||1===n?1:MEMOIZED_FACT[n]>0?MEMOIZED_FACT[n]:(MEMOIZED_FACT[n]=exports.FACT(n-1)*n,MEMOIZED_FACT[n])},exports.FACTDOUBLE=function(number){if((number=utils.parseNumber(number))instanceof Error)return number;var n=Math.floor(number);return n<=0?1:n*exports.FACTDOUBLE(n-2)},exports.FLOOR=function(number,significance,mode){return significance=void 0===significance?1:significance,mode=void 0===mode?0:mode,number=utils.parseNumber(number),significance=utils.parseNumber(significance),mode=utils.parseNumber(mode),utils.anyIsError(number,significance,mode)?error.value:0===significance?0:(significance=Math.abs(significance),number>=0?Math.floor(number/significance)*significance:0===mode?-1*Math.ceil(Math.abs(number)/significance)*significance:-1*Math.floor(Math.abs(number)/significance)*significance)},exports.FLOOR.MATH=exports.FLOOR,exports.GCD=null,exports.INT=function(number){return(number=utils.parseNumber(number))instanceof Error?number:Math.floor(number)},exports.LCM=function(){var o=utils.parseNumberArray(utils.flatten(arguments));if(o instanceof Error)return o;for(var i,j,n,d,r=1;void 0!==(n=o.pop());)for(;n>1;){if(n%2){for(i=3,j=Math.floor(Math.sqrt(n));i<=j&&n%i;i+=2);d=i<=j?i:n}else d=2;for(n/=d,r*=d,i=o.length;i;o[--i]%d==0&&1==(o[i]/=d)&&o.splice(i,1));}return r},exports.LN=function(number){return(number=utils.parseNumber(number))instanceof Error?number:Math.log(number)},exports.LOG=function(number,base){return number=utils.parseNumber(number),base=void 0===base?10:utils.parseNumber(base),utils.anyIsError(number,base)?error.value:Math.log(number)/Math.log(base)},exports.LOG10=function(number){return(number=utils.parseNumber(number))instanceof Error?number:Math.log(number)/Math.log(10)},exports.MDETERM=null,exports.MINVERSE=null,exports.MMULT=null,exports.MOD=function(dividend,divisor){if(dividend=utils.parseNumber(dividend),divisor=utils.parseNumber(divisor),utils.anyIsError(dividend,divisor))return error.value;if(0===divisor)return error.div0;var modulus=Math.abs(dividend%divisor);return divisor>0?modulus:-modulus},exports.MROUND=function(number,multiple){return number=utils.parseNumber(number),multiple=utils.parseNumber(multiple),utils.anyIsError(number,multiple)?error.value:number*multiple<0?error.num:Math.round(number/multiple)*multiple},exports.MULTINOMIAL=function(){var args=utils.parseNumberArray(utils.flatten(arguments));if(args instanceof Error)return args;for(var sum=0,divisor=1,i=0;i<args.length;i++)sum+=args[i],divisor*=exports.FACT(args[i]);return exports.FACT(sum)/divisor},exports.MUNIT=null,exports.ODD=function(number){if((number=utils.parseNumber(number))instanceof Error)return number;var temp=Math.ceil(Math.abs(number));return temp=1&temp?temp:temp+1,number>0?temp:-temp},exports.PI=function(){return Math.PI},exports.POWER=function(number,power){if(number=utils.parseNumber(number),power=utils.parseNumber(power),utils.anyIsError(number,power))return error.value;var result=Math.pow(number,power);return isNaN(result)?error.num:result},exports.PRODUCT=function(){var args=utils.parseNumberArray(utils.flatten(arguments));if(args instanceof Error)return args;for(var result=1,i=0;i<args.length;i++)result*=args[i];return result},exports.QUOTIENT=function(numerator,denominator){return numerator=utils.parseNumber(numerator),denominator=utils.parseNumber(denominator),utils.anyIsError(numerator,denominator)?error.value:parseInt(numerator/denominator,10)},exports.RADIANS=function(number){return(number=utils.parseNumber(number))instanceof Error?number:number*Math.PI/180},exports.RAND=function(){return Math.random()},exports.RANDBETWEEN=function(bottom,top){return bottom=utils.parseNumber(bottom),top=utils.parseNumber(top),utils.anyIsError(bottom,top)?error.value:bottom+Math.ceil((top-bottom+1)*Math.random())-1},exports.ROMAN=null,exports.ROUND=function(number,digits){return number=utils.parseNumber(number),digits=utils.parseNumber(digits),utils.anyIsError(number,digits)?error.value:Math.round(number*Math.pow(10,digits))/Math.pow(10,digits)},exports.ROUNDDOWN=function(number,digits){return number=utils.parseNumber(number),digits=utils.parseNumber(digits),utils.anyIsError(number,digits)?error.value:(number>0?1:-1)*Math.floor(Math.abs(number)*Math.pow(10,digits))/Math.pow(10,digits);var sign},exports.ROUNDUP=function(number,digits){return number=utils.parseNumber(number),digits=utils.parseNumber(digits),utils.anyIsError(number,digits)?error.value:(number>0?1:-1)*Math.ceil(Math.abs(number)*Math.pow(10,digits))/Math.pow(10,digits);var sign},exports.SEC=function(number){return(number=utils.parseNumber(number))instanceof Error?number:1/Math.cos(number)},exports.SECH=function(number){return(number=utils.parseNumber(number))instanceof Error?number:2/(Math.exp(number)+Math.exp(-number))},exports.SERIESSUM=function(x,n,m,coefficients){if(x=utils.parseNumber(x),n=utils.parseNumber(n),m=utils.parseNumber(m),coefficients=utils.parseNumberArray(coefficients),utils.anyIsError(x,n,m,coefficients))return error.value;for(var result=coefficients[0]*Math.pow(x,n),i=1;i<coefficients.length;i++)result+=coefficients[i]*Math.pow(x,n+i*m);return result},exports.SIGN=function(number){return(number=utils.parseNumber(number))instanceof Error?number:number<0?-1:0===number?0:1},exports.SIN=function(number){return(number=utils.parseNumber(number))instanceof Error?number:Math.sin(number)},exports.SINH=function(number){return(number=utils.parseNumber(number))instanceof Error?number:(Math.exp(number)-Math.exp(-number))/2},exports.SQRT=function(number){return(number=utils.parseNumber(number))instanceof Error?number:number<0?error.num:Math.sqrt(number)},exports.SQRTPI=function(number){return(number=utils.parseNumber(number))instanceof Error?number:Math.sqrt(number*Math.PI)},exports.SUBTOTAL=null,exports.ADD=function(num1,num2){return 2!==arguments.length?error.na:(num1=utils.parseNumber(num1),num2=utils.parseNumber(num2),utils.anyIsError(num1,num2)?error.value:num1+num2)},exports.MINUS=function(num1,num2){return 2!==arguments.length?error.na:(num1=utils.parseNumber(num1),num2=utils.parseNumber(num2),utils.anyIsError(num1,num2)?error.value:num1-num2)},exports.DIVIDE=function(dividend,divisor){return 2!==arguments.length?error.na:(dividend=utils.parseNumber(dividend),divisor=utils.parseNumber(divisor),utils.anyIsError(dividend,divisor)?error.value:0===divisor?error.div0:dividend/divisor)},exports.MULTIPLY=function(factor1,factor2){return 2!==arguments.length?error.na:(factor1=utils.parseNumber(factor1),factor2=utils.parseNumber(factor2),utils.anyIsError(factor1,factor2)?error.value:factor1*factor2)},exports.GTE=function(num1,num2){return 2!==arguments.length?error.na:(num1=utils.parseNumber(num1),num2=utils.parseNumber(num2),utils.anyIsError(num1,num2)?error.error:num1>=num2)},exports.LT=function(num1,num2){return 2!==arguments.length?error.na:(num1=utils.parseNumber(num1),num2=utils.parseNumber(num2),utils.anyIsError(num1,num2)?error.error:num1<num2)},exports.LTE=function(num1,num2){return 2!==arguments.length?error.na:(num1=utils.parseNumber(num1),num2=utils.parseNumber(num2),utils.anyIsError(num1,num2)?error.error:num1<=num2)},exports.EQ=function(value1,value2){return 2!==arguments.length?error.na:value1===value2},exports.NE=function(value1,value2){return 2!==arguments.length?error.na:value1!==value2},exports.POW=function(base,exponent){return 2!==arguments.length?error.na:(base=utils.parseNumber(base),exponent=utils.parseNumber(exponent),utils.anyIsError(base,exponent)?error.error:exports.POWER(base,exponent))},exports.SUM=function(){for(var result=0,argsKeys=Object.keys(arguments),i=0;i<argsKeys.length;++i){var elt=arguments[argsKeys[i]];if("number"==typeof elt)result+=elt;else if("string"==typeof elt){var parsed=parseFloat(elt);!isNaN(parsed)&&(result+=parsed)}else Array.isArray(elt)&&(result+=exports.SUM.apply(null,elt))}return result},exports.SUMIF=function(){var args=utils.argsToArray(arguments),criteria=args.pop(),range=utils.parseNumberArray(utils.flatten(args));if(range instanceof Error)return range;for(var result=0,i=0;i<range.length;i++)result+=eval(range[i]+criteria)?range[i]:0;return result},exports.SUMIFS=function(){var args=utils.argsToArray(arguments),range=utils.parseNumberArray(utils.flatten(args.shift()));if(range instanceof Error)return range;for(var criteria=args,n_range_elements=range.length,n_criterias=criteria.length,result=0,i=0;i<n_range_elements;i++){for(var el=range[i],condition="",c=0;c<n_criterias;c+=2)isNaN(criteria[c][i])?condition+='"'+criteria[c][i]+'"'+criteria[c+1]:condition+=criteria[c][i]+criteria[c+1],c!==n_criterias-1&&(condition+=" && ");condition=condition.slice(0,-4),eval(condition)&&(result+=el)}return result},exports.SUMPRODUCT=null,exports.SUMSQ=function(){var numbers=utils.parseNumberArray(utils.flatten(arguments));if(numbers instanceof Error)return numbers;for(var result=0,length=numbers.length,i=0;i<length;i++)result+=ISNUMBER(numbers[i])?numbers[i]*numbers[i]:0;return result},exports.SUMX2MY2=function(array_x,array_y){if(array_x=utils.parseNumberArray(utils.flatten(array_x)),array_y=utils.parseNumberArray(utils.flatten(array_y)),utils.anyIsError(array_x,array_y))return error.value;for(var result=0,i=0;i<array_x.length;i++)result+=array_x[i]*array_x[i]-array_y[i]*array_y[i];return result},exports.SUMX2PY2=function(array_x,array_y){if(array_x=utils.parseNumberArray(utils.flatten(array_x)),array_y=utils.parseNumberArray(utils.flatten(array_y)),utils.anyIsError(array_x,array_y))return error.value;var result=0;array_x=utils.parseNumberArray(utils.flatten(array_x)),array_y=utils.parseNumberArray(utils.flatten(array_y));for(var i=0;i<array_x.length;i++)result+=array_x[i]*array_x[i]+array_y[i]*array_y[i];return result},exports.SUMXMY2=function(array_x,array_y){if(array_x=utils.parseNumberArray(utils.flatten(array_x)),array_y=utils.parseNumberArray(utils.flatten(array_y)),utils.anyIsError(array_x,array_y))return error.value;var result=0;array_x=utils.flatten(array_x),array_y=utils.flatten(array_y);for(var i=0;i<array_x.length;i++)result+=Math.pow(array_x[i]-array_y[i],2);return result},exports.TAN=function(number){return(number=utils.parseNumber(number))instanceof Error?number:Math.tan(number)},exports.TANH=function(number){if((number=utils.parseNumber(number))instanceof Error)return number;var e2=Math.exp(2*number);return(e2-1)/(e2+1)},exports.TRUNC=function(number,digits){return digits=void 0===digits?0:digits,number=utils.parseNumber(number),digits=utils.parseNumber(digits),utils.anyIsError(number,digits)?error.value:(number>0?1:-1)*Math.floor(Math.abs(number)*Math.pow(10,digits))/Math.pow(10,digits);var sign},exports}(),met.misc=function(){var exports={UNIQUE:function(){for(var result=[],i=0;i<arguments.length;++i){for(var hasElement=!1,element=arguments[i],j=0;j<result.length&&!(hasElement=result[j]===element);++j);hasElement||result.push(element)}return result}};return exports.FLATTEN=utils.flatten,exports.ARGS2ARRAY=function(){return Array.prototype.slice.call(arguments,0)},exports.REFERENCE=function(context,reference){try{for(var path=reference.split("."),result=context,i=0;i<path.length;++i){var step=path[i];if("]"===step[step.length-1]){var opening=step.indexOf("["),index=step.substring(opening+1,step.length-1);result=result[step.substring(0,opening)][index]}else result=result[step]}return result}catch(error){}},exports.JOIN=function(array,separator){return array.join(separator)},exports.NUMBERS=function(){var possibleNumbers=utils.flatten(arguments);return possibleNumbers.filter((function(el){return"number"==typeof el}))},exports.NUMERAL=null,exports}(),met.text=function(){var exports={ASC:null,BAHTTEXT:null,CHAR:function(number){return(number=utils.parseNumber(number))instanceof Error?number:String.fromCharCode(number)},CLEAN:function(text){var re=/[\0-\x1F]/g;return(text=text||"").replace(re,"")},CODE:function(text){return(text=text||"").charCodeAt(0)},CONCATENATE:function(){for(var args=utils.flatten(arguments),trueFound=0;(trueFound=args.indexOf(!0))>-1;)args[trueFound]="TRUE";for(var falseFound=0;(falseFound=args.indexOf(!1))>-1;)args[falseFound]="FALSE";return args.join("")},DBCS:null,DOLLAR:null,EXACT:function(text1,text2){return text1===text2},FIND:function(find_text,within_text,position){return position=void 0===position?0:position,within_text?within_text.indexOf(find_text,position-1)+1:null},FIXED:null,HTML2TEXT:function(value){var result="";return value&&(value instanceof Array?value.forEach((function(line){""!==result&&(result+="\n"),result+=line.replace(/<(?:.|\n)*?>/gm,"")})):result=value.replace(/<(?:.|\n)*?>/gm,"")),result},LEFT:function(text,number){return number=void 0===number?1:number,(number=utils.parseNumber(number))instanceof Error||"string"!=typeof text?error.value:text?text.substring(0,number):null},LEN:function(text){return 0===arguments.length?error.error:"string"==typeof text?text?text.length:0:text.length?text.length:error.value},LOWER:function(text){return"string"!=typeof text?error.value:text?text.toLowerCase():text},MID:function(text,start,number){if(start=utils.parseNumber(start),number=utils.parseNumber(number),utils.anyIsError(start,number)||"string"!=typeof text)return number;var begin=start-1,end=begin+number;return text.substring(begin,end)},NUMBERVALUE:null,PRONETIC:null,PROPER:function(text){return void 0===text||0===text.length?error.value:(!0===text&&(text="TRUE"),!1===text&&(text="FALSE"),isNaN(text)&&"number"==typeof text?error.value:("number"==typeof text&&(text=""+text),text.replace(/\w\S*/g,(function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()}))))},REGEXEXTRACT:function(text,regular_expression){var match=text.match(new RegExp(regular_expression));return match?match[match.length>1?match.length-1:0]:null},REGEXMATCH:function(text,regular_expression,full){var match=text.match(new RegExp(regular_expression));return full?match:!!match},REGEXREPLACE:function(text,regular_expression,replacement){return text.replace(new RegExp(regular_expression),replacement)},REPLACE:function(text,position,length,new_text){return position=utils.parseNumber(position),length=utils.parseNumber(length),utils.anyIsError(position,length)||"string"!=typeof text||"string"!=typeof new_text?error.value:text.substr(0,position-1)+new_text+text.substr(position-1+length)},REPT:function(text,number){return(number=utils.parseNumber(number))instanceof Error?number:new Array(number+1).join(text)},RIGHT:function(text,number){return number=void 0===number?1:number,(number=utils.parseNumber(number))instanceof Error?number:text?text.substring(text.length-number):null},SEARCH:function(find_text,within_text,position){var foundAt;return"string"!=typeof find_text||"string"!=typeof within_text?error.value:(position=void 0===position?0:position,0===(foundAt=within_text.toLowerCase().indexOf(find_text.toLowerCase(),position-1)+1)?error.value:foundAt)},SPLIT:function(text,separator){return text.split(separator)},SUBSTITUTE:function(text,old_text,new_text,occurrence){if(!(text&&old_text&&new_text))return text;if(void 0===occurrence)return text.replace(new RegExp(old_text,"g"),new_text);for(var index=0,i=0;text.indexOf(old_text,index)>0;)if(index=text.indexOf(old_text,index+1),++i===occurrence)return text.substring(0,index)+new_text+text.substring(index+old_text.length)},T:function(value){return"string"==typeof value?value:""},TEXT:null,TRIM:function(text){return"string"!=typeof text?error.value:text.replace(/ +/g," ").trim()}};return exports.UNICHAR=exports.CHAR,exports.UNICODE=exports.CODE,exports.UPPER=function(text){return"string"!=typeof text?error.value:text.toUpperCase()},exports.VALUE=null,exports}(),met.stats=function(){var exports={},SQRT2PI=2.5066282746310002;return exports.AVEDEV=null,exports.AVERAGE=function(){for(var range=utils.numbers(utils.flatten(arguments)),n=range.length,sum=0,count=0,i=0;i<n;i++)sum+=range[i],count+=1;return sum/count},exports.AVERAGEA=function(){for(var range=utils.flatten(arguments),n=range.length,sum=0,count=0,i=0;i<n;i++){var el=range[i];"number"==typeof el&&(sum+=el),!0===el&&sum++,null!==el&&count++}return sum/count},exports.AVERAGEIF=function(range,criteria,average_range){if(average_range=average_range||range,range=utils.flatten(range),average_range=utils.parseNumberArray(utils.flatten(average_range)),average_range instanceof Error)return average_range;for(var average_count=0,result=0,i=0;i<range.length;i++)eval(range[i]+criteria)&&(result+=average_range[i],average_count++);return result/average_count},exports.AVERAGEIFS=null,exports.COUNT=function(){return utils.numbers(utils.flatten(arguments)).length},exports.COUNTA=function(){var range=utils.flatten(arguments);return range.length-exports.COUNTBLANK(range)},exports.COUNTIN=function(range,value){for(var result=0,i=0;i<range.length;i++)range[i]===value&&result++;return result},exports.COUNTBLANK=function(){for(var range=utils.flatten(arguments),blanks=0,element,i=0;i<range.length;i++)null!==(element=range[i])&&""!==element||blanks++;return blanks},exports.COUNTIF=function(){var args=utils.argsToArray(arguments),criteria=args.pop(),range=utils.flatten(args);/[<>=!]/.test(criteria)||(criteria='=="'+criteria+'"');for(var matches=0,i=0;i<range.length;i++)"string"!=typeof range[i]?eval(range[i]+criteria)&&matches++:eval('"'+range[i]+'"'+criteria)&&matches++;return matches},exports.COUNTIFS=function(){for(var args=utils.argsToArray(arguments),results=new Array(utils.flatten(args[0]).length),i=0;i<results.length;i++)results[i]=!0;for(i=0;i<args.length;i+=2){var range=utils.flatten(args[i]),criteria=args[i+1];/[<>=!]/.test(criteria)||(criteria='=="'+criteria+'"');for(var j=0;j<range.length;j++)"string"!=typeof range[j]?results[j]=results[j]&&eval(range[j]+criteria):results[j]=results[j]&&eval('"'+range[j]+'"'+criteria)}var result=0;for(i=0;i<results.length;i++)results[i]&&result++;return result},exports.COUNTUNIQUE=function(){return UNIQUE.apply(null,utils.flatten(arguments)).length},exports.FISHER=function(x){return(x=utils.parseNumber(x))instanceof Error?x:Math.log((1+x)/(1-x))/2},exports.FISHERINV=function(y){if((y=utils.parseNumber(y))instanceof Error)return y;var e2y=Math.exp(2*y);return(e2y-1)/(e2y+1)},exports.FREQUENCY=function(data,bins){if(data=utils.parseNumberArray(utils.flatten(data)),bins=utils.parseNumberArray(utils.flatten(bins)),utils.anyIsError(data,bins))return error.value;for(var n=data.length,b=bins.length,r=[],i=0;i<=b;i++){r[i]=0;for(var j=0;j<n;j++)0===i?data[j]<=bins[0]&&(r[0]+=1):i<b?data[j]>bins[i-1]&&data[j]<=bins[i]&&(r[i]+=1):i===b&&data[j]>bins[b-1]&&(r[b]+=1)}return r},exports.LARGE=function(range,k){return range=utils.parseNumberArray(utils.flatten(range)),k=utils.parseNumber(k),utils.anyIsError(range,k)?range:range.sort((function(a,b){return b-a}))[k-1]},exports.MAX=function(){var range=utils.numbers(utils.flatten(arguments));return 0===range.length?0:Math.max.apply(Math,range)},exports.MAXA=function(){var range=utils.arrayValuesToNumbers(utils.flatten(arguments));return 0===range.length?0:Math.max.apply(Math,range)},exports.MIN=function(){var range=utils.numbers(utils.flatten(arguments));return 0===range.length?0:Math.min.apply(Math,range)},exports.MINA=function(){var range=utils.arrayValuesToNumbers(utils.flatten(arguments));return 0===range.length?0:Math.min.apply(Math,range)},exports.MODE={},exports.MODE.MULT=function(){var range=utils.parseNumberArray(utils.flatten(arguments));if(range instanceof Error)return range;for(var n=range.length,count={},maxItems=[],max=0,currentItem,i=0;i<n;i++)count[currentItem=range[i]]=count[currentItem]?count[currentItem]+1:1,count[currentItem]>max&&(max=count[currentItem],maxItems=[]),count[currentItem]===max&&(maxItems[maxItems.length]=currentItem);return maxItems},exports.MODE.SNGL=function(){var range=utils.parseNumberArray(utils.flatten(arguments));return range instanceof Error?range:exports.MODE.MULT(range).sort((function(a,b){return a-b}))[0]},exports.PERCENTILE={},exports.PERCENTILE.EXC=function(array,k){if(array=utils.parseNumberArray(utils.flatten(array)),k=utils.parseNumber(k),utils.anyIsError(array,k))return error.value;var n=(array=array.sort((function(a,b){return a-b}))).length;if(k<1/(n+1)||k>1-1/(n+1))return error.num;var l=k*(n+1)-1,fl=Math.floor(l);return utils.cleanFloat(l===fl?array[l]:array[fl]+(l-fl)*(array[fl+1]-array[fl]))},exports.PERCENTILE.INC=function(array,k){if(array=utils.parseNumberArray(utils.flatten(array)),k=utils.parseNumber(k),utils.anyIsError(array,k))return error.value;var n,l=k*((array=array.sort((function(a,b){return a-b}))).length-1),fl=Math.floor(l);return utils.cleanFloat(l===fl?array[l]:array[fl]+(l-fl)*(array[fl+1]-array[fl]))},exports.PERCENTRANK={},exports.PERCENTRANK.EXC=function(array,x,significance){if(significance=void 0===significance?3:significance,array=utils.parseNumberArray(utils.flatten(array)),x=utils.parseNumber(x),significance=utils.parseNumber(significance),utils.anyIsError(array,x,significance))return error.value;array=array.sort((function(a,b){return a-b}));for(var uniques=UNIQUE.apply(null,array),n=array.length,m=uniques.length,power=Math.pow(10,significance),result=0,match=!1,i=0;!match&&i<m;)x===uniques[i]?(result=(array.indexOf(uniques[i])+1)/(n+1),match=!0):x>=uniques[i]&&(x<uniques[i+1]||i===m-1)&&(result=(array.indexOf(uniques[i])+1+(x-uniques[i])/(uniques[i+1]-uniques[i]))/(n+1),match=!0),i++;return Math.floor(result*power)/power},exports.PERCENTRANK.INC=function(array,x,significance){if(significance=void 0===significance?3:significance,array=utils.parseNumberArray(utils.flatten(array)),x=utils.parseNumber(x),significance=utils.parseNumber(significance),utils.anyIsError(array,x,significance))return error.value;array=array.sort((function(a,b){return a-b}));for(var uniques=UNIQUE.apply(null,array),n=array.length,m=uniques.length,power=Math.pow(10,significance),result=0,match=!1,i=0;!match&&i<m;)x===uniques[i]?(result=array.indexOf(uniques[i])/(n-1),match=!0):x>=uniques[i]&&(x<uniques[i+1]||i===m-1)&&(result=(array.indexOf(uniques[i])+(x-uniques[i])/(uniques[i+1]-uniques[i]))/(n-1),match=!0),i++;return Math.floor(result*power)/power},exports.PERMUT=function(number,number_chosen){return number=utils.parseNumber(number),number_chosen=utils.parseNumber(number_chosen),utils.anyIsError(number,number_chosen)?error.value:FACT(number)/FACT(number-number_chosen)},exports.PERMUTATIONA=function(number,number_chosen){return number=utils.parseNumber(number),number_chosen=utils.parseNumber(number_chosen),utils.anyIsError(number,number_chosen)?error.value:Math.pow(number,number_chosen)},exports.PHI=function(x){return(x=utils.parseNumber(x))instanceof Error?error.value:Math.exp(-.5*x*x)/SQRT2PI},exports.PROB=function(range,probability,lower,upper){if(void 0===lower)return 0;if(upper=void 0===upper?lower:upper,range=utils.parseNumberArray(utils.flatten(range)),probability=utils.parseNumberArray(utils.flatten(probability)),lower=utils.parseNumber(lower),upper=utils.parseNumber(upper),utils.anyIsError(range,probability,lower,upper))return error.value;if(lower===upper)return range.indexOf(lower)>=0?probability[range.indexOf(lower)]:0;for(var sorted=range.sort((function(a,b){return a-b})),n=sorted.length,result=0,i=0;i<n;i++)sorted[i]>=lower&&sorted[i]<=upper&&(result+=probability[range.indexOf(sorted[i])]);return result},exports.QUARTILE={},exports.QUARTILE.EXC=function(range,quart){if(range=utils.parseNumberArray(utils.flatten(range)),quart=utils.parseNumber(quart),utils.anyIsError(range,quart))return error.value;switch(quart){case 1:return exports.PERCENTILE.EXC(range,.25);case 2:return exports.PERCENTILE.EXC(range,.5);case 3:return exports.PERCENTILE.EXC(range,.75);default:return error.num}},exports.QUARTILE.INC=function(range,quart){if(range=utils.parseNumberArray(utils.flatten(range)),quart=utils.parseNumber(quart),utils.anyIsError(range,quart))return error.value;switch(quart){case 1:return exports.PERCENTILE.INC(range,.25);case 2:return exports.PERCENTILE.INC(range,.5);case 3:return exports.PERCENTILE.INC(range,.75);default:return error.num}},exports.RANK={},exports.RANK.AVG=function(number,range,order){if(number=utils.parseNumber(number),range=utils.parseNumberArray(utils.flatten(range)),utils.anyIsError(number,range))return error.value;for(var sort=(order=order||!1)?function(a,b){return a-b}:function(a,b){return b-a},length=(range=(range=utils.flatten(range)).sort(sort)).length,count=0,i=0;i<length;i++)range[i]===number&&count++;return count>1?(2*range.indexOf(number)+count+1)/2:range.indexOf(number)+1},exports.RANK.EQ=function(number,range,order){if(number=utils.parseNumber(number),range=utils.parseNumberArray(utils.flatten(range)),utils.anyIsError(number,range))return error.value;var sort=(order=order||!1)?function(a,b){return a-b}:function(a,b){return b-a};return(range=range.sort(sort)).indexOf(number)+1},exports.RSQ=function(data_x,data_y){return data_x=utils.parseNumberArray(utils.flatten(data_x)),data_y=utils.parseNumberArray(utils.flatten(data_y)),utils.anyIsError(data_x,data_y)?error.value:Math.pow(exports.PEARSON(data_x,data_y),2)},exports.SMALL=function(range,k){return range=utils.parseNumberArray(utils.flatten(range)),k=utils.parseNumber(k),utils.anyIsError(range,k)?range:range.sort((function(a,b){return a-b}))[k-1]},exports.STANDARDIZE=function(x,mean,sd){return x=utils.parseNumber(x),mean=utils.parseNumber(mean),sd=utils.parseNumber(sd),utils.anyIsError(x,mean,sd)?error.value:(x-mean)/sd},exports.STDEV={},exports.STDEV.P=function(){var v=exports.VAR.P.apply(this,arguments);return Math.sqrt(v)},exports.STDEV.S=function(){var v=exports.VAR.S.apply(this,arguments);return Math.sqrt(v)},exports.STDEVA=function(){var v=exports.VARA.apply(this,arguments);return Math.sqrt(v)},exports.STDEVPA=function(){var v=exports.VARPA.apply(this,arguments);return Math.sqrt(v)},exports.VAR={},exports.VAR.P=function(){for(var range=utils.numbers(utils.flatten(arguments)),n=range.length,sigma=0,mean=exports.AVERAGE(range),i=0;i<n;i++)sigma+=Math.pow(range[i]-mean,2);return sigma/n},exports.VAR.S=function(){for(var range=utils.numbers(utils.flatten(arguments)),n=range.length,sigma=0,mean=exports.AVERAGE(range),i=0;i<n;i++)sigma+=Math.pow(range[i]-mean,2);return sigma/(n-1)},exports.VARA=function(){for(var range=utils.flatten(arguments),n=range.length,sigma=0,count=0,mean=exports.AVERAGEA(range),i=0;i<n;i++){var el=range[i];sigma+="number"==typeof el?Math.pow(el-mean,2):!0===el?Math.pow(1-mean,2):Math.pow(0-mean,2),null!==el&&count++}return sigma/(count-1)},exports.VARPA=function(){for(var range=utils.flatten(arguments),n=range.length,sigma=0,count=0,mean=exports.AVERAGEA(range),i=0;i<n;i++){var el=range[i];sigma+="number"==typeof el?Math.pow(el-mean,2):!0===el?Math.pow(1-mean,2):Math.pow(0-mean,2),null!==el&&count++}return sigma/count},exports.WEIBULL={},exports.WEIBULL.DIST=function(x,alpha,beta,cumulative){return x=utils.parseNumber(x),alpha=utils.parseNumber(alpha),beta=utils.parseNumber(beta),utils.anyIsError(x,alpha,beta)?error.value:cumulative?1-Math.exp(-Math.pow(x/beta,alpha)):Math.pow(x,alpha-1)*Math.exp(-Math.pow(x/beta,alpha))*alpha/Math.pow(beta,alpha)},exports.Z={},exports.Z.TEST=function(range,x,sd){if(range=utils.parseNumberArray(utils.flatten(range)),x=utils.parseNumber(x),utils.anyIsError(range,x))return error.value;sd=sd||exports.STDEV.S(range);var n=range.length;return 1-exports.NORM.S.DIST((exports.AVERAGE(range)-x)/(sd/Math.sqrt(n)),!0)},exports}(),met.utils=function(){var exports={PROGRESS:function(p,c){var color,value;return'<div style="width:'+(p||"0")+"%;height:4px;background-color:"+(c||"red")+';margin-top:1px;"></div>'},RATING:function(v){for(var html='<div class="jrating">',i=0;i<5;i++)html+=i<v?'<div class="jrating-selected"></div>':"<div></div>";return html+="</div>"}};return exports}();for(var i=0;i<Object.keys(met).length;i++)for(var methods=met[Object.keys(met)[i]],keys=Object.keys(methods),j=0;j<keys.length;j++)if(methods[keys[j]])if("function"==typeof methods[keys[j]]||"object"==typeof methods[keys[j]]){if(window[keys[j]]=methods[keys[j]],window[keys[j]].toString=function(){return"#ERROR"},"object"==typeof methods[keys[j]])for(var tmp=Object.keys(methods[keys[j]]),z=0;z<tmp.length;z++)window[keys[j]][tmp[z]].toString=function(){return"#ERROR"}}else window[keys[j]]=function(){return keys[j]+"Not implemented"};else window[keys[j]]=function(){return keys[j]+"Not implemented"};var x=null,y=null,instance=null;window.TABLE=function(){return instance},window.COLUMN=window.COL=function(){return parseInt(x)+1},window.ROW=function(){return parseInt(y)+1},window.CELL=function(){return F.getColumnNameFromCoords(x,y)},window.VALUE=function(col,row,processed){return instance.getValueFromCoords(parseInt(col)-1,parseInt(row)-1,processed)},window.THISROWCELL=function(col){return instance.getValueFromCoords(parseInt(col)-1,parseInt(y))};var secureFormula=function(oldValue,runtime){for(var newValue="",inside=0,special=["=","!",">","<"],i=0;i<oldValue.length;i++)'"'==oldValue[i]&&(inside=0==inside?1:0),1==inside?newValue+=oldValue[i]:(newValue+=oldValue[i].toUpperCase(),1==runtime&&i>0&&"="==oldValue[i]&&-1==special.indexOf(oldValue[i-1])&&-1==special.indexOf(oldValue[i+1])&&(newValue+="="));return newValue=(newValue=(newValue=(newValue=newValue.replace(/\^/g,"**")).replace(/\<\>/g,"!=")).replace(/\&/g,"+")).replace(/\$/g,"")},tokensUpdate=function(tokens,e){for(var index=0;index<tokens.length;index++){var f=F.getTokensFromRange(tokens[index]);e=e.replace(tokens[index],"["+f.join(",")+"]")}return e},F=function(expression,variables,i,j,obj){instance=obj,x=i,y=j;var s="",keys=Object.keys(variables);if(keys.length)for(var i=0;i<keys.length;i++)-1==keys[i].indexOf(".")&&-1==keys[i].indexOf("!")?s+="var "+keys[i]+" = "+variables[keys[i]]+";\n":s+=keys[i]+" = "+variables[keys[i]]+";\n";expression=(expression=expression.replace(/\$/g,"")).replace(/\!/g,".");var tokens=(expression=secureFormula(expression,!0)).match(/([A-Z]+[0-9]*\.)?(\$?[A-Z]+\$?[0-9]+):(\$?[A-Z]+\$?[0-9]+)?/g);return tokens&&tokens.length&&(expression=tokensUpdate(tokens,expression)),new Function(s+"; return "+expression)()},getColumnName=function(i){var letter="";return i>701?(letter+=String.fromCharCode(64+parseInt(i/676)),letter+=String.fromCharCode(64+parseInt(i%676/26))):i>25&&(letter+=String.fromCharCode(64+parseInt(i/26))),letter+=String.fromCharCode(65+i%26)};return F.getColumnNameFromCoords=function(x,y){return getColumnName(parseInt(x))+(parseInt(y)+1)},F.getCoordsFromColumnName=function(columnName){var t=/^[a-zA-Z]+/.exec(columnName);if(t){for(var code=0,i=0;i<t[0].length;i++)code+=parseInt(t[0].charCodeAt(i)-64)*Math.pow(26,t[0].length-1-i);--code<0&&(code=0);var number=parseInt(/[0-9]+$/.exec(columnName))||null;return number>0&&number--,[code,number]}},F.getRangeFromTokens=function(tokens){tokens=tokens.filter((function(v){return"#REF!"!=v}));for(var d="",t="",i=0;i<tokens.length;i++)tokens[i].indexOf(".")>=0?d=".":tokens[i].indexOf("!")>=0&&(d="!"),d&&(t=tokens[i].split(d),tokens[i]=t[1],t=t[0]+d);return tokens.sort((function(a,b){var t1=Helpers.getCoordsFromColumnName(a),t2=Helpers.getCoordsFromColumnName(b);return t1[1]>t2[1]?1:t1[1]<t2[1]?-1:t1[0]>t2[0]?1:t1[0]<t2[0]?-1:0})),tokens.length?t+(tokens[0]+":")+tokens[tokens.length-1]:"#REF!"},F.getTokensFromRange=function(range){if(range.indexOf(".")>0){var t=range.split(".");range=t[1],t=t[0]+"."}else if(range.indexOf("!")>0){var t=range.split("!");range=t[1],t=t[0]+"!"}else var t="";var range=range.split(":"),e1=F.getCoordsFromColumnName(range[0]),e2=F.getCoordsFromColumnName(range[1]);if(e1[0]<=e2[0])var x1=e1[0],x2=e2[0];else var x1=e2[0],x2=e1[0];if(null===e1[1]&&null==e2[1])for(var y1=null,y2=null,k=Object.keys(vars),i=0;i<k.length;i++){var tmp=F.getCoordsFromColumnName(k[i]);tmp[0]===e1[0]&&(null===y1||tmp[1]<y1)&&(y1=tmp[1]),tmp[0]===e2[0]&&(null===y2||tmp[1]>y2)&&(y2=tmp[1])}else if(e1[1]<=e2[1])var y1=e1[1],y2=e2[1];else var y1=e2[1],y2=e1[1];for(var f=[],j=y1;j<=y2;j++){for(var line=[],i=x1;i<=x2;i++)line.push(t+F.getColumnNameFromCoords(i,j));f.push(line)}return f},F.setFormula=function(o){for(var k=Object.keys(o),i=0;i<k.length;i++)"function"==typeof o[k[i]]&&(window[k[i]]=o[k[i]])},F}();if(!jSuites&&"function"==typeof require)var jSuites=require("jsuites");!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):global.jspreadsheet=global.jexcel=factory()}(this,(function(){"use strict";var Version=(info={title:"Jspreadsheet",version:"4.10.1",type:"CE",host:"https://bossanova.uk/jspreadsheet",license:"MIT",print:function(){return[this.title+" "+this.type+" "+this.version,this.host,this.license].join("\r\n")}},function(){return info}),info,isFormula=function(value){var v=(""+value)[0];return"="==v||"#"==v},getMask=function(o){if(o.format||o.mask||o.locale){var opt={};return o.mask?opt.mask=o.mask:o.format?opt.mask=o.format:(opt.locale=o.locale,opt.options=o.options),o.decimal&&(opt.options||(opt.options={}),opt.options={decimal:o.decimal}),opt}return null},jexcel=function(el,options){var obj={options:{}};if(!(el instanceof Element||el instanceof HTMLDocument))return console.error("Jspreadsheet: el is not a valid DOM element"),!1;if("TABLE"==el.tagName){if(!(options=jexcel.createFromTable(el,options)))return console.error("Jspreadsheet: el is not a valid DOM element"),!1;var div=document.createElement("div");el.parentNode.insertBefore(div,el),el.remove(),el=div}var defaults={url:null,method:"GET",requestVariables:null,data:null,sorting:null,copyCompatibility:!1,root:null,rows:[],columns:[],colHeaders:[],colWidths:[],colAlignments:[],nestedHeaders:null,defaultColWidth:50,defaultColAlign:"center",defaultRowHeight:null,minSpareRows:0,minSpareCols:0,minDimensions:[0,0],allowExport:!0,includeHeadersOnDownload:!1,includeHeadersOnCopy:!1,columnSorting:!0,columnDrag:!1,columnResize:!0,rowResize:!1,rowDrag:!0,editable:!0,allowInsertRow:!0,allowManualInsertRow:!0,allowInsertColumn:!0,allowManualInsertColumn:!0,allowDeleteRow:!0,allowDeletingAllRows:!1,allowDeleteColumn:!0,allowRenameColumn:!0,allowComments:!1,wordWrap:!1,imageOptions:null,csv:null,csvFileName:"jspreadsheet",csvHeaders:!0,csvDelimiter:",",parseTableFirstRowAsHeader:!1,parseTableAutoCellType:!1,selectionCopy:!0,mergeCells:{},toolbar:null,search:!1,pagination:!1,paginationOptions:null,fullscreen:!1,lazyLoading:!1,loadingSpin:!1,tableOverflow:!1,tableHeight:"300px",tableWidth:null,textOverflow:!1,meta:null,style:null,classes:null,parseFormulas:!0,autoIncrement:!0,autoCasting:!0,secureFormulas:!0,stripHTML:!0,stripHTMLOnCopy:!1,filters:!1,footers:null,onundo:null,onredo:null,onload:null,onchange:null,oncomments:null,onbeforechange:null,onafterchanges:null,onbeforeinsertrow:null,oninsertrow:null,onbeforeinsertcolumn:null,oninsertcolumn:null,onbeforedeleterow:null,ondeleterow:null,onbeforedeletecolumn:null,ondeletecolumn:null,onmoverow:null,onmovecolumn:null,onresizerow:null,onresizecolumn:null,onsort:null,onselection:null,oncopy:null,onpaste:null,onbeforepaste:null,onmerge:null,onfocus:null,onblur:null,onchangeheader:null,oncreateeditor:null,oneditionstart:null,oneditionend:null,onchangestyle:null,onchangemeta:null,onchangepage:null,onbeforesave:null,onsave:null,onevent:null,persistance:!1,updateTable:null,detachForUpdates:!1,freezeColumns:null,text:{noRecordsFound:"No records found",showingPage:"Showing page {0} of {1} entries",show:"Show ",search:"Search",entries:" entries",columnName:"Column name",insertANewColumnBefore:"Insert a new column before",insertANewColumnAfter:"Insert a new column after",deleteSelectedColumns:"Delete selected columns",renameThisColumn:"Rename this column",orderAscending:"Order ascending",orderDescending:"Order descending",insertANewRowBefore:"Insert a new row before",insertANewRowAfter:"Insert a new row after",deleteSelectedRows:"Delete selected rows",editComments:"Edit comments",addComments:"Add comments",comments:"Comments",clearComments:"Clear comments",copy:"Copy...",paste:"Paste...",saveAs:"Save as...",about:"About",areYouSureToDeleteTheSelectedRows:"Are you sure to delete the selected rows?",areYouSureToDeleteTheSelectedColumns:"Are you sure to delete the selected columns?",thisActionWillDestroyAnyExistingMergedCellsAreYouSure:"This action will destroy any existing merged cells. Are you sure?",thisActionWillClearYourSearchResultsAreYouSure:"This action will clear your search results. Are you sure?",thereIsAConflictWithAnotherMergedCell:"There is a conflict with another merged cell",invalidMergeProperties:"Invalid merged properties",cellAlreadyMerged:"Cell already merged",noCellsSelected:"No cells selected"},about:!0};for(var property in defaults)if(options&&options.hasOwnProperty(property))if("text"===property)for(var textKey in obj.options[property]=defaults[property],options[property])options[property].hasOwnProperty(textKey)&&(obj.options[property][textKey]=options[property][textKey]);else obj.options[property]=options[property];else obj.options[property]=defaults[property];obj.el=el,obj.corner=null,obj.contextMenu=null,obj.textarea=null,obj.ads=null,obj.content=null,obj.table=null,obj.thead=null,obj.tbody=null,obj.rows=[],obj.results=null,obj.searchInput=null,obj.toolbar=null,obj.pagination=null,obj.pageNumber=null,obj.headerContainer=null,obj.colgroupContainer=null,obj.headers=[],obj.records=[],obj.history=[],obj.formula=[],obj.colgroup=[],obj.selection=[],obj.highlighted=[],obj.selectedCell=null,obj.selectedContainer=null,obj.style=[],obj.data=null,obj.filter=null,obj.filters=[],obj.cursor=null,obj.historyIndex=-1,obj.ignoreEvents=!1,obj.ignoreHistory=!1,obj.edition=null,obj.hashString=null,obj.resizing=null,obj.dragging=null,1==obj.options.lazyLoading&&0==obj.options.tableOverflow&&0==obj.options.fullscreen&&(console.error("Jspreadsheet: The lazyloading only works when tableOverflow = yes or fullscreen = yes"),obj.options.lazyLoading=!1),obj.fullscreen=function(activate){null==activate&&(activate=!obj.options.fullscreen),obj.options.fullscreen!=activate&&(obj.options.fullscreen=activate,1==activate?el.classList.add("fullscreen"):el.classList.remove("fullscreen"))},obj.dispatch=function(event){if(!obj.ignoreEvents){if("function"==typeof obj.options.onevent)var ret=obj.options.onevent.apply(this,arguments);if("function"==typeof obj.options[event])var ret=obj.options[event].apply(this,Array.prototype.slice.call(arguments,1))}if("onafterchanges"==event&&obj.options.persistance){var url=1==obj.options.persistance?obj.options.url:obj.options.persistance,data=obj.prepareJson(arguments[2]);obj.save(url,data)}return ret},obj.prepareTable=function(){var results=[],size=obj.options.columns.length;if(obj.options.data&&void 0!==obj.options.data[0]){var keys=Object.keys(obj.options.data[0]);keys.length>size&&(size=keys.length)}obj.options.minDimensions[0]>size&&(size=obj.options.minDimensions[0]);for(var multiple=[],i=0;i<size;i++)obj.options.colHeaders[i]||(obj.options.colHeaders[i]=""),obj.options.colWidths[i]||(obj.options.colWidths[i]=obj.options.defaultColWidth),obj.options.colAlignments[i]||(obj.options.colAlignments[i]=obj.options.defaultColAlign),obj.options.columns[i]?obj.options.columns[i].type||(obj.options.columns[i].type="text"):obj.options.columns[i]={type:"text"},obj.options.columns[i].name||(obj.options.columns[i].name=keys&&keys[i]?keys[i]:i),obj.options.columns[i].source||(obj.options.columns[i].source=[]),obj.options.columns[i].options||(obj.options.columns[i].options=[]),obj.options.columns[i].editor||(obj.options.columns[i].editor=null),obj.options.columns[i].allowEmpty||(obj.options.columns[i].allowEmpty=!1),obj.options.columns[i].title||(obj.options.columns[i].title=obj.options.colHeaders[i]?obj.options.colHeaders[i]:""),obj.options.columns[i].width||(obj.options.columns[i].width=obj.options.colWidths[i]?obj.options.colWidths[i]:obj.options.defaultColWidth),obj.options.columns[i].align||(obj.options.columns[i].align=obj.options.colAlignments[i]?obj.options.colAlignments[i]:"center"),"autocomplete"==obj.options.columns[i].type||"dropdown"==obj.options.columns[i].type?obj.options.columns[i].url&&multiple.push({url:obj.options.columns[i].url,index:i,method:"GET",dataType:"json",success:function(data){for(var source=[],i=0;i<data.length;i++)obj.options.columns[this.index].source.push(data[i])}}):"calendar"==obj.options.columns[i].type&&(obj.options.columns[i].options.format||(obj.options.columns[i].options.format="DD/MM/YYYY"));multiple.length?jSuites.ajax(multiple,(function(){obj.createTable()})):obj.createTable()},obj.createTable=function(){obj.table=document.createElement("table"),obj.thead=document.createElement("thead"),obj.tbody=document.createElement("tbody"),obj.headers=[],obj.colgroup=[],obj.content=document.createElement("div"),obj.content.classList.add("jexcel_content"),obj.content.onscroll=function(e){obj.scrollControls(e)},obj.content.onwheel=function(e){obj.wheelControls(e)},obj.toolbar=document.createElement("div"),obj.toolbar.classList.add("jexcel_toolbar");var searchContainer=document.createElement("div"),searchText=document.createTextNode(obj.options.text.search+": ");obj.searchInput=document.createElement("input"),obj.searchInput.classList.add("jexcel_search"),searchContainer.appendChild(searchText),searchContainer.appendChild(obj.searchInput),obj.searchInput.onfocus=function(){obj.resetSelection()};var paginationUpdateContainer=document.createElement("div");if(obj.options.pagination>0&&obj.options.paginationOptions&&obj.options.paginationOptions.length>0){obj.paginationDropdown=document.createElement("select"),obj.paginationDropdown.classList.add("jexcel_pagination_dropdown"),obj.paginationDropdown.onchange=function(){obj.options.pagination=parseInt(this.value),obj.page(0)};for(var i=0;i<obj.options.paginationOptions.length;i++){var temp=document.createElement("option");temp.value=obj.options.paginationOptions[i],temp.innerHTML=obj.options.paginationOptions[i],obj.paginationDropdown.appendChild(temp)}obj.paginationDropdown.value=obj.options.pagination,paginationUpdateContainer.appendChild(document.createTextNode(obj.options.text.show)),paginationUpdateContainer.appendChild(obj.paginationDropdown),paginationUpdateContainer.appendChild(document.createTextNode(obj.options.text.entries))}var filter=document.createElement("div"),tempCol,tempCol;if(filter.classList.add("jexcel_filter"),filter.appendChild(paginationUpdateContainer),filter.appendChild(searchContainer),obj.colgroupContainer=document.createElement("colgroup"),(tempCol=document.createElement("col")).setAttribute("width","50"),obj.colgroupContainer.appendChild(tempCol),obj.options.nestedHeaders&&obj.options.nestedHeaders.length>0)if(obj.options.nestedHeaders[0]&&obj.options.nestedHeaders[0][0])for(var j=0;j<obj.options.nestedHeaders.length;j++)obj.thead.appendChild(obj.createNestedHeader(obj.options.nestedHeaders[j]));else obj.thead.appendChild(obj.createNestedHeader(obj.options.nestedHeaders));obj.headerContainer=document.createElement("tr"),(tempCol=document.createElement("td")).classList.add("jexcel_selectall"),obj.headerContainer.appendChild(tempCol);for(var i=0;i<obj.options.columns.length;i++)obj.createCellHeader(i),obj.headerContainer.appendChild(obj.headers[i]),obj.colgroupContainer.appendChild(obj.colgroup[i]);if(obj.thead.appendChild(obj.headerContainer),1==obj.options.filters){obj.filter=document.createElement("tr");var td=document.createElement("td");obj.filter.appendChild(td);for(var i=0;i<obj.options.columns.length;i++){var td;(td=document.createElement("td")).innerHTML="&nbsp;",td.setAttribute("data-x",i),td.className="jexcel_column_filter","hidden"==obj.options.columns[i].type&&(td.style.display="none"),obj.filter.appendChild(td)}obj.thead.appendChild(obj.filter)}obj.table=document.createElement("table"),obj.table.classList.add("jexcel"),obj.table.setAttribute("cellpadding","0"),obj.table.setAttribute("cellspacing","0"),obj.table.setAttribute("unselectable","yes"),obj.table.appendChild(obj.colgroupContainer),obj.table.appendChild(obj.thead),obj.table.appendChild(obj.tbody),obj.options.textOverflow||obj.table.classList.add("jexcel_overflow"),obj.corner=document.createElement("div"),obj.corner.className="jexcel_corner",obj.corner.setAttribute("unselectable","on"),obj.corner.setAttribute("onselectstart","return false"),0==obj.options.selectionCopy&&(obj.corner.style.display="none"),obj.textarea=document.createElement("textarea"),obj.textarea.className="jexcel_textarea",obj.textarea.id="jexcel_textarea",obj.textarea.tabIndex="-1",obj.contextMenu=document.createElement("div"),obj.contextMenu.className="jexcel_contextmenu",jSuites.contextmenu(obj.contextMenu,{onclick:function(){obj.contextMenu.contextmenu.close(!1)}});var ads=document.createElement("a");ads.setAttribute("href","https://bossanova.uk/jspreadsheet/"),obj.ads=document.createElement("div"),obj.ads.className="jexcel_about";try{if("undefined"!=typeof sessionStorage&&!sessionStorage.getItem("jexcel")){sessionStorage.setItem("jexcel",!0);var img=document.createElement("img");img.src="//bossanova.uk/jspreadsheet/logo.png",ads.appendChild(img)}}catch(exception){}var span=document.createElement("span"),container;span.innerHTML="Jspreadsheet CE",ads.appendChild(span),obj.ads.appendChild(ads),document.createElement("div").classList.add("jexcel_table"),obj.pagination=document.createElement("div"),obj.pagination.classList.add("jexcel_pagination");var paginationInfo=document.createElement("div"),paginationPages=document.createElement("div");if(obj.pagination.appendChild(paginationInfo),obj.pagination.appendChild(paginationPages),obj.options.pagination||(obj.pagination.style.display="none"),1==obj.options.search&&el.appendChild(filter),obj.content.appendChild(obj.table),obj.content.appendChild(obj.corner),obj.content.appendChild(obj.textarea),el.appendChild(obj.toolbar),el.appendChild(obj.content),el.appendChild(obj.pagination),el.appendChild(obj.contextMenu),el.appendChild(obj.ads),el.classList.add("jexcel_container"),obj.options.toolbar&&obj.options.toolbar.length&&obj.createToolbar(),1==obj.options.fullscreen?el.classList.add("fullscreen"):1==obj.options.tableOverflow&&(obj.options.tableHeight&&(obj.content.style["overflow-y"]="auto",obj.content.style["box-shadow"]="rgb(221 221 221) 2px 2px 5px 0.1px",obj.content.style.maxHeight=obj.options.tableHeight),obj.options.tableWidth&&(obj.content.style["overflow-x"]="auto",obj.content.style.width=obj.options.tableWidth)),1!=obj.options.tableOverflow&&obj.options.toolbar&&el.classList.add("with-toolbar"),1==obj.options.columnDrag&&obj.thead.classList.add("draggable"),1==obj.options.columnResize&&obj.thead.classList.add("resizable"),1==obj.options.rowDrag&&obj.tbody.classList.add("draggable"),1==obj.options.rowResize&&obj.tbody.classList.add("resizable"),obj.setData(),obj.options.style&&obj.setStyle(obj.options.style,null,null,1,1),obj.options.classes)for(var k=Object.keys(obj.options.classes),i=0;i<k.length;i++){var cell=jexcel.getIdFromColumnName(k[i],!0);obj.records[cell[1]][cell[0]].classList.add(obj.options.classes[k[i]])}},obj.refresh=function(){obj.options.url?(1==obj.options.loadingSpin&&jSuites.loading.show(),jSuites.ajax({url:obj.options.url,method:obj.options.method,data:obj.options.requestVariables,dataType:"json",success:function(result){obj.options.data=result.data?result.data:result,obj.setData(),1==obj.options.loadingSpin&&jSuites.loading.hide()}})):obj.setData()},obj.setData=function(data){if(data&&("string"==typeof data&&(data=JSON.parse(data)),obj.options.data=data),obj.options.data||(obj.options.data=[]),obj.options.data&&obj.options.data[0]&&!Array.isArray(obj.options.data[0])){for(var data=[],j=0;j<obj.options.data.length;j++){for(var row=[],i=0;i<obj.options.columns.length;i++)row[i]=obj.options.data[j][obj.options.columns[i].name];data.push(row)}obj.options.data=data}var j=0,i=0,size_i=obj.options.columns.length,size_j=obj.options.data.length,min_i=obj.options.minDimensions[0],min_j=obj.options.minDimensions[1],max_i=min_i>size_i?min_i:size_i,max_j=min_j>size_j?min_j:size_j;for(j=0;j<max_j;j++)for(i=0;i<max_i;i++)null==obj.options.data[j]&&(obj.options.data[j]=[]),null==obj.options.data[j][i]&&(obj.options.data[j][i]="");if(obj.rows=[],obj.results=null,obj.records=[],obj.history=[],obj.historyIndex=-1,obj.tbody.innerHTML="",1==obj.options.lazyLoading){var startNumber=0,finalNumber=obj.options.data.length<100?obj.options.data.length:100;obj.options.pagination&&(obj.options.pagination=!1,console.error("Jspreadsheet: Pagination will be disable due the lazyLoading"))}else if(obj.options.pagination){obj.pageNumber||(obj.pageNumber=0);var quantityPerPage=obj.options.pagination;startNumber=obj.options.pagination*obj.pageNumber,finalNumber=obj.options.pagination*obj.pageNumber+obj.options.pagination,obj.options.data.length<finalNumber&&(finalNumber=obj.options.data.length)}else var startNumber=0,finalNumber=obj.options.data.length;for(j=0;j<obj.options.data.length;j++){var tr=obj.createRow(j,obj.options.data[j]);j>=startNumber&&j<finalNumber&&obj.tbody.appendChild(tr)}if(1==obj.options.lazyLoading||obj.options.pagination&&obj.updatePagination(),obj.options.mergeCells)for(var keys=Object.keys(obj.options.mergeCells),i=0;i<keys.length;i++){var num=obj.options.mergeCells[keys[i]];obj.setMerge(keys[i],num[0],num[1],1)}obj.updateTable(),obj.dispatch("onload",el,obj)},obj.getData=function(highlighted,dataOnly){for(var dataset=[],px=0,py=0,dataType=1==dataOnly||0==obj.options.copyCompatibility,x=obj.options.columns.length,y=obj.options.data.length,j=0;j<y;j++){px=0;for(var i=0;i<x;i++)highlighted&&!obj.records[j][i].classList.contains("highlight")||(dataset[py]||(dataset[py]=[]),dataset[py][px]=dataType?obj.options.data[j][i]:obj.records[j][i].innerHTML,px++);px>0&&py++}return dataset},obj.getJsonRow=function(rowNumber){for(var rowData=obj.options.data[rowNumber],x=obj.options.columns.length,row={},i=0;i<x;i++)obj.options.columns[i].name||(obj.options.columns[i].name=i),row[obj.options.columns[i].name]=rowData[i];return row},obj.getJson=function(highlighted){for(var data=[],x=obj.options.columns.length,y=obj.options.data.length,j=0;j<y;j++){for(var row=null,i=0;i<x;i++)highlighted&&!obj.records[j][i].classList.contains("highlight")||(null==row&&(row={}),obj.options.columns[i].name||(obj.options.columns[i].name=i),row[obj.options.columns[i].name]=obj.options.data[j][i]);null!=row&&data.push(row)}return data},obj.prepareJson=function(data){for(var rows=[],i=0;i<data.length;i++){var x=data[i].x,y=data[i].y,k=obj.options.columns[x].name?obj.options.columns[x].name:x;rows[y]||(rows[y]={row:y,data:{}}),rows[y].data[k]=data[i].newValue}return rows.filter((function(el){return null!=el}))},obj.save=function(url,data){var ret=obj.dispatch("onbeforesave",el,obj,data);if(ret)var data=ret;else if(!1===ret)return!1;jSuites.ajax({url:url,method:"POST",dataType:"json",data:{data:JSON.stringify(data)},success:function(result){obj.dispatch("onsave",el,obj,data)}})},obj.getRowData=function(rowNumber){return obj.options.data[rowNumber]},obj.setRowData=function(rowNumber,data){for(var i=0;i<obj.headers.length;i++){var columnName=jexcel.getColumnNameFromId([i,rowNumber]);null!=data[i]&&obj.setValue(columnName,data[i])}},obj.getColumnData=function(columnNumber){for(var dataset=[],j=0;j<obj.options.data.length;j++)dataset.push(obj.options.data[j][columnNumber]);return dataset},obj.setColumnData=function(colNumber,data){for(var j=0;j<obj.rows.length;j++){var columnName=jexcel.getColumnNameFromId([colNumber,j]);null!=data[j]&&obj.setValue(columnName,data[j])}},obj.createRow=function(j,data){if(obj.records[j]||(obj.records[j]=[]),!data)var data=obj.options.data[j];obj.rows[j]=document.createElement("tr"),obj.rows[j].setAttribute("data-y",j);var index=null;obj.options.defaultRowHeight&&(obj.rows[j].style.height=obj.options.defaultRowHeight+"px"),obj.options.rows[j]&&(obj.options.rows[j].height&&(obj.rows[j].style.height=obj.options.rows[j].height),obj.options.rows[j].title&&(index=obj.options.rows[j].title)),index||(index=parseInt(j+1));var td=document.createElement("td");td.innerHTML=index,td.setAttribute("data-y",j),td.className="jexcel_row",obj.rows[j].appendChild(td);for(var i=0;i<obj.options.columns.length;i++)obj.records[j][i]=obj.createCell(i,j,data[i]),obj.rows[j].appendChild(obj.records[j][i]);return obj.rows[j]},obj.parseValue=function(i,j,value,cell){"="==(""+value).substr(0,1)&&1==obj.options.parseFormulas&&(value=obj.executeFormula(value,i,j));var options=obj.options.columns[i];if(options&&!isFormula(value)){var opt=null;if(opt=getMask(options)){value&&value==Number(value)&&(value=Number(value));var masked=jSuites.mask.render(value,opt,!0);if(cell&&opt.mask){var t=opt.mask.split(";"),t1,t2;if(t[1])t[1].match(new RegExp("\\[Red\\]","gi"))&&(value<0?cell.classList.add("red"):cell.classList.remove("red")),t[1].match(new RegExp("\\(","gi"))&&value<0&&(masked="("+masked+")")}masked&&(value=masked)}}return value};var validDate=function(date){return"-"==(date=""+date).substr(4,1)&&"-"==date.substr(7,1)||4==(date=date.split("-"))[0].length&&date[0]==Number(date[0])&&2==date[1].length&&date[1]==Number(date[1])};obj.createCell=function(i,j,value){var td=document.createElement("td");if(td.setAttribute("data-x",i),td.setAttribute("data-y",j),"="==(""+value).substr(0,1)&&1==obj.options.secureFormulas){var val=secureFormula(value);val!=value&&(value=val)}if(obj.options.columns[i].editor)!1===obj.options.stripHTML||!1===obj.options.columns[i].stripHTML?td.innerHTML=value:td.innerText=value,"function"==typeof obj.options.columns[i].editor.createCell&&(td=obj.options.columns[i].editor.createCell(td));else if("hidden"==obj.options.columns[i].type)td.style.display="none",td.innerText=value;else if("checkbox"==obj.options.columns[i].type||"radio"==obj.options.columns[i].type){var element=document.createElement("input");element.type=obj.options.columns[i].type,element.name="c"+i,element.checked=1==value||1==value||"true"==value,element.onclick=function(){obj.setValue(td,this.checked)},1!=obj.options.columns[i].readOnly&&0!=obj.options.editable||element.setAttribute("disabled","disabled"),td.appendChild(element),obj.options.data[j][i]=element.checked}else if("calendar"==obj.options.columns[i].type){var formatted=null;if(!validDate(value)){var tmp=jSuites.calendar.extractDateFromString(value,obj.options.columns[i].options.format);tmp&&(formatted=tmp)}td.innerText=jSuites.calendar.getDateString(formatted||value,obj.options.columns[i].options.format)}else if("dropdown"==obj.options.columns[i].type||"autocomplete"==obj.options.columns[i].type)td.classList.add("jexcel_dropdown"),td.innerText=obj.getDropDownValue(i,value);else if("color"==obj.options.columns[i].type)if("square"==obj.options.columns[i].render){var color=document.createElement("div");color.className="color",color.style.backgroundColor=value,td.appendChild(color)}else td.style.color=value,td.innerText=value;else if("image"==obj.options.columns[i].type){if(value&&"data:image"==value.substr(0,10)){var img=document.createElement("img");img.src=value,td.appendChild(img)}}else"html"==obj.options.columns[i].type?td.innerHTML=stripScript(obj.parseValue(i,j,value,td)):!1===obj.options.stripHTML||!1===obj.options.columns[i].stripHTML?td.innerHTML=stripScript(obj.parseValue(i,j,value,td)):td.innerText=obj.parseValue(i,j,value,td);1==obj.options.columns[i].readOnly&&(td.className="readonly");var colAlign=obj.options.columns[i].align?obj.options.columns[i].align:"center";return td.style.textAlign=colAlign,0!=obj.options.columns[i].wordWrap&&(1==obj.options.wordWrap||1==obj.options.columns[i].wordWrap||td.innerHTML.length>200)&&(td.style.whiteSpace="pre-wrap"),i>0&&1==this.options.textOverflow&&(value||td.innerHTML?obj.records[j][i-1].style.overflow="hidden":i==obj.options.columns.length-1&&(td.style.overflow="hidden")),td},obj.createCellHeader=function(colNumber){var colWidth=obj.options.columns[colNumber].width?obj.options.columns[colNumber].width:obj.options.defaultColWidth,colAlign=obj.options.columns[colNumber].align?obj.options.columns[colNumber].align:obj.options.defaultColAlign;obj.headers[colNumber]=document.createElement("td"),obj.options.stripHTML?obj.headers[colNumber].innerText=obj.options.columns[colNumber].title?obj.options.columns[colNumber].title:jexcel.getColumnName(colNumber):obj.headers[colNumber].innerHTML=obj.options.columns[colNumber].title?obj.options.columns[colNumber].title:jexcel.getColumnName(colNumber),obj.headers[colNumber].setAttribute("data-x",colNumber),obj.headers[colNumber].style.textAlign=colAlign,obj.options.columns[colNumber].title&&obj.headers[colNumber].setAttribute("title",obj.options.columns[colNumber].title),obj.options.columns[colNumber].id&&obj.headers[colNumber].setAttribute("id",obj.options.columns[colNumber].id),obj.colgroup[colNumber]=document.createElement("col"),obj.colgroup[colNumber].setAttribute("width",colWidth),"hidden"==obj.options.columns[colNumber].type&&(obj.headers[colNumber].style.display="none",obj.colgroup[colNumber].style.display="none")},obj.updateNestedHeader=function(x,y,title){obj.options.nestedHeaders[y][x].title&&(obj.options.nestedHeaders[y][x].title=title,obj.options.nestedHeaders[y].element.children[x+1].innerText=title)},obj.createNestedHeader=function(nestedInformation){var tr=document.createElement("tr");tr.classList.add("jexcel_nested");var td=document.createElement("td");tr.appendChild(td),nestedInformation.element=tr;for(var headerIndex=0,i=0;i<nestedInformation.length;i++){nestedInformation[i].colspan||(nestedInformation[i].colspan=1),nestedInformation[i].align||(nestedInformation[i].align="center"),nestedInformation[i].title||(nestedInformation[i].title="");for(var numberOfColumns=nestedInformation[i].colspan,column=[],x=0;x<numberOfColumns;x++)obj.options.columns[headerIndex]&&"hidden"==obj.options.columns[headerIndex].type&&numberOfColumns++,column.push(headerIndex),headerIndex++;var td;(td=document.createElement("td")).setAttribute("data-column",column.join(",")),td.setAttribute("colspan",nestedInformation[i].colspan),td.setAttribute("align",nestedInformation[i].align),td.innerText=nestedInformation[i].title,tr.appendChild(td)}return tr},obj.createToolbar=function(toolbar){if(toolbar)obj.options.toolbar=toolbar;else var toolbar=obj.options.toolbar;for(var i=0;i<toolbar.length;i++){var toolbarItem;if("i"==toolbar[i].type)(toolbarItem=document.createElement("i")).classList.add("jexcel_toolbar_item"),toolbarItem.classList.add("material-icons"),toolbarItem.setAttribute("data-k",toolbar[i].k),toolbarItem.setAttribute("data-v",toolbar[i].v),toolbarItem.setAttribute("id",toolbar[i].id),toolbar[i].tooltip&&toolbarItem.setAttribute("title",toolbar[i].tooltip),toolbar[i].onclick&&(toolbar[i].onclick,1)?toolbarItem.onclick=function(a){var b=a;return function(){toolbar[b].onclick(el,obj,this)}}(i):toolbarItem.onclick=function(){var k=this.getAttribute("data-k"),v=this.getAttribute("data-v");obj.setStyle(obj.highlighted,k,v)},toolbarItem.innerText=toolbar[i].content,obj.toolbar.appendChild(toolbarItem);else if("select"==toolbar[i].type){var toolbarItem;(toolbarItem=document.createElement("select")).classList.add("jexcel_toolbar_item"),toolbarItem.setAttribute("data-k",toolbar[i].k),toolbar[i].tooltip&&toolbarItem.setAttribute("title",toolbar[i].tooltip),toolbar[i].onchange&&(toolbar[i].onchange,1)?toolbarItem.onchange=toolbar[i].onchange:toolbarItem.onchange=function(){var k=this.getAttribute("data-k");obj.setStyle(obj.highlighted,k,this.value)};for(var j=0;j<toolbar[i].v.length;j++){var toolbarDropdownOption=document.createElement("option");toolbarDropdownOption.value=toolbar[i].v[j],toolbarDropdownOption.innerText=toolbar[i].v[j],toolbarItem.appendChild(toolbarDropdownOption)}obj.toolbar.appendChild(toolbarItem)}else if("color"==toolbar[i].type){var toolbarItem;(toolbarItem=document.createElement("i")).classList.add("jexcel_toolbar_item"),toolbarItem.classList.add("material-icons"),toolbarItem.setAttribute("data-k",toolbar[i].k),toolbarItem.setAttribute("data-v",""),toolbar[i].tooltip&&toolbarItem.setAttribute("title",toolbar[i].tooltip),obj.toolbar.appendChild(toolbarItem),toolbarItem.innerText=toolbar[i].content,jSuites.color(toolbarItem,{onchange:function(o,v){var k=o.getAttribute("data-k");obj.setStyle(obj.highlighted,k,v)}})}}},obj.setMerge=function(cellName,colspan,rowspan,ignoreHistoryAndEvents){var test=!1;if(!cellName){if(!obj.highlighted.length)return alert(obj.options.text.noCellsSelected),null;var x1=parseInt(obj.highlighted[0].getAttribute("data-x")),y1=parseInt(obj.highlighted[0].getAttribute("data-y")),x2=parseInt(obj.highlighted[obj.highlighted.length-1].getAttribute("data-x")),y2=parseInt(obj.highlighted[obj.highlighted.length-1].getAttribute("data-y")),cellName=jexcel.getColumnNameFromId([x1,y1]),colspan=x2-x1+1,rowspan=y2-y1+1}var cell=jexcel.getIdFromColumnName(cellName,!0);if(obj.options.mergeCells[cellName])obj.records[cell[1]][cell[0]].getAttribute("data-merged")&&(test=obj.options.text.cellAlreadyMerged);else if((!colspan||colspan<2)&&(!rowspan||rowspan<2))test=obj.options.text.invalidMergeProperties;else for(var cells=[],j=cell[1];j<cell[1]+rowspan;j++)for(var i=cell[0];i<cell[0]+colspan;i++){var columnName=jexcel.getColumnNameFromId([i,j]);obj.records[j][i].getAttribute("data-merged")&&(test=obj.options.text.thereIsAConflictWithAnotherMergedCell)}if(test)alert(test);else{colspan>1?obj.records[cell[1]][cell[0]].setAttribute("colspan",colspan):colspan=1,rowspan>1?obj.records[cell[1]][cell[0]].setAttribute("rowspan",rowspan):rowspan=1,obj.options.mergeCells[cellName]=[colspan,rowspan,[]],obj.records[cell[1]][cell[0]].setAttribute("data-merged","true"),obj.records[cell[1]][cell[0]].style.overflow="hidden";for(var data=[],y=cell[1];y<cell[1]+rowspan;y++)for(var x=cell[0];x<cell[0]+colspan;x++)cell[0]==x&&cell[1]==y||(data.push(obj.options.data[y][x]),obj.updateCell(x,y,"",!0),obj.options.mergeCells[cellName][2].push(obj.records[y][x]),obj.records[y][x].style.display="none",obj.records[y][x]=obj.records[cell[1]][cell[0]]);obj.updateSelection(obj.records[cell[1]][cell[0]]),ignoreHistoryAndEvents||(obj.setHistory({action:"setMerge",column:cellName,colspan:colspan,rowspan:rowspan,data:data}),obj.dispatch("onmerge",el,cellName,colspan,rowspan))}},obj.getMerge=function(cellName){var data={};if(cellName)data=obj.options.mergeCells[cellName]?[obj.options.mergeCells[cellName][0],obj.options.mergeCells[cellName][1]]:null;else if(obj.options.mergeCells)for(var mergedCells=obj.options.mergeCells,keys=Object.keys(obj.options.mergeCells),i=0;i<keys.length;i++)data[keys[i]]=[obj.options.mergeCells[keys[i]][0],obj.options.mergeCells[keys[i]][1]];return data},obj.removeMerge=function(cellName,data,keepOptions){if(obj.options.mergeCells[cellName]){var cell=jexcel.getIdFromColumnName(cellName,!0);obj.records[cell[1]][cell[0]].removeAttribute("colspan"),obj.records[cell[1]][cell[0]].removeAttribute("rowspan"),obj.records[cell[1]][cell[0]].removeAttribute("data-merged");for(var info=obj.options.mergeCells[cellName],index=0,j=0;j<info[1];j++)for(var i=0;i<info[0];i++)(j>0||i>0)&&(obj.records[cell[1]+j][cell[0]+i]=info[2][index],obj.records[cell[1]+j][cell[0]+i].style.display="",data&&data[index]&&obj.updateCell(cell[0]+i,cell[1]+j,data[index]),index++);obj.updateSelection(obj.records[cell[1]][cell[0]],obj.records[cell[1]+j-1][cell[0]+i-1]),keepOptions||delete obj.options.mergeCells[cellName]}},obj.destroyMerged=function(keepOptions){if(obj.options.mergeCells)for(var mergedCells=obj.options.mergeCells,keys=Object.keys(obj.options.mergeCells),i=0;i<keys.length;i++)obj.removeMerge(keys[i],null,keepOptions)},obj.isColMerged=function(x,insertBefore){var cols=[];if(obj.options.mergeCells)for(var keys=Object.keys(obj.options.mergeCells),i=0;i<keys.length;i++){var info=jexcel.getIdFromColumnName(keys[i],!0),colspan=obj.options.mergeCells[keys[i]][0],x1=info[0],x2=info[0]+(colspan>1?colspan-1:0);null==insertBefore?x1<=x&&x2>=x&&cols.push(keys[i]):insertBefore?x1<x&&x2>=x&&cols.push(keys[i]):x1<=x&&x2>x&&cols.push(keys[i])}return cols},obj.isRowMerged=function(y,insertBefore){var rows=[];if(obj.options.mergeCells)for(var keys=Object.keys(obj.options.mergeCells),i=0;i<keys.length;i++){var info=jexcel.getIdFromColumnName(keys[i],!0),rowspan=obj.options.mergeCells[keys[i]][1],y1=info[1],y2=info[1]+(rowspan>1?rowspan-1:0);null==insertBefore?y1<=y&&y2>=y&&rows.push(keys[i]):insertBefore?y1<y&&y2>=y&&rows.push(keys[i]):y1<=y&&y2>y&&rows.push(keys[i])}return rows},obj.openFilter=function(columnId){if(obj.options.filters){columnId=parseInt(columnId),obj.resetSelection();var optionsFiltered=[];if("checkbox"==obj.options.columns[columnId].type)optionsFiltered.push({id:"true",name:"True"}),optionsFiltered.push({id:"false",name:"False"});else{for(var options=[],hasBlanks=!1,j=0;j<obj.options.data.length;j++){var k=obj.options.data[j][columnId],v=obj.records[j][columnId].innerHTML;if(k&&v)options[k]=v;else var hasBlanks=!0}for(var keys=Object.keys(options),optionsFiltered=[],j=0;j<keys.length;j++)optionsFiltered.push({id:keys[j],name:options[keys[j]]});hasBlanks&&optionsFiltered.push({value:"",id:"",name:"(Blanks)"})}var div=document.createElement("div");obj.filter.children[columnId+1].innerHTML="",obj.filter.children[columnId+1].appendChild(div),obj.filter.children[columnId+1].style.paddingLeft="0px",obj.filter.children[columnId+1].style.paddingRight="0px",obj.filter.children[columnId+1].style.overflow="initial";var opt={data:optionsFiltered,multiple:!0,autocomplete:!0,opened:!0,value:void 0!==obj.filters[columnId]?obj.filters[columnId]:null,width:"100%",position:1==obj.options.tableOverflow||1==obj.options.fullscreen,onclose:function(o){obj.resetFilters(),obj.filters[columnId]=o.dropdown.getValue(!0),obj.filter.children[columnId+1].innerHTML=o.dropdown.getText(),obj.filter.children[columnId+1].style.paddingLeft="",obj.filter.children[columnId+1].style.paddingRight="",obj.filter.children[columnId+1].style.overflow="",obj.closeFilter(columnId),obj.refreshSelection()}};jSuites.dropdown(div,opt)}else console.log("Jspreadsheet: filters not enabled.")},obj.resetFilters=function(){if(obj.options.filters)for(var i=0;i<obj.filter.children.length;i++)obj.filter.children[i].innerHTML="&nbsp;",obj.filters[i]=null;obj.results=null,obj.updateResult()},obj.closeFilter=function(columnId){if(!columnId)for(var i=0;i<obj.filter.children.length;i++)obj.filters[i]&&(columnId=i);var search=function(query,x,y){for(var i=0;i<query.length;i++){var value=""+obj.options.data[y][x],label=""+obj.records[y][x].innerHTML;if(query[i]==value||query[i]==label)return!0}return!1},query=obj.filters[columnId];obj.results=[];for(var j=0;j<obj.options.data.length;j++)search(query,columnId,j)&&obj.results.push(j);obj.results.length||(obj.results=null),obj.updateResult()},obj.openEditor=function(cell,empty,e){var y=cell.getAttribute("data-y"),x=cell.getAttribute("data-x");obj.dispatch("oneditionstart",el,cell,x,y),x>0&&(obj.records[y][x-1].style.overflow="hidden");var createEditor=function(type){var info=cell.getBoundingClientRect(),editor=document.createElement(type);return editor.style.width=info.width+"px",editor.style.height=info.height-2+"px",editor.style.minHeight=info.height-2+"px",cell.classList.add("editor"),cell.innerHTML="",cell.appendChild(editor),obj.dispatch("oncreateeditor",el,cell,x,y,editor),editor};if(1==cell.classList.contains("readonly"));else if(obj.edition=[obj.records[y][x],obj.records[y][x].innerHTML,x,y],obj.options.columns[x].editor)obj.options.columns[x].editor.openEditor(cell,el,empty,e);else if("hidden"==obj.options.columns[x].type);else if("checkbox"==obj.options.columns[x].type||"radio"==obj.options.columns[x].type){var value=!cell.children[0].checked;obj.setValue(cell,value),obj.edition=null}else if("dropdown"==obj.options.columns[x].type||"autocomplete"==obj.options.columns[x].type){var value=obj.options.data[y][x];if(obj.options.columns[x].multiple&&!Array.isArray(value)&&(value=value.split(";")),"function"==typeof obj.options.columns[x].filter)var source=obj.options.columns[x].filter(el,cell,x,y,obj.options.columns[x].source);else var source=obj.options.columns[x].source;for(var data=[],j=0;j<source.length;j++)data.push(source[j]);var editor=createEditor("div"),options={data:data,multiple:!!obj.options.columns[x].multiple,autocomplete:!(!obj.options.columns[x].autocomplete&&"autocomplete"!=obj.options.columns[x].type),opened:!0,value:value,width:"100%",height:editor.style.minHeight,position:1==obj.options.tableOverflow||1==obj.options.fullscreen,onclose:function(){obj.closeEditor(cell,!0)}};obj.options.columns[x].options&&obj.options.columns[x].options.type&&(options.type=obj.options.columns[x].options.type),jSuites.dropdown(editor,options)}else if("calendar"==obj.options.columns[x].type||"color"==obj.options.columns[x].type){var value=obj.options.data[y][x],editor;(editor=createEditor("input")).value=value,1!=obj.options.tableOverflow&&1!=obj.options.fullscreen||(obj.options.columns[x].options.position=!0),obj.options.columns[x].options.value=obj.options.data[y][x],obj.options.columns[x].options.opened=!0,obj.options.columns[x].options.onclose=function(el,value){obj.closeEditor(cell,!0)},"color"==obj.options.columns[x].type?jSuites.color(editor,obj.options.columns[x].options):jSuites.calendar(editor,obj.options.columns[x].options),editor.focus()}else if("html"==obj.options.columns[x].type){var value=obj.options.data[y][x],editor,div;(editor=createEditor("div")).style.position="relative",(div=document.createElement("div")).classList.add("jexcel_richtext"),editor.appendChild(div),jSuites.editor(div,{focus:!0,value:value});var rect=cell.getBoundingClientRect(),rectContent=div.getBoundingClientRect();window.innerHeight<rect.bottom+rectContent.height?div.style.top=rect.top-(rectContent.height+2)+"px":div.style.top=rect.top+"px"}else if("image"==obj.options.columns[x].type){var img=cell.children[0],editor,div;(editor=createEditor("div")).style.position="relative",(div=document.createElement("div")).classList.add("jclose"),img&&img.src&&div.appendChild(img),editor.appendChild(div),jSuites.image(div,obj.options.imageOptions);var rect=cell.getBoundingClientRect(),rectContent=div.getBoundingClientRect();window.innerHeight<rect.bottom+rectContent.height?div.style.top=rect.top-(rectContent.height+2)+"px":div.style.top=rect.top+"px"}else{var value=1==empty?"":obj.options.data[y][x];if(0==obj.options.columns[x].wordWrap||1!=obj.options.wordWrap&&1!=obj.options.columns[x].wordWrap)var editor=createEditor("input");else var editor=createEditor("textarea");editor.focus(),editor.value=value;var options=obj.options.columns[x],opt=null;if(!isFormula(value)&&(opt=getMask(options))){if(!options.disabledMaskOnEdition)if(options.mask){var m=options.mask.split(";");editor.setAttribute("data-mask",m[0])}else options.locale&&editor.setAttribute("data-locale",options.locale);opt.input=editor,editor.mask=opt,jSuites.mask.render(value,opt,!1)}editor.onblur=function(){obj.closeEditor(cell,!0)},editor.scrollLeft=editor.scrollWidth}},obj.closeEditor=function(cell,save){var x=parseInt(cell.getAttribute("data-x")),y=parseInt(cell.getAttribute("data-y"));if(1==save){if(obj.options.columns[x].editor)var value=obj.options.columns[x].editor.closeEditor(cell,save);else if("checkbox"==obj.options.columns[x].type||"radio"==obj.options.columns[x].type||"hidden"==obj.options.columns[x].type);else if("dropdown"==obj.options.columns[x].type||"autocomplete"==obj.options.columns[x].type)var value=cell.children[0].dropdown.close(!0);else if("calendar"==obj.options.columns[x].type)var value=cell.children[0].calendar.close(!0);else if("color"==obj.options.columns[x].type)var value=cell.children[0].color.close(!0);else if("html"==obj.options.columns[x].type)var value=cell.children[0].children[0].editor.getData();else if("image"==obj.options.columns[x].type)var img=cell.children[0].children[0].children[0],value=img&&"IMG"==img.tagName?img.src:"";else if("numeric"==obj.options.columns[x].type){var value;"="!=(""+(value=cell.children[0].value)).substr(0,1)&&""==value&&(value=obj.options.columns[x].allowEmpty?"":0),cell.children[0].onblur=null}else{var value=cell.children[0].value;cell.children[0].onblur=null;var options=obj.options.columns[x],opt=null;if((opt=getMask(options))&&""!==value&&!isFormula(value)&&"number"!=typeof value){var t=jSuites.mask.extract(value,opt,!0);t&&""!==t.value&&(value=t.value)}}obj.options.data[y][x]==value?cell.innerHTML=obj.edition[1]:obj.setValue(cell,value)}else obj.options.columns[x].editor?obj.options.columns[x].editor.closeEditor(cell,save):"dropdown"==obj.options.columns[x].type||"autocomplete"==obj.options.columns[x].type?cell.children[0].dropdown.close(!0):"calendar"==obj.options.columns[x].type?cell.children[0].calendar.close(!0):"color"==obj.options.columns[x].type?cell.children[0].color.close(!0):cell.children[0].onblur=null,cell.innerHTML=obj.edition&&obj.edition[1]?obj.edition[1]:"";obj.dispatch("oneditionend",el,cell,x,y,value,save),cell.classList.remove("editor"),obj.edition=null},obj.getCell=function(cell){var x=(cell=jexcel.getIdFromColumnName(cell,!0))[0],y=cell[1];return obj.records[y][x]},obj.getColumnOptions=function(x,y){var options=obj.options.columns[x];return options||(options={type:"text"}),options},obj.getCellFromCoords=function(x,y){return obj.records[y][x]},obj.getLabel=function(cell){var x=(cell=jexcel.getIdFromColumnName(cell,!0))[0],y=cell[1];return obj.records[y][x].innerHTML},obj.getLabelFromCoords=function(x,y){return obj.records[y][x].innerHTML},obj.getValue=function(cell,processedValue){if("object"==typeof cell)var x=cell.getAttribute("data-x"),y=cell.getAttribute("data-y");else var x=(cell=jexcel.getIdFromColumnName(cell,!0))[0],y=cell[1];var value=null;return null!=x&&null!=y&&(obj.records[y]&&obj.records[y][x]&&(processedValue||1==obj.options.copyCompatibility)?value=obj.records[y][x].innerHTML:obj.options.data[y]&&"undefined"!=obj.options.data[y][x]&&(value=obj.options.data[y][x])),value},obj.getValueFromCoords=function(x,y,processedValue){var value=null;return null!=x&&null!=y&&(obj.records[y]&&obj.records[y][x]&&processedValue||1==obj.options.copyCompatibility?value=obj.records[y][x].innerHTML:obj.options.data[y]&&"undefined"!=obj.options.data[y][x]&&(value=obj.options.data[y][x])),value},obj.setValue=function(cell,value,force){var records=[];if("string"==typeof cell){var columnId,x=(columnId=jexcel.getIdFromColumnName(cell,!0))[0],y=columnId[1];records.push(obj.updateCell(x,y,value,force)),obj.updateFormulaChain(x,y,records)}else{var x=null,y=null;if(cell&&cell.getAttribute)var x=cell.getAttribute("data-x"),y=cell.getAttribute("data-y");if(null!=x&&null!=y)records.push(obj.updateCell(x,y,value,force)),obj.updateFormulaChain(x,y,records);else{var keys=Object.keys(cell);if(keys.length>0)for(var i=0;i<keys.length;i++){if("string"==typeof cell[i])var columnId,x=(columnId=jexcel.getIdFromColumnName(cell[i],!0))[0],y=columnId[1];else if(null!=cell[i].x&&null!=cell[i].y){var x=cell[i].x,y=cell[i].y;null!=cell[i].newValue?value=cell[i].newValue:null!=cell[i].value&&(value=cell[i].value)}else var x=cell[i].getAttribute("data-x"),y=cell[i].getAttribute("data-y");null!=x&&null!=y&&(records.push(obj.updateCell(x,y,value,force)),obj.updateFormulaChain(x,y,records))}}}obj.setHistory({action:"setValue",records:records,selection:obj.selectedCell}),obj.updateTable(),obj.onafterchanges(el,records)},obj.setValueFromCoords=function(x,y,value,force){var records=[];records.push(obj.updateCell(x,y,value,force)),obj.updateFormulaChain(x,y,records),obj.setHistory({action:"setValue",records:records,selection:obj.selectedCell}),obj.updateTable(),obj.onafterchanges(el,records)},obj.setCheckRadioValue=function(){for(var records=[],keys=Object.keys(obj.highlighted),i=0;i<keys.length;i++){var x=obj.highlighted[i].getAttribute("data-x"),y=obj.highlighted[i].getAttribute("data-y");"checkbox"!=obj.options.columns[x].type&&"radio"!=obj.options.columns[x].type||records.push(obj.updateCell(x,y,!obj.options.data[y][x]))}records.length&&(obj.setHistory({action:"setValue",records:records,selection:obj.selectedCell}),obj.onafterchanges(el,records))};var stripScript=function(a){var b=new Option;b.innerHTML=a;var c=null;for(a=b.getElementsByTagName("script");c=a[0];)c.parentNode.removeChild(c);return b.innerHTML};obj.updateCell=function(x,y,value,force){if(1!=obj.records[y][x].classList.contains("readonly")||force){var val,val;if("="==(""+value).substr(0,1)&&1==obj.options.secureFormulas)(val=secureFormula(value))!=value&&(value=val);null!=(val=obj.dispatch("onbeforechange",el,obj.records[y][x],x,y,value))&&(value=val),obj.options.columns[x].editor&&"function"==typeof obj.options.columns[x].editor.updateCell&&(value=obj.options.columns[x].editor.updateCell(obj.records[y][x],value,force));var record={x:x,y:y,col:x,row:y,newValue:value,oldValue:obj.options.data[y][x]};if(obj.options.columns[x].editor)obj.options.data[y][x]=value;else if("checkbox"==obj.options.columns[x].type||"radio"==obj.options.columns[x].type){if("radio"==obj.options.columns[x].type)for(var j=0;j<obj.options.data.length;j++)obj.options.data[j][x]=!1;obj.records[y][x].children[0].checked=1==value||1==value||"true"==value||"TRUE"==value,obj.options.data[y][x]=obj.records[y][x].children[0].checked}else if("dropdown"==obj.options.columns[x].type||"autocomplete"==obj.options.columns[x].type)obj.options.data[y][x]=value,obj.records[y][x].innerText=obj.getDropDownValue(x,value);else if("calendar"==obj.options.columns[x].type){var formatted=null;if(!validDate(value)){var tmp=jSuites.calendar.extractDateFromString(value,obj.options.columns[x].options.format);tmp&&(formatted=tmp)}obj.options.data[y][x]=value,obj.records[y][x].innerText=jSuites.calendar.getDateString(formatted||value,obj.options.columns[x].options.format)}else if("color"==obj.options.columns[x].type)if(obj.options.data[y][x]=value,"square"==obj.options.columns[x].render){var color=document.createElement("div");color.className="color",color.style.backgroundColor=value,obj.records[y][x].innerText="",obj.records[y][x].appendChild(color)}else obj.records[y][x].style.color=value,obj.records[y][x].innerText=value;else if("image"==obj.options.columns[x].type){if(value=""+value,obj.options.data[y][x]=value,obj.records[y][x].innerHTML="",value&&"data:image"==value.substr(0,10)){var img=document.createElement("img");img.src=value,obj.records[y][x].appendChild(img)}}else obj.options.data[y][x]=value,"html"==obj.options.columns[x].type?obj.records[y][x].innerHTML=stripScript(obj.parseValue(x,y,value)):!1===obj.options.stripHTML||!1===obj.options.columns[x].stripHTML?obj.records[y][x].innerHTML=stripScript(obj.parseValue(x,y,value,obj.records[y][x])):obj.records[y][x].innerText=obj.parseValue(x,y,value,obj.records[y][x]),0!=obj.options.columns[x].wordWrap&&(1==obj.options.wordWrap||1==obj.options.columns[x].wordWrap||obj.records[y][x].innerHTML.length>200)?obj.records[y][x].style.whiteSpace="pre-wrap":obj.records[y][x].style.whiteSpace="";x>0&&(obj.records[y][x-1].style.overflow=value?"hidden":""),obj.dispatch("onchange",el,obj.records[y]&&obj.records[y][x]?obj.records[y][x]:null,x,y,value,record.oldValue)}else var record={x:x,y:y,col:x,row:y};return record},obj.copyData=function(o,d){var data=obj.getData(!0,!0),h=obj.selectedContainer,x1=parseInt(o.getAttribute("data-x")),y1=parseInt(o.getAttribute("data-y")),x2=parseInt(d.getAttribute("data-x")),y2=parseInt(d.getAttribute("data-y")),records=[],breakControl=!1;if(h[0]==x1){if(y1<h[1])var rowNumber=y1-h[1];else var rowNumber=1;var colNumber=0}else{if(x1<h[0])var colNumber=x1-h[0];else var colNumber=1;var rowNumber=0}for(var posx=0,posy=0,j=y1;j<=y2;j++)if(!obj.rows[j]||"none"!=obj.rows[j].style.display){if(null==data[posy]&&(posy=0),posx=0,h[0]!=x1)if(x1<h[0])var colNumber=x1-h[0];else var colNumber=1;for(var i=x1;i<=x2;i++){if(obj.records[j][i]&&!obj.records[j][i].classList.contains("readonly")&&"none"!=obj.records[j][i].style.display&&0==breakControl){if(!obj.selection.length&&""!=obj.options.data[j][i]){breakControl=!0;continue}null==data[posy]?posx=0:null==data[posy][posx]&&(posx=0);var value=data[posy][posx];if(value&&!data[1]&&1==obj.options.autoIncrement)if("text"==obj.options.columns[i].type||"number"==obj.options.columns[i].type)if("="==(""+value).substr(0,1)){var tokens=value.match(/([A-Z]+[0-9]+)/g);if(tokens){for(var affectedTokens=[],index=0;index<tokens.length;index++){var position=jexcel.getIdFromColumnName(tokens[index],1);position[0]+=colNumber,position[1]+=rowNumber,position[1]<0&&(position[1]=0);var token=jexcel.getColumnNameFromId([position[0],position[1]]);token!=tokens[index]&&(affectedTokens[tokens[index]]=token)}affectedTokens&&(value=obj.updateFormula(value,affectedTokens))}}else value==Number(value)&&(value=Number(value)+rowNumber);else if("calendar"==obj.options.columns[i].type){var date=new Date(value);date.setDate(date.getDate()+rowNumber),value=date.getFullYear()+"-"+jexcel.doubleDigitFormat(parseInt(date.getMonth()+1))+"-"+jexcel.doubleDigitFormat(date.getDate())+" 00:00:00"}records.push(obj.updateCell(i,j,value)),obj.updateFormulaChain(i,j,records)}posx++,h[0]!=x1&&colNumber++}posy++,rowNumber++}obj.setHistory({action:"setValue",records:records,selection:obj.selectedCell}),obj.updateTable(),obj.onafterchanges(el,records)},obj.refreshSelection=function(){obj.selectedCell&&obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3])},obj.conditionalSelectionUpdate=function(type,o,d){if(1==type){if(obj.selectedCell&&(o>=obj.selectedCell[1]&&o<=obj.selectedCell[3]||d>=obj.selectedCell[1]&&d<=obj.selectedCell[3]))return void obj.resetSelection()}else if(obj.selectedCell&&(o>=obj.selectedCell[0]&&o<=obj.selectedCell[2]||d>=obj.selectedCell[0]&&d<=obj.selectedCell[2]))return void obj.resetSelection()},obj.resetSelection=function(blur){if(obj.highlighted.length)for(var previousStatus=1,i=0;i<obj.highlighted.length;i++){obj.highlighted[i].classList.remove("highlight"),obj.highlighted[i].classList.remove("highlight-left"),obj.highlighted[i].classList.remove("highlight-right"),obj.highlighted[i].classList.remove("highlight-top"),obj.highlighted[i].classList.remove("highlight-bottom"),obj.highlighted[i].classList.remove("highlight-selected");var px=parseInt(obj.highlighted[i].getAttribute("data-x")),py=parseInt(obj.highlighted[i].getAttribute("data-y"));if(obj.highlighted[i].getAttribute("data-merged"))var colspan=parseInt(obj.highlighted[i].getAttribute("colspan")),rowspan=parseInt(obj.highlighted[i].getAttribute("rowspan")),ux=colspan>0?px+(colspan-1):px,uy=rowspan>0?py+(rowspan-1):py;else var ux=px,uy=py;for(var j=px;j<=ux;j++)obj.headers[j]&&obj.headers[j].classList.remove("selected");for(var j=py;j<=uy;j++)obj.rows[j]&&obj.rows[j].classList.remove("selected")}else var previousStatus=0;return obj.highlighted=[],obj.selectedCell=null,obj.corner.style.top="-2000px",obj.corner.style.left="-2000px",1==blur&&1==previousStatus&&obj.dispatch("onblur",el),previousStatus},obj.updateSelection=function(el1,el2,origin){var x1=el1.getAttribute("data-x"),y1=el1.getAttribute("data-y");if(el2)var x2=el2.getAttribute("data-x"),y2=el2.getAttribute("data-y");else var x2=x1,y2=y1;obj.updateSelectionFromCoords(x1,y1,x2,y2,origin)},obj.updateSelectionFromCoords=function(x1,y1,x2,y2,origin){var updated=null,previousState=obj.resetSelection();if(null==y1&&(y1=0,y2=obj.rows.length-1),null==x2&&(x2=x1),null==y2&&(y2=y1),x1>=obj.headers.length&&(x1=obj.headers.length-1),y1>=obj.rows.length&&(y1=obj.rows.length-1),x2>=obj.headers.length&&(x2=obj.headers.length-1),y2>=obj.rows.length&&(y2=obj.rows.length-1),obj.selectedCell=[x1,y1,x2,y2],null!=x1){if(obj.records[y1][x1]&&obj.records[y1][x1].classList.add("highlight-selected"),parseInt(x1)<parseInt(x2))var px=parseInt(x1),ux=parseInt(x2);else var px=parseInt(x2),ux=parseInt(x1);if(parseInt(y1)<parseInt(y2))var py=parseInt(y1),uy=parseInt(y2);else var py=parseInt(y2),uy=parseInt(y1);for(var i=px;i<=ux;i++)for(var j=py;j<=uy;j++)if(obj.records[j][i]&&obj.records[j][i].getAttribute("data-merged")){var x=parseInt(obj.records[j][i].getAttribute("data-x")),y=parseInt(obj.records[j][i].getAttribute("data-y")),colspan=parseInt(obj.records[j][i].getAttribute("colspan")),rowspan=parseInt(obj.records[j][i].getAttribute("rowspan"));colspan>1&&(x<px&&(px=x),x+colspan>ux&&(ux=x+colspan-1)),rowspan&&(y<py&&(py=y),y+rowspan>uy&&(uy=y+rowspan-1))}for(var borderLeft=null,borderRight=null,borderTop=null,borderBottom=null,j=py;j<=uy;j++)"none"!=obj.rows[j].style.display&&(null==borderTop&&(borderTop=j),borderBottom=j);for(var i=px;i<=ux;i++){for(var j=py;j<=uy;j++)"none"!=obj.rows[j].style.display&&"none"!=obj.records[j][i].style.display&&(obj.records[j][i].classList.add("highlight"),obj.highlighted.push(obj.records[j][i]));"hidden"!=obj.options.columns[i].type&&(null==borderLeft&&(borderLeft=i),borderRight=i)}borderLeft||(borderLeft=0),borderRight||(borderRight=0);for(var i=borderLeft;i<=borderRight;i++)"hidden"!=obj.options.columns[i].type&&(obj.records[borderTop]&&obj.records[borderTop][i]&&obj.records[borderTop][i].classList.add("highlight-top"),obj.records[borderBottom]&&obj.records[borderBottom][i]&&obj.records[borderBottom][i].classList.add("highlight-bottom"),obj.headers[i].classList.add("selected"));for(var j=borderTop;j<=borderBottom;j++)obj.rows[j]&&"none"!=obj.rows[j].style.display&&(obj.records[j][borderLeft].classList.add("highlight-left"),obj.records[j][borderRight].classList.add("highlight-right"),obj.rows[j].classList.add("selected"));obj.selectedContainer=[borderLeft,borderTop,borderRight,borderBottom]}0==previousState&&(obj.dispatch("onfocus",el),obj.removeCopyingSelection()),obj.dispatch("onselection",el,borderLeft,borderTop,borderRight,borderBottom,origin),obj.updateCornerPosition()},obj.removeCopySelection=function(){for(var i=0;i<obj.selection.length;i++)obj.selection[i].classList.remove("selection"),obj.selection[i].classList.remove("selection-left"),obj.selection[i].classList.remove("selection-right"),obj.selection[i].classList.remove("selection-top"),obj.selection[i].classList.remove("selection-bottom");obj.selection=[]},obj.updateCopySelection=function(x3,y3){obj.removeCopySelection();var x1=obj.selectedContainer[0],y1=obj.selectedContainer[1],x2=obj.selectedContainer[2],y2=obj.selectedContainer[3];if(null!=x3&&null!=y3){if(x3-x2>0)var px=parseInt(x2)+1,ux=parseInt(x3);else var px=parseInt(x3),ux=parseInt(x1)-1;if(y3-y2>0)var py=parseInt(y2)+1,uy=parseInt(y3);else var py=parseInt(y3),uy=parseInt(y1)-1;if(ux-px<=uy-py)var px=parseInt(x1),ux=parseInt(x2);else var py=parseInt(y1),uy=parseInt(y2);for(var j=py;j<=uy;j++)for(var i=px;i<=ux;i++)obj.records[j][i]&&"none"!=obj.rows[j].style.display&&"none"!=obj.records[j][i].style.display&&(obj.records[j][i].classList.add("selection"),obj.records[py][i].classList.add("selection-top"),obj.records[uy][i].classList.add("selection-bottom"),obj.records[j][px].classList.add("selection-left"),obj.records[j][ux].classList.add("selection-right"),obj.selection.push(obj.records[j][i]))}},obj.updateCornerPosition=function(){if(obj.highlighted.length){var last=obj.highlighted[obj.highlighted.length-1],lastX=last.getAttribute("data-x"),contentRect=obj.content.getBoundingClientRect(),x1=contentRect.left,y1=contentRect.top,lastRect=last.getBoundingClientRect(),x2=lastRect.left,y2=lastRect.top,w2=lastRect.width,h2=lastRect.height,x=x2-x1+obj.content.scrollLeft+w2-4,y=y2-y1+obj.content.scrollTop+h2-4;if(obj.corner.style.top=y+"px",obj.corner.style.left=x+"px",obj.options.freezeColumns){var width=obj.getFreezeWidth();lastX>obj.options.freezeColumns-1&&x2-x1+w2<width?obj.corner.style.display="none":1==obj.options.selectionCopy&&(obj.corner.style.display="")}else 1==obj.options.selectionCopy&&(obj.corner.style.display="")}else obj.corner.style.top="-2000px",obj.corner.style.left="-2000px"},obj.updateScroll=function(direction){var contentRect=obj.content.getBoundingClientRect(),x1=contentRect.left,y1=contentRect.top,w1=contentRect.width,h1=contentRect.height,reference,referenceRect=obj.records[obj.selectedCell[3]][obj.selectedCell[2]].getBoundingClientRect(),x2=referenceRect.left,y2=referenceRect.top,w2=referenceRect.width,h2=referenceRect.height;if(0==direction||1==direction)var x=x2-x1+obj.content.scrollLeft,y=y2-y1+obj.content.scrollTop-2;else var x=x2-x1+obj.content.scrollLeft+w2,y=y2-y1+obj.content.scrollTop+h2;y>obj.content.scrollTop+30&&y<obj.content.scrollTop+h1||(y<obj.content.scrollTop+30?obj.content.scrollTop=y-h2:obj.content.scrollTop=y-(h1-2));var freezed=obj.getFreezeWidth();x>obj.content.scrollLeft+freezed&&x<obj.content.scrollLeft+w1||(x<obj.content.scrollLeft+30?(obj.content.scrollLeft=x,obj.content.scrollLeft<50&&(obj.content.scrollLeft=0)):x<obj.content.scrollLeft+freezed?obj.content.scrollLeft=x-freezed-1:obj.content.scrollLeft=x-(w1-20))},obj.getWidth=function(column){if(column)"object"==typeof column&&(column=$(column).getAttribute("data-x")),data=obj.colgroup[column].getAttribute("width");else for(var data=[],i=0;i<obj.headers.length;i++)data.push(obj.options.columns[i].width);return data},obj.setWidth=function(column,width,oldWidth){if(width){if(Array.isArray(column)){if(!oldWidth)var oldWidth=[];for(var i=0;i<column.length;i++){oldWidth[i]||(oldWidth[i]=obj.colgroup[column[i]].getAttribute("width"));var w=Array.isArray(width)&&width[i]?width[i]:width;obj.colgroup[column[i]].setAttribute("width",w),obj.options.columns[column[i]].width=w}}else oldWidth||(oldWidth=obj.colgroup[column].getAttribute("width")),obj.colgroup[column].setAttribute("width",width),obj.options.columns[column].width=width;obj.setHistory({action:"setWidth",column:column,oldValue:oldWidth,newValue:width}),obj.dispatch("onresizecolumn",el,column,width,oldWidth),obj.updateCornerPosition()}},obj.setHeight=function(row,height,oldHeight){if(height>0){var rect;if("object"==typeof row&&(row=row.getAttribute("data-y")),!oldHeight)if(!(oldHeight=obj.rows[row].getAttribute("height")))oldHeight=obj.rows[row].getBoundingClientRect().height;height=parseInt(height),obj.rows[row].style.height=height+"px",obj.options.rows[row]||(obj.options.rows[row]={}),obj.options.rows[row].height=height,obj.setHistory({action:"setHeight",row:row,oldValue:oldHeight,newValue:height}),obj.dispatch("onresizerow",el,row,height,oldHeight),obj.updateCornerPosition()}},obj.getHeight=function(row){if(row){"object"==typeof row&&(row=$(row).getAttribute("data-y"));var data=obj.rows[row].style.height}else for(var data=[],j=0;j<obj.rows.length;j++){var h=obj.rows[j].style.height;h&&(data[j]=h)}return data},obj.setFooter=function(data){if(data&&(obj.options.footers=data),obj.options.footers){obj.tfoot||(obj.tfoot=document.createElement("tfoot"),obj.table.appendChild(obj.tfoot));for(var j=0;j<obj.options.footers.length;j++){if(obj.tfoot.children[j])var tr=obj.tfoot.children[j];else{var tr=document.createElement("tr"),td=document.createElement("td");tr.appendChild(td),obj.tfoot.appendChild(tr)}for(var i=0;i<obj.headers.length;i++){if(obj.options.footers[j][i]||(obj.options.footers[j][i]=""),obj.tfoot.children[j].children[i+1])var td=obj.tfoot.children[j].children[i+1];else{var td=document.createElement("td");tr.appendChild(td);var colAlign=obj.options.columns[i].align?obj.options.columns[i].align:"center";td.style.textAlign=colAlign}td.innerText=obj.parseValue(+obj.records.length+i,j,obj.options.footers[j][i]),td.style.display=obj.colgroup[i].style.display}}}},obj.getHeader=function(column){return obj.headers[column].innerText},obj.setHeader=function(column,newValue){if(obj.headers[column]){var oldValue=obj.headers[column].innerText;newValue||(newValue=prompt(obj.options.text.columnName,oldValue)),newValue&&(obj.headers[column].innerText=newValue,obj.headers[column].setAttribute("title",newValue),obj.options.columns[column].title=newValue),obj.setHistory({action:"setHeader",column:column,oldValue:oldValue,newValue:newValue}),obj.dispatch("onchangeheader",el,column,oldValue,newValue)}},obj.getHeaders=function(asArray){for(var title=[],i=0;i<obj.headers.length;i++)title.push(obj.getHeader(i));return asArray?title:title.join(obj.options.csvDelimiter)},obj.getMeta=function(cell,key){return cell?key?obj.options.meta[cell]&&obj.options.meta[cell][key]?obj.options.meta[cell][key]:null:obj.options.meta[cell]?obj.options.meta[cell]:null:obj.options.meta},obj.setMeta=function(o,k,v){if(obj.options.meta||(obj.options.meta={}),k&&v)obj.options.meta[o]||(obj.options.meta[o]={}),obj.options.meta[o][k]=v;else for(var keys=Object.keys(o),i=0;i<keys.length;i++){obj.options.meta[keys[i]]||(obj.options.meta[keys[i]]={});for(var prop=Object.keys(o[keys[i]]),j=0;j<prop.length;j++)obj.options.meta[keys[i]][prop[j]]=o[keys[i]][prop[j]]}obj.dispatch("onchangemeta",el,o,k,v)},obj.updateMeta=function(affectedCells){if(obj.options.meta){for(var newMeta={},keys=Object.keys(obj.options.meta),i=0;i<keys.length;i++)affectedCells[keys[i]]?newMeta[affectedCells[keys[i]]]=obj.options.meta[keys[i]]:newMeta[keys[i]]=obj.options.meta[keys[i]];obj.options.meta=newMeta}},obj.getStyle=function(cell,key){if(cell)return cell=jexcel.getIdFromColumnName(cell,!0),key?obj.records[cell[1]][cell[0]].style[key]:obj.records[cell[1]][cell[0]].getAttribute("style");for(var data={},x=obj.options.data[0].length,y=obj.options.data.length,j=0;j<y;j++)for(var i=0;i<x;i++){var v=key?obj.records[j][i].style[key]:obj.records[j][i].getAttribute("style"),k;if(v)data[jexcel.getColumnNameFromId([i,j])]=v}return data},obj.resetStyle=function(o,ignoreHistoryAndEvents){for(var keys=Object.keys(o),i=0;i<keys.length;i++){var cell=jexcel.getIdFromColumnName(keys[i],!0);obj.records[cell[1]]&&obj.records[cell[1]][cell[0]]&&obj.records[cell[1]][cell[0]].setAttribute("style","")}obj.setStyle(o,null,null,null,ignoreHistoryAndEvents)},obj.setStyle=function(o,k,v,force,ignoreHistoryAndEvents){var newValue={},oldValue={},applyStyle=function(cellId,key,value){var cell=jexcel.getIdFromColumnName(cellId,!0);if(obj.records[cell[1]]&&obj.records[cell[1]][cell[0]]&&(0==obj.records[cell[1]][cell[0]].classList.contains("readonly")||force)){var currentValue=obj.records[cell[1]][cell[0]].style[key];currentValue!=value||force?obj.records[cell[1]][cell[0]].style[key]=value:(value="",obj.records[cell[1]][cell[0]].style[key]=""),oldValue[cellId]||(oldValue[cellId]=[]),newValue[cellId]||(newValue[cellId]=[]),oldValue[cellId].push([key+":"+currentValue]),newValue[cellId].push([key+":"+value])}};if(k&&v)if("string"==typeof o)applyStyle(o,k,v);else for(var oneApplication=[],i=0;i<o.length;i++){var x=o[i].getAttribute("data-x"),y=o[i].getAttribute("data-y"),cellName=jexcel.getColumnNameFromId([x,y]);oneApplication[cellName]||(applyStyle(cellName,k,v),oneApplication[cellName]=!0)}else for(var keys=Object.keys(o),i=0;i<keys.length;i++){var style=o[keys[i]];"string"==typeof style&&(style=style.split(";"));for(var j=0;j<style.length;j++)"string"==typeof style[j]&&(style[j]=style[j].split(":")),style[j][0].trim()&&applyStyle(keys[i],style[j][0].trim(),style[j][1])}for(var keys=Object.keys(oldValue),i=0;i<keys.length;i++)oldValue[keys[i]]=oldValue[keys[i]].join(";");for(var keys=Object.keys(newValue),i=0;i<keys.length;i++)newValue[keys[i]]=newValue[keys[i]].join(";");ignoreHistoryAndEvents||obj.setHistory({action:"setStyle",oldValue:oldValue,newValue:newValue}),obj.dispatch("onchangestyle",el,o,k,v)},obj.getComments=function(cell,withAuthor){if(cell){if("string"==typeof cell)var cell=jexcel.getIdFromColumnName(cell,!0);return withAuthor?[obj.records[cell[1]][cell[0]].getAttribute("title"),obj.records[cell[1]][cell[0]].getAttribute("author")]:obj.records[cell[1]][cell[0]].getAttribute("title")||""}for(var data={},j=0;j<obj.options.data.length;j++)for(var i=0;i<obj.options.columns.length;i++){var comments=obj.records[j][i].getAttribute("title"),cell;if(comments)data[cell=jexcel.getColumnNameFromId([i,j])]=comments}return data},obj.setComments=function(cellId,comments,author){if("string"==typeof cellId)var cell=jexcel.getIdFromColumnName(cellId,!0);else var cell=cellId;var title=obj.records[cell[1]][cell[0]].getAttribute("title"),author,oldValue=[title,author=obj.records[cell[1]][cell[0]].getAttribute("data-author")];obj.records[cell[1]][cell[0]].setAttribute("title",comments||""),obj.records[cell[1]][cell[0]].setAttribute("data-author",author||""),comments?obj.records[cell[1]][cell[0]].classList.add("jexcel_comments"):obj.records[cell[1]][cell[0]].classList.remove("jexcel_comments"),obj.setHistory({action:"setComments",column:cellId,newValue:[comments,author],oldValue:oldValue}),obj.dispatch("oncomments",el,comments,title,cell,cell[0],cell[1])},obj.getConfig=function(){var options=obj.options;return options.style=obj.getStyle(),options.mergeCells=obj.getMerge(),options.comments=obj.getComments(),options},obj.orderBy=function(column,order){if(column>=0){if(Object.keys(obj.options.mergeCells).length>0){if(!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure))return!1;obj.destroyMerged()}order=null==order?obj.headers[column].classList.contains("arrow-down")?1:0:order?1:0;var temp=[];if("number"==obj.options.columns[column].type||"percentage"==obj.options.columns[column].type||"autonumber"==obj.options.columns[column].type||"color"==obj.options.columns[column].type)for(var j=0;j<obj.options.data.length;j++)temp[j]=[j,Number(obj.options.data[j][column])];else if("calendar"==obj.options.columns[column].type||"checkbox"==obj.options.columns[column].type||"radio"==obj.options.columns[column].type)for(var j=0;j<obj.options.data.length;j++)temp[j]=[j,obj.options.data[j][column]];else for(var j=0;j<obj.options.data.length;j++)temp[j]=[j,obj.records[j][column].innerText.toLowerCase()];"function"!=typeof obj.options.sorting&&(obj.options.sorting=function(direction){return function(a,b){var valueA=a[1],valueB=b[1];return direction?""===valueA&&""!==valueB?1:""!==valueA&&""===valueB?-1:valueA>valueB?-1:valueA<valueB?1:0:""===valueA&&""!==valueB?1:""!==valueA&&""===valueB?-1:valueA>valueB?1:valueA<valueB?-1:0}}),temp=temp.sort(obj.options.sorting(order));for(var newValue=[],j=0;j<temp.length;j++)newValue[j]=temp[j][0];return obj.setHistory({action:"orderBy",rows:newValue,column:column,order:order}),obj.updateOrderArrow(column,order),obj.updateOrder(newValue),obj.dispatch("onsort",el,column,order),!0}},obj.updateOrderArrow=function(column,order){for(var i=0;i<obj.headers.length;i++)obj.headers[i].classList.remove("arrow-up"),obj.headers[i].classList.remove("arrow-down");order?obj.headers[column].classList.add("arrow-up"):obj.headers[column].classList.add("arrow-down")},obj.updateOrder=function(rows){for(var data=[],j=0;j<rows.length;j++)data[j]=obj.options.data[rows[j]];obj.options.data=data;for(var data=[],j=0;j<rows.length;j++)data[j]=obj.records[rows[j]];obj.records=data;for(var data=[],j=0;j<rows.length;j++)data[j]=obj.rows[rows[j]];if(obj.rows=data,obj.updateTableReferences(),obj.results&&obj.results.length)obj.searchInput.value?obj.search(obj.searchInput.value):obj.closeFilter();else if(obj.results=null,obj.pageNumber=0,obj.options.pagination>0)obj.page(0);else if(1==obj.options.lazyLoading)obj.loadPage(0);else for(var j=0;j<obj.rows.length;j++)obj.tbody.appendChild(obj.rows[j])},obj.moveRow=function(o,d,ignoreDom){if(Object.keys(obj.options.mergeCells).length>0){if(o>d)var insertBefore=1;else var insertBefore=0;if(obj.isRowMerged(o).length||obj.isRowMerged(d,insertBefore).length){if(!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure))return!1;obj.destroyMerged()}}if(1==obj.options.search){if(obj.results&&obj.results.length!=obj.rows.length){if(!confirm(obj.options.text.thisActionWillClearYourSearchResultsAreYouSure))return!1;obj.resetSearch()}obj.results=null}ignoreDom||(Array.prototype.indexOf.call(obj.tbody.children,obj.rows[d])>=0?o>d?obj.tbody.insertBefore(obj.rows[o],obj.rows[d]):obj.tbody.insertBefore(obj.rows[o],obj.rows[d].nextSibling):obj.tbody.removeChild(obj.rows[o])),obj.rows.splice(d,0,obj.rows.splice(o,1)[0]),obj.records.splice(d,0,obj.records.splice(o,1)[0]),obj.options.data.splice(d,0,obj.options.data.splice(o,1)[0]),obj.options.pagination>0&&obj.tbody.children.length!=obj.options.pagination&&obj.page(obj.pageNumber),obj.setHistory({action:"moveRow",oldValue:o,newValue:d}),obj.updateTableReferences(),obj.dispatch("onmoverow",el,o,d)},obj.insertRow=function(mixed,rowNumber,insertBefore){if(1==obj.options.allowInsertRow){var records=[],data=[];if(mixed>0)var numOfRows=mixed;else{var numOfRows=1;mixed&&(data=mixed)}var insertBefore=!!insertBefore,lastRow=obj.options.data.length-1;if((null==rowNumber||rowNumber>=parseInt(lastRow)||rowNumber<0)&&(rowNumber=lastRow),!1===obj.dispatch("onbeforeinsertrow",el,rowNumber,numOfRows,insertBefore))return!1;if(Object.keys(obj.options.mergeCells).length>0&&obj.isRowMerged(rowNumber,insertBefore).length){if(!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure))return!1;obj.destroyMerged()}if(1==obj.options.search){if(obj.results&&obj.results.length!=obj.rows.length){if(!confirm(obj.options.text.thisActionWillClearYourSearchResultsAreYouSure))return!1;obj.resetSearch()}obj.results=null}for(var rowIndex=insertBefore?rowNumber:rowNumber+1,currentRecords=obj.records.splice(rowIndex),currentData=obj.options.data.splice(rowIndex),currentRows=obj.rows.splice(rowIndex),rowRecords=[],rowData=[],rowNode=[],row=rowIndex;row<numOfRows+rowIndex;row++){obj.options.data[row]=[];for(var col=0;col<obj.options.columns.length;col++)obj.options.data[row][col]=data[col]?data[col]:"";var tr=obj.createRow(row,obj.options.data[row]);currentRows[0]?Array.prototype.indexOf.call(obj.tbody.children,currentRows[0])>=0&&obj.tbody.insertBefore(tr,currentRows[0]):Array.prototype.indexOf.call(obj.tbody.children,obj.rows[rowNumber])>=0&&obj.tbody.appendChild(tr),rowRecords.push(obj.records[row]),rowData.push(obj.options.data[row]),rowNode.push(tr)}Array.prototype.push.apply(obj.records,currentRecords),Array.prototype.push.apply(obj.options.data,currentData),Array.prototype.push.apply(obj.rows,currentRows),obj.options.pagination>0&&obj.page(obj.pageNumber),obj.setHistory({action:"insertRow",rowNumber:rowNumber,numOfRows:numOfRows,insertBefore:insertBefore,rowRecords:rowRecords,rowData:rowData,rowNode:rowNode}),obj.updateTableReferences(),obj.dispatch("oninsertrow",el,rowNumber,numOfRows,rowRecords,insertBefore)}},obj.deleteRow=function(rowNumber,numOfRows){if(1==obj.options.allowDeleteRow)if(1==obj.options.allowDeletingAllRows||obj.options.data.length>1){if(null==rowNumber){var number=obj.getSelectedRows();number[0]?(rowNumber=parseInt(number[0].getAttribute("data-y")),numOfRows=number.length):(rowNumber=obj.options.data.length-1,numOfRows=1)}var lastRow=obj.options.data.length-1;if((null==rowNumber||rowNumber>lastRow||rowNumber<0)&&(rowNumber=lastRow),numOfRows||(numOfRows=1),rowNumber+numOfRows>=obj.options.data.length&&(numOfRows=obj.options.data.length-rowNumber),!1===obj.dispatch("onbeforedeleterow",el,rowNumber,numOfRows))return!1;if(parseInt(rowNumber)>-1){var mergeExists=!1;if(Object.keys(obj.options.mergeCells).length>0)for(var row=rowNumber;row<rowNumber+numOfRows;row++)obj.isRowMerged(row,!1).length&&(mergeExists=!0);if(mergeExists){if(!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure))return!1;obj.destroyMerged()}if(1==obj.options.search){if(obj.results&&obj.results.length!=obj.rows.length){if(!confirm(obj.options.text.thisActionWillClearYourSearchResultsAreYouSure))return!1;obj.resetSearch()}obj.results=null}0==obj.options.allowDeletingAllRows&&lastRow+1===numOfRows&&(numOfRows--,console.error("Jspreadsheet: It is not possible to delete the last row"));for(var row=rowNumber;row<rowNumber+numOfRows;row++)Array.prototype.indexOf.call(obj.tbody.children,obj.rows[row])>=0&&(obj.rows[row].className="",obj.rows[row].parentNode.removeChild(obj.rows[row]));var rowRecords=obj.records.splice(rowNumber,numOfRows),rowData=obj.options.data.splice(rowNumber,numOfRows),rowNode=obj.rows.splice(rowNumber,numOfRows);obj.options.pagination>0&&obj.tbody.children.length!=obj.options.pagination&&obj.page(obj.pageNumber),obj.conditionalSelectionUpdate(1,rowNumber,rowNumber+numOfRows-1),obj.setHistory({action:"deleteRow",rowNumber:rowNumber,numOfRows:numOfRows,insertBefore:1,rowRecords:rowRecords,rowData:rowData,rowNode:rowNode}),obj.updateTableReferences(),obj.dispatch("ondeleterow",el,rowNumber,numOfRows,rowRecords)}}else console.error("Jspreadsheet: It is not possible to delete the last row")},obj.moveColumn=function(o,d){if(Object.keys(obj.options.mergeCells).length>0){if(o>d)var insertBefore=1;else var insertBefore=0;if(obj.isColMerged(o).length||obj.isColMerged(d,insertBefore).length){if(!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure))return!1;obj.destroyMerged()}}var o,d;if((o=parseInt(o))>(d=parseInt(d))){obj.headerContainer.insertBefore(obj.headers[o],obj.headers[d]),obj.colgroupContainer.insertBefore(obj.colgroup[o],obj.colgroup[d]);for(var j=0;j<obj.rows.length;j++)obj.rows[j].insertBefore(obj.records[j][o],obj.records[j][d])}else{obj.headerContainer.insertBefore(obj.headers[o],obj.headers[d].nextSibling),obj.colgroupContainer.insertBefore(obj.colgroup[o],obj.colgroup[d].nextSibling);for(var j=0;j<obj.rows.length;j++)obj.rows[j].insertBefore(obj.records[j][o],obj.records[j][d].nextSibling)}obj.options.columns.splice(d,0,obj.options.columns.splice(o,1)[0]),obj.headers.splice(d,0,obj.headers.splice(o,1)[0]),obj.colgroup.splice(d,0,obj.colgroup.splice(o,1)[0]);for(var j=0;j<obj.rows.length;j++)obj.options.data[j].splice(d,0,obj.options.data[j].splice(o,1)[0]),obj.records[j].splice(d,0,obj.records[j].splice(o,1)[0]);if(obj.options.footers)for(var j=0;j<obj.options.footers.length;j++)obj.options.footers[j].splice(d,0,obj.options.footers[j].splice(o,1)[0]);obj.setHistory({action:"moveColumn",oldValue:o,newValue:d}),obj.updateTableReferences(),obj.dispatch("onmovecolumn",el,o,d)},obj.insertColumn=function(mixed,columnNumber,insertBefore,properties){if(1==obj.options.allowInsertColumn){var records=[],data=[];if(mixed>0)var numOfColumns=mixed;else{var numOfColumns=1;mixed&&(data=mixed)}var insertBefore=!!insertBefore,lastColumn=obj.options.columns.length-1;if((null==columnNumber||columnNumber>=parseInt(lastColumn)||columnNumber<0)&&(columnNumber=lastColumn),!1===obj.dispatch("onbeforeinsertcolumn",el,columnNumber,numOfColumns,insertBefore))return!1;if(Object.keys(obj.options.mergeCells).length>0&&obj.isColMerged(columnNumber,insertBefore).length){if(!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure))return!1;obj.destroyMerged()}properties||(properties=[]);for(var i=0;i<numOfColumns;i++)properties[i]||(properties[i]={type:"text",source:[],options:[],width:obj.options.defaultColWidth,align:obj.options.defaultColAlign});var columnIndex=insertBefore?columnNumber:columnNumber+1;obj.options.columns=jexcel.injectArray(obj.options.columns,columnIndex,properties);for(var currentHeaders=obj.headers.splice(columnIndex),currentColgroup=obj.colgroup.splice(columnIndex),historyHeaders=[],historyColgroup=[],historyRecords=[],historyData=[],historyFooters=[],col=columnIndex;col<numOfColumns+columnIndex;col++)obj.createCellHeader(col),obj.headerContainer.insertBefore(obj.headers[col],obj.headerContainer.children[col+1]),obj.colgroupContainer.insertBefore(obj.colgroup[col],obj.colgroupContainer.children[col+1]),historyHeaders.push(obj.headers[col]),historyColgroup.push(obj.colgroup[col]);if(obj.options.footers)for(var j=0;j<obj.options.footers.length;j++){historyFooters[j]=[];for(var i=0;i<numOfColumns;i++)historyFooters[j].push("");obj.options.footers[j].splice(columnIndex,0,historyFooters[j])}for(var row=0;row<obj.options.data.length;row++){var currentData=obj.options.data[row].splice(columnIndex),currentRecord=obj.records[row].splice(columnIndex);historyData[row]=[],historyRecords[row]=[];for(var col=columnIndex;col<numOfColumns+columnIndex;col++){var value=data[row]?data[row]:"";obj.options.data[row][col]=value;var td=obj.createCell(col,row,obj.options.data[row][col]);obj.records[row][col]=td,obj.rows[row]&&obj.rows[row].insertBefore(td,obj.rows[row].children[col+1]),historyData[row].push(value),historyRecords[row].push(td)}Array.prototype.push.apply(obj.options.data[row],currentData),Array.prototype.push.apply(obj.records[row],currentRecord)}if(Array.prototype.push.apply(obj.headers,currentHeaders),Array.prototype.push.apply(obj.colgroup,currentColgroup),obj.options.nestedHeaders&&obj.options.nestedHeaders.length>0)if(obj.options.nestedHeaders[0]&&obj.options.nestedHeaders[0][0])for(var j=0;j<obj.options.nestedHeaders.length;j++){var colspan=parseInt(obj.options.nestedHeaders[j][obj.options.nestedHeaders[j].length-1].colspan)+numOfColumns;obj.options.nestedHeaders[j][obj.options.nestedHeaders[j].length-1].colspan=colspan,obj.thead.children[j].children[obj.thead.children[j].children.length-1].setAttribute("colspan",colspan);var o=obj.thead.children[j].children[obj.thead.children[j].children.length-1].getAttribute("data-column");o=o.split(",");for(var col=columnIndex;col<numOfColumns+columnIndex;col++)o.push(col);obj.thead.children[j].children[obj.thead.children[j].children.length-1].setAttribute("data-column",o)}else{var colspan=parseInt(obj.options.nestedHeaders[0].colspan)+numOfColumns;obj.options.nestedHeaders[0].colspan=colspan,obj.thead.children[0].children[obj.thead.children[0].children.length-1].setAttribute("colspan",colspan)}obj.setHistory({action:"insertColumn",columnNumber:columnNumber,numOfColumns:numOfColumns,insertBefore:insertBefore,columns:properties,headers:historyHeaders,colgroup:historyColgroup,records:historyRecords,footers:historyFooters,data:historyData}),obj.updateTableReferences(),obj.dispatch("oninsertcolumn",el,columnNumber,numOfColumns,historyRecords,insertBefore)}},obj.deleteColumn=function(columnNumber,numOfColumns){if(1==obj.options.allowDeleteColumn)if(obj.headers.length>1){if(null==columnNumber){var number=obj.getSelectedColumns(!0);number.length?(columnNumber=parseInt(number[0]),numOfColumns=parseInt(number.length)):(columnNumber=obj.headers.length-1,numOfColumns=1)}var lastColumn=obj.options.data[0].length-1;if((null==columnNumber||columnNumber>lastColumn||columnNumber<0)&&(columnNumber=lastColumn),numOfColumns||(numOfColumns=1),numOfColumns>obj.options.data[0].length-columnNumber&&(numOfColumns=obj.options.data[0].length-columnNumber),!1===obj.dispatch("onbeforedeletecolumn",el,columnNumber,numOfColumns))return!1;if(parseInt(columnNumber)>-1){var mergeExists=!1;if(Object.keys(obj.options.mergeCells).length>0)for(var col=columnNumber;col<columnNumber+numOfColumns;col++)obj.isColMerged(col,!1).length&&(mergeExists=!0);if(mergeExists){if(!confirm(obj.options.text.thisActionWillDestroyAnyExistingMergedCellsAreYouSure))return!1;obj.destroyMerged()}for(var columns=obj.options.columns.splice(columnNumber,numOfColumns),col=columnNumber;col<columnNumber+numOfColumns;col++)obj.colgroup[col].className="",obj.headers[col].className="",obj.colgroup[col].parentNode.removeChild(obj.colgroup[col]),obj.headers[col].parentNode.removeChild(obj.headers[col]);for(var historyHeaders=obj.headers.splice(columnNumber,numOfColumns),historyColgroup=obj.colgroup.splice(columnNumber,numOfColumns),historyRecords=[],historyData=[],historyFooters=[],row=0;row<obj.options.data.length;row++)for(var col=columnNumber;col<columnNumber+numOfColumns;col++)obj.records[row][col].className="",obj.records[row][col].parentNode.removeChild(obj.records[row][col]);for(var row=0;row<obj.options.data.length;row++)historyData[row]=obj.options.data[row].splice(columnNumber,numOfColumns),historyRecords[row]=obj.records[row].splice(columnNumber,numOfColumns);if(obj.options.footers)for(var row=0;row<obj.options.footers.length;row++)historyFooters[row]=obj.options.footers[row].splice(columnNumber,numOfColumns);if(obj.conditionalSelectionUpdate(0,columnNumber,columnNumber+numOfColumns-1),obj.options.nestedHeaders&&obj.options.nestedHeaders.length>0)if(obj.options.nestedHeaders[0]&&obj.options.nestedHeaders[0][0])for(var j=0;j<obj.options.nestedHeaders.length;j++){var colspan=parseInt(obj.options.nestedHeaders[j][obj.options.nestedHeaders[j].length-1].colspan)-numOfColumns;obj.options.nestedHeaders[j][obj.options.nestedHeaders[j].length-1].colspan=colspan,obj.thead.children[j].children[obj.thead.children[j].children.length-1].setAttribute("colspan",colspan)}else{var colspan=parseInt(obj.options.nestedHeaders[0].colspan)-numOfColumns;obj.options.nestedHeaders[0].colspan=colspan,obj.thead.children[0].children[obj.thead.children[0].children.length-1].setAttribute("colspan",colspan)}obj.setHistory({action:"deleteColumn",columnNumber:columnNumber,numOfColumns:numOfColumns,insertBefore:1,columns:columns,headers:historyHeaders,colgroup:historyColgroup,records:historyRecords,footers:historyFooters,data:historyData}),obj.updateTableReferences(),obj.dispatch("ondeletecolumn",el,columnNumber,numOfColumns,historyRecords)}}else console.error("Jspreadsheet: It is not possible to delete the last column")},obj.getSelectedRows=function(asIds){for(var rows=[],j=0;j<obj.rows.length;j++)obj.rows[j].classList.contains("selected")&&(asIds?rows.push(j):rows.push(obj.rows[j]));return rows},obj.getSelectedColumns=function(){for(var cols=[],i=0;i<obj.headers.length;i++)obj.headers[i].classList.contains("selected")&&cols.push(i);return cols},obj.getHighlighted=function(){return obj.highlighted},obj.updateTableReferences=function(){for(var i=0;i<obj.headers.length;i++){var x;(x=obj.headers[i].getAttribute("data-x"))!=i&&(obj.headers[i].setAttribute("data-x",i),obj.headers[i].getAttribute("title")||(obj.headers[i].innerHTML=jexcel.getColumnName(i)))}for(var j=0;j<obj.rows.length;j++){var y;if(obj.rows[j])(y=obj.rows[j].getAttribute("data-y"))!=j&&(obj.rows[j].setAttribute("data-y",j),obj.rows[j].children[0].setAttribute("data-y",j),obj.rows[j].children[0].innerHTML=j+1)}for(var affectedTokens=[],mergeCellUpdates=[],updatePosition=function(x,y,i,j){if(x!=i&&obj.records[j][i].setAttribute("data-x",i),y!=j&&obj.records[j][i].setAttribute("data-y",j),x!=i||y!=j){var columnIdFrom=jexcel.getColumnNameFromId([x,y]),columnIdTo=jexcel.getColumnNameFromId([i,j]);affectedTokens[columnIdFrom]=columnIdTo}},j=0;j<obj.records.length;j++)for(var i=0;i<obj.records[0].length;i++)if(obj.records[j][i]){var x=obj.records[j][i].getAttribute("data-x"),y=obj.records[j][i].getAttribute("data-y");if(obj.records[j][i].getAttribute("data-merged")){var columnIdFrom=jexcel.getColumnNameFromId([x,y]),columnIdTo=jexcel.getColumnNameFromId([i,j]);if(null==mergeCellUpdates[columnIdFrom])if(columnIdFrom==columnIdTo)mergeCellUpdates[columnIdFrom]=!1;else{var totalX=parseInt(i-x),totalY=parseInt(j-y);mergeCellUpdates[columnIdFrom]=[columnIdTo,totalX,totalY]}}else updatePosition(x,y,i,j)}var keys=Object.keys(mergeCellUpdates);if(keys.length)for(var i=0;i<keys.length;i++)if(mergeCellUpdates[keys[i]]){var info=jexcel.getIdFromColumnName(keys[i],!0),x,y;updatePosition(x=info[0],y=info[1],x+mergeCellUpdates[keys[i]][1],y+mergeCellUpdates[keys[i]][2]);for(var columnIdFrom=keys[i],columnIdTo=mergeCellUpdates[keys[i]][0],j=0;j<obj.options.mergeCells[columnIdFrom][2].length;j++){var x=parseInt(obj.options.mergeCells[columnIdFrom][2][j].getAttribute("data-x")),y=parseInt(obj.options.mergeCells[columnIdFrom][2][j].getAttribute("data-y"));obj.options.mergeCells[columnIdFrom][2][j].setAttribute("data-x",x+mergeCellUpdates[keys[i]][1]),obj.options.mergeCells[columnIdFrom][2][j].setAttribute("data-y",y+mergeCellUpdates[keys[i]][2])}obj.options.mergeCells[columnIdTo]=obj.options.mergeCells[columnIdFrom],delete obj.options.mergeCells[columnIdFrom]}obj.updateFormulas(affectedTokens),obj.updateMeta(affectedTokens),obj.refreshSelection(),obj.updateTable()},obj.updateTable=function(){if(obj.options.minSpareRows>0){for(var numBlankRows=0,j=obj.rows.length-1;j>=0;j--){for(var test=!1,i=0;i<obj.headers.length;i++)obj.options.data[j][i]&&(test=!0);if(test)break;numBlankRows++}obj.options.minSpareRows-numBlankRows>0&&obj.insertRow(obj.options.minSpareRows-numBlankRows)}if(obj.options.minSpareCols>0){for(var numBlankCols=0,i=obj.headers.length-1;i>=0;i--){for(var test=!1,j=0;j<obj.rows.length;j++)obj.options.data[j][i]&&(test=!0);if(test)break;numBlankCols++}obj.options.minSpareCols-numBlankCols>0&&obj.insertColumn(obj.options.minSpareCols-numBlankCols)}if("function"==typeof obj.options.updateTable){obj.options.detachForUpdates&&el.removeChild(obj.content);for(var j=0;j<obj.rows.length;j++)for(var i=0;i<obj.headers.length;i++)obj.options.updateTable(el,obj.records[j][i],i,j,obj.options.data[j][i],obj.records[j][i].innerText,jexcel.getColumnNameFromId([i,j]));obj.options.detachForUpdates&&el.insertBefore(obj.content,obj.pagination)}obj.options.footers&&obj.setFooter(),setTimeout((function(){obj.updateCornerPosition()}),0)},obj.isReadOnly=function(cell){if(cell=obj.getCell(cell))return!!cell.classList.contains("readonly")},obj.setReadOnly=function(cell,state){(cell=obj.getCell(cell))&&(state?cell.classList.add("readonly"):cell.classList.remove("readonly"))},obj.showRow=function(rowNumber){obj.rows[rowNumber].style.display=""},obj.hideRow=function(rowNumber){obj.rows[rowNumber].style.display="none"},obj.showColumn=function(colNumber){obj.headers[colNumber].style.display="",obj.colgroup[colNumber].style.display="",obj.filter&&obj.filter.children.length>colNumber+1&&(obj.filter.children[colNumber+1].style.display="");for(var j=0;j<obj.options.data.length;j++)obj.records[j][colNumber].style.display="";obj.options.footers&&obj.setFooter(),obj.resetSelection()},obj.hideColumn=function(colNumber){obj.headers[colNumber].style.display="none",obj.colgroup[colNumber].style.display="none",obj.filter&&obj.filter.children.length>colNumber+1&&(obj.filter.children[colNumber+1].style.display="none");for(var j=0;j<obj.options.data.length;j++)obj.records[j][colNumber].style.display="none";obj.options.footers&&obj.setFooter(),obj.resetSelection()},obj.showIndex=function(){obj.table.classList.remove("jexcel_hidden_index")},obj.hideIndex=function(){obj.table.classList.add("jexcel_hidden_index")};var chainLoopProtection=[];obj.updateFormulaChain=function(x,y,records){var cellId=jexcel.getColumnNameFromId([x,y]);if(obj.formula[cellId]&&obj.formula[cellId].length>0)if(chainLoopProtection[cellId])obj.records[y][x].innerHTML="#ERROR",obj.formula[cellId]="";else{chainLoopProtection[cellId]=!0;for(var i=0;i<obj.formula[cellId].length;i++){var cell=jexcel.getIdFromColumnName(obj.formula[cellId][i],!0),value=""+obj.options.data[cell[1]][cell[0]];"="==value.substr(0,1)?records.push(obj.updateCell(cell[0],cell[1],value,!0)):Object.keys(obj.formula)[i]=null,obj.updateFormulaChain(cell[0],cell[1],records)}}chainLoopProtection=[]},obj.updateFormulas=function(referencesToUpdate){for(var j=0;j<obj.options.data.length;j++)for(var i=0;i<obj.options.data[0].length;i++){var value;if("="==(value=""+obj.options.data[j][i]).substr(0,1)){var newFormula=obj.updateFormula(value,referencesToUpdate);newFormula!=value&&(obj.options.data[j][i]=newFormula)}}for(var formula=[],keys=Object.keys(obj.formula),j=0;j<keys.length;j++){var key=keys[j],value=obj.formula[key];referencesToUpdate[key]&&(key=referencesToUpdate[key]),formula[key]=[];for(var i=0;i<value.length;i++){var letter=value[i];referencesToUpdate[letter]&&(letter=referencesToUpdate[letter]),formula[key].push(letter)}}obj.formula=formula},obj.updateFormula=function(formula,referencesToUpdate){for(var testLetter=/[A-Z]/,testNumber=/[0-9]/,newFormula="",letter=null,number=null,token="",index=0;index<formula.length;index++)testLetter.exec(formula[index])?(letter=1,number=0,token+=formula[index]):testNumber.exec(formula[index])?(number=letter?1:0,token+=formula[index]):(letter&&number&&(token=referencesToUpdate[token]?referencesToUpdate[token]:token),newFormula+=token,newFormula+=formula[index],letter=0,number=0,token="");return token&&(letter&&number&&(token=referencesToUpdate[token]?referencesToUpdate[token]:token),newFormula+=token),newFormula};var secureFormula=function(oldValue){for(var newValue="",inside=0,i=0;i<oldValue.length;i++)'"'==oldValue[i]&&(inside=0==inside?1:0),newValue+=1==inside?oldValue[i]:oldValue[i].toUpperCase();return newValue};obj.executeFormula=function(expression,x,y){var formulaResults=[],formulaLoopProtection=[],execute=function(expression,x,y){var parentId=jexcel.getColumnNameFromId([x,y]);if(formulaLoopProtection[parentId])return console.error("Reference loop detected"),"#ERROR";formulaLoopProtection[parentId]=!0;var tokensUpdate=function(tokens){for(var index=0;index<tokens.length;index++){var f=[],token=tokens[index].split(":"),e1=jexcel.getIdFromColumnName(token[0],!0),e2=jexcel.getIdFromColumnName(token[1],!0);if(e1[0]<=e2[0])var x1=e1[0],x2=e2[0];else var x1=e2[0],x2=e1[0];if(e1[1]<=e2[1])var y1=e1[1],y2=e2[1];else var y1=e2[1],y2=e1[1];for(var j=y1;j<=y2;j++)for(var i=x1;i<=x2;i++)f.push(jexcel.getColumnNameFromId([i,j]));expression=expression.replace(tokens[index],f.join(","))}};expression=expression.replace(/\$?([A-Z]+)\$?([0-9]+)/g,"$1$2");var tokens=expression.match(/([A-Z]+[0-9]+)\:([A-Z]+[0-9]+)/g);tokens&&tokens.length&&tokensUpdate(tokens);var tokens=expression.match(/([A-Z]+[0-9]+)/g);if(tokens&&tokens.indexOf(parentId)>-1)return console.error("Self Reference detected"),"#ERROR";var formulaExpressions={};if(tokens)for(var i=0;i<tokens.length;i++)if(obj.formula[tokens[i]]||(obj.formula[tokens[i]]=[]),obj.formula[tokens[i]].indexOf(parentId)<0&&obj.formula[tokens[i]].push(parentId),eval("typeof("+tokens[i]+') == "undefined"')){var position=jexcel.getIdFromColumnName(tokens[i],1);if(void 0!==obj.options.data[position[1]]&&void 0!==obj.options.data[position[1]][position[0]])var value=obj.options.data[position[1]][position[0]];else var value="";if("="==(""+value).substr(0,1)&&(formulaResults[tokens[i]]?value=formulaResults[tokens[i]]:(value=execute(value,position[0],position[1]),formulaResults[tokens[i]]=value)),""==(""+value).trim())formulaExpressions[tokens[i]]=null;else if(value==Number(value)&&1==obj.options.autoCasting)formulaExpressions[tokens[i]]=Number(value);else{var number=obj.parseNumber(value,position[0]);1==obj.options.autoCasting&&number?formulaExpressions[tokens[i]]=number:formulaExpressions[tokens[i]]='"'+value+'"'}}try{var res=jexcel.formula(expression.substr(1),formulaExpressions,x,y,obj)}catch(e){var res="#ERROR";console.log(e)}return res};return execute(expression,x,y)},obj.parseNumber=function(value,columnNumber){var decimal=columnNumber&&obj.options.columns[columnNumber].decimal?obj.options.columns[columnNumber].decimal:".",number=""+value;if((number=number.split(decimal))[0]=number[0].match(/[+-]?[0-9]/g),number[0]&&(number[0]=number[0].join("")),number[1]&&(number[1]=number[1].match(/[0-9]*/g).join("")),number[0]&&Number(number[0])>=0)if(number[1])var value=Number(number[0]+"."+number[1]);else var value=Number(number[0]+".00");else var value=null;return value},obj.row=function(cell){},obj.col=function(cell){},obj.up=function(shiftKey,ctrlKey){if(shiftKey?obj.selectedCell[3]>0&&obj.up.visible(1,ctrlKey?0:1):(obj.selectedCell[1]>0&&obj.up.visible(0,ctrlKey?0:1),obj.selectedCell[2]=obj.selectedCell[0],obj.selectedCell[3]=obj.selectedCell[1]),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]),1==obj.options.lazyLoading)if(0==obj.selectedCell[1]||0==obj.selectedCell[3])obj.loadPage(0),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]);else if(obj.loadValidation())obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]);else{var item=parseInt(obj.tbody.firstChild.getAttribute("data-y"));obj.selectedCell[1]-item<30&&(obj.loadUp(),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]))}else if(obj.options.pagination>0){var pageNumber=obj.whichPage(obj.selectedCell[3]);pageNumber!=obj.pageNumber&&obj.page(pageNumber)}obj.updateScroll(1)},obj.up.visible=function(group,direction){if(0==group)var x=parseInt(obj.selectedCell[0]),y=parseInt(obj.selectedCell[1]);else var x=parseInt(obj.selectedCell[2]),y=parseInt(obj.selectedCell[3]);if(0==direction){for(var j=0;j<y;j++)if("none"!=obj.records[j][x].style.display&&"none"!=obj.rows[j].style.display){y=j;break}}else y=obj.up.get(x,y);0==group?(obj.selectedCell[0]=x,obj.selectedCell[1]=y):(obj.selectedCell[2]=x,obj.selectedCell[3]=y)},obj.up.get=function(x,y){for(var x=parseInt(x),y,j=(y=parseInt(y))-1;j>=0;j--)if("none"!=obj.records[j][x].style.display&&"none"!=obj.rows[j].style.display){if(obj.records[j][x].getAttribute("data-merged")&&obj.records[j][x]==obj.records[y][x])continue;y=j;break}return y},obj.down=function(shiftKey,ctrlKey){var item;if(shiftKey?obj.selectedCell[3]<obj.records.length-1&&obj.down.visible(1,ctrlKey?0:1):(obj.selectedCell[1]<obj.records.length-1&&obj.down.visible(0,ctrlKey?0:1),obj.selectedCell[2]=obj.selectedCell[0],obj.selectedCell[3]=obj.selectedCell[1]),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]),1==obj.options.lazyLoading)obj.selectedCell[1]==obj.records.length-1||obj.selectedCell[3]==obj.records.length-1?(obj.loadPage(-1),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3])):obj.loadValidation()?obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]):parseInt(obj.tbody.lastChild.getAttribute("data-y"))-obj.selectedCell[3]<30&&(obj.loadDown(),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]));else if(obj.options.pagination>0){var pageNumber=obj.whichPage(obj.selectedCell[3]);pageNumber!=obj.pageNumber&&obj.page(pageNumber)}obj.updateScroll(3)},obj.down.visible=function(group,direction){if(0==group)var x=parseInt(obj.selectedCell[0]),y=parseInt(obj.selectedCell[1]);else var x=parseInt(obj.selectedCell[2]),y=parseInt(obj.selectedCell[3]);if(0==direction){for(var j=obj.rows.length-1;j>y;j--)if("none"!=obj.records[j][x].style.display&&"none"!=obj.rows[j].style.display){y=j;break}}else y=obj.down.get(x,y);0==group?(obj.selectedCell[0]=x,obj.selectedCell[1]=y):(obj.selectedCell[2]=x,obj.selectedCell[3]=y)},obj.down.get=function(x,y){for(var x=parseInt(x),y,j=(y=parseInt(y))+1;j<obj.rows.length;j++)if("none"!=obj.records[j][x].style.display&&"none"!=obj.rows[j].style.display){if(obj.records[j][x].getAttribute("data-merged")&&obj.records[j][x]==obj.records[y][x])continue;y=j;break}return y},obj.right=function(shiftKey,ctrlKey){shiftKey?obj.selectedCell[2]<obj.headers.length-1&&obj.right.visible(1,ctrlKey?0:1):(obj.selectedCell[0]<obj.headers.length-1&&obj.right.visible(0,ctrlKey?0:1),obj.selectedCell[2]=obj.selectedCell[0],obj.selectedCell[3]=obj.selectedCell[1]),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]),obj.updateScroll(2)},obj.right.visible=function(group,direction){if(0==group)var x=parseInt(obj.selectedCell[0]),y=parseInt(obj.selectedCell[1]);else var x=parseInt(obj.selectedCell[2]),y=parseInt(obj.selectedCell[3]);if(0==direction){for(var i=obj.headers.length-1;i>x;i--)if("none"!=obj.records[y][i].style.display){x=i;break}}else x=obj.right.get(x,y);0==group?(obj.selectedCell[0]=x,obj.selectedCell[1]=y):(obj.selectedCell[2]=x,obj.selectedCell[3]=y)},obj.right.get=function(x,y){for(var x=parseInt(x),y=parseInt(y),i=x+1;i<obj.headers.length;i++)if("none"!=obj.records[y][i].style.display){if(obj.records[y][i].getAttribute("data-merged")&&obj.records[y][i]==obj.records[y][x])continue;x=i;break}return x},obj.left=function(shiftKey,ctrlKey){shiftKey?obj.selectedCell[2]>0&&obj.left.visible(1,ctrlKey?0:1):(obj.selectedCell[0]>0&&obj.left.visible(0,ctrlKey?0:1),obj.selectedCell[2]=obj.selectedCell[0],obj.selectedCell[3]=obj.selectedCell[1]),obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]),obj.updateScroll(0)},obj.left.visible=function(group,direction){if(0==group)var x=parseInt(obj.selectedCell[0]),y=parseInt(obj.selectedCell[1]);else var x=parseInt(obj.selectedCell[2]),y=parseInt(obj.selectedCell[3]);if(0==direction){for(var i=0;i<x;i++)if("none"!=obj.records[y][i].style.display){x=i;break}}else x=obj.left.get(x,y);0==group?(obj.selectedCell[0]=x,obj.selectedCell[1]=y):(obj.selectedCell[2]=x,obj.selectedCell[3]=y)},obj.left.get=function(x,y){for(var x=parseInt(x),y=parseInt(y),i=x-1;i>=0;i--)if("none"!=obj.records[y][i].style.display){if(obj.records[y][i].getAttribute("data-merged")&&obj.records[y][i]==obj.records[y][x])continue;x=i;break}return x},obj.first=function(shiftKey,ctrlKey){if(shiftKey?ctrlKey?obj.selectedCell[3]=0:obj.left.visible(1,0):(ctrlKey?obj.selectedCell[1]=0:obj.left.visible(0,0),obj.selectedCell[2]=obj.selectedCell[0],obj.selectedCell[3]=obj.selectedCell[1]),1!=obj.options.lazyLoading||0!=obj.selectedCell[1]&&0!=obj.selectedCell[3]){if(obj.options.pagination>0){var pageNumber=obj.whichPage(obj.selectedCell[3]);pageNumber!=obj.pageNumber&&obj.page(pageNumber)}}else obj.loadPage(0);obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]),obj.updateScroll(1)},obj.last=function(shiftKey,ctrlKey){if(shiftKey?ctrlKey?obj.selectedCell[3]=obj.records.length-1:obj.right.visible(1,0):(ctrlKey?obj.selectedCell[1]=obj.records.length-1:obj.right.visible(0,0),obj.selectedCell[2]=obj.selectedCell[0],obj.selectedCell[3]=obj.selectedCell[1]),1!=obj.options.lazyLoading||obj.selectedCell[1]!=obj.records.length-1&&obj.selectedCell[3]!=obj.records.length-1){if(obj.options.pagination>0){var pageNumber=obj.whichPage(obj.selectedCell[3]);pageNumber!=obj.pageNumber&&obj.page(pageNumber)}}else obj.loadPage(-1);obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3]),obj.updateScroll(3)},obj.selectAll=function(){obj.selectedCell||(obj.selectedCell=[]),obj.selectedCell[0]=0,obj.selectedCell[1]=0,obj.selectedCell[2]=obj.headers.length-1,obj.selectedCell[3]=obj.records.length-1,obj.updateSelectionFromCoords(obj.selectedCell[0],obj.selectedCell[1],obj.selectedCell[2],obj.selectedCell[3])},obj.loadPage=function(pageNumber){if(1==obj.options.search&&obj.results)var results=obj.results;else var results=obj.rows;var quantityPerPage=100;null!=pageNumber&&-1!=pageNumber||(pageNumber=Math.ceil(results.length/100)-1);var startRow=100*pageNumber,finalRow=100*pageNumber+100;finalRow>results.length&&(finalRow=results.length),(startRow=finalRow-100)<0&&(startRow=0);for(var j=startRow;j<finalRow;j++)1==obj.options.search&&obj.results?obj.tbody.appendChild(obj.rows[results[j]]):obj.tbody.appendChild(obj.rows[j]),obj.tbody.children.length>100&&obj.tbody.removeChild(obj.tbody.firstChild)},obj.loadUp=function(){if(1==obj.options.search&&obj.results)var results=obj.results;else var results=obj.rows;var test=0;if(results.length>100){var item=parseInt(obj.tbody.firstChild.getAttribute("data-y"));if(1==obj.options.search&&obj.results&&(item=results.indexOf(item)),item>0)for(var j=0;j<30;j++)(item-=1)>-1&&(1==obj.options.search&&obj.results?obj.tbody.insertBefore(obj.rows[results[item]],obj.tbody.firstChild):obj.tbody.insertBefore(obj.rows[item],obj.tbody.firstChild),obj.tbody.children.length>100&&(obj.tbody.removeChild(obj.tbody.lastChild),test=1))}return test},obj.loadDown=function(){if(1==obj.options.search&&obj.results)var results=obj.results;else var results=obj.rows;var test=0;if(results.length>100){var item=parseInt(obj.tbody.lastChild.getAttribute("data-y"));if(1==obj.options.search&&obj.results&&(item=results.indexOf(item)),item<obj.rows.length-1)for(var j=0;j<=30;j++)item<results.length&&(1==obj.options.search&&obj.results?obj.tbody.appendChild(obj.rows[results[item]]):obj.tbody.appendChild(obj.rows[item]),obj.tbody.children.length>100&&(obj.tbody.removeChild(obj.tbody.firstChild),test=1)),item+=1}return test},obj.loadValidation=function(){if(obj.selectedCell){var currentPage=parseInt(obj.tbody.firstChild.getAttribute("data-y"))/100,selectedPage=parseInt(obj.selectedCell[3]/100),totalPages=parseInt(obj.rows.length/100);if(currentPage!=selectedPage&&selectedPage<=totalPages&&!Array.prototype.indexOf.call(obj.tbody.children,obj.rows[obj.selectedCell[3]]))return obj.loadPage(selectedPage),!0}return!1},obj.resetSearch=function(){obj.searchInput.value="",obj.search(""),obj.results=null},obj.search=function(query){if(query)var query=query.toLowerCase();if(obj.options.filters&&obj.resetFilters(),obj.resetSelection(),obj.pageNumber=0,obj.results=[],query)var search=function(item,query,index){for(var i=0;i<item.length;i++)if((""+item[i]).toLowerCase().search(query)>=0||(""+obj.records[index][i].innerHTML).toLowerCase().search(query)>=0)return!0;return!1},addToResult=function(k){-1==obj.results.indexOf(k)&&obj.results.push(k)},data=obj.options.data.filter((function(v,k){if(search(v,query,k)){var rows=obj.isRowMerged(k);if(rows.length)for(var i=0;i<rows.length;i++)for(var row=jexcel.getIdFromColumnName(rows[i],!0),j=0;j<obj.options.mergeCells[rows[i]][1];j++)addToResult(row[1]+j);else addToResult(k);return!0}return!1}));else obj.results=null;return obj.updateResult()},obj.updateResult=function(){var total=0,index=0;for(total=1==obj.options.lazyLoading?100:obj.options.pagination>0?obj.options.pagination:obj.results?obj.results.length:obj.rows.length;obj.tbody.firstChild;)obj.tbody.removeChild(obj.tbody.firstChild);for(var j=0;j<obj.rows.length;j++)!obj.results||obj.results.indexOf(j)>-1?(index<total&&(obj.tbody.appendChild(obj.rows[j]),index++),obj.rows[j].style.display=""):obj.rows[j].style.display="none";return obj.options.pagination>0&&obj.updatePagination(),obj.updateCornerPosition(),total},obj.whichPage=function(cell){return 1==obj.options.search&&obj.results&&(cell=obj.results.indexOf(cell)),Math.ceil((parseInt(cell)+1)/parseInt(obj.options.pagination))-1},obj.page=function(pageNumber){var oldPage=obj.pageNumber;if(1==obj.options.search&&obj.results)var results=obj.results;else var results=obj.rows;var quantityPerPage=parseInt(obj.options.pagination);null!=pageNumber&&-1!=pageNumber||(pageNumber=Math.ceil(results.length/quantityPerPage)-1),obj.pageNumber=pageNumber;var startRow=pageNumber*quantityPerPage,finalRow=pageNumber*quantityPerPage+quantityPerPage;for(finalRow>results.length&&(finalRow=results.length),startRow<0&&(startRow=0);obj.tbody.firstChild;)obj.tbody.removeChild(obj.tbody.firstChild);for(var j=startRow;j<finalRow;j++)1==obj.options.search&&obj.results?obj.tbody.appendChild(obj.rows[results[j]]):obj.tbody.appendChild(obj.rows[j]);obj.options.pagination>0&&obj.updatePagination(),obj.updateCornerPosition(),obj.dispatch("onchangepage",el,pageNumber,oldPage)},obj.updatePagination=function(){if(obj.pagination.children[0].innerHTML="",obj.pagination.children[1].innerHTML="",obj.options.pagination){if(1==obj.options.search&&obj.results)var results=obj.results.length;else var results=obj.rows.length;if(results){var quantyOfPages=Math.ceil(results/obj.options.pagination),paginationItem,paginationItem;if(obj.pageNumber<6)var startNumber=1,finalNumber=quantyOfPages<10?quantyOfPages:10;else if(quantyOfPages-obj.pageNumber<5){var startNumber,finalNumber=quantyOfPages;(startNumber=quantyOfPages-9)<1&&(startNumber=1)}else var startNumber=obj.pageNumber-4,finalNumber=obj.pageNumber+5;if(startNumber>1)(paginationItem=document.createElement("div")).className="jexcel_page",paginationItem.innerHTML="<",paginationItem.title=1,obj.pagination.children[1].appendChild(paginationItem);for(var i=startNumber;i<=finalNumber;i++){var paginationItem;(paginationItem=document.createElement("div")).className="jexcel_page",paginationItem.innerHTML=i,obj.pagination.children[1].appendChild(paginationItem),obj.pageNumber==i-1&&paginationItem.classList.add("jexcel_page_selected")}if(finalNumber<quantyOfPages)(paginationItem=document.createElement("div")).className="jexcel_page",paginationItem.innerHTML=">",paginationItem.title=quantyOfPages,obj.pagination.children[1].appendChild(paginationItem);var format=function(format){var args=Array.prototype.slice.call(arguments,1);return format.replace(/{(\d+)}/g,(function(match,number){return void 0!==args[number]?args[number]:match}))};obj.pagination.children[0].innerHTML=format(obj.options.text.showingPage,obj.pageNumber+1,quantyOfPages)}else obj.pagination.children[0].innerHTML=obj.options.text.noRecordsFound}},obj.download=function(includeHeaders){if(0==obj.options.allowExport)console.error("Export not allowed");else{var data="";data+=obj.copy(!1,obj.options.csvDelimiter,!0,includeHeaders,!0);var blob=new Blob(["\ufeff"+data],{type:"text/csv;charset=utf-8;"});if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(blob,obj.options.csvFileName+".csv");else{var pom=document.createElement("a"),url=URL.createObjectURL(blob);pom.href=url,pom.setAttribute("download",obj.options.csvFileName+".csv"),document.body.appendChild(pom),pom.click(),pom.parentNode.removeChild(pom)}}},obj.setHistory=function(changes){if(1!=obj.ignoreHistory){var index=++obj.historyIndex;obj.history=obj.history=obj.history.slice(0,index+1),obj.history[index]=changes}},obj.copy=function(highlighted,delimiter,returnData,includeHeaders,download){delimiter||(delimiter="\t");for(var div=new RegExp(delimiter,"ig"),header=[],col=[],colLabel=[],row=[],rowLabel=[],x=obj.options.data[0].length,y=obj.options.data.length,tmp="",copyHeader=!1,headers="",nestedHeaders="",numOfCols=0,numOfRows=0,copyX=0,copyY=0,isPartialCopy=!0,j=0;j<y;j++)for(var i=0;i<x;i++)highlighted&&!obj.records[j][i].classList.contains("highlight")||(copyX<=i&&(copyX=i),copyY<=j&&(copyY=j));if(x===copyX+1&&y===copyY+1&&(isPartialCopy=!1),download&&1==obj.options.includeHeadersOnDownload||!download&&1==obj.options.includeHeadersOnCopy&&!isPartialCopy||includeHeaders){if(obj.options.nestedHeaders&&obj.options.nestedHeaders.length>0){tmp=obj.options.nestedHeaders[0]&&obj.options.nestedHeaders[0][0]?obj.options.nestedHeaders:[obj.options.nestedHeaders];for(var j=0;j<tmp.length;j++){for(var nested=[],i=0;i<tmp[j].length;i++){var colspan=parseInt(tmp[j][i].colspan);nested.push(tmp[j][i].title);for(var c=0;c<colspan-1;c++)nested.push("")}nestedHeaders+=nested.join(delimiter)+"\r\n"}}copyHeader=!0}obj.style=[];for(var j=0;j<y;j++){col=[],colLabel=[];for(var i=0;i<x;i++)if(!highlighted||obj.records[j][i].classList.contains("highlight")){1==copyHeader&&header.push(obj.headers[i].innerText);var value=obj.options.data[j][i];if(value.match&&(value.match(div)||value.match(/,/g)||value.match(/\n/)||value.match(/\"/))&&(value='"'+(value=value.replace(new RegExp('"',"g"),'""'))+'"'),col.push(value),"checkbox"==obj.options.columns[i].type||"radio"==obj.options.columns[i].type)var label=value;else{if(1==obj.options.stripHTMLOnCopy)var label=obj.records[j][i].innerText;else var label=obj.records[j][i].innerHTML;label.match&&(label.match(div)||label.match(/,/g)||label.match(/\n/)||label.match(/\"/))&&(label='"'+(label=label.replace(new RegExp('"',"g"),'""'))+'"')}colLabel.push(label),tmp=(tmp=obj.records[j][i].getAttribute("style")).replace("display: none;",""),obj.style.push(tmp||"")}col.length&&(copyHeader&&(numOfCols=col.length,row.push(header.join(delimiter))),row.push(col.join(delimiter))),colLabel.length&&(numOfRows++,copyHeader&&(rowLabel.push(header.join(delimiter)),copyHeader=!1),rowLabel.push(colLabel.join(delimiter)))}x==numOfCols&&y==numOfRows&&(headers=nestedHeaders);var str=headers+row.join("\r\n"),strLabel=headers+rowLabel.join("\r\n");if(returnData||(1==obj.options.copyCompatibility?obj.textarea.value=strLabel:obj.textarea.value=str,obj.textarea.select(),document.execCommand("copy")),1==obj.options.copyCompatibility?obj.data=strLabel:obj.data=str,obj.hashString=obj.hash(obj.data),!returnData){if(obj.removeCopyingSelection(),obj.highlighted)for(var i=0;i<obj.highlighted.length;i++)obj.highlighted[i].classList.add("copying"),obj.highlighted[i].classList.contains("highlight-left")&&obj.highlighted[i].classList.add("copying-left"),obj.highlighted[i].classList.contains("highlight-right")&&obj.highlighted[i].classList.add("copying-right"),obj.highlighted[i].classList.contains("highlight-top")&&obj.highlighted[i].classList.add("copying-top"),obj.highlighted[i].classList.contains("highlight-bottom")&&obj.highlighted[i].classList.add("copying-bottom");obj.dispatch("oncopy",el,1==obj.options.copyCompatibility?rowLabel:row,obj.hashString)}return obj.data},obj.paste=function(x,y,data){var ret=obj.dispatch("onbeforepaste",el,data,x,y);if(!1===ret)return!1;if(ret)var data=ret;var hash=obj.hash(data),style=hash==obj.hashString?obj.style:null;if(1==obj.options.copyCompatibility&&hash==obj.hashString)var data=obj.data;var data=obj.parseCSV(data,"\t");if(null!=x&&null!=y&&data){for(var i=0,j=0,records=[],newStyle={},oldStyle={},styleIndex=0,colIndex=parseInt(x),rowIndex=parseInt(y),row=null;row=data[j];){for(i=0,colIndex=parseInt(x);null!=row[i];){var record=obj.updateCell(colIndex,rowIndex,row[i]);if(records.push(record),obj.updateFormulaChain(colIndex,rowIndex,records),style&&style[styleIndex]){var columnName=jexcel.getColumnNameFromId([colIndex,rowIndex]);newStyle[columnName]=style[styleIndex],oldStyle[columnName]=obj.getStyle(columnName),obj.records[rowIndex][colIndex].setAttribute("style",style[styleIndex]),styleIndex++}if(null!=row[++i]){if(colIndex>=obj.headers.length-1){if(1!=obj.options.allowInsertColumn)break;obj.insertColumn()}colIndex=obj.right.get(colIndex,rowIndex)}}if(data[++j]){if(rowIndex>=obj.rows.length-1){if(1!=obj.options.allowInsertRow)break;obj.insertRow()}rowIndex=obj.down.get(x,rowIndex)}}obj.updateSelectionFromCoords(x,y,colIndex,rowIndex),obj.setHistory({action:"setValue",records:records,selection:obj.selectedCell,newStyle:newStyle,oldStyle:oldStyle}),obj.updateTable(),obj.dispatch("onpaste",el,data),obj.onafterchanges(el,records)}obj.removeCopyingSelection()},obj.removeCopyingSelection=function(){for(var copying=document.querySelectorAll(".jexcel .copying"),i=0;i<copying.length;i++)copying[i].classList.remove("copying"),copying[i].classList.remove("copying-left"),copying[i].classList.remove("copying-right"),copying[i].classList.remove("copying-top"),copying[i].classList.remove("copying-bottom")},obj.historyProcessRow=function(type,historyRecord){var rowIndex=historyRecord.insertBefore?+historyRecord.rowNumber:historyRecord.rowNumber+1;if(1==obj.options.search&&obj.results&&obj.results.length!=obj.rows.length&&obj.resetSearch(),1==type){for(var numOfRows=historyRecord.numOfRows,j=rowIndex;j<numOfRows+rowIndex;j++)obj.rows[j].parentNode.removeChild(obj.rows[j]);obj.records.splice(rowIndex,numOfRows),obj.options.data.splice(rowIndex,numOfRows),obj.rows.splice(rowIndex,numOfRows),obj.conditionalSelectionUpdate(1,rowIndex,numOfRows+rowIndex-1)}else{obj.records=jexcel.injectArray(obj.records,rowIndex,historyRecord.rowRecords),obj.options.data=jexcel.injectArray(obj.options.data,rowIndex,historyRecord.rowData),obj.rows=jexcel.injectArray(obj.rows,rowIndex,historyRecord.rowNode);for(var index=0,j=rowIndex;j<historyRecord.numOfRows+rowIndex;j++)obj.tbody.insertBefore(historyRecord.rowNode[index],obj.tbody.children[j]),index++}obj.options.pagination>0&&obj.page(obj.pageNumber),obj.updateTableReferences()},obj.historyProcessColumn=function(type,historyRecord){var columnIndex=historyRecord.insertBefore?historyRecord.columnNumber:historyRecord.columnNumber+1;if(1==type){var numOfColumns=historyRecord.numOfColumns;obj.options.columns.splice(columnIndex,numOfColumns);for(var i=columnIndex;i<numOfColumns+columnIndex;i++)obj.headers[i].parentNode.removeChild(obj.headers[i]),obj.colgroup[i].parentNode.removeChild(obj.colgroup[i]);obj.headers.splice(columnIndex,numOfColumns),obj.colgroup.splice(columnIndex,numOfColumns);for(var j=0;j<historyRecord.data.length;j++){for(var i=columnIndex;i<numOfColumns+columnIndex;i++)obj.records[j][i].parentNode.removeChild(obj.records[j][i]);obj.records[j].splice(columnIndex,numOfColumns),obj.options.data[j].splice(columnIndex,numOfColumns)}if(obj.options.footers)for(var j=0;j<obj.options.footers.length;j++)obj.options.footers[j].splice(columnIndex,numOfColumns)}else{obj.options.columns=jexcel.injectArray(obj.options.columns,columnIndex,historyRecord.columns),obj.headers=jexcel.injectArray(obj.headers,columnIndex,historyRecord.headers),obj.colgroup=jexcel.injectArray(obj.colgroup,columnIndex,historyRecord.colgroup);for(var index=0,i=columnIndex;i<historyRecord.numOfColumns+columnIndex;i++)obj.headerContainer.insertBefore(historyRecord.headers[index],obj.headerContainer.children[i+1]),obj.colgroupContainer.insertBefore(historyRecord.colgroup[index],obj.colgroupContainer.children[i+1]),index++;for(var j=0;j<historyRecord.data.length;j++){obj.options.data[j]=jexcel.injectArray(obj.options.data[j],columnIndex,historyRecord.data[j]),obj.records[j]=jexcel.injectArray(obj.records[j],columnIndex,historyRecord.records[j]);for(var index=0,i=columnIndex;i<historyRecord.numOfColumns+columnIndex;i++)obj.rows[j].insertBefore(historyRecord.records[j][index],obj.rows[j].children[i+1]),index++}if(obj.options.footers)for(var j=0;j<obj.options.footers.length;j++)obj.options.footers[j]=jexcel.injectArray(obj.options.footers[j],columnIndex,historyRecord.footers[j])}if(obj.options.nestedHeaders&&obj.options.nestedHeaders.length>0)if(obj.options.nestedHeaders[0]&&obj.options.nestedHeaders[0][0])for(var j=0;j<obj.options.nestedHeaders.length;j++){if(1==type)var colspan=parseInt(obj.options.nestedHeaders[j][obj.options.nestedHeaders[j].length-1].colspan)-historyRecord.numOfColumns;else var colspan=parseInt(obj.options.nestedHeaders[j][obj.options.nestedHeaders[j].length-1].colspan)+historyRecord.numOfColumns;obj.options.nestedHeaders[j][obj.options.nestedHeaders[j].length-1].colspan=colspan,obj.thead.children[j].children[obj.thead.children[j].children.length-1].setAttribute("colspan",colspan)}else{if(1==type)var colspan=parseInt(obj.options.nestedHeaders[0].colspan)-historyRecord.numOfColumns;else var colspan=parseInt(obj.options.nestedHeaders[0].colspan)+historyRecord.numOfColumns;obj.options.nestedHeaders[0].colspan=colspan,obj.thead.children[0].children[obj.thead.children[0].children.length-1].setAttribute("colspan",colspan)}obj.updateTableReferences()},obj.undo=function(){var ignoreEvents=!!obj.ignoreEvents,ignoreHistory=!!obj.ignoreHistory;obj.ignoreEvents=!0,obj.ignoreHistory=!0;var records=[];if(obj.historyIndex>=0){var historyRecord=obj.history[obj.historyIndex--];if("insertRow"==historyRecord.action)obj.historyProcessRow(1,historyRecord);else if("deleteRow"==historyRecord.action)obj.historyProcessRow(0,historyRecord);else if("insertColumn"==historyRecord.action)obj.historyProcessColumn(1,historyRecord);else if("deleteColumn"==historyRecord.action)obj.historyProcessColumn(0,historyRecord);else if("moveRow"==historyRecord.action)obj.moveRow(historyRecord.newValue,historyRecord.oldValue);else if("moveColumn"==historyRecord.action)obj.moveColumn(historyRecord.newValue,historyRecord.oldValue);else if("setMerge"==historyRecord.action)obj.removeMerge(historyRecord.column,historyRecord.data);else if("setStyle"==historyRecord.action)obj.setStyle(historyRecord.oldValue,null,null,1);else if("setWidth"==historyRecord.action)obj.setWidth(historyRecord.column,historyRecord.oldValue);else if("setHeight"==historyRecord.action)obj.setHeight(historyRecord.row,historyRecord.oldValue);else if("setHeader"==historyRecord.action)obj.setHeader(historyRecord.column,historyRecord.oldValue);else if("setComments"==historyRecord.action)obj.setComments(historyRecord.column,historyRecord.oldValue[0],historyRecord.oldValue[1]);else if("orderBy"==historyRecord.action){for(var rows=[],j=0;j<historyRecord.rows.length;j++)rows[historyRecord.rows[j]]=j;obj.updateOrderArrow(historyRecord.column,historyRecord.order?0:1),obj.updateOrder(rows)}else if("setValue"==historyRecord.action){for(var i=0;i<historyRecord.records.length;i++)records.push({x:historyRecord.records[i].x,y:historyRecord.records[i].y,newValue:historyRecord.records[i].oldValue}),historyRecord.oldStyle&&obj.resetStyle(historyRecord.oldStyle);obj.setValue(records),historyRecord.selection&&obj.updateSelectionFromCoords(historyRecord.selection[0],historyRecord.selection[1],historyRecord.selection[2],historyRecord.selection[3])}}obj.ignoreEvents=ignoreEvents,obj.ignoreHistory=ignoreHistory,obj.dispatch("onundo",el,historyRecord)},obj.redo=function(){var ignoreEvents=!!obj.ignoreEvents,ignoreHistory=!!obj.ignoreHistory;obj.ignoreEvents=!0,obj.ignoreHistory=!0;var records=[];if(obj.historyIndex<obj.history.length-1){var historyRecord=obj.history[++obj.historyIndex];if("insertRow"==historyRecord.action)obj.historyProcessRow(0,historyRecord);else if("deleteRow"==historyRecord.action)obj.historyProcessRow(1,historyRecord);else if("insertColumn"==historyRecord.action)obj.historyProcessColumn(0,historyRecord);else if("deleteColumn"==historyRecord.action)obj.historyProcessColumn(1,historyRecord);else if("moveRow"==historyRecord.action)obj.moveRow(historyRecord.oldValue,historyRecord.newValue);else if("moveColumn"==historyRecord.action)obj.moveColumn(historyRecord.oldValue,historyRecord.newValue);else if("setMerge"==historyRecord.action)obj.setMerge(historyRecord.column,historyRecord.colspan,historyRecord.rowspan,1);else if("setStyle"==historyRecord.action)obj.setStyle(historyRecord.newValue,null,null,1);else if("setWidth"==historyRecord.action)obj.setWidth(historyRecord.column,historyRecord.newValue);else if("setHeight"==historyRecord.action)obj.setHeight(historyRecord.row,historyRecord.newValue);else if("setHeader"==historyRecord.action)obj.setHeader(historyRecord.column,historyRecord.newValue);else if("setComments"==historyRecord.action)obj.setComments(historyRecord.column,historyRecord.newValue[0],historyRecord.newValue[1]);else if("orderBy"==historyRecord.action)obj.updateOrderArrow(historyRecord.column,historyRecord.order),obj.updateOrder(historyRecord.rows);else if("setValue"==historyRecord.action){obj.setValue(historyRecord.records);for(var i=0;i<historyRecord.records.length;i++)historyRecord.oldStyle&&obj.resetStyle(historyRecord.newStyle);historyRecord.selection&&obj.updateSelectionFromCoords(historyRecord.selection[0],historyRecord.selection[1],historyRecord.selection[2],historyRecord.selection[3])}}obj.ignoreEvents=ignoreEvents,obj.ignoreHistory=ignoreHistory,obj.dispatch("onredo",el,historyRecord)},obj.getDropDownValue=function(column,key){var value=[];if(obj.options.columns[column]&&obj.options.columns[column].source){for(var combo=[],source=obj.options.columns[column].source,i=0;i<source.length;i++)"object"==typeof source[i]?combo[source[i].id]=source[i].name:combo[source[i]]=source[i];for(var keys=Array.isArray(key)?key:(""+key).split(";"),i=0;i<keys.length;i++)"object"==typeof keys[i]?value.push(combo[keys[i].id]):combo[keys[i]]&&value.push(combo[keys[i]])}else console.error("Invalid column");return value.length>0?value.join("; "):""},obj.parseCSV=function(str,delimiter){9==(str=str.replace(/\r?\n$|\r$|\n$/g,"")).charCodeAt(str.length-1)&&(str+="\0"),delimiter=delimiter||",";for(var arr=[],quote=!1,row=0,col=0,c=0;c<str.length;c++){var cc=str[c],nc=str[c+1];arr[row]=arr[row]||[],arr[row][col]=arr[row][col]||"",'"'==cc&&quote&&'"'==nc?(arr[row][col]+=cc,++c):'"'!=cc?cc!=delimiter||quote?"\r"!=cc||"\n"!=nc||quote?("\n"!=cc||quote)&&("\r"!=cc||quote)?arr[row][col]+=cc:(++row,col=0):(++row,col=0,++c):++col:quote=!quote}return arr},obj.hash=function(str){var hash=0,i,chr;if(0===str.length)return hash;for(i=0;i<str.length;i++)hash=(hash<<5)-hash+(chr=str.charCodeAt(i)),hash|=0;return hash},obj.onafterchanges=function(el,records){obj.dispatch("onafterchanges",el,records)},obj.destroy=function(){jexcel.destroy(el)},obj.init=function(){jexcel.current=obj,"function"==typeof jexcel.build&&(obj.options.root?jexcel.build(obj.options.root):(jexcel.build(document),jexcel.build=null)),el.setAttribute("tabindex",1),el.addEventListener("focus",(function(e){jexcel.current&&!obj.selectedCell&&(obj.updateSelectionFromCoords(0,0,0,0),obj.left())})),obj.options.csv?(1==obj.options.loadingSpin&&jSuites.loading.show(),jSuites.ajax({url:obj.options.csv,method:obj.options.method,data:obj.options.requestVariables,dataType:"text",success:function(result){var newData=obj.parseCSV(result,obj.options.csvDelimiter);if(1==obj.options.csvHeaders&&newData.length>0)for(var headers=newData.shift(),i=0;i<headers.length;i++)obj.options.columns[i]||(obj.options.columns[i]={type:"text",align:obj.options.defaultColAlign,width:obj.options.defaultColWidth}),void 0===obj.options.columns[i].title&&(obj.options.columns[i].title=headers[i]);obj.options.data=newData,obj.prepareTable(),1==obj.options.loadingSpin&&jSuites.loading.hide()}})):obj.options.url?(1==obj.options.loadingSpin&&jSuites.loading.show(),jSuites.ajax({url:obj.options.url,method:obj.options.method,data:obj.options.requestVariables,dataType:"json",success:function(result){obj.options.data=result.data?result.data:result,obj.prepareTable(),1==obj.options.loadingSpin&&jSuites.loading.hide()}})):obj.prepareTable()},options&&null!=options.contextMenu?obj.options.contextMenu=options.contextMenu:obj.options.contextMenu=function(el,x,y,e){var items=[];if(null==y)1==obj.options.allowInsertColumn&&items.push({title:obj.options.text.insertANewColumnBefore,onclick:function(){obj.insertColumn(1,parseInt(x),1)}}),1==obj.options.allowInsertColumn&&items.push({title:obj.options.text.insertANewColumnAfter,onclick:function(){obj.insertColumn(1,parseInt(x),0)}}),1==obj.options.allowDeleteColumn&&items.push({title:obj.options.text.deleteSelectedColumns,onclick:function(){obj.deleteColumn(obj.getSelectedColumns().length?void 0:parseInt(x))}}),1==obj.options.allowRenameColumn&&items.push({title:obj.options.text.renameThisColumn,onclick:function(){obj.setHeader(x)}}),1==obj.options.columnSorting&&(items.push({type:"line"}),items.push({title:obj.options.text.orderAscending,onclick:function(){obj.orderBy(x,0)}}),items.push({title:obj.options.text.orderDescending,onclick:function(){obj.orderBy(x,1)}}));else if(1==obj.options.allowInsertRow&&(items.push({title:obj.options.text.insertANewRowBefore,onclick:function(){obj.insertRow(1,parseInt(y),1)}}),items.push({title:obj.options.text.insertANewRowAfter,onclick:function(){obj.insertRow(1,parseInt(y))}})),1==obj.options.allowDeleteRow&&items.push({title:obj.options.text.deleteSelectedRows,onclick:function(){obj.deleteRow(obj.getSelectedRows().length?void 0:parseInt(y))}}),x&&1==obj.options.allowComments){items.push({type:"line"});var title=obj.records[y][x].getAttribute("title")||"";items.push({title:title?obj.options.text.editComments:obj.options.text.addComments,onclick:function(){var comment=prompt(obj.options.text.comments,title);comment&&obj.setComments([x,y],comment)}}),title&&items.push({title:obj.options.text.clearComments,onclick:function(){obj.setComments([x,y],"")}})}return items.push({type:"line"}),items.push({title:obj.options.text.copy,shortcut:"Ctrl + C",onclick:function(){obj.copy(!0)}}),navigator&&navigator.clipboard&&items.push({title:obj.options.text.paste,shortcut:"Ctrl + V",onclick:function(){obj.selectedCell&&navigator.clipboard.readText().then((function(text){text&&jexcel.current.paste(obj.selectedCell[0],obj.selectedCell[1],text)}))}}),obj.options.allowExport&&items.push({title:obj.options.text.saveAs,shortcut:"Ctrl + S",onclick:function(){obj.download()}}),obj.options.about&&items.push({title:obj.options.text.about,onclick:function(){!0===obj.options.about?alert(Version().print()):alert(obj.options.about)}}),items},obj.scrollControls=function(e){obj.wheelControls(),obj.options.freezeColumns>0&&obj.content.scrollLeft!=scrollLeft&&obj.updateFreezePosition(),1!=obj.options.lazyLoading&&1!=obj.options.tableOverflow||obj.edition&&"jdropdown"!=e.target.className.substr(0,9)&&obj.closeEditor(obj.edition[0],!0)},obj.wheelControls=function(e){1==obj.options.lazyLoading&&null==jexcel.timeControlLoading&&(jexcel.timeControlLoading=setTimeout((function(){obj.content.scrollTop+obj.content.clientHeight>=obj.content.scrollHeight-10?obj.loadDown()&&(obj.content.scrollTop+obj.content.clientHeight>obj.content.scrollHeight-10&&(obj.content.scrollTop=obj.content.scrollTop-obj.content.clientHeight),obj.updateCornerPosition()):obj.content.scrollTop<=obj.content.clientHeight&&obj.loadUp()&&(obj.content.scrollTop<10&&(obj.content.scrollTop=obj.content.scrollTop+obj.content.clientHeight),obj.updateCornerPosition()),jexcel.timeControlLoading=null}),100))},obj.getFreezeWidth=function(){var width=0;if(obj.options.freezeColumns>0)for(var i=0;i<obj.options.freezeColumns;i++)width+=parseInt(obj.options.columns[i].width);return width};var scrollLeft=0;return obj.updateFreezePosition=function(){var width=0;if((scrollLeft=obj.content.scrollLeft)>50)for(var i=0;i<obj.options.freezeColumns;i++){i>0&&"hidden"!==obj.options.columns[i-1].type&&(width+=parseInt(obj.options.columns[i-1].width)),obj.headers[i].classList.add("jexcel_freezed"),obj.headers[i].style.left=width+"px";for(var j=0;j<obj.rows.length;j++)if(obj.rows[j]&&obj.records[j][i]){var shifted=scrollLeft+(i>0?obj.records[j][i-1].style.width:0)-51+"px";obj.records[j][i].classList.add("jexcel_freezed"),obj.records[j][i].style.left=shifted}}else for(var i=0;i<obj.options.freezeColumns;i++){obj.headers[i].classList.remove("jexcel_freezed"),obj.headers[i].style.left="";for(var j=0;j<obj.rows.length;j++)obj.records[j][i]&&(obj.records[j][i].classList.remove("jexcel_freezed"),obj.records[j][i].style.left="")}obj.updateCornerPosition()},el.addEventListener("DOMMouseScroll",obj.wheelControls),el.addEventListener("mousewheel",obj.wheelControls),el.jexcel=obj,el.jspreadsheet=obj,obj.init(),obj},component;return jexcel.setDictionary=function(o){jSuites.setDictionary(o)},jexcel.setExtensions=function(o){for(var k=Object.keys(o),i=0;i<k.length;i++)"function"==typeof o[k[i]]&&(jexcel[k[i]]=o[k[i]],jexcel.license&&"function"==typeof o[k[i]].license&&o[k[i]].license(jexcel.license))},void 0!==formula&&(jexcel.formula=formula),jexcel.version=Version,jexcel.current=null,jexcel.timeControl=null,jexcel.timeControlLoading=null,jexcel.destroy=function(element,destroyEventHandlers){if(element.jexcel){var root=element.jexcel.options.root?element.jexcel.options.root:document;element.removeEventListener("DOMMouseScroll",element.jexcel.scrollControls),element.removeEventListener("mousewheel",element.jexcel.scrollControls),element.jexcel=null,element.innerHTML="",destroyEventHandlers&&(root.removeEventListener("mouseup",jexcel.mouseUpControls),root.removeEventListener("mousedown",jexcel.mouseDownControls),root.removeEventListener("mousemove",jexcel.mouseMoveControls),root.removeEventListener("mouseover",jexcel.mouseOverControls),root.removeEventListener("dblclick",jexcel.doubleClickControls),root.removeEventListener("paste",jexcel.pasteControls),root.removeEventListener("contextmenu",jexcel.contextMenuControls),root.removeEventListener("touchstart",jexcel.touchStartControls),root.removeEventListener("touchend",jexcel.touchEndControls),root.removeEventListener("touchcancel",jexcel.touchEndControls),document.removeEventListener("keydown",jexcel.keyDownControls),jexcel=null)}},jexcel.build=function(root){root.addEventListener("mouseup",jexcel.mouseUpControls),root.addEventListener("mousedown",jexcel.mouseDownControls),root.addEventListener("mousemove",jexcel.mouseMoveControls),root.addEventListener("mouseover",jexcel.mouseOverControls),root.addEventListener("dblclick",jexcel.doubleClickControls),root.addEventListener("paste",jexcel.pasteControls),root.addEventListener("contextmenu",jexcel.contextMenuControls),root.addEventListener("touchstart",jexcel.touchStartControls),root.addEventListener("touchend",jexcel.touchEndControls),root.addEventListener("touchcancel",jexcel.touchEndControls),root.addEventListener("touchmove",jexcel.touchEndControls),document.addEventListener("keydown",jexcel.keyDownControls)},jexcel.keyDownControls=function(e){if(jexcel.current){if(jexcel.current.edition)if(27==e.which)jexcel.current.edition&&jexcel.current.closeEditor(jexcel.current.edition[0],!1),e.preventDefault();else if(13==e.which)if("calendar"==jexcel.current.options.columns[jexcel.current.edition[2]].type)jexcel.current.closeEditor(jexcel.current.edition[0],!0);else if("dropdown"==jexcel.current.options.columns[jexcel.current.edition[2]].type||"autocomplete"==jexcel.current.options.columns[jexcel.current.edition[2]].type);else if((1==jexcel.current.options.wordWrap||1==jexcel.current.options.columns[jexcel.current.edition[2]].wordWrap||jexcel.current.options.data[jexcel.current.edition[3]][jexcel.current.edition[2]].length>200)&&e.altKey){var editorTextarea=jexcel.current.edition[0].children[0],editorValue=jexcel.current.edition[0].children[0].value,editorIndexOf=editorTextarea.selectionStart;editorValue=editorValue.slice(0,editorIndexOf)+"\n"+editorValue.slice(editorIndexOf),editorTextarea.value=editorValue,editorTextarea.focus(),editorTextarea.selectionStart=editorIndexOf+1,editorTextarea.selectionEnd=editorIndexOf+1}else jexcel.current.edition[0].children[0].blur();else 9==e.which&&("calendar"==jexcel.current.options.columns[jexcel.current.edition[2]].type?jexcel.current.closeEditor(jexcel.current.edition[0],!0):jexcel.current.edition[0].children[0].blur());if(!jexcel.current.edition&&jexcel.current.selectedCell)if(37==e.which)jexcel.current.left(e.shiftKey,e.ctrlKey),e.preventDefault();else if(39==e.which)jexcel.current.right(e.shiftKey,e.ctrlKey),e.preventDefault();else if(38==e.which)jexcel.current.up(e.shiftKey,e.ctrlKey),e.preventDefault();else if(40==e.which)jexcel.current.down(e.shiftKey,e.ctrlKey),e.preventDefault();else if(36==e.which)jexcel.current.first(e.shiftKey,e.ctrlKey),e.preventDefault();else if(35==e.which)jexcel.current.last(e.shiftKey,e.ctrlKey),e.preventDefault();else if(32==e.which)1==jexcel.current.options.editable&&jexcel.current.setCheckRadioValue(),e.preventDefault();else if(46==e.which)1==jexcel.current.options.editable&&(jexcel.current.selectedRow?1==jexcel.current.options.allowDeleteRow&&confirm(jexcel.current.options.text.areYouSureToDeleteTheSelectedRows)&&jexcel.current.deleteRow():jexcel.current.selectedHeader?1==jexcel.current.options.allowDeleteColumn&&confirm(jexcel.current.options.text.areYouSureToDeleteTheSelectedColumns)&&jexcel.current.deleteColumn():jexcel.current.setValue(jexcel.current.highlighted,""));else if(13==e.which)e.shiftKey?jexcel.current.up():(1==jexcel.current.options.allowInsertRow&&1==jexcel.current.options.allowManualInsertRow&&jexcel.current.selectedCell[1]==jexcel.current.options.data.length-1&&jexcel.current.insertRow(),jexcel.current.down()),e.preventDefault();else if(9==e.which)e.shiftKey?jexcel.current.left():(1==jexcel.current.options.allowInsertColumn&&1==jexcel.current.options.allowManualInsertColumn&&jexcel.current.selectedCell[0]==jexcel.current.options.data[0].length-1&&jexcel.current.insertColumn(),jexcel.current.right()),e.preventDefault();else if(!e.ctrlKey&&!e.metaKey||e.shiftKey){if(jexcel.current.selectedCell&&1==jexcel.current.options.editable){var rowId=jexcel.current.selectedCell[1],columnId=jexcel.current.selectedCell[0];"readonly"!=jexcel.current.options.columns[columnId].type&&(32==e.keyCode?"checkbox"==jexcel.current.options.columns[columnId].type||"radio"==jexcel.current.options.columns[columnId].type?e.preventDefault():jexcel.current.openEditor(jexcel.current.records[rowId][columnId],!0):113==e.keyCode?jexcel.current.openEditor(jexcel.current.records[rowId][columnId],!1):(8==e.keyCode||e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=111||e.keyCode>=187&&e.keyCode<=190||(String.fromCharCode(e.keyCode)==e.key||String.fromCharCode(e.keyCode).toLowerCase()==e.key.toLowerCase())&&jexcel.validLetter(String.fromCharCode(e.keyCode)))&&(jexcel.current.openEditor(jexcel.current.records[rowId][columnId],!0),"calendar"==jexcel.current.options.columns[columnId].type&&e.preventDefault()))}}else 65==e.which?(jexcel.current.selectAll(),e.preventDefault()):83==e.which?(jexcel.current.download(),e.preventDefault()):89==e.which?(jexcel.current.redo(),e.preventDefault()):90==e.which?(jexcel.current.undo(),e.preventDefault()):67==e.which?(jexcel.current.copy(!0),e.preventDefault()):88==e.which?(1==jexcel.current.options.editable?jexcel.cutControls():jexcel.copyControls(),e.preventDefault()):86==e.which&&jexcel.pasteControls();else e.target.classList.contains("jexcel_search")&&(jexcel.timeControl&&clearTimeout(jexcel.timeControl),jexcel.timeControl=setTimeout((function(){jexcel.current.search(e.target.value)}),200))}},jexcel.isMouseAction=!1,jexcel.mouseDownControls=function(e){if((e=e||window.event).buttons)var mouseButton=e.buttons;else if(e.button)var mouseButton=e.button;else var mouseButton=e.which;var jexcelTable=jexcel.getElement(e.target);if(jexcelTable[0]?jexcel.current!=jexcelTable[0].jexcel&&(jexcel.current&&(jexcel.current.edition&&jexcel.current.closeEditor(jexcel.current.edition[0],!0),jexcel.current.resetSelection()),jexcel.current=jexcelTable[0].jexcel):jexcel.current&&(jexcel.current.edition&&jexcel.current.closeEditor(jexcel.current.edition[0],!0),jexcel.current.resetSelection(!0),jexcel.current=null),jexcel.current&&1==mouseButton){if(e.target.classList.contains("jexcel_selectall"))jexcel.current&&jexcel.current.selectAll();else if(e.target.classList.contains("jexcel_corner"))1==jexcel.current.options.editable&&(jexcel.current.selectedCorner=!0);else{var columnId;if(1==jexcelTable[1]){if(columnId=e.target.getAttribute("data-x")){var info=e.target.getBoundingClientRect();if(1==jexcel.current.options.columnResize&&info.width-e.offsetX<6){jexcel.current.resizing={mousePosition:e.pageX,column:columnId,width:info.width},jexcel.current.headers[columnId].classList.add("resizing");for(var j=0;j<jexcel.current.records.length;j++)jexcel.current.records[j][columnId]&&jexcel.current.records[j][columnId].classList.add("resizing")}else if(1==jexcel.current.options.columnDrag&&info.height-e.offsetY<6)if(jexcel.current.isColMerged(columnId).length)console.error("Jspreadsheet: This column is part of a merged cell.");else{jexcel.current.resetSelection(),jexcel.current.dragging={element:e.target,column:columnId,destination:columnId},jexcel.current.headers[columnId].classList.add("dragging");for(var j=0;j<jexcel.current.records.length;j++)jexcel.current.records[j][columnId]&&jexcel.current.records[j][columnId].classList.add("dragging")}else{if(jexcel.current.selectedHeader&&(e.shiftKey||e.ctrlKey))var o=jexcel.current.selectedHeader,d=columnId;else{jexcel.current.selectedHeader==columnId&&1==jexcel.current.options.allowRenameColumn&&(jexcel.timeControl=setTimeout((function(){jexcel.current.setHeader(columnId)}),800)),jexcel.current.selectedHeader=columnId;var o=columnId,d=columnId}jexcel.current.updateSelectionFromCoords(o,0,d,jexcel.current.options.data.length-1)}}else if(e.target.parentNode.classList.contains("jexcel_nested")){if(e.target.getAttribute("data-column"))var column=e.target.getAttribute("data-column").split(","),c1=parseInt(column[0]),c2=parseInt(column[column.length-1]);else var c1=0,c2=jexcel.current.options.columns.length-1;jexcel.current.updateSelectionFromCoords(c1,0,c2,jexcel.current.options.data.length-1)}}else jexcel.current.selectedHeader=!1;if(2==jexcelTable[1]){var rowId=e.target.getAttribute("data-y");if(e.target.classList.contains("jexcel_row")){var info=e.target.getBoundingClientRect();if(1==jexcel.current.options.rowResize&&info.height-e.offsetY<6)jexcel.current.resizing={element:e.target.parentNode,mousePosition:e.pageY,row:rowId,height:info.height},e.target.parentNode.classList.add("resizing");else if(1==jexcel.current.options.rowDrag&&info.width-e.offsetX<6)jexcel.current.isRowMerged(rowId).length?console.error("Jspreadsheet: This row is part of a merged cell"):1==jexcel.current.options.search&&jexcel.current.results?console.error("Jspreadsheet: Please clear your search before perform this action"):(jexcel.current.resetSelection(),jexcel.current.dragging={element:e.target.parentNode,row:rowId,destination:rowId},e.target.parentNode.classList.add("dragging"));else{if(jexcel.current.selectedRow&&(e.shiftKey||e.ctrlKey))var o=jexcel.current.selectedRow,d=rowId;else{jexcel.current.selectedRow=rowId;var o=rowId,d=rowId}jexcel.current.updateSelectionFromCoords(0,o,jexcel.current.options.data[0].length-1,d)}}else if(e.target.classList.contains("jclose")&&e.target.clientWidth-e.offsetX<50&&e.offsetY<50)jexcel.current.closeEditor(jexcel.current.edition[0],!0);else{var getCellCoords=function(element){var x=element.getAttribute("data-x"),y=element.getAttribute("data-y");return x&&y?[x,y]:element.parentNode?getCellCoords(element.parentNode):void 0},position=getCellCoords(e.target);if(position){var columnId=position[0],rowId=position[1];jexcel.current.edition&&(jexcel.current.edition[2]==columnId&&jexcel.current.edition[3]==rowId||jexcel.current.closeEditor(jexcel.current.edition[0],!0)),jexcel.current.edition||(e.shiftKey?jexcel.current.updateSelectionFromCoords(jexcel.current.selectedCell[0],jexcel.current.selectedCell[1],columnId,rowId):jexcel.current.updateSelectionFromCoords(columnId,rowId)),jexcel.current.selectedHeader=null,jexcel.current.selectedRow=null}}}else jexcel.current.selectedRow=!1;e.target.classList.contains("jexcel_page")&&("<"==e.target.innerText?jexcel.current.page(0):">"==e.target.innerText?jexcel.current.page(e.target.getAttribute("title")-1):jexcel.current.page(e.target.innerText-1))}jexcel.current.edition?jexcel.isMouseAction=!1:jexcel.isMouseAction=!0}else jexcel.isMouseAction=!1},jexcel.mouseUpControls=function(e){if(jexcel.current)if(jexcel.current.resizing){if(jexcel.current.resizing.column){var newWidth=jexcel.current.colgroup[jexcel.current.resizing.column].getAttribute("width"),columns=jexcel.current.getSelectedColumns();if(columns.length>1){for(var currentWidth=[],i=0;i<columns.length;i++)currentWidth.push(parseInt(jexcel.current.colgroup[columns[i]].getAttribute("width")));var index;currentWidth[columns.indexOf(parseInt(jexcel.current.resizing.column))]=jexcel.current.resizing.width,jexcel.current.setWidth(columns,newWidth,currentWidth)}else jexcel.current.setWidth(jexcel.current.resizing.column,newWidth,jexcel.current.resizing.width);jexcel.current.headers[jexcel.current.resizing.column].classList.remove("resizing");for(var j=0;j<jexcel.current.records.length;j++)jexcel.current.records[j][jexcel.current.resizing.column]&&jexcel.current.records[j][jexcel.current.resizing.column].classList.remove("resizing")}else{jexcel.current.rows[jexcel.current.resizing.row].children[0].classList.remove("resizing");var newHeight=jexcel.current.rows[jexcel.current.resizing.row].getAttribute("height");jexcel.current.setHeight(jexcel.current.resizing.row,newHeight,jexcel.current.resizing.height),jexcel.current.resizing.element.classList.remove("resizing")}jexcel.current.resizing=null}else if(jexcel.current.dragging){if(jexcel.current.dragging){if(jexcel.current.dragging.column){var columnId=e.target.getAttribute("data-x");jexcel.current.headers[jexcel.current.dragging.column].classList.remove("dragging");for(var j=0;j<jexcel.current.rows.length;j++)jexcel.current.records[j][jexcel.current.dragging.column]&&jexcel.current.records[j][jexcel.current.dragging.column].classList.remove("dragging");for(var i=0;i<jexcel.current.headers.length;i++)jexcel.current.headers[i].classList.remove("dragging-left"),jexcel.current.headers[i].classList.remove("dragging-right");columnId&&jexcel.current.dragging.column!=jexcel.current.dragging.destination&&jexcel.current.moveColumn(jexcel.current.dragging.column,jexcel.current.dragging.destination)}else{if(jexcel.current.dragging.element.nextSibling){var position=parseInt(jexcel.current.dragging.element.nextSibling.getAttribute("data-y"));jexcel.current.dragging.row<position&&(position-=1)}else var position=parseInt(jexcel.current.dragging.element.previousSibling.getAttribute("data-y"));jexcel.current.dragging.row!=jexcel.current.dragging.destination&&jexcel.current.moveRow(jexcel.current.dragging.row,position,!0),jexcel.current.dragging.element.classList.remove("dragging")}jexcel.current.dragging=null}}else jexcel.current.selectedCorner&&(jexcel.current.selectedCorner=!1,jexcel.current.selection.length>0&&(jexcel.current.copyData(jexcel.current.selection[0],jexcel.current.selection[jexcel.current.selection.length-1]),jexcel.current.removeCopySelection()));jexcel.timeControl&&(clearTimeout(jexcel.timeControl),jexcel.timeControl=null),jexcel.isMouseAction=!1},jexcel.mouseMoveControls=function(e){if((e=e||window.event).buttons)var mouseButton=e.buttons;else if(e.button)var mouseButton=e.button;else var mouseButton=e.which;if(mouseButton||(jexcel.isMouseAction=!1),jexcel.current)if(1==jexcel.isMouseAction){if(jexcel.current.resizing)if(jexcel.current.resizing.column){var width=e.pageX-jexcel.current.resizing.mousePosition;if(jexcel.current.resizing.width+width>0){var tempWidth=jexcel.current.resizing.width+width;jexcel.current.colgroup[jexcel.current.resizing.column].setAttribute("width",tempWidth),jexcel.current.updateCornerPosition()}}else{var height=e.pageY-jexcel.current.resizing.mousePosition;if(jexcel.current.resizing.height+height>0){var tempHeight=jexcel.current.resizing.height+height;jexcel.current.rows[jexcel.current.resizing.row].setAttribute("height",tempHeight),jexcel.current.updateCornerPosition()}}else if(jexcel.current.dragging)if(jexcel.current.dragging.column){var columnId=e.target.getAttribute("data-x");if(columnId)if(jexcel.current.isColMerged(columnId).length)console.error("Jspreadsheet: This column is part of a merged cell.");else{for(var i=0;i<jexcel.current.headers.length;i++)jexcel.current.headers[i].classList.remove("dragging-left"),jexcel.current.headers[i].classList.remove("dragging-right");jexcel.current.dragging.column==columnId?jexcel.current.dragging.destination=parseInt(columnId):e.target.clientWidth/2>e.offsetX?(jexcel.current.dragging.column<columnId?jexcel.current.dragging.destination=parseInt(columnId)-1:jexcel.current.dragging.destination=parseInt(columnId),jexcel.current.headers[columnId].classList.add("dragging-left")):(jexcel.current.dragging.column<columnId?jexcel.current.dragging.destination=parseInt(columnId):jexcel.current.dragging.destination=parseInt(columnId)+1,jexcel.current.headers[columnId].classList.add("dragging-right"))}}else{var rowId=e.target.getAttribute("data-y");if(rowId)if(jexcel.current.isRowMerged(rowId).length)console.error("Jspreadsheet: This row is part of a merged cell.");else{var target=e.target.clientHeight/2>e.offsetY?e.target.parentNode.nextSibling:e.target.parentNode;jexcel.current.dragging.element!=target&&(e.target.parentNode.parentNode.insertBefore(jexcel.current.dragging.element,target),jexcel.current.dragging.destination=Array.prototype.indexOf.call(jexcel.current.dragging.element.parentNode.children,jexcel.current.dragging.element))}}}else{var x=e.target.getAttribute("data-x"),y=e.target.getAttribute("data-y"),rect=e.target.getBoundingClientRect();jexcel.current.cursor&&(jexcel.current.cursor.style.cursor="",jexcel.current.cursor=null),e.target.parentNode.parentNode&&e.target.parentNode.parentNode.className&&(e.target.parentNode.parentNode.classList.contains("resizable")&&(e.target&&x&&!y&&rect.width-(e.clientX-rect.left)<6?(jexcel.current.cursor=e.target,jexcel.current.cursor.style.cursor="col-resize"):e.target&&!x&&y&&rect.height-(e.clientY-rect.top)<6&&(jexcel.current.cursor=e.target,jexcel.current.cursor.style.cursor="row-resize")),e.target.parentNode.parentNode.classList.contains("draggable")&&(e.target&&!x&&y&&rect.width-(e.clientX-rect.left)<6?(jexcel.current.cursor=e.target,jexcel.current.cursor.style.cursor="move"):e.target&&x&&!y&&rect.height-(e.clientY-rect.top)<6&&(jexcel.current.cursor=e.target,jexcel.current.cursor.style.cursor="move")))}},jexcel.mouseOverControls=function(e){if((e=e||window.event).buttons)var mouseButton=e.buttons;else if(e.button)var mouseButton=e.button;else var mouseButton=e.which;if(mouseButton||(jexcel.isMouseAction=!1),jexcel.current&&1==jexcel.isMouseAction){var jexcelTable=jexcel.getElement(e.target);if(jexcelTable[0]){if(jexcel.current!=jexcelTable[0].jexcel&&jexcel.current)return!1;var columnId=e.target.getAttribute("data-x"),rowId=e.target.getAttribute("data-y");if(jexcel.current.resizing||jexcel.current.dragging);else{if(1==jexcelTable[1]&&jexcel.current.selectedHeader){var columnId=e.target.getAttribute("data-x"),o=jexcel.current.selectedHeader,d=columnId;jexcel.current.updateSelectionFromCoords(o,0,d,jexcel.current.options.data.length-1)}if(2==jexcelTable[1])if(e.target.classList.contains("jexcel_row")){if(jexcel.current.selectedRow){var o=jexcel.current.selectedRow,d=rowId;jexcel.current.updateSelectionFromCoords(0,o,jexcel.current.options.data[0].length-1,d)}}else jexcel.current.edition||columnId&&rowId&&(jexcel.current.selectedCorner?jexcel.current.updateCopySelection(columnId,rowId):jexcel.current.selectedCell&&jexcel.current.updateSelectionFromCoords(jexcel.current.selectedCell[0],jexcel.current.selectedCell[1],columnId,rowId))}}}jexcel.timeControl&&(clearTimeout(jexcel.timeControl),jexcel.timeControl=null)},jexcel.doubleClickControls=function(e){if(jexcel.current)if(e.target.classList.contains("jexcel_corner")){if(jexcel.current.highlighted.length>0){var x1=jexcel.current.highlighted[0].getAttribute("data-x"),y1=parseInt(jexcel.current.highlighted[jexcel.current.highlighted.length-1].getAttribute("data-y"))+1,x2=jexcel.current.highlighted[jexcel.current.highlighted.length-1].getAttribute("data-x"),y2=jexcel.current.records.length-1;jexcel.current.copyData(jexcel.current.records[y1][x1],jexcel.current.records[y2][x2])}}else if(e.target.classList.contains("jexcel_column_filter")){var columnId=e.target.getAttribute("data-x");jexcel.current.openFilter(columnId)}else{var jexcelTable=jexcel.getElement(e.target),columnId;if(1==jexcelTable[1]&&1==jexcel.current.options.columnSorting)(columnId=e.target.getAttribute("data-x"))&&jexcel.current.orderBy(columnId);if(2==jexcelTable[1]&&1==jexcel.current.options.editable&&!jexcel.current.edition){var getCellCoords=function(element){if(element.parentNode){var x=element.getAttribute("data-x"),y=element.getAttribute("data-y");return x&&y?element:getCellCoords(element.parentNode)}},cell=getCellCoords(e.target);cell&&cell.classList.contains("highlight")&&jexcel.current.openEditor(cell)}}},jexcel.copyControls=function(e){jexcel.current&&jexcel.copyControls.enabled&&(jexcel.current.edition||jexcel.current.copy(!0))},jexcel.cutControls=function(e){jexcel.current&&(jexcel.current.edition||(jexcel.current.copy(!0),1==jexcel.current.options.editable&&jexcel.current.setValue(jexcel.current.highlighted,"")))},jexcel.pasteControls=function(e){jexcel.current&&jexcel.current.selectedCell&&(jexcel.current.edition||1==jexcel.current.options.editable&&(e&&e.clipboardData?(jexcel.current.paste(jexcel.current.selectedCell[0],jexcel.current.selectedCell[1],e.clipboardData.getData("text")),e.preventDefault()):window.clipboardData&&jexcel.current.paste(jexcel.current.selectedCell[0],jexcel.current.selectedCell[1],window.clipboardData.getData("text"))))},jexcel.contextMenuControls=function(e){if("buttons"in(e=e||window.event))var mouseButton=e.buttons;else var mouseButton=e.which||e.button;if(jexcel.current)if(jexcel.current.edition)e.preventDefault();else if(jexcel.current.options.contextMenu&&(jexcel.current.contextMenu.contextmenu.close(),jexcel.current)){var x=e.target.getAttribute("data-x"),y=e.target.getAttribute("data-y");if(x||y){(x<parseInt(jexcel.current.selectedCell[0])||x>parseInt(jexcel.current.selectedCell[2])||y<parseInt(jexcel.current.selectedCell[1])||y>parseInt(jexcel.current.selectedCell[3]))&&jexcel.current.updateSelectionFromCoords(x,y,x,y);var items=jexcel.current.options.contextMenu(jexcel.current,x,y,e);jexcel.current.contextMenu.contextmenu.open(e,items),e.preventDefault()}}},jexcel.touchStartControls=function(e){var jexcelTable=jexcel.getElement(e.target);if(jexcelTable[0]?jexcel.current!=jexcelTable[0].jexcel&&(jexcel.current&&jexcel.current.resetSelection(),jexcel.current=jexcelTable[0].jexcel):jexcel.current&&(jexcel.current.resetSelection(),jexcel.current=null),jexcel.current&&!jexcel.current.edition){var columnId=e.target.getAttribute("data-x"),rowId=e.target.getAttribute("data-y");columnId&&rowId&&(jexcel.current.updateSelectionFromCoords(columnId,rowId),jexcel.timeControl=setTimeout((function(){"color"==jexcel.current.options.columns[columnId].type?jexcel.tmpElement=null:jexcel.tmpElement=e.target,jexcel.current.openEditor(e.target,!1,e)}),500))}},jexcel.touchEndControls=function(e){jexcel.timeControl&&(clearTimeout(jexcel.timeControl),jexcel.timeControl=null,jexcel.tmpElement&&"INPUT"==jexcel.tmpElement.children[0].tagName&&jexcel.tmpElement.children[0].focus(),jexcel.tmpElement=null)},jexcel.tabs=function(tabs,result){var instances=[];if(tabs.classList.contains("jexcel_tabs"))var headers=tabs.children[0],content=tabs.children[1];else{tabs.innerHTML="",tabs.classList.add("jexcel_tabs"),tabs.jexcel=[];var div=document.createElement("div"),headers=tabs.appendChild(div),div=document.createElement("div"),content=tabs.appendChild(div)}for(var spreadsheet=[],link=[],i=0;i<result.length;i++){spreadsheet[i]=document.createElement("div"),spreadsheet[i].classList.add("jexcel_tab");var worksheet=jexcel(spreadsheet[i],result[i]);content.appendChild(spreadsheet[i]),instances[i]=tabs.jexcel.push(worksheet),link[i]=document.createElement("div"),link[i].classList.add("jexcel_tab_link"),link[i].setAttribute("data-spreadsheet",tabs.jexcel.length-1),link[i].innerHTML=result[i].sheetName,link[i].onclick=function(){for(var j=0;j<headers.children.length;j++)headers.children[j].classList.remove("selected"),content.children[j].style.display="none";var i=this.getAttribute("data-spreadsheet");content.children[i].style.display="block",headers.children[i].classList.add("selected")},headers.appendChild(link[i])}for(var j=0;j<headers.children.length;j++)headers.children[j].classList.remove("selected"),content.children[j].style.display="none";return headers.children[headers.children.length-1].classList.add("selected"),content.children[headers.children.length-1].style.display="block",instances},jexcel.createTabs=jexcel.tabs,jexcel.fromSpreadsheet=function(file,__callback){var convert=function(workbook){var spreadsheets=[];return workbook.SheetNames.forEach((function(sheetName){var spreadsheet={rows:[],columns:[],data:[],style:{}},temp,temp,temp;if(spreadsheet.sheetName=sheetName,(temp=workbook.Sheets[sheetName]["!cols"])&&temp.length)for(var i=0;i<temp.length;i++)spreadsheet.columns[i]={},temp[i]&&temp[i].wpx&&(spreadsheet.columns[i].width=temp[i].wpx+"px");if((temp=workbook.Sheets[sheetName]["!rows"])&&temp.length)for(var i=0;i<temp.length;i++)temp[i]&&temp[i].hpx&&(spreadsheet.rows[i]={},spreadsheet.rows[i].height=temp[i].hpx+"px");if((temp=workbook.Sheets[sheetName]["!merges"])&&temp.length>0){spreadsheet.mergeCells=[];for(var i=0;i<temp.length;i++){var x1=temp[i].s.c,y1=temp[i].s.r,x2=temp[i].e.c,y2=temp[i].e.r,key=jexcel.getColumnNameFromId([x1,y1]);spreadsheet.mergeCells[key]=[x2-x1+1,y2-y1+1]}}for(var max_x=0,max_y=0,temp=Object.keys(workbook.Sheets[sheetName]),i=0;i<temp.length;i++)if("!"!=temp[i].substr(0,1)){var cell=workbook.Sheets[sheetName][temp[i]],info=jexcel.getIdFromColumnName(temp[i],!0);spreadsheet.data[info[1]]||(spreadsheet.data[info[1]]=[]),spreadsheet.data[info[1]][info[0]]=cell.f?"="+cell.f:cell.w,max_x<info[0]&&(max_x=info[0]),max_y<info[1]&&(max_y=info[1]),cell.style&&Object.keys(cell.style).length>0&&(spreadsheet.style[temp[i]]=cell.style),cell.s&&cell.s.fgColor&&(spreadsheet.style[temp[i]]&&(spreadsheet.style[temp[i]]+=";"),spreadsheet.style[temp[i]]+="background-color:#"+cell.s.fgColor.rgb)}for(var numColumns=spreadsheet.columns,j=0;j<=max_y;j++)for(var i=0;i<=max_x;i++)spreadsheet.data[j]||(spreadsheet.data[j]=[]),spreadsheet.data[j][i]||numColumns<i&&(spreadsheet.data[j][i]="");spreadsheets.push(spreadsheet)})),spreadsheets},oReq;(oReq=new XMLHttpRequest).open("GET",file,!0),"undefined"!=typeof Uint8Array?(oReq.responseType="arraybuffer",oReq.onload=function(e){var arraybuffer=oReq.response,data=new Uint8Array(arraybuffer),wb=XLSX.read(data,{type:"array",cellFormula:!0,cellStyles:!0});__callback(convert(wb))}):(oReq.setRequestHeader("Accept-Charset","x-user-defined"),oReq.onreadystatechange=function(){if(4==oReq.readyState&&200==oReq.status){var ff=convertResponseBodyToText(oReq.responseBody),wb=XLSX.read(ff,{type:"binary",cellFormula:!0,cellStyles:!0});__callback(convert(wb))}}),oReq.send()},jexcel.validLetter=function(text){var regex=/([\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC-\u0400-\u04FF']+)/g;return text.match(regex)?1:0},jexcel.injectArray=function(o,idx,arr){return o.slice(0,idx).concat(arr).concat(o.slice(idx))},jexcel.getColumnName=function(i){var letter="";return i>701?(letter+=String.fromCharCode(64+parseInt(i/676)),letter+=String.fromCharCode(64+parseInt(i%676/26))):i>25&&(letter+=String.fromCharCode(64+parseInt(i/26))),letter+=String.fromCharCode(65+i%26)},jexcel.getIdFromColumnName=function(id,arr){var t=/^[a-zA-Z]+/.exec(id);if(t){for(var code=0,i=0;i<t[0].length;i++)code+=parseInt(t[0].charCodeAt(i)-64)*Math.pow(26,t[0].length-1-i);--code<0&&(code=0);var number=parseInt(/[0-9]+$/.exec(id));number>0&&number--,id=1==arr?[code,number]:code+"-"+number}return id},jexcel.getColumnNameFromId=function(cellId){return Array.isArray(cellId)||(cellId=cellId.split("-")),jexcel.getColumnName(parseInt(cellId[0]))+(parseInt(cellId[1])+1)},jexcel.getElement=function(element){var jexcelSection=0,jexcelElement=0;function path(element){element.className&&element.classList.contains("jexcel_container")&&(jexcelElement=element),"THEAD"==element.tagName?jexcelSection=1:"TBODY"==element.tagName&&(jexcelSection=2),element.parentNode&&(jexcelElement||path(element.parentNode))}return path(element),[jexcelElement,jexcelSection]},jexcel.doubleDigitFormat=function(v){return 1==(v=""+v).length&&(v="0"+v),v},jexcel.createFromTable=function(el,options){if("TABLE"==el.tagName){options||(options={}),options.columns=[],options.data=[];var colgroup=el.querySelectorAll("colgroup > col");if(colgroup.length)for(var i=0;i<colgroup.length;i++){var width;if(!(width=colgroup[i].style.width))var width=colgroup[i].getAttribute("width");width&&(options.columns[i]||(options.columns[i]={}),options.columns[i].width=width)}var parseHeader=function(header){var info=header.getBoundingClientRect(),width=info.width>50?info.width:50;options.columns[i]||(options.columns[i]={}),header.getAttribute("data-celltype")?options.columns[i].type=header.getAttribute("data-celltype"):options.columns[i].type="text",options.columns[i].width=width+"px",options.columns[i].title=header.innerHTML,options.columns[i].align=header.style.textAlign||"center",(info=header.getAttribute("name"))&&(options.columns[i].name=info),(info=header.getAttribute("id"))&&(options.columns[i].id=info)},nested=[],headers=el.querySelectorAll(":scope > thead > tr"),content;if(headers.length){for(var j=0;j<headers.length-1;j++){for(var cells=[],i=0;i<headers[j].children.length;i++){var row={title:headers[j].children[i].innerText,colspan:headers[j].children[i].getAttribute("colspan")||1};cells.push(row)}nested.push(cells)}headers=headers[headers.length-1].children;for(var i=0;i<headers.length;i++)parseHeader(headers[i])}for(var rowNumber=0,mergeCells={},rows={},style={},classes={},content=el.querySelectorAll(":scope > tr, :scope > tbody > tr"),j=0;j<content.length;j++)if(options.data[rowNumber]=[],1!=options.parseTableFirstRowAsHeader||headers.length||0!=j){for(var i=0;i<content[j].children.length;i++){var value;if(value=content[j].children[i].getAttribute("data-formula"))"="!=value.substr(0,1)&&(value="="+value);else var value=content[j].children[i].innerHTML;options.data[rowNumber].push(value);var cellName=jexcel.getColumnNameFromId([i,j]),tmp=content[j].children[i].getAttribute("class");tmp&&(classes[cellName]=tmp);var mergedColspan=parseInt(content[j].children[i].getAttribute("colspan"))||0,mergedRowspan=parseInt(content[j].children[i].getAttribute("rowspan"))||0;(mergedColspan||mergedRowspan)&&(mergeCells[cellName]=[mergedColspan||1,mergedRowspan||1]),(s=content[j].children[i].style&&"none"==content[j].children[i].style.display)&&(content[j].children[i].style.display="");var s=content[j].children[i].getAttribute("style");s&&(style[cellName]=s),content[j].children[i].classList.contains("styleBold")&&(style[cellName]?style[cellName]+="; font-weight:bold;":style[cellName]="font-weight:bold;")}content[j].style&&content[j].style.height&&(rows[j]={height:content[j].style.height}),rowNumber++}else for(var i=0;i<content[j].children.length;i++)parseHeader(content[j].children[i]);if(Object.keys(nested).length>0&&(options.nestedHeaders=nested),Object.keys(style).length>0&&(options.style=style),Object.keys(mergeCells).length>0&&(options.mergeCells=mergeCells),Object.keys(rows).length>0&&(options.rows=rows),Object.keys(classes).length>0&&(options.classes=classes),(content=el.querySelectorAll("tfoot tr")).length){for(var footers=[],j=0;j<content.length;j++){for(var footer=[],i=0;i<content[j].children.length;i++)footer.push(content[j].children[i].innerText);footers.push(footer)}Object.keys(footers).length>0&&(options.footers=footers)}if(1==options.parseTableAutoCellType)for(var pattern=[],i=0;i<options.columns.length;i++){var test=!0,testCalendar=!0;pattern[i]=[];for(var j=0;j<options.data.length;j++){var value=options.data[j][i];pattern[i][value]||(pattern[i][value]=0),pattern[i][value]++,value.length>25&&(test=!1),10==value.length&&"-"==value.substr(4,1)&&"-"==value.substr(7,1)||(testCalendar=!1)}var keys=Object.keys(pattern[i]).length;testCalendar?options.columns[i].type="calendar":1==test&&keys>1&&keys<=parseInt(.1*options.data.length)&&(options.columns[i].type="dropdown",options.columns[i].source=Object.keys(pattern[i]))}return options}console.log("Element is not a table")},jexcel.helpers=(component={getCaretIndex:function(e){if(this.config.root)var d=this.config.root;else var d=window;var pos=0,s=d.getSelection();if(s&&0!==s.rangeCount){var r=s.getRangeAt(0),p=r.cloneRange();p.selectNodeContents(e),p.setEnd(r.endContainer,r.endOffset),pos=p.toString().length}return pos},invert:function(o){for(var d=[],k=Object.keys(o),i=0;i<k.length;i++)d[o[k[i]]]=k[i];return d},getColumnName:function(i){var letter="";return i>701?(letter+=String.fromCharCode(64+parseInt(i/676)),letter+=String.fromCharCode(64+parseInt(i%676/26))):i>25&&(letter+=String.fromCharCode(64+parseInt(i/26))),letter+=String.fromCharCode(65+i%26)},getColumnNameFromCoords:function(x,y){return component.getColumnName(parseInt(x))+(parseInt(y)+1)},getCoordsFromColumnName:function(columnName){var t=/^[a-zA-Z]+/.exec(columnName);if(t){for(var code=0,i=0;i<t[0].length;i++)code+=parseInt(t[0].charCodeAt(i)-64)*Math.pow(26,t[0].length-1-i);--code<0&&(code=0);var number=parseInt(/[0-9]+$/.exec(columnName))||null;return number>0&&number--,[code,number]}},createFromTable:function(){},injectArray:function(o,idx,arr){return o.slice(0,idx).concat(arr).concat(o.slice(idx))},parseCSV:function(str,delimiter){delimiter=delimiter||",";for(var col=0,row=0,num=0,data=[[]],limit=0,flag=null,inside=!1,closed=!1,i=0;i<str.length;i++)if(data[row]||(data[row]=[]),data[row][col]||(data[row][col]=""),"\r"!=str[i])if("\n"!=str[i]&&str[i]!=delimiter||0!=inside&&1!=closed&&flag){if('"'==str[i]&&(inside=!inside),null===flag){if(1==(flag=inside))continue}else if(!0===flag&&!closed&&'"'==str[i]){'"'==str[i+1]?(inside=!0,data[row][col]+=str[i],i++):closed=!0;continue}data[row][col]+=str[i]}else{if(flag=null,inside=!1,closed=!1,'"'==data[row][col][0]){var val=data[row][col].trim();'"'==val[val.length-1]&&(data[row][col]=val.substr(1,val.length-2))}"\n"==str[i]?(col=0,row++):++col>limit&&(limit=col)}for(var j=0;j<data.length;j++)for(var i=0;i<=limit;i++)void 0===data[j][i]&&(data[j][i]="");return data}},component),"undefined"!=typeof jQuery&&function($){$.fn.jspreadsheet=$.fn.jexcel=function(mixed){var spreadsheetContainer=$(this).get(0);return spreadsheetContainer.jexcel?Array.isArray(spreadsheetContainer.jexcel)?spreadsheetContainer.jexcel[mixed][arguments[1]].apply(this,Array.prototype.slice.call(arguments,2)):spreadsheetContainer.jexcel[mixed].apply(this,Array.prototype.slice.call(arguments,1)):jexcel($(this).get(0),arguments[0])}}(jQuery),jexcel}));

            
/*
	Generated By : Steps Code Generator.
	Version : 2024
	Generated On : Mon Jan 26 2026 17:13:31 GMT+0530 (India Standard Time)
	Description : Client Logic for BCSFuel Kanban. DON"T TOUCH THE BASE CODE 
*/

$(document).ready(onApplicationReady);

function onApplicationReady() {
  clCommon.showLoader('svcProgress');
  var url = "/sauth/getuser";
  clCommon.getSvc(true, url, onUser, onUserError);
}


/*
    Function is called during onload event
*/
function onUser(resp) {
  if (resp.code !== 200)
    redirect("/");


  userObj = resp.user;
  clCommon.initLanguage(userObj.realm_lang, function() {
    var url = "./common/appsvc";
    clCommon.getSvc(true, url, onAppUserInfo, onAppUserInfoError);
  });
}


/*
    Function is called during onload event
    This function invoked on error response
*/
function onUserError(resp) {
  clCommon.hideLoader('svcProgress');
  redirect("/sauth/login.html");
}


/*
    Function is called during onload event on error response
*/
function onAppUserInfo(resp) {
  var bannerMsg = document.getElementById("bannerMsg");
  clCommon.hideLoader('svcProgress');
  if (resp.code === 200) {
    if (resp.menuArr) {

      onLoad(resp.menuArr);
      bannerMsg.innerHTML = Strings.LOADING_INDEX_TEXT + ' BCSFuel';
    } else {
      bannerMsg.innerHTML = Strings.INDEX_NO_ROLES;
    }
  } else {
    s_error(Strings.GET_APP_USER_INFO_ERROR_TITLE, Strings.APP_USER_MENU_ERROR);
  }
}


function onLoad(menuArr) {
  var menus = {};
  var menuObj;

  menuArr = menuArr.sort(function(m1, m2) {
    m1Obj = JSON.parse(m1.definition);
    m2Obj = JSON.parse(m2.definition);
    var seq1 = m1Obj.sequence ? m1Obj.sequence : 0;
    var seq2 = m2Obj.sequence ? m2Obj.sequence : 0;
    return seq1 - seq2;
  });

  var redirectURL = "";
  for (var m = 0; m < menuArr.length; m++) {
    menuObj = JSON.parse(menuArr[m].definition);

    if (clCommon.isMobile() && menuObj.mobile_tools) {
      var toolsArr = menuObj.tools;
      var mobileToolsArr = menuObj.mobile_tools;

      var modToolsArr = [];
      mobileToolsArr.forEach(mToolId => {
        toolsArr.forEach(tool => {
          if (tool.id === mToolId) {
            modToolsArr.push(tool);
          }
        });
      });
      if (modToolsArr.length > 0)
        menuObj.tools = modToolsArr;
    }

    var active = (m === 0) ? true : false;
    menuObj.active = active;
    menus[menuObj.id] = menuObj;
    if (active)
      redirectURL = menuObj.tools[0].href;
  }

  window.location = redirectURL;
}


/*
    Function is called during onload event on error response
*/
function onAppUserInfoError(resp) {
  clCommon.hideLoader('svcProgress');
  s_error(Strings.GET_APP_USER_INFO_ERROR_TITLE, Strings.APP_USER_MENU_ERROR);
}


function redirect(url) {
  clCommon.hideLoader('svcProgress');
  window.location.href = url;
}
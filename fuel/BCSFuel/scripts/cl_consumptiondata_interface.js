/*
		Generated By : Steps Code Generator.
		Version : 2024
		Generated On : Sat Jan 31 2026 11:01:05 GMT+0530 (India Standard Time)
		Description : Interface Logic for BCSFuel List Details.
		WARNING : DO NOT MODIFY THE GENERATED INTERFACE METHOD NAME OR ARGUMENTS.
		Custom code can be writter here.
		Use customDtOpns object to maniuplate data table.
	*/

var mSelect,ySelect;
var filterMSelect, filterYSelect;
var previousCodeId;

if (typeof TenantFuelConsumptionInterface === 'undefined')
	TenantFuelConsumptionInterface = {};

var FuelConsumptionInterface = {
	onLoad: function() {
		//Custom code goes here

		document.querySelector("title").innerHTML = "BCS Fuel";
		document.querySelector("span").innerHTML = "BCS Fuel";
		document.querySelector("button span[data-string-key='UPDATE_FUELCONSUMPTION']").innerHTML = "Update Consumption";
		document.querySelector("button span[data-string-key='CREATE_FUELCONSUMPTION']").innerHTML = "Create Consumption";
		document.querySelector("#fuelCodeFilter option[value='all']").innerHTML = "All Fuel Code";

		clCommon.hide(document.getElementById("nav-action-tab"));
		clCommon.hide(document.getElementById("fuelConsumptionFuel_unit_idZoom"));

		convertDateToMonthYearPicker();
		mSelect = document.getElementById('record_date_monthSelect');
		ySelect = document.getElementById('record_date_yearSelect');

		createFilterMonthYearPicker();
		getAllUtilizationPromise();
		//getAllResourcePromise();

		if (TenantFuelConsumptionInterface && TenantFuelConsumptionInterface.onLoad)
			return TenantFuelConsumptionInterface.onLoad();

		return true;
	},

	onBeforeLoad: function(dataSources) {
		clCommon.disable(fuelConsumptionAvg_consumption_per_day);
		clCommon.disable(fuelConsumptionConsumed_total_value);
		clCommon.disable(fuelConsumptionUnit_price);
		clCommon.disable(fuelConsumptionConsumed_gst_value);


		var dates = getCustomFilterDates();
		dataSources.startDate = dates.startDate;
		dataSources.endDate = dates.endDate;

		common_util.setFuelCodeCookie();


		if (TenantFuelConsumptionInterface && TenantFuelConsumptionInterface.onBeforeLoad)
			return TenantFuelConsumptionInterface.onBeforeLoad();

		return dataSources;
	},

	onAfterLoad: function(dataSources) {

		clCommon.hide(fuel_code_idAddBtn);
		clCommon.hide(fuel_unit_idAddBtn);
		clCommon.hide(fuel_utilization_point_idAddBtn);

		if (formView.classList.contains("hide")) {
			if (clCommon.isMobile()) {
				clCommon.hide(filterActionsFuelConsumptionBtn);
			}
		}

		/*var codeMap = {};
		if (dataSources.getCode) {
			dataSources.getCode.forEach(function (codeObj) {
				codeMap[codeObj.id] = codeObj.code;
			});
		}

		var unitMap = {};
		if (dataSources.getUnit) {
			dataSources.getUnit.forEach(function (unitObj) {
				unitMap[unitObj.id] = unitObj.unit;
			});
		}

		var resourceMap = {};
		if (dataSources.getAllResource) {
			dataSources.getAllResource.forEach(function (resourceObj) {
				resourceMap[resourceObj._sid] = resourceObj.name;
			});
		}

		if (dataSources.getUtilizationPoint) {
			dataSources.getUtilizationPoint.forEach(function (upObj) {

				var code  = codeMap[upObj.fuel_code_id] || '';
				var name  = resourceMap[upObj.utilization_point] || '';
				var unit  = unitMap[upObj.fuel_unit_id] || '';

				var parts = [];
				if (code) parts.push(code);
				if (name) parts.push(name);
				if (unit) parts.push(unit);

				upObj.utilization_point_name = parts.join(' - ');
			});
		}


		if(dataSources.getUtilizationPoint){
			for (var utilIdx = 0; utilIdx < dataSources.getUtilizationPoint.length; utilIdx++) {
				var utilObj = dataSources.getUtilizationPoint[utilIdx];

				for (var resourceIdx = 0; resourceIdx < dataSources.getAllResource.length; resourceIdx++) {
					var resourceObj = dataSources.getAllResource[resourceIdx];

					if (utilObj.utilization_point === resourceObj._sid) {
						utilObj.utilization_point_name = resourceObj.name;

					}

				}
			}
		}*/

		if(dataSources.getUtilizationPoint){
			for (var utilIdx = 0; utilIdx < dataSources.getUtilizationPoint.length; utilIdx++) {
				var utilObj = dataSources.getUtilizationPoint[utilIdx];

				for (var resourceIdx = 0; resourceIdx < dataSources.getAllUtilizationWithoutLimit.length; resourceIdx++) {
					var resourceObj = dataSources.getAllUtilizationWithoutLimit[resourceIdx];

					if (utilObj.utilization_point === resourceObj._sid) {
						utilObj.utilization_point_name = resourceObj.resources_short_name;
					}

				}
			}
		}




		if (TenantFuelConsumptionInterface && TenantFuelConsumptionInterface.onAfterLoad)
			return TenantFuelConsumptionInterface.onAfterLoad(dataSources);

		return dataSources;
	},

	onBeforeData: function(params, dataSources) {

		var allOkFlg = true;
		//var dates = getDates();
		var dates = getCustomFilterDates();

		dataSources.startDate = dates.startDate;
		dataSources.endDate = dates.endDate;

		if(params && params.length >= 3) {
			params[0] = dates.startDate;
			params[1] = dates.endDate;
		}

		if (dates == null) {
			if (!errFlg) {
				s_error(Strings.DATE_ERROR_TITLE, Strings.VALID_DATE_ERROR, dlgOptions);
				errFlg = true;
			}
			return false;
		}
		if (dates.startDate > dates.endDate) {
			if (!errFlg) {
				s_error(Strings.DATE_ERROR_TITLE, Strings.START_DATE_GREATER_THAN_END_DATE_ERROR, dlgOptions);
				errFlg = true;
			}

			return false;
		}

		//Custom code goes here



		if (TenantFuelConsumptionInterface && TenantFuelConsumptionInterface.onBeforeData)
			return TenantFuelConsumptionInterface.onBeforeData(params, dataSources);

		return true;
	},

	onAfterData: function(isSuccessful, dataArr, dataSources) {
		//custom code goes here

		if (TenantFuelConsumptionInterface && TenantFuelConsumptionInterface.onAfterData)
			return TenantFuelConsumptionInterface.onAfterData(isSuccessful, dataArr, dataSources);

		return dataArr;
	},

	renderData: function(value, type, dtObj, meta) {
		//custom code goes here

		var rVal;
		switch(meta.col){
			case 0 :
				if(value){
					rVal = this._getFormattedDate(value);
				}else{
					rVal = Strings.NA_STRING;
				}
				break;

			case 1 :
				rVal = this._getCodeName(value);
				break;

			case 2 :
				rVal = this._getResourcesName(value);
				break;

			case 3 :
				var decimalDigits = 3;
				var numberFormatForAmount = decimalDigits !== null ? new Intl.NumberFormat(localeCode, {
					style: "decimal",
					minimumFractionDigits: decimalDigits,
					maximumFractionDigits: decimalDigits
				}) : numberFormat;
				rVal = `<span style="display:inline-block; text-align:right; width:100%;">${numberFormatForAmount.format(dtObj.consumed_qty)}</span>`;

				break;

			case 4 :
				var decimalDigits = 3;
				var numberFormatForAmount = decimalDigits !== null ? new Intl.NumberFormat(localeCode, {
					style: "decimal",
					minimumFractionDigits: decimalDigits,
					maximumFractionDigits: decimalDigits
				}) : numberFormat;
				rVal = `<span style="display:inline-block; text-align:right; width:100%;">${numberFormatForAmount.format(dtObj.avg_consumption_per_day)}</span>`;

				break;


			case 5:
				rVal = `<span style="display:inline-block; text-align:right; width:100%;">${currencyFormat.format(value)}</span>`;
				break;


		}

		if (TenantFuelConsumptionInterface && TenantFuelConsumptionInterface.renderData)
			return TenantFuelConsumptionInterface.renderData(value, type, dtObj, meta);

		return rVal;
	},

	onBeforeCreate: function(dataObj, dataSources) {
		//custom code here
		if(mSelect && ySelect) {
			var year = parseInt(ySelect.value, 10);
			var month = parseInt(mSelect.value, 10);

			dataObj.record_date = Date.UTC(year, month, 1);
		}///

		if (dataObj && dataObj.remarks) {
			var value = dataObj.remarks;

			if (value.length > 100) {
				s_info(Strings.ERROR, Strings.INVALID_REMARKS_LENGTH, dlgOptions);
				return false;
			}

			var alphaNumericRegex = /^[a-zA-Z0-9\s]+$/;
			if (!alphaNumericRegex.test(value)) {
				s_info(Strings.ERROR, Strings.DESCRIPTION_ALPHANUMERIC_ERROR, dlgOptions);
				return false;
			}
		}

		if (dataObj && dataObj.fuel_utilization_point_id) {
			for(var idx = 0; idx < dataSources.getUtilizationPoint.length; idx++){
				if(dataObj.fuel_utilization_point_id == dataSources.getUtilizationPoint[idx].id && /-\s*inactive$/i.test(dataSources.getUtilizationPoint[idx].utilization_point_name)){
					s_info(Strings.ERROR, Strings.INACTIVE_UTILIZATION_POINT, dlgOptions);
					return false;
				}
			}
		}


		if (TenantFuelConsumptionInterface && TenantFuelConsumptionInterface.onBeforeCreate)
			return TenantFuelConsumptionInterface.onBeforeCreate(dataObj, dataSources);

		return dataObj;
	},

	onAfterCreate: function(isSuccessful, dataObj, dataSources) {
		//Custom code here
		if(dataObj.err_code && dataObj.err_code === 409){
			clCommon.hideLoader("createProgress");
			clCommon.enable(createFuelConsumptionBtn);
			s_info(Strings.FUELCONSUMPTION_ERROR_TITLE, Strings.DUPLICATE_CONSUMPTION_ON_SAMEMONTH, dlgOptions);
			return false;
		}


		if (TenantFuelConsumptionInterface && TenantFuelConsumptionInterface.onAfterCreate)
			return TenantFuelConsumptionInterface.onAfterCreate(isSuccessful, dataObj, dataSources);

		return dataObj;
	},

	onBeforeUpdate: function(dataObj, dataSources) {
		//custom code here

		if(mSelect && ySelect) {
			var year = parseInt(ySelect.value, 10);
			var month = parseInt(mSelect.value, 10);

			dataObj.record_date = Date.UTC(year, month, 1);
		}

		if (dataObj && dataObj.remarks) {
			var value = dataObj.remarks;

			if (value.length > 100) {
				s_info(Strings.ERROR, Strings.INVALID_REMARKS_LENGTH, dlgOptions);
				return false;
			}

			var alphaNumericRegex = /^[a-zA-Z0-9\s]+$/;
			if (!alphaNumericRegex.test(value)) {
				s_info(Strings.ERROR, Strings.DESCRIPTION_ALPHANUMERIC_ERROR, dlgOptions);
				return false;
			}
		}

		if (dataObj && dataObj.fuel_utilization_point_id) {
			for(var idx = 0; idx < dataSources.getUtilizationPoint.length; idx++){
				if(dataObj.fuel_utilization_point_id == dataSources.getUtilizationPoint[idx].id && /-\s*inactive$/i.test(dataSources.getUtilizationPoint[idx].utilization_point_name)){
					s_info(Strings.ERROR, Strings.INACTIVE_UTILIZATION_POINT, dlgOptions);
					return false;
				}
			}
		}


		if (TenantFuelConsumptionInterface && TenantFuelConsumptionInterface.onBeforeUpdate)
			return TenantFuelConsumptionInterface.onBeforeUpdate(dataObj, dataSources);

		return dataObj;
	},

	onAfterUpdate: function(isSuccessful, dataObj, dataSources) {
		//Custom code here
		if(dataObj.err_code && dataObj.err_code === 409){
			clCommon.hideLoader("updateProgress");
			clCommon.enable(editFuelConsumptionBtn);
			s_info(Strings.FUELCONSUMPTION_ERROR_TITLE, Strings.DUPLICATE_CONSUMPTION_ON_SAMEMONTH, dlgOptions);
			return false;
		}


		if (TenantFuelConsumptionInterface && TenantFuelConsumptionInterface.onAfterUpdate)
			return TenantFuelConsumptionInterface.onAfterUpdate(isSuccessful, dataObj, dataSources);

		return dataObj;
	},

	onBeforeDelete: function(dataObj, dataSources) {
		//custom code here


		if (TenantFuelConsumptionInterface && TenantFuelConsumptionInterface.onBeforeDelete)
			return TenantFuelConsumptionInterface.onBeforeDelete(dataObj, dataSources);

		return dataObj;
	},

	onAfterDelete: function(isSuccessful, resultObj, dataSources) {
		//Custom code here


		if (TenantFuelConsumptionInterface && TenantFuelConsumptionInterface.onAfterDelete)
			return TenantFuelConsumptionInterface.onAfterDelete(isSuccessful, resultObj, dataSources);

		return resultObj;
	},

	onChangeFilter: function(changedFilter) {
		//Custom code here
		var el = changedFilter.target ? changedFilter.target : changedFilter;
		if (el.id === 'filter_monthSelect' || el.id === 'filter_yearSelect') {
			if (el.options && el.options[el.selectedIndex]) {
				el.setAttribute("title", el.options[el.selectedIndex].text);
			}

			if (filterMSelect && filterYSelect) {
				var saveObj = {
					month: filterMSelect.value,
					year: filterYSelect.value
				};
				clCommon.setCookie("record_date", JSON.stringify(saveObj), 10);
			}
		}

		if(el.id === 'fuelCodeFilter'){
			if(fuelCodeFilter){
				var saveObj = {
					fuelCode : fuelCodeFilter.value
				};
				clCommon.setCookie("fuelCode", JSON.stringify(saveObj), 10);
			}
		}

		if (TenantFuelConsumptionInterface && TenantFuelConsumptionInterface.onChangeFilter)
			return TenantFuelConsumptionInterface.onChangeFilter(changedFilter);

		return true;
	},

	onSearchChangeFilter: function(searchedFilter) {

		if (TenantFuelConsumptionInterface && TenantFuelConsumptionInterface.onSearchChangeFilter)
			return TenantFuelConsumptionInterface.onSearchChangeFilter(searchedFilter);

		return true;
	},

	onRowItemClick: function(rowData) {
		//Custom code here

		if(dataSources.getCode){
			for (var codeIdx = 0; codeIdx < dataSources.getCode.length; codeIdx++) {
				if (rowData.fuel_code_id === dataSources.getCode[codeIdx].id) {
					rowData.fuel_code_name = dataSources.getCode[codeIdx].code;
				}
			}
		}

		if (TenantFuelConsumptionInterface && TenantFuelConsumptionInterface.onRowItemClick)
			return TenantFuelConsumptionInterface.onRowItemClick(rowData);

		return rowData;
	},

	onDisplayForm: function(rowData) {
		//Custom code here
		if(rowData.fuel_code_id){
			previousCodeId = rowData.fuel_code_id;
		} else {
			previousCodeId = "";
		}


		if(rowData.record_date){
			var consumptionDate = new Date(rowData.record_date);
			var consumptionMonthIndex = consumptionDate.getMonth();
			var consumptionYear = consumptionDate.getFullYear();

			ySelect.value = consumptionYear;
			mSelect.value = consumptionMonthIndex;
		}

		//set title on form 
		if(rowData.record_date) {
			var dt = new Date(rowData.record_date);

			if(mSelect && ySelect) {
				mSelect.value = dt.getUTCMonth();
				ySelect.value = dt.getUTCFullYear();

				var selectedMonthOption = mSelect.options[mSelect.selectedIndex];
				var monthText = selectedMonthOption ? selectedMonthOption.text : "";

				var selectedYearOption = ySelect.options[ySelect.selectedIndex];
				var yearText = selectedYearOption ? selectedYearOption.text : "";

				mSelect.setAttribute("title", monthText);
				ySelect.setAttribute("title", yearText);
			}
		}

		if (TenantFuelConsumptionInterface && TenantFuelConsumptionInterface.onDisplayForm)
			return TenantFuelConsumptionInterface.onDisplayForm(rowData);

		return rowData;
	},

	onClearForm: function(defaultObj, dataSources) {
		//Custom code here
		previousCodeId = "";

		var consumptionDate = new Date();
		var consumptionMonthIndex = consumptionDate.getMonth();
		var consumptionYear = consumptionDate.getFullYear();

		ySelect.value = consumptionYear;
		mSelect.value = consumptionMonthIndex;

		if (TenantFuelConsumptionInterface && TenantFuelConsumptionInterface.onClearForm)
			return TenantFuelConsumptionInterface.onClearForm(defaultObj, dataSources);

		return defaultObj;
	},

	onFieldFocus: function(focusedField, dataSources) {

		if (TenantFuelConsumptionInterface && TenantFuelConsumptionInterface.onFieldFocus)
			return TenantFuelConsumptionInterface.onFieldFocus(focusedField, dataSources);

	},


	onFieldChange: function(changedField, dataSources) {

		if (changedField.id === "fuelConsumptionFuel_code_id") {
			var selectedCodeId = fuelConsumptionFuel_code_id.getAttribute("fuel_code_id");

			if(previousCodeId && previousCodeId !== selectedCodeId){
				fuelConsumptionFuel_utilization_point_id.value = "";
				fuelConsumptionFuel_utilization_point_id.setAttribute("fuel_utilization_point_id", "");
			}

			previousCodeId = selectedCodeId;


			// Set Unit
			if (selectedCodeId && dataSources.getCode) {
				var codeObj = dataSources.getCode.find(c => c.id === selectedCodeId);
				if (codeObj && codeObj.unit) {
					var unitObj = dataSources.getUnit.find(u => u.id === codeObj.unit);
					if (unitObj) {
						fuelConsumptionFuel_unit_id.value = unitObj.unit;
						fuelConsumptionFuel_unit_id.setAttribute("fuel_unit_id", unitObj.id);
					}
				}
			}
		}

		//calculate gst
		if (changedField.id === "fuelConsumptionConsumed_value" || changedField.id === "fuelConsumptionFuel_code_id") {
			var selectedCodeId = fuelConsumptionFuel_code_id.getAttribute("Fuel_code_id");
			var fuelRate = Number(fuelConsumptionConsumed_value.getAttribute("val")) || 0;

			if(!selectedCodeId){
				fuelConsumptionConsumed_gst_value.setAttribute("val", 0);
				fuelConsumptionConsumed_gst_value.value = currencyFormat.format(0);
			}


			if (selectedCodeId && dataSources.getCode) {
				var codeObj = dataSources.getCode.find(c => c.id === selectedCodeId);
				var gstRate = Number(codeObj.gst_rate);

				if(gstRate){
					var totalGst = (fuelRate * gstRate) / 100;
					fuelConsumptionConsumed_gst_value.setAttribute("val", totalGst);
					fuelConsumptionConsumed_gst_value.value = currencyFormat.format(totalGst);
				}else{
					fuelConsumptionConsumed_gst_value.setAttribute("val", 0);
					fuelConsumptionConsumed_gst_value.value = currencyFormat.format(0);
				}
			}
		}

		//calculate Avg consumption per day
		if (changedField.id === "fuelConsumptionConsumed_qty" || changedField.id === "record_date_monthSelect" || changedField.id === "record_date_yearSelect"  ) {

			var qty = Number(fuelConsumptionConsumed_qty.getAttribute("val")) || 0;
			var avg  = Number(fuelConsumptionAvg_consumption_per_day.getAttribute("val")) || 0;

			var selectedMonthDays = getSelectedMonthDays();

			var avgPerDay = qty / selectedMonthDays;

			var decimalDigits = 3;
			var numberFormatForAmount = decimalDigits !== null ? new Intl.NumberFormat(localeCode, {
				style: "decimal",
				minimumFractionDigits: decimalDigits,
				maximumFractionDigits: decimalDigits
			}) : numberFormat;

			//var formattedValue = numberFormatForAmount.format(avgPerDay);


			fuelConsumptionAvg_consumption_per_day.setAttribute("val",avgPerDay);
			fuelConsumptionAvg_consumption_per_day.value = numberFormatForAmount.format(avgPerDay);
		}

		// Calculate fuel total value (Fuel Value + GST)
		if (changedField.id === "fuelConsumptionConsumed_value" || changedField.id === "fuelConsumptionConsumed_gst_value" || changedField.id === "fuelConsumptionFuel_code_id") {
			var fuelValue = Number(fuelConsumptionConsumed_value.getAttribute("val")) || 0;
			var fuelGstValue = Number(fuelConsumptionConsumed_gst_value.getAttribute("val")) || 0;

			var totalValue = fuelValue + fuelGstValue;

			fuelConsumptionConsumed_total_value.setAttribute("val", totalValue);
			fuelConsumptionConsumed_total_value.value = currencyFormat.format(totalValue);
		}

		// Unit price depends on Quantity + Total Value
		if (changedField.id === "fuelConsumptionConsumed_qty" || changedField.id === "fuelConsumptionConsumed_value" || changedField.id === "fuelConsumptionConsumed_gst_value" || changedField.id === "fuelConsumptionFuel_code_id") {
			var qty = Number(fuelConsumptionConsumed_qty.getAttribute("val")) || 0;
			var totalFuelVal = Number(fuelConsumptionConsumed_total_value.getAttribute("val")) || 0;

			// Unit Price = Total Value / Quantity
			var unitPrice = (qty > 0 && totalFuelVal > 0) ? (totalFuelVal / qty) : 0;

			fuelConsumptionUnit_price.setAttribute("val", unitPrice);
			fuelConsumptionUnit_price.value = currencyFormat.format(unitPrice);
		}

		if (TenantFuelConsumptionInterface && TenantFuelConsumptionInterface.onFieldChange)
			return TenantFuelConsumptionInterface.onFieldChange(changedField, dataSources);

	},

	onToolBarBtnClick: function(changedField, dataSources) {

		if (TenantFuelConsumptionInterface && TenantFuelConsumptionInterface.onToolBarBtnClick)
			return TenantFuelConsumptionInterface.onToolBarBtnClick(changedField, dataSources);

	},

	onLookupAddBtnClick: function(attribute, changedField, dataSources) {

		if (TenantFuelConsumptionInterface && TenantFuelConsumptionInterface.onLookupAddBtnClick)
			return TenantFuelConsumptionInterface.onLookupAddBtnClick(attribute, changedField, dataSources);

	},


	onLookUpData: function(attribute, dataSources) {

		switch (attribute) {

			case "fuel_utilization_point_id":
				var utilArr = [];
				var utilFlg = false;
				var pushState = (typeof e !== 'undefined' && e !== false);
				var selectedCodeId = fuelConsumptionFuel_code_id.getAttribute("Fuel_code_id");


				var objective = {
					"id": fuelConsumptionFuel_utilization_point_id.getAttribute("Fuel_utilization_point_id")
				};


				var utilPoints = dataSources.getUtilizationPoint;
				//var resources = dataSources.getAllResource;

				for (var uIdx = 0; uIdx < utilPoints.length; uIdx++) {
					var uPoint = utilPoints[uIdx];

					if (selectedCodeId && uPoint.fuel_code_id !== selectedCodeId) {
						continue;
					}

					if (uPoint.utilization_point) {
						var checked = "";
						if (objective.id && objective.id == uPoint.id) {
							checked = "checked";
							utilFlg = true;
						} else if (rowData && rowData.fuel_utilization_point_id == uPoint.id && !utilFlg) {
							checked = "checked";
						}

						utilArr.push({
							"fuel_utilization_point_idName": '<label for="' + uPoint.id + '">' + uPoint.utilization_point_name + '</label>',
							"radio": '<input type="radio" name="fuel_utilization_point_idName" fuel_utilization_point_idId="' + uPoint.id + '" fuel_utilization_point_idName="' + JSON.stringify(uPoint).replaceAll('"', '$' + 'DQUOTE' + '$') + '" ' + checked + '>'
						});
					}
				}


				fuel_utilization_point_idTable.clear().draw();
				fuel_utilization_point_idTable.rows.add(utilArr).draw();

				if (clCommon.isMobile() && pushState) {
					window.history.pushState('fuel_utilization_point_idForm', null, '#fuel_utilization_point_idsForm');
					clCommon.hide(contentView);
				}

				return false;
		}


		if (TenantFuelConsumptionInterface && TenantFuelConsumptionInterface.onLookUpData)
			return TenantFuelConsumptionInterface.onLookUpData(attribute, dataSources);

		return true;

	},


	onChangeOfActionSelect: function(changedAction, dataSources) {

		switch (changedAction.value) {}

		if (TenantFuelConsumptionInterface && TenantFuelConsumptionInterface.onChangeOfActionSelect)
			return TenantFuelConsumptionInterface.onChangeOfActionSelect(changedAction, dataSources);

		return true;
	},
	_getResourcesName: function (value) {
		var rVal = Strings.NA_STRING;

		for (var utilIdx = 0; utilIdx < dataSources.getUtilizationPoint.length; utilIdx++) {
			var utilObj = dataSources.getUtilizationPoint[utilIdx];

			if (value === utilObj.id) {
				for (var resourceIdx = 0; resourceIdx < dataSources.getAllUtilizationWithoutLimit.length; resourceIdx++) {
					var resourceObj = dataSources.getAllUtilizationWithoutLimit[resourceIdx];

					if (utilObj.utilization_point === resourceObj._sid) {
						rVal = resourceObj.resources_short_name;
						return rVal;
					}
				}
			}
		}

		return rVal;
	},

	_getFormattedDate: function (value) {
		if (!value) return '';
		const date = new Date(value);
		const localeStr = (userObj && userObj.realm_locale && userObj.realm_locale.code)? userObj.realm_locale.code: 'en-US';
		const month = date.toLocaleString(localeStr, { month: 'short' });
		const year = date.getUTCFullYear(); 
		return month + ' / ' + year;
	},

	_getCodeName: function(value){
		for(var codeIdx = 0; codeIdx < dataSources.getCode.length; codeIdx++){
			var codeObj = dataSources.getCode[codeIdx];
			if(value == codeObj.id){
				rVal = codeObj.code;
				break;
			}else{
				rVal = Strings.NA_STRING;

			}
		}
		return rVal;
	},

};

function getSelectedMonthDays() {
	var monthVal = parseInt(mSelect.value, 10);
	var yearVal = parseInt(ySelect.value, 10);

	// Fallback if parsing fails
	if (isNaN(monthVal) || isNaN(yearVal)) {
		var now = new Date();
		monthVal = now.getMonth();
		yearVal = now.getFullYear();
	}

	return new Date(yearVal, monthVal + 1, 0).getDate();
}


function getAllUtilizationPromise() {
	Service.getAllUtilizationWithoutLimit(function (respObj) {
		if (respObj && respObj.code === 200) {
			var utilizationArr = respObj.data || [];
			dataSources = dataSources || {};

			// Store raw data
			dataSources.getAllUtilizationWithoutLimit = utilizationArr;

			if (dataSources.getAllUtilizationWithoutLimit.length > 1) {
				dataSources.getAllUtilizationWithoutLimit = clCommon.sort(dataSources.getAllUtilizationWithoutLimit, "resources_short_name");
			}

			dataSources.utilizationShortName = [];
			for (var t = 0; t < dataSources.getAllUtilizationWithoutLimit.length; t++) {

				if(dataSources.getAllUtilizationWithoutLimit[t].isactive == false){
					dataSources.getAllUtilizationWithoutLimit[t].resources_short_name += " - Inactive"
				}

				try {
					dataSources.getAllUtilizationWithoutLimit[t].resources_short_name = scrypto.decrypt(dataSources.getAllUtilizationWithoutLimit[t].resources_short_name);
				} catch (e) {
					dataSources.getAllUtilizationWithoutLimit[t].resources_short_name = dataSources.getAllUtilizationWithoutLimit[t].resources_short_name;
				}
			}

		} 
	});
}



function getAllResourcePromise() {
	return Service.getAllResource(function (respObj) {
		if (respObj && respObj.code === 200) {
			var resourcesArr = respObj.data || [];
			dataSources = dataSources || {};

			// Store raw data
			if (!dataSources.getAllResource) {
				dataSources.getAllResource = resourcesArr;
			}

			// Sort alphabetically by name
			if (dataSources.getAllResource && dataSources.getAllResource.length > 1) {
				dataSources.getAllResource = clCommon.sort(
					dataSources.getAllResource,
					"name"
				);
			}

			// Populate dropdown
			for (var t = 0; t < dataSources.getAllResource.length; t++) {
				try {
					dataSources.getAllResource[t].name =
						scrypto.decrypt(dataSources.getAllResource[t].name);
				} catch (e) {
					// keep original name if decrypt fails
					dataSources.getAllResource[t].name =
						dataSources.getAllResource[t].name;
				}
			}
		}
	});
}




function getCustomFilterDates() {
	var now = new Date();
	var month = now.getMonth();
	var year = now.getFullYear();

	// Check elements
	if(filterMSelect && filterYSelect) {
		month = parseInt(filterMSelect.value);
		year = parseInt(filterYSelect.value);
	} else {
		// Elements not ready, check Cookie
		var cookieVal = clCommon.getCookie("record_date");
		if(cookieVal) {
			try {
				var cObj = JSON.parse(cookieVal);
				month = parseInt(cObj.month);
				year = parseInt(cObj.year);
			} catch(e) { console.log(e); }
		}
	}


	var startDate = Date.UTC(year, month, 1, 0, 0, 0, 0);

	var endDate = Date.UTC(year, month + 1, 0, 23, 59, 59, 999);

	return {
		startDate: startDate,
		endDate: endDate
	};
}


function convertDateToMonthYearPicker() {

	if (document.getElementById('record_date_monthSelect')) {
		return;
	}
	var fuelUnitContainer = document.querySelector('div[field="fuel_unit_id"]');
	var formGroupContainer; 

	if (fuelUnitContainer) {
		var newCol = document.createElement('div');
		newCol.className = 'col-sm-12';
		newCol.setAttribute('field', 'record_date');
		newCol.setAttribute('data-expand-class', 'col-lg-3 col-md-4');
		newCol.setAttribute('data-normal-class', 'col-sm-12');

		// Create the Form Group
		formGroupContainer = document.createElement('div');
		formGroupContainer.id = 'fuelConsumptionFuel_record_dateForTour';
		formGroupContainer.className = 'form-group mb-3';

		// Create Label
		var label = document.createElement('label');
		label.className = 'form-label';
		label.setAttribute('data-string-key', 'LABEL_RECORD_DATE');
		label.innerHTML = Strings.DATELABEL +'<sup>*</sup>';

		// Append Label to Group
		formGroupContainer.appendChild(label);

		// Append Group to Column
		newCol.appendChild(formGroupContainer);
		fuelUnitContainer.parentNode.insertBefore(newCol, fuelUnitContainer.nextSibling);
	}

	var wrapper = document.createElement('div');
	wrapper.className = 'd-flex'; 

	// Create Month Select
	var monthSelect = document.createElement('select');
	monthSelect.id = 'record_date_monthSelect';
	monthSelect.className = 'form-select';
	monthSelect.style.marginRight = '10px';

	var months = [
		"Jan", "Feb", "Mar", "Apr", "May", "Jun", 
		"Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
	];

	var currentDate = new Date();
	var currentMonthIndex = currentDate.getMonth();
	var currentYear = currentDate.getFullYear();

	months.forEach(function(month, index) {
		var option = document.createElement('option');
		option.value = index; 
		option.innerText = month;
		if (index === currentMonthIndex) {
			//option.selected = true;
		}
		monthSelect.appendChild(option);
	});

	// Create Year Select
	var yearSelect = document.createElement('select');
	yearSelect.id = 'record_date_yearSelect';
	yearSelect.className = 'form-select';

	// Populate Year Options (Current -10 to +10)
	var startYear = currentYear - 10;
	var endYear = currentYear + 10;

	for (var i = startYear; i <= endYear; i++) {
		var option = document.createElement('option');
		option.value = i;
		option.innerText = i;
		if (i === currentYear) {
			//option.selected = true;
		}
		yearSelect.appendChild(option);
	}

	wrapper.appendChild(monthSelect);
	wrapper.appendChild(yearSelect);

	formGroupContainer.appendChild(wrapper);

	monthSelect.addEventListener('change', onFieldChange);
	monthSelect.addEventListener('focus', onFieldFocus);
	monthSelect.addEventListener('blur', onFieldChange);

	yearSelect.addEventListener('change', onFieldChange);
	yearSelect.addEventListener('focus', onFieldFocus);
	yearSelect.addEventListener('blur', onFieldChange);
}

function createFilterMonthYearPicker() {

	if (document.getElementById('custom_filter_wrapper')) return;


	var container = document.getElementById('dateFilterContainer');

	if (!container) {
		var fuelCodeFilter = document.getElementById('fuelCodeFilter');

		if(fuelCodeFilter) {
			var fuelCodeContainer = fuelCodeFilter.closest('.form-group') || fuelCodeFilter.parentNode;

			// Create a new container for the Date Picker
			container = document.createElement('div');
			container.id = 'dateFilterContainer';
			container.className = 'form-group mb-3'; 

			// Insert BEFORE the Fuel code Container 
			if(fuelCodeContainer && fuelCodeContainer.parentNode) {
				fuelCodeContainer.parentNode.insertBefore(container, fuelCodeContainer);
			}
		} 
		else {
			// Fallback: Append to the main filter row if Fuel Code filter is missing
			var filterRow = document.getElementById('selectFilters');
			if(filterRow) {
				container = document.createElement('div');
				container.id = 'dateFilterContainer';
				container.className = 'form-group mb-3';
				filterRow.insertBefore(container, filterRow.firstChild);
			} else {
				return;
			}
		}
	}

	// Create Wrapper for Dropdowns
	var wrapper = document.createElement('div');
	wrapper.id = 'custom_filter_wrapper';
	wrapper.className = 'd-flex';

	// Create Month Select
	filterMSelect = document.createElement('select');
	filterMSelect.id = 'filter_monthSelect';
	filterMSelect.className = 'form-select';
	filterMSelect.style.marginRight = '10px';

	var months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
	var now = new Date();

	// Check Cookie
	var cookieVal = clCommon.getCookie("record_date");
	var storedMonth = now.getMonth();
	var storedYear = now.getFullYear();

	if(cookieVal) {
		try {
			var cObj = JSON.parse(cookieVal);
			storedMonth = parseInt(cObj.month);
			storedYear = parseInt(cObj.year);
		} catch(e) { console.error(e); }
	}

	// Populate Month
	months.forEach(function(m, i) {
		var opt = document.createElement('option');
		opt.value = i;
		opt.text = m;
		if(i === storedMonth) opt.selected = true;
		filterMSelect.appendChild(opt);
	});

	//Create Year Select
	filterYSelect = document.createElement('select');
	filterYSelect.id = 'filter_yearSelect';
	filterYSelect.className = 'form-select';

	// Populate Year
	for(var i = now.getFullYear() - 10; i <= now.getFullYear() + 10; i++) {
		var opt = document.createElement('option');
		opt.value = i;
		opt.text = i;
		if(i === storedYear) opt.selected = true;
		filterYSelect.appendChild(opt);
	}

	// Initial Title Setup
	if(filterMSelect.options[filterMSelect.selectedIndex]) 
		filterMSelect.setAttribute("title", filterMSelect.options[filterMSelect.selectedIndex].text);
	if(filterYSelect.options[filterYSelect.selectedIndex]) 
		filterYSelect.setAttribute("title", filterYSelect.options[filterYSelect.selectedIndex].text);


	filterMSelect.addEventListener('change', onChangeOfFilter);
	filterYSelect.addEventListener('change', onChangeOfFilter);


	// Append to DOM
	wrapper.appendChild(filterMSelect);
	wrapper.appendChild(filterYSelect);
	container.appendChild(wrapper);
}
